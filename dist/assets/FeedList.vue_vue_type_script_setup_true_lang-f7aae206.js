import{o as a,h as c,b as i,d as L,f,c as x,g as A,r as M,t as u,n as I,a as k,j as m,w,m as P,q as S,N as z,v as F,p as B,F as V,i as H,B as U}from"./index-da8da68e.js";import{u as j}from"./useResource-a9ab2bb4.js";import{u as D}from"./useResourceRelations-a8b5716f.js";const q=l=>{if(!l||l==="")return[];const t=l.replace(/\?/g,"?.").split(".");let o=0;const n=[];for(;o<t.length;){let s=0,h=[];if(t[o].length>=270)n.push(t[o].replace("/?./g","?")),o++;else{for(;o<t.length&&s+t[o].length<270;)h.push(t[o]),s+=t[o].length,o++;n.push(h.join(". ").replace("/?./g","?"))}}return n},E=l=>l?l.split(`
`).map(o=>q(o)).flat():[],R={splitTextForPanel:E};function O(l,t){return a(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function G(l,t){return a(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})])}function J(l,t){return a(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}const K=["src"],Q={key:1,class:"bg-white h-full text-center flex items-center justify-center"},W={class:"text-2xl text-black"},X={class:"text-lg text-bold mt-2"},Y={class:"text-bold mb-2"},Z={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},ee={key:1},te={key:1},re=L({__name:"FeedCardTextInterface",props:{interaction:{}},setup(l){const t=l,o=r=>{if(r>0&&r<=p.value.length){const e=p.value[r-1];return{text:e.replace(/#/g,""),header:r===1?"Commentaire : ":null,class:{"font-black":e.charAt(0)==="#","bg-gray-700":!0}}}else{const e=y.value[r-p.value.length-1];return{text:e?e.replace(/#/g,""):"",header:r===p.value.length+1?"Contenu : ":null,class:{"font-black":e&&e.charAt(0)==="#","bg-slate-700":!0}}}},n=f(0),s=()=>{n.value=(n.value+1)%d.value},h=()=>{n.value===0?n.value=d.value-1:n.value=(n.value-1)%d.value},v=x(()=>`${n.value+1}/${d.value}`),d=x(()=>p.value.length+y.value.length+1),y=x(()=>R.splitTextForPanel(t.interaction.resource.content)),p=x(()=>R.splitTextForPanel(t.interaction.context_comment)),C=()=>{if(t.interaction.interaction_type!="inpt"&&t.interaction.resource.image_url!==""){const r=g.value.offsetHeight;g.value.style.height=`${r}px`}},{getAuthorInteractionForResource:T}=j(),_=f(null),g=f(null);return A(async()=>{(t.interaction.interaction_type!="inpt"&&t.interaction.resource.image_url===""||t.interaction.resource.image_url===null)&&(n.value=1);const r=await T(t.interaction.resource.id);r&&(r.resource=t.interaction.resource,r.user_id=r.interaction_user_id,_.value=r)}),(r,e)=>{const b=M("router-link");return r.interaction.interaction_type!="inpt"&&r.interaction.interaction_type!="bibl"?(a(),c("div",{key:0,class:"overflow-auto relative w-full md:h-4/5 h-full min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:g},[n.value==0&&r.interaction.resource.image_url!==""?(a(),c("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:r.interaction.resource.image_url,onLoad:C},null,40,K)):n.value==0?(a(),c("div",Q,[i("div",null,[i("div",W,u(r.interaction.resource.title),1),i("div",X,u(r.interaction.resource.subtitle),1)])])):(a(),c("div",{key:2,class:I(["h-full overflow-scroll p-1 pb-16 border flex items-center justify-center",o(n.value).class])},[i("div",{class:I([o(n.value).class,"text-center text-sm my-auto text-white"])},[i("div",null,[i("div",Y,u(o(n.value).header),1),i("div",null,u(o(n.value).text),1)])],2)],2)),i("div",Z,u(v.value),1),i("div",{class:"absolute h-full w-full left-0 top-0 flex"},[i("div",{class:"w-1/2 h-full",onClick:h}),i("div",{class:"w-1/2 h-full",onClick:s})])],512)):(a(),c("div",ee,[_.value?(a(),k(N,{key:0,interaction:_.value,class:"mx-1.5 mb-0.5 h-96 border-1 border border-slate-600 rounded"},null,8,["interaction"])):(a(),c("div",te,[m(b,{to:"/resources/"+r.interaction.resource.id},{default:w(()=>[P(u(r.interaction.resource.title),1)]),_:1},8,["to"])]))]))}}}),oe={class:"flex flex-col py-1.5 overflow-auto dark:border-gray-600 border-t border-black"},ne={class:"flex mx-1.5"},se={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},ie={key:0,class:"flex mx-1.5"},ae={title:"Coming Soon ;)",class:"w-6"},le={title:"Coming Soon ;)",class:"w-6"},ce={key:1,class:"flex mx-1.5"},ue={class:"text-2xs"},de={class:""},pe={class:"mb-2 font-bold text-sm"},he={class:"text-2xs mb-auto"},N=L({__name:"FeedCard",props:{interaction:{}},setup(l){const t=l,o=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",n=e=>e==="outp"?"Production personnelle":"Bibliographie",{resourceTypeOptions:s,getAuthorInteractionForResource:h}=j(),v=e=>s.find(b=>b.value===e).text;f(null);const d=f(null),y=e=>e?e.length>200?e.slice(0,150)+"...":e:"",p=f([]),{getResourceRelationsForResource:C}=D(),T=async()=>{t.interaction.id&&(p.value=await C(t.interaction.resource.id))},{getUserById:_}=S(),g=f(!1),r=async()=>{if(t.interaction.user_id){try{d.value=await _(t.interaction.user_id)}catch(e){console.log(e)}g.value=!0}else{const e=await h(t.interaction.resource.id);d.value=await _(e.value)}};return A(async()=>{await T(),await r()}),(e,b)=>{const $=M("router-link");return a(),c("div",oe,[i("div",ne,[g.value?(a(),k(z,{key:0,class:"flex mb-1.5 h-8",user:d.value,secondText:o(e.interaction.date),firstBottomText:n(e.interaction.interaction_type),secondBottomText:e.$t(v(e.interaction.resource.resource_type))},null,8,["user","secondText","firstBottomText","secondBottomText"])):(a(),c("div",se))]),m(re,{class:"border-1 border-black",interaction:e.interaction},null,8,["interaction"]),e.interaction.interaction_type!="inpt"?(a(),c("div",ie,[i("div",ae,[m(F(G),{class:"w-full my-auto"})]),i("div",le,[m(F(J),{class:"w-full my-auto"})]),m($,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto"},{default:w(()=>[m(F(O),{class:"w-8"})]),_:1},8,["to"])])):B("",!0),e.interaction.interaction_type!="inpt"?(a(),c("div",ce,[i("div",ue,u(Math.floor(Math.random()*100))+" likes",1),m($,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:w(()=>[P(u(p.value.length)+" relations ",1)]),_:1},8,["to"])])):B("",!0),e.interaction.interaction_type!="inpt"?(a(),k($,{key:2,class:"mx-1.5",to:"/resources/"+e.interaction.resource.id},{default:w(()=>[i("div",de,[i("div",pe,u(e.interaction.resource.title),1),i("div",he,u(y(e.interaction.resource.subtitle)),1)])]),_:1},8,["to"])):B("",!0)])}}}),me={class:"flex flex-col"},ge=L({__name:"FeedList",props:{interactionsList:{}},setup(l){const t=l,{feedFilter:o}=U(),n=x(()=>t.interactionsList.filter(s=>o.value==="production"?s.interaction_type==="outp"&&!s.resource.is_external&&s.resource.resource_type!=="pblm"&&!s.resource.is_external:o.value==="draft"?s.interaction_type==="outp"&&!s.resource.is_external&&(s.resource.maturing_state==="drft"||s.resource.maturing_state==="rvew"):o.value==="reviews"?s.interaction_type==="rvew":o.value==="problem"?s.resource.resource_type==="pblm":o.value==="biblio"?s.interaction_type==="inpt":s.interaction_type==="bibl"||s.interaction_type==="inpt"||!s.resource.is_external));return(s,h)=>(a(),c("div",me,[(a(!0),c(V,null,H(n.value,(v,d)=>(a(),k(N,{class:"md:mb-2 md:mx-1 flex-grow md:rounded max-h-screen border-t-[1px] md:border-[1px] border-black",interaction:v,key:v.id},null,8,["interaction"]))),128))]))}});export{ge as _};
