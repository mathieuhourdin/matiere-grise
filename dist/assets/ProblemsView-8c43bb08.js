import{n as f,p as $,d as g,r as b,f as v,q as A,o as c,c as d,j as y,w as D,h as a,t as p,a as w,e as F,s as R,F as P,i as x,v as S,x as B,m as U}from"./index-1f519ece.js";import{u as L}from"./useThoughtInputUsages-ba79821a.js";import{u as N}from"./useResource-2c4f22fd.js";const{launchSnackbar:T}=$(),V=()=>{const t={title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"drft",maturing_state:"idea",image_url:"",resource_type:"pblm",comment:""};return{interaction_progress:0,interaction_comment:"",interaction_date:new Date(Date.now()),resource:t,interaction_is_public:!0}},j=t=>(t.created_at&&(t.created_at=new Date(t.created_at.split(".")[0])),t),q=async()=>(await f.get("/problems")).data.map(s=>j(s)),E=async t=>{var s;try{const r={...t,interaction_date:(s=t.interaction_date)==null?void 0:s.toISOString().split(".")[0]};return(await f.post("/thought_outputs",r)).data}catch(r){throw T(`Error updating resource : ${r}`,"error"),r}};function C(){return{newProblem:V,getProblems:q,createProblem:E}}const W={class:"border shadow-xl rounded m-2 p-4 h-72 w-60"},M={class:"max-h-full"},O=["src"],z={class:"h-full"},G={class:"mb-2"},H={key:0,class:"text-2xs italic",style:{"margin-top":"-8px"}},J={class:"text-2xs mb-auto"},K={class:"flex mt-2"},Q={class:"text-2xs italic mt-auto"},X={class:"ml-auto text-2xs underline"},Y=g({__name:"ProblemCard",props:{problem:{}},setup(t){const s=t,r=n=>n?n.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",u=b(null),i=b(null),_=n=>n.length>200?n.slice(0,150)+"...":n,{getAuthorInteractionForResource:m}=N(),e=b([]),{getThoughtInputUsagesForResource:o}=L(),l=async()=>{s.problem.id&&(e.value=await o(s.problem.id))},{getUserById:h}=F(),k=async()=>{u.value=await m(s.problem.id),u.value&&(i.value=await h(u.value.interaction_user_id))};return v(async()=>{await l(),await k()}),(n,oe)=>{const I=A("router-link");return c(),d("div",W,[y(I,{to:"/thought_outputs/"+n.problem.id},{default:D(()=>[a("div",M,[a("img",{class:"h-28 mx-auto mb-4",src:n.problem.image_url},null,8,O),a("div",z,[a("div",G,p(n.problem.title),1),i.value?(c(),d("div",H,p(i.value.first_name)+" "+p(i.value.last_name),1)):w("",!0),a("div",J,p(_(n.problem.subtitle)),1),a("div",K,[a("div",Q,p(r(n.problem.created_at)),1),a("div",X,p(e.value.length)+" inputs",1)])])])]),_:1},8,["to"])])}}}),Z={class:"flex"},ee=a("hr",{class:"border-top border-slate-800 border-dashed my-1"},null,-1),te={class:"flex overflow-scroll"},se=g({__name:"CategoryProblemsCarousel",props:{problemsList:{},category:{}},setup(t){const s=t,{newProblem:r,createProblem:u}=C(),i=R(),_=async()=>{const e=r();e.resource.category_id=s.category.id;const o=await u(e);i.push({path:"/thought_outputs/"+o.resource.id,query:{editing:"true"}})},m=e=>e=="default"?"Autres":e;return(e,o)=>(c(),d("div",null,[a("div",Z,[a("div",null,p(m(e.category.display_name)),1),a("div",{onClick:_,class:"ml-auto text-sm mr-2 underline"},"Ajouter")]),ee,a("div",te,[(c(!0),d(P,null,x(e.problemsList,(l,h)=>(c(),d("div",{class:"mb-4",key:h},[y(Y,{problem:l},null,8,["problem"])]))),128))])]))}}),re={key:0,class:"m-4"},ce=g({__name:"ProblemsView",setup(t){const{getProblems:s}=C(),r=b(null),{categories:u}=B(),i=S(()=>u.value.map(e=>(e.problems=_(e),e.problems_count=e.problems?e.problems.length:0,e))),_=m=>{var e,o;return m.display_name=="default"?(e=r.value)==null?void 0:e.filter(l=>l.category_id==null):(o=r.value)==null?void 0:o.filter(l=>l.category_id==m.id)};return v(async()=>r.value=await s()),(m,e)=>(c(),d("div",null,[r.value?(c(),d("div",re,[(c(!0),d(P,null,x(i.value.sort((o,l)=>l.problems_count-o.problems_count),o=>(c(),U(se,{class:"mt-4",category:o,key:o.id,"problems-list":o.problems},null,8,["category","problems-list"]))),128))])):w("",!0)]))}});export{ce as default};
