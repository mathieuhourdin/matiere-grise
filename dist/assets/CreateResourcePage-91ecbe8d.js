import{I as A,d as h,k as u,q as E,o as n,c as i,a as s,J as F,j as R,w as p,m as f,A as y,e as r,i as N,h as B,b as d,g as K,K as j,x as O,y as S}from"./index-2358f579.js";import{_ as x}from"./TextInput.vue_vue_type_script_setup_true_lang-cd1b6467.js";import{_ as q}from"./UserPicker.vue_vue_type_script_setup_true_lang-ba1692ee.js";import{_ as G}from"./SelectionTextInterface.vue_vue_type_style_index_0_lang-444b5f35.js";import{u as J}from"./useFileConverter-b4804c9c.js";async function W(b){return(await A.post("/link_preview",b)).data}function z(){return{postLinkPreview:W}}const H=h({__name:"ExternalResourcePreview",emits:["change"],setup(b,{emit:o}){const{postLinkPreview:C}=z(),g=async()=>{const m=await C({external_content_url:c.value});console.log(m),e.value=c.value,o("change",m)},c=u(""),e=u(""),V=E(()=>e.value!==c.value);return(m,w)=>(n(),i("div",null,[s(x,{modelValue:c.value,"onUpdate:modelValue":w[0]||(w[0]=P=>c.value=P),class:"mb-4",onKeyup:F(g,["enter"]),label:"Lien ressource externe"},null,8,["modelValue","onKeyup"]),V.value?(n(),R(y,{key:0,class:"mb-4",onClick:g,type:"valid"},{default:p(()=>[f("Générer")]),_:1})):r("",!0)]))}}),M={class:"mt-10 mx-5"},Q={key:0},X={key:1},Y={key:2},Z=d("div",null,"Optionnel : ajouter le contenu à partir d'un fichier La-tex",-1),ee={key:1},te=["src"],le={key:0},ae=d("div",{class:"text-2xs text-slate-800"},"Text formaté",-1),se=h({__name:"CreateResourceProcess",setup(b){const o=u(0),{newResource:C,createResource:g,resourceTypeOptions:c}=O(),e=u({id:"",title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"",maturing_state:"",image_url:"",resource_type:"",comment:"",is_local_draft:!0,is_external:!1}),V=a=>{_.value=a,a?(o.value=1,e.value.maturing_state="fnsh",e.value.is_external=!0):(v.value=P.value.id,e.value.maturing_state="drft",e.value.is_external=!1,o.value=1,k.value=new Date(Date.now()).toISOString().split("T")[0])},{postFileConversion:m}=J(),w=async a=>{const t=a.target.files[0],l=new FormData;l.append(t.name,t);const U=await m(l);e.value.content=U.content,e.value.title=U.name},{user:P}=N(),v=u(null),k=u(null),_=u(!1),$=u(!1),D=a=>{console.log("apply preview : ",a),e.value.title=a.title,e.value.subtitle=a.subtitle,e.value.image_url=a.image_url,e.value.content=a.content,e.value.resource_type=a.resource_type,e.value.external_content_url=a.external_content_url,$.value=!0},{createInteractionForResource:I,newInteraction:oe}=S(),L=B(),T=async()=>{const a=await g(e.value),t={interaction_user_id:v.value,resource_id:a.id,interaction_progress:_?100:0,interaction_date:new Date(k.value),interaction_comment:"",interaction_is_public:!!_.value};await I(a.id,t),L.push({path:"/app/resources/"+a.id,query:{editing:"false"}})};return(a,t)=>(n(),i("div",M,[o.value===0?(n(),i("div",Q,[d("div",null,[s(y,{class:"mb-2",type:"valid",onClick:t[0]||(t[0]=l=>V(!0))},{default:p(()=>[f("Resource Externe")]),_:1}),s(y,{type:"valid",onClick:t[1]||(t[1]=l=>V(!1))},{default:p(()=>[f("Production personnelle")]),_:1})])])):r("",!0),o.value===1?(n(),i("div",X,[s(q,{class:"mb-4",modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=l=>v.value=l)},null,8,["modelValue"]),v.value?(n(),R(x,{key:0,class:"text-2xs mb-4",label:"Date d'écriture","model-value":k.value,"onUpdate:modelValue":t[3]||(t[3]=l=>k.value=l),type:"date"},null,8,["model-value"])):r("",!0),s(y,{type:"valid",onClick:t[4]||(t[4]=l=>o.value=2)},{default:p(()=>[f("Valider")]),_:1})])):r("",!0),o.value===2?(n(),i("div",Y,[d("div",null,[_.value?(n(),R(H,{key:0,onChange:t[5]||(t[5]=l=>D(l))})):r("",!0),Z,d("input",{id:"file",type:"file",onChange:w,placeholder:"Ajouter depuis un fichier"},null,32),!_.value||$.value?(n(),i("div",ee,[s(x,{class:"mb-4",modelValue:e.value.title,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.title=l),label:"Titre"},null,8,["modelValue"]),s(x,{class:"mb-4",modelValue:e.value.subtitle,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.subtitle=l),label:"Description"},null,8,["modelValue"]),s(x,{class:"mb-4",modelValue:e.value.image_url,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.image_url=l),label:"Url de l'image"},null,8,["modelValue"]),d("img",{class:"mb-4",src:e.value.image_url},null,8,te),s(j,{label:"Type de ressource",class:"mb-4",choices:K(c),modelValue:e.value.resource_type,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.resource_type=l)},null,8,["choices","modelValue"]),e.value.content!==""?(n(),i("div",le,[ae,s(G,{class:"max-h-40 overflow-scroll border border-slate-400 mb-4 p-2 rounded",type:"textarea",text:e.value.content},null,8,["text"])])):r("",!0),s(y,{class:"mb-4",onClick:T,type:"valid"},{default:p(()=>[f("Créer")]),_:1})])):r("",!0)])])):r("",!0)]))}}),ne={class:"w-full"},me=h({__name:"CreateResourcePage",setup(b){return(o,C)=>(n(),i("div",ne,[s(se)]))}});export{me as default};
