import{d as v,r as i,c as m,o as w,a as A,b as r,e as c,f as n,g as k,_ as N,t as d,h as T,w as S,u as M,F as U,i as V}from"./index-d2f664fb.js";import{u as j}from"./useResourceRelations-6904b3ed.js";import{u as D}from"./useInteraction-9607bc04.js";const H=u=>{if(!u)return[];const o=u.replace("/?/g","?.").split(".");let s=0;const a=[];for(;s<o.length-1;){let l=0,t=[];if(o[s].length>=270)a.push(o[s].replace("/?./g","?")),s++;else{for(;s<o.length&&l+o[s].length<270;)t.push(o[s]),l+=o[s].length,s++;a.push(t.join(". ").replace("/?./g","?"))}}return a},y={splitTextForPanel:H},q={class:"flex flex-col border p-1.5 overflow-auto"},z={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},E=["src"],W={key:1,class:"overflow-auto h-full overflow-scroll bg-red-100 p-1 pt-8 border"},G={class:"bg-red-100 text-center text-sm my-auto"},J={key:2,class:"overflow-auto h-full overflow-scroll bg-blue-100 p-1 pt-8 border"},K={class:"bg-blue-100 text-center text-sm my-auto"},O={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},Q={class:""},X={class:"mb-2 font-bold text-sm"},Y={class:"text-2xs mb-auto"},Z={class:"flex mt-2"},ee={class:"ml-auto text-2xs underline"},te=v({__name:"FeedCard",props:{interaction:{}},setup(u){const o=u,s=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",a=e=>e==="outp"?"Production personnelle":"Bibliographie",l=e=>{switch(e){case"pblm":return"ProblÃ©matique";case"book":return"Livre";case"atcl":return"Article";case"ratc":return"Article de recherche"}return e},t=i(0);i(null);const h=i(null),F=()=>{t.value=(t.value+1)%g.value},B=m(()=>`${t.value+1}/${g.value}`),g=m(()=>_.value.length+f.value.length+1),f=m(()=>y.splitTextForPanel(o.interaction.resource.content)),_=m(()=>y.splitTextForPanel(o.interaction.context_comment)),C=e=>e?e.length>200?e.slice(0,150)+"...":e:"",b=i([]),{getResourceRelationsForResource:R}=j(),L=async()=>{o.interaction.id&&(b.value=await R(o.interaction.resource.id))},{getUserById:$}=M(),x=i(!1),I=async()=>{try{h.value=await $(o.interaction.user_id)}catch(e){console.log(e)}x.value=!0},p=i(null);return w(async()=>{await L(),await I();const e=p.value.offsetHeight;p.value.style.height=`${e}px`}),(e,re)=>{const P=A("router-link");return r(),c("div",q,[n("div",null,[x.value?(r(),k(N,{key:0,class:"flex mb-1.5 h-8",user:h.value,secondText:s(e.interaction.date),firstBottomText:a(e.interaction.interaction_type),secondBottomText:l(e.interaction.resource.resource_type)},null,8,["user","secondText","firstBottomText","secondBottomText"])):(r(),c("div",z))]),n("div",{onClick:F,class:"overflow-auto relative w-full md:h-3/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:p},[t.value==0?(r(),c("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:e.interaction.resource.image_url},null,8,E)):t.value>0&&t.value<=_.value.length?(r(),c("div",W,[n("div",G,d(_.value[t.value-1]),1)])):(r(),c("div",J,[n("div",K,d(f.value[t.value-1]),1)])),n("div",O,d(B.value),1)],512),T(P,{class:"",to:"/thought_outputs/"+e.interaction.resource.id},{default:S(()=>[n("div",Q,[n("div",X,d(e.interaction.resource.title),1),n("div",Y,d(C(e.interaction.resource.subtitle)),1),n("div",Z,[n("div",ee,d(b.value.length)+" inputs",1)])])]),_:1},8,["to"])])}}}),oe={class:"flex flex-col"},se=v({__name:"FeedList",props:{interactionsList:{}},setup(u){return(o,s)=>(r(),c("div",oe,[(r(!0),c(U,null,V(o.interactionsList,(a,l)=>(r(),k(te,{class:"md:mb-2 flex-grow md:rounded max-h-screen border-b-1 border-black",interaction:a},null,8,["interaction"]))),256))]))}}),ne={class:"mt-1 md:w-96"},ie=v({__name:"FeedView",setup(u){const{getReadAndWriteInteractions:o}=D(),s=i([]),a=m(()=>s.value.map(t=>({resource:t.resource,date:t.interaction_date,user_id:t.interaction_user_id,context_comment:t.interaction_comment,progress:t.interaction_progress,...t})).sort((t,h)=>.5-Math.random())),l=async()=>s.value=await o();return w(async()=>{await l()}),(t,h)=>(r(),c("div",ne,[T(se,{"interactions-list":a.value},null,8,["interactions-list"])]))}});export{ie as default};
