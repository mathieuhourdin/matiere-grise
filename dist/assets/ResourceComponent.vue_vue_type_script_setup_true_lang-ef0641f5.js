import{o as r,c as m,h as l,d as $,t as b,r as g,v as O,f as B,j as d,e as P,A as _e,y as z,B as j,k as ve,C as ge,D as he,a as x,q as ne,w as A,g as M,E as oe,m as V,F as se,i as ae,G as fe,n as I,u as q,l as H,x as ye,H as be,s as we,z as xe,I as $e}from"./index-bd79dfef.js";import{_ as G,u as ke}from"./TextInterface.vue_vue_type_script_setup_true_lang-7dc3410b.js";import{_ as L}from"./TextInput.vue_vue_type_script_setup_true_lang-ec7e0500.js";import{u as Ie}from"./useResource-759233b0.js";import{u as le}from"./useThoughtInputUsages-de040b0f.js";function Ve(n,e){return r(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}const Ce={class:"m-4"},Ue={class:"block text-2xs text-slate-800"},Re=["value","placeholder"],X=$({__name:"TextAreaInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue"],setup(n,{emit:e}){const o=t=>{e("update:modelValue",t.target.value)};return(t,u)=>(r(),m("div",Ce,[l("label",Ue,b(t.label),1),l("textarea",{class:"border border-neutral-800 block h-full w-full",value:t.modelValue,placeholder:t.placeholder,onInput:u[0]||(u[0]=a=>o(a))},null,40,Re)]))}}),Te=l("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Se=l("div",{class:"text-xs italic"},"Raison de la lecture",-1),De=$({__name:"SeeThoughtInput",props:{thoughtInput:{}},setup(n){const e=n,{getUserById:o,user:t}=P(),u=g(null),a=O(()=>t.value?e.thoughtInput.interaction_user_id===t.value.id:!1);return B(async()=>{e.thoughtInput.interaction_user_id&&(u.value=await o(e.thoughtInput.interaction_user_id))}),(s,v)=>(r(),m("div",null,[d(Ht,{id:s.thoughtInput.resource_id,"second-level":""},null,8,["id"]),Te,Se,d(G,{"full-text":s.thoughtInput.interaction_comment,editable:a.value},null,8,["full-text","editable"])]))}}),Ae={class:"flex"},ue=$({__name:"ModalSheet",props:{open:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const o=n,t=g(!1);return B(()=>{t.value=o.open}),_e(()=>{const u=a=>{(a.key==="Escape"||a.key==="Enter"||a.key==="Esc"||a.keyCode===27)&&e("close")};return window.addEventListener("keydown",u),()=>{window.removeEventListener("keydown",u)}}),z(j(o).open,u=>t.value=u),(u,a)=>t.value?(r(),m("div",{key:0,tabindex:"0",onKeyup:a[2]||(a[2]=he(s=>e("close"),["esc"])),class:"fixed top-0 left-0 w-full h-full z-10 bg-slate-500/50",onClick:a[3]||(a[3]=s=>e("close"))},[l("div",{class:"max-w-xl overflow-y-scroll max-h-screen mb-10 bg-white mx-auto mt-6 p-4 rounded shadow",onClick:a[1]||(a[1]=ge(()=>{},["stop"]))},[l("div",Ae,[l("div",{class:"ml-auto",onClick:a[0]||(a[0]=s=>e("close"))},"x")]),ve(u.$slots,"default")])],32)):x("",!0)}}),Be={class:"w-full md:w-96"},Oe={key:0,class:"text-xs italic mb-2"},Ne={class:"border shadow-lg rounded p-4 md:w-96"},Fe={class:"flex"},Ee=["src"],Le={class:"flex flex-wrap w-full",style:{"margin-top":"-8px"}},Pe=l("div",{class:"text-2xs italic"}," Nom de l'auteur ",-1),qe={class:"ml-auto m-1 w-1/3"},ze={class:"text-2xs"},je={class:"flex flex-wrap"},Me={key:0,class:"text-2xs italic"},He=$({__name:"ThoughtInputCard",props:{thoughtInput:{},usageReason:{}},setup(n){const e=n,{getUserById:o}=P(),t=g(null);B(async()=>{e.thoughtInput.interaction_user_id&&(t.value=await o(e.thoughtInput.interaction_user_id))});const u=s=>s.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}),a=s=>s.length>200?s.slice(0,150)+"...":s;return(s,v)=>{const i=ne("router-link");return r(),m("div",Be,[s.usageReason?(r(),m("div",Oe,b(s.usageReason),1)):x("",!0),l("div",Ne,[l("div",Fe,[s.thoughtInput.resource?(r(),m("img",{key:0,class:"w-8 h-fit mr-4",src:s.thoughtInput.resource.image_url},null,8,Ee)):x("",!0),l("div",null,[l("div",null,[d(i,{to:"/thought_inputs/"+s.thoughtInput.id},{default:A(()=>[M(b(s.thoughtInput.resource.title),1)]),_:1},8,["to"])]),l("div",Le,[Pe,l("div",qe,[d(oe,{"progress-value":s.thoughtInput.interaction_progress},null,8,["progress-value"])])]),l("div",ze,b(a(s.thoughtInput.interaction_comment)),1)])]),l("div",je,[s.thoughtInput.interaction_date?(r(),m("div",Me,b(u(s.thoughtInput.interaction_date)),1)):x("",!0),t.value?(r(),V(i,{key:1,to:"/users/"+t.value.id,class:"ml-auto text-2xs underline"},{default:A(()=>[M(b(t.value.first_name)+" "+b(t.value.last_name),1)]),_:1},8,["to"])):x("",!0)])])])}}}),Je={class:"w-fit"},Ke=$({__name:"ThoughtInputCardWithPopup",props:{thoughtInput:{},usageReason:{}},setup(n){const e=g(!1);return(o,t)=>(r(),m("div",Je,[d(ue,{open:e.value,onClose:t[0]||(t[0]=u=>e.value=!1)},{default:A(()=>[d(De,{"thought-input":o.thoughtInput,"usage-reason":o.usageReason},null,8,["thought-input","usage-reason"])]),_:1},8,["open"]),d(He,{class:"md:w-96","thought-input":o.thoughtInput,"usage-reason":o.usageReason,onClick:t[1]||(t[1]=u=>e.value=!0)},null,8,["thought-input","usage-reason"])]))}}),We={class:"relative max-w-full"},Ge={key:0,class:"absolute md:border h-full start-1/2"},re=$({__name:"ThoughtInputsList",props:{thoughtInputs:{},usageReasons:{},center:{type:Boolean,default:!1}},emits:["select"],setup(n,{emit:e}){const o=n,t=s=>{if(o.usageReasons&&o.usageReasons.length===o.thoughtInputs.length)return o.usageReasons[s]},u=s=>s.sort((v,i)=>+(i.interaction_date>v.interaction_date)),a=s=>{console.log("Select"),e("select",s)};return(s,v)=>(r(),m("div",We,[s.center?x("",!0):(r(),m("div",Ge)),(r(!0),m(se,null,ae(u(s.thoughtInputs),(i,c)=>(r(),V(Ke,{key:i.id,class:fe(["mb-4 md:mb-1 mx-auto max-w-full max-w-fit p-1",{"md:ml-0":c%2==0&&!s.center,"md:mr-0":!s.center}]),"thought-input":i,"usage-reason":t(c),onClick:C=>a(i)},null,8,["class","thought-input","usage-reason","onClick"]))),128))]))}});function Qe(){const n={title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"pbsh",maturing_state:"fnsh",image_url:"",resource_type:"",comment:""};return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0,resource:n}}function J(n){return console.log("Date : ",n.interaction_date),n.interaction_date=new Date(n.interaction_date),n}async function Xe(){return(await I.get("/thought_inputs")).data.map(e=>J(e))}async function Ye(n){const e=await I.get("/thought_inputs/"+n);return J(e.data)}async function Ze(n){return(await I.get("/users/"+n+"/thought_inputs")).data.map(o=>J(o))}async function et(n){const e=new Date(n.interaction_date);console.log("Date : ",e);const o=e.toISOString().split(".")[0];n.interaction_progress=Number(n.interaction_progress);const t=await I.post("/thought_inputs",{...n,interaction_date:o});return J(t.data)}function tt(){return{getUserThoughtInputs:Ze,newThoughtInput:Qe,createThoughtInput:et,getThoughtInputs:Xe,getThoughtInput:Ye}}const nt={key:0},ot={key:2},st={class:"flex flex-row-reverse"},at=$({__name:"CreateThoughtInputUsageForm",props:{thoughtOutput:{}},emits:["close","refresh"],setup(n,{emit:e}){const o=n,{user:t}=P(),u=g([]),a=g(null),s=g(""),{createThoughtInputUsage:v}=le(),i=async()=>{if(console.log("create"),!a.value)return;const U={thought_output_id:o.thoughtOutput.id,thought_input_id:a.value.id,usage_reason:s.value};await v(U),e("refresh"),e("close")},{getUserThoughtInputs:c}=tt(),C=U=>{a.value=U};return B(async()=>{!t.value||!t.value.id||(u.value=await c(t.value.id))}),(U,k)=>(r(),m("div",null,[q(t)?(r(),m("div",nt,"Nouvelle utilisation par "+b(q(t).first_name)+" "+b(q(t).last_name),1)):x("",!0),a.value?(r(),m("div",ot,[d(X,{label:"Pourquoi ajouter cet élément ?",modelValue:s.value,"onUpdate:modelValue":k[1]||(k[1]=R=>s.value=R)},null,8,["modelValue"]),l("div",st,[d(H,{type:"valid",onClick:i,text:"Ajouter"}),d(H,{type:"abort",onClick:k[2]||(k[2]=R=>e("close")),text:"Ajouter"})])])):(r(),V(re,{key:1,"thought-inputs":u.value,center:"",onSelect:k[0]||(k[0]=R=>C(R))},null,8,["thought-inputs"]))]))}}),lt={class:"block text-2xs text-slate-800"},ut=["value"],rt=["value"],Q=$({__name:"SelectInput",props:{label:{},choices:{},modelValue:{},displayFunction:{type:Function,default:n=>n.text}},emits:["update:modelValue"],setup(n,{emit:e}){const o=t=>{console.log(t.target.value),e("update:modelValue",t.target.value)};return(t,u)=>(r(),m("div",null,[l("label",lt,b(t.label),1),l("select",{value:t.modelValue,name:"Stade d'écriture",class:"text-xs w-full p-1 block rounded border-2 border-neutral-400",onInput:u[0]||(u[0]=a=>o(a))},[(r(!0),m(se,null,ae(t.choices,a=>(r(),m("option",{key:a.value,value:a.value},b(t.displayFunction(a)),9,rt))),128))],40,ut)]))}}),it={class:"m-4"},ct={class:"block text-2xs text-slate-800"},dt=["value","placeholder"],ie=$({__name:"NumberInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue","input"],setup(n,{emit:e}){const o=t=>{e("update:modelValue",t.target.value),e("input",t.target.value)};return(t,u)=>(r(),m("div",it,[l("label",ct,b(t.label),1),l("input",{class:"border border-neutral-400 block h-full w-full rounded-md border-2 p-1 pl-2 text-xs",type:"number",value:t.modelValue,placeholder:t.placeholder,onInput:u[0]||(u[0]=a=>o(a))},null,40,dt)]))}}),pt={class:"flex"},mt={class:"ml-auto h-6 m-4 w-1/3"},_t={class:"ml-auto h-6 m-4 w-1/3"},vt={class:"flex"},gt=$({__name:"ArticleForm",props:{article:{}},emits:["change"],setup(n,{emit:e}){const o=n,t=g([{text:"Terminé",value:"fnsh"},{text:"Relecture",value:"rvew"},{text:"Idée",value:"idea"}]),{categories:u}=ye(),a=O(()=>u.value.map(v=>({text:v.display_name,value:v.id}))),s=(v,i)=>{let c={...o.article};c[v]=i,e("change",c)};return(v,i)=>(r(),m("div",null,[d(L,{label:"Titre",modelValue:v.article.title,"onUpdate:modelValue":i[0]||(i[0]=c=>s("title",c))},null,8,["modelValue"]),d(L,{class:"h-6",label:"Sous-titre",modelValue:v.article.subtitle,"onUpdate:modelValue":i[1]||(i[1]=c=>s("subtitle",c))},null,8,["modelValue"]),l("div",pt,[d(ie,{class:"mr-auto h-6",label:"Progression",modelValue:v.article.interaction_progress,"onUpdate:modelValue":i[2]||(i[2]=c=>s("progress",c))},null,8,["modelValue"]),l("div",mt,[d(Q,{label:"Catégorie",choices:a.value,"model-value":v.article.category_id,"onUpdate:modelValue":i[3]||(i[3]=c=>s("category_id",c))},null,8,["choices","model-value"])]),l("div",_t,[d(Q,{label:"Stade d'écriture",choices:t.value,"model-value":v.article.maturing_state,"onUpdate:modelValue":i[4]||(i[4]=c=>s("maturing_state",c))},null,8,["choices","model-value"])])]),l("div",vt,[d(L,{class:"h-6",label:"Lien contenu externe",modelValue:v.article.external_content_url,"onUpdate:modelValue":i[5]||(i[5]=c=>s("external_content_url",c))},null,8,["modelValue"]),d(L,{class:"h-6",label:"Lien image",modelValue:v.article.image_url,"onUpdate:modelValue":i[6]||(i[6]=c=>s("image_url",c))},null,8,["modelValue"])]),d(X,{label:"Pistes d'amélioration",modelValue:v.article.comment,"onUpdate:modelValue":i[7]||(i[7]=c=>s("comment",c))},null,8,["modelValue"])]))}});function ht(){return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0}}function N(n){return console.log("Date : ",n.interaction_date),n.interaction_date=new Date(n.interaction_date),n}async function ft(){return(await I.get("/thought_inputs")).data.map(e=>N(e))}async function yt(n){const e=await I.get("/thought_inputs/"+n);return N(e.data)}async function bt(n){return(await I.get("/users/"+n+"/thought_inputs")).data.map(o=>N(o))}async function wt(n,e){const o=new Date(e.interaction_date);console.log("Date : ",o);const t=o.toISOString().split(".")[0];e.interaction_progress=Number(e.interaction_progress);const u=await I.put("/interactions/"+n,{...e,interaction_date:t});return N(u.data)}async function xt(n){const e=new Date(n.interaction_date);console.log("Date : ",e);const o=e.toISOString().split(".")[0];n.interaction_progress=Number(n.interaction_progress);const t=await I.post("/thought_inputs",{...n,interaction_date:o});return N(t.data)}async function $t(n,e){const o=new Date(e.interaction_date);console.log("Date : ",o);const t=o.toISOString().split(".")[0];e.interaction_progress=Number(e.interaction_progress);const u=await I.post(`/resources/${n}/interactions`,{...e,interaction_date:t});return N(u.data)}function kt(){return{getUserInteractions:bt,newInteraction:ht,createInteraction:xt,getInteractions:ft,getInteraction:yt,updateInteraction:wt,createInteractionForResource:$t}}const It={class:"flex flex-wrap"},Vt=$({__name:"ResourceAuthorPicker",props:{interaction:{},resourceId:{}},emits:["update"],setup(n,{emit:e}){const o=n,t=g(null),u=g([]),a=_=>{if(_)return{text:`${_.first_name} ${_.last_name}`,value:_.id}},s=O(()=>{var _;return(_=t.value)==null?void 0:_.id}),v=O(()=>{if(u.value)return u.value.map(_=>a(_))}),{getUsers:i,getUserById:c}=P(),C=async _=>t.value=await c(_.interaction_user_id),{createInteractionForResource:U,newInteraction:k,createInteraction:R,updateInteraction:F}=kt(),E=async _=>{if(console.log(`newUser : ${JSON.stringify(_)}`),o.interaction){const f={...o.interaction};f.interaction_user_id=_,console.log("newUserid : ",_.id),console.log(`Interaction payload : ${JSON.stringify(f)}`),await F(o.interaction.id,f),e("update")}else{console.log("create interaction");const f=k();f.interaction_user_id=_,f.resource_id=o.resourceId,await U(o.resourceId,f),e("update")}},p=async _=>{await F(o.interaction.id,_),e("update")};return B(async()=>{u.value=await i(),await C(o.interaction)}),z(j(o).interaction,async _=>await C(_)),(_,f)=>(r(),m("div",null,[l("div",It,[d(Q,{label:"Auteur",class:"my-auto",choices:v.value,"model-value":s.value,"onUpdate:modelValue":f[0]||(f[0]=T=>E(T))},null,8,["choices","model-value"]),d(L,{class:"my-auto",label:"Date d'écriture","model-value":_.interaction.interaction_date.split("T")[0],"onUpdate:modelValue":f[1]||(f[1]=T=>p({..._.interaction,interaction_date:T})),type:"date"},null,8,["model-value"]),d(ie,{class:"my-auto",label:"Progression",modelValue:_.interaction.interaction_progress,"onUpdate:modelValue":f[2]||(f[2]=T=>p({..._.interaction,interaction_progress:T}))},null,8,["modelValue"])])]))}}),Ct={key:0,class:"mx-auto"},Ut={key:0},Rt={class:"my-8"},Tt=["src"],St={class:"text-3xl my-3 font-mplus md:text-center text-left"},Dt={class:"md:text-center text-left"},At={class:"md:text-center text-left"},Bt={class:"md:flex my-8"},Ot=["href"],Nt={key:1},Ft={class:"flex flex-row-reverse"},Et={key:1,class:"p-2 border rounded bg-neutral-100"},Lt=l("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Pt={key:2},qt=l("div",{class:"text-xs italic"},"Commentaire",-1),zt=l("hr",{class:"border-top border-zinc-400 my-4"},null,-1),jt=l("div",{class:"text-xs italic"},"Contenu",-1),Mt={key:3},Ht=$({__name:"ResourceComponent",props:{id:{},secondLevel:{type:Boolean}},setup(n){const e=n,o=be(),t=O(()=>e.secondLevel?"popup_tab":"tab"),u=g([{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli"}]),a=g(o.query[t.value]&&typeof o.query[t.value]=="string"?o.query[t.value]:"ctnt"),s=g(o.query[t.value]);z(()=>o.query[t.value],h=>{console.log("new route query",h),typeof h=="string"&&(s.value=h)});const{getThoughtInputUsagesForResource:v}=le(),i=g([]),c=g(!1),C=async()=>{i.value=await v(j(e).id.value)};B(()=>C());const{newResource:U,getResource:k,updateResource:R,getAuthorInteractionForResource:F}=Ie(),E=g(null),p=g(U()),_=we();z(()=>o.query.editing,h=>{console.log("Editing : ",h),f.value=h==="false"?!1:!!h});const f=g(!1),T=h=>{_.push({query:{editing:h.toString()}})},ce=()=>{!p.value||!p.value.id||(p.value.publishing_state="pbsh",R(p.value.id,p.value))},Y=(h,y)=>{p.value=y,E.value!==null&&clearTimeout(E.value),E.value=setTimeout(async()=>{try{await R(h,p.value)}catch(W){console.log("An error : ",W)}},1e3)},Z=h=>{h!=`
`&&Y(j(e).id.value,{...p.value,content:h})},{user:ee,getUserById:de}=P(),K=O(()=>p.value.is_external?!0:!ee.value||!S.value?!1:S.value.id==ee.value.id),S=g(null),D=g(null),pe=async()=>{D.value=await F(e.id)},{getCommentsForThoughtOutput:me}=ke(),te=g([]);return B(async()=>{p.value=await k(e.id),te.value=await me(e.id),D.value=await F(e.id),D.value&&(S.value=await de(D.value.interaction_user_id));const h=o.query.editing;f.value=h==="false"?!1:!!h}),(h,y)=>{const W=ne("router-link");return p.value?(r(),m("div",Ct,[f.value?(r(),m("div",Nt,[d(gt,{article:p.value,onChange:y[1]||(y[1]=w=>Y(p.value.id,w))},null,8,["article"]),d(Vt,{class:"mx-4",interaction:D.value,"resource-id":h.id,onChange:pe},null,8,["interaction","resource-id"]),l("div",Ft,[d(H,{class:"mx-4",onClick:y[2]||(y[2]=w=>T(!1)),type:"valid",text:"Preview"},{default:A(()=>[M("Ok")]),_:1}),p.value.publishing_state=="drft"?(r(),V(H,{key:0,onClick:ce,type:"valid",text:"Publier"})):(r(),m("div",Et,"Publié"))])])):(r(),m("div",Ut,[l("div",Rt,[l("img",{src:p.value.image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto",style:{"max-height":"20rem"}},null,8,Tt)]),l("h1",St,b(p.value.title),1),l("div",Dt,b(p.value.subtitle),1),l("div",At,[S.value?(r(),V(W,{key:0,to:"/users/"+S.value.id,class:"text-sm underline"},{default:A(()=>[M(b(S.value.first_name)+" "+b(S.value.last_name),1)]),_:1},8,["to"])):x("",!0)]),K.value?(r(),V(xe,{key:0,onClick:y[0]||(y[0]=w=>T(!0))},{default:A(()=>[d(q(Ve),{class:"m-1"})]),_:1})):x("",!0),l("div",Bt,[D.value?(r(),V(oe,{key:0,"progress-value":D.value.interaction_progress,class:"m-2 w-1/3"},null,8,["progress-value"])):x("",!0),p.value.resource_type==="atcl"?(r(),m("a",{key:1,class:"ml-auto underline",href:p.value.external_content_url}," Ajouter un commentaire ",8,Ot)):x("",!0)])])),l("div",null,[d($e,{choices:u.value,default:a.value,"url-key":t.value},null,8,["choices","default","url-key"])]),Lt,s.value=="ctnt"?(r(),m("div",Pt,[qt,d(G,{"full-text":p.value.comment,editable:K.value},null,8,["full-text","editable"]),zt,jt,p.value.publishing_state!="drft"?(r(),V(G,{key:0,"ext-comments":te.value,"resource-id":p.value.id,"full-text":p.value.content,editable:K.value,onChange:y[3]||(y[3]=w=>Z(w))},null,8,["ext-comments","resource-id","full-text","editable"])):(r(),V(X,{key:1,class:"h-96",label:"Contenu",modelValue:p.value.content,"onUpdate:modelValue":y[4]||(y[4]=w=>Z(w))},null,8,["modelValue"]))])):(r(),m("div",Mt,[d(ue,{open:c.value,onClose:y[6]||(y[6]=w=>c.value=!1)},{default:A(()=>[d(at,{onRefresh:C,onClose:y[5]||(y[5]=w=>c.value=!1),"thought-output":p.value},null,8,["thought-output"])]),_:1},8,["open"]),l("div",{onClick:y[7]||(y[7]=w=>c.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),d(re,{"thought-inputs":i.value.map(w=>w.thought_input),"usage-reasons":i.value.map(w=>w.usage_reason)},null,8,["thought-inputs","usage-reasons"])]))])):x("",!0)}}});export{Ht as _,De as a,ue as b,re as c,Q as d,Ve as r,tt as u};
