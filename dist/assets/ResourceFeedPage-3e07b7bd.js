import{_ as y}from"./FeedList.vue_vue_type_script_setup_true_lang-009feec1.js";import{_ as x}from"./JournalItem.vue_vue_type_script_setup_true_lang-1b617799.js";import{u as k}from"./useResourceRelations-22334af8.js";import{d as g,r as u,o as F,B as R,c as a,e as _,F as b,g as I,s as $,n as A,b as n}from"./index-67386673.js";import"./UserMini.vue_vue_type_script_setup_true_lang-14fa25ac.js";import"./PaperAirplaneIcon-e301c639.js";const B={key:0,class:"mt-1 md:w-96 mx-auto"},C={key:1,class:"mt-10 mx-4 md:w-11/12 md:mx-auto"},E=g({__name:"ResourceFeedPage",props:{id:{}},setup(p){const i=p,{getResource:v,getAuthorInteractionForResource:f}=$(),{headerValue:l}=A(),o=u(null),{getAllRelationsForResource:h}=k(),d=u([]),c=u([]),w=async()=>{const m=await Promise.all(d.value.map(async e=>{const t=e.origin_resource_id===i.id?e.target_resource:e.origin_resource;let r=e.created_at;try{const s=await f(t.id);s&&s.interaction_date&&(r=s.interaction_date)}catch(s){console.warn(`Could not fetch author interaction for resource ${t.id}:`,s)}return{resource:t,date:r,user_id:e.user_id,context_comment:e.relation_comment,interaction_type:"bibl",progress:null,id:e.id,...e}}));c.value=m.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())};return F(async()=>{d.value=await h(i.id),o.value=await v(i.id),o.value&&(l.value={text:o.value.title,link:`/resources/${o.value.id}`}),await w()}),R(()=>{l.value=null}),(m,e)=>(n(),a("div",null,[o.value&&o.value.resource_type!=="jrnl"?(n(),a("div",B,[_(y,{"interactions-list":c.value},null,8,["interactions-list"])])):(n(),a("div",C,[(n(!0),a(b,null,I(c.value,(t,r)=>(n(),a("div",{key:r,class:"mb-6"},[_(x,{resourceItem:t},null,8,["resourceItem"])]))),128))]))]))}});export{E as default};
