import{d as b,r as a,c as v,o as k,a as L,b as n,e as i,f as r,g as B,_ as N,t as d,h as R,w as S,u as U,F as V,i as j}from"./index-b3fec653.js";import{u as D}from"./useResourceRelations-aa992535.js";import{u as H}from"./useInteraction-9ec295ca.js";const M={class:"flex flex-col border p-1.5 overflow-auto"},P={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},q=["src"],z={key:1,class:"overflow-auto h-full overflow-scroll bg-blue-100 p-1 pt-8 border"},E={class:"bg-blue-100 text-center text-sm my-auto"},W={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},G={class:""},J={class:"mb-2 font-bold text-sm"},K={class:"text-2xs mb-auto"},O={class:"flex mt-2"},Q={class:"ml-auto text-2xs underline"},X=b({__name:"FeedCard",props:{interaction:{}},setup(p){const s=p,c=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",l=e=>e==="outp"?"Production personnelle":"Bibliographie",m=e=>{switch(e){case"pblm":return"ProblÃ©matique";case"book":return"Livre";case"atcl":return"Article";case"ratc":return"Article de recherche"}return e},t=a(0);a(null);const h=a(null),T=v(()=>`${t.value}/${_.value.length}`),_=v(()=>{if(!s.interaction.resource.content)return[];const e=s.interaction.resource.content.replaceAll("?","?.").split(".");let o=0;const u=[];for(;o<e.length-1;){let g=0,w=[];if(e[o].length>=270)u.push(e[o].replaceAll("?.","?")),o++;else{for(;o<e.length&&g+e[o].length<270;)w.push(e[o]),g+=e[o].length,o++;u.push(w.join(". ").replaceAll("?.","?"))}}return u}),C=e=>e?e.length>200?e.slice(0,150)+"...":e:"",x=a([]),{getResourceRelationsForResource:F}=D(),$=async()=>{s.interaction.id&&(x.value=await F(s.interaction.resource.id))},{getUserById:A}=U(),y=a(!1),I=async()=>{try{h.value=await A(s.interaction.user_id)}catch(e){console.log(e)}y.value=!0},f=a(null);return k(async()=>{await $(),await I();const e=f.value.offsetHeight;f.value.style.height=`${e}px`}),(e,o)=>{const u=L("router-link");return n(),i("div",M,[r("div",null,[y.value?(n(),B(N,{key:0,class:"flex mb-1.5 h-8",user:h.value,secondText:c(e.interaction.date),firstBottomText:l(e.interaction.interaction_type),secondBottomText:m(e.interaction.resource.resource_type)},null,8,["user","secondText","firstBottomText","secondBottomText"])):(n(),i("div",P))]),r("div",{onClick:o[0]||(o[0]=g=>t.value=(t.value+1)%(_.value.length+1)),class:"overflow-auto relative w-full md:h-3/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:f},[t.value==0?(n(),i("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:e.interaction.resource.image_url},null,8,q)):(n(),i("div",z,[r("div",E,d(_.value[t.value-1]),1)])),r("div",W,d(T.value),1)],512),R(u,{class:"",to:"/thought_outputs/"+e.interaction.resource.id},{default:S(()=>[r("div",G,[r("div",J,d(e.interaction.resource.title),1),r("div",K,d(C(e.interaction.resource.subtitle)),1),r("div",O,[r("div",Q,d(x.value.length)+" inputs",1)])])]),_:1},8,["to"])])}}}),Y={class:"flex flex-col"},Z=b({__name:"FeedList",props:{interactionsList:{}},setup(p){return(s,c)=>(n(),i("div",Y,[(n(!0),i(V,null,j(s.interactionsList,(l,m)=>(n(),B(X,{class:"md:mb-2 flex-grow md:rounded max-h-screen border-b-1 border-black",interaction:l},null,8,["interaction"]))),256))]))}}),ee={class:"mt-1 md:w-96"},re=b({__name:"FeedView",setup(p){const{getReadAndWriteInteractions:s}=H(),c=a([]),l=v(()=>c.value.map(t=>({resource:t.resource,date:t.interaction_date,user_id:t.interaction_user_id,context_comment:t.interaction_comment,progress:t.interaction_progress,...t})).sort((t,h)=>.5-Math.random())),m=async()=>c.value=await s();return k(async()=>{await m()}),(t,h)=>(n(),i("div",ee,[R(Z,{"interactions-list":l.value},null,8,["interactions-list"])]))}});export{re as default};
