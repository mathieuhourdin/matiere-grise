import{d as M,r as A,j as b,y as J,a as N,b as l,c,m as j,l as a,F as H,g as F,t as S,h as B,w as L,f as k,k as C,O as q,e as f,u as D,o as O,p as V,P as U,Q as G,S as I,U as z,M as Q}from"./index-feeccd59.js";import{u as R}from"./useLens-2bfa7f8c.js";import"./useJournal-7bf2b09e.js";import{_ as P}from"./HeatmapDisplay.vue_vue_type_script_setup_true_lang-f94bde21.js";import{J as K}from"./JournalPadComponent-85f859c1.js";import"./PlusIcon-b9d888db.js";const X={class:"font-inter"},Y={key:0,class:"text-sm text-slate-500 mt-3"},Z={key:1,class:"text-sm text-slate-500 mt-3"},tt={key:2,class:"text-sm text-slate-500 mt-3"},et={key:3,class:"mt-3"},st={class:"list-disc list-outside pl-4 space-y-1"},at={class:"text-xs leading-[0.95rem] text-slate-200 whitespace-normal break-words"},ot={class:"mt-2 flex justify-end"},nt=M({__name:"LastElementsSection",setup($){const{displayLandscapeAnalysis:i}=R(),_=A([]),h=A(!1),p=t=>{if(typeof t!="string")return null;let s=t.trim();if(!s)return null;for(let n=0;n<3;n++){if(typeof s!="string")return s;const v=s.trim();if(!v)return null;if(!(v.startsWith("{")||v.startsWith("[")||v.startsWith('"')))return n===0?null:s;try{s=JSON.parse(v)}catch{return n===0?null:s}}return s},d=t=>{var n;const s=p((t==null?void 0:t.content)??((n=t==null?void 0:t.resource)==null?void 0:n.content)??"");return s&&typeof s=="object"&&!Array.isArray(s)?s:null},y=t=>{var v,T;const s=d(t),n=(t==null?void 0:t.element_type)??(t==null?void 0:t.elementType)??((v=t==null?void 0:t.resource)==null?void 0:v.element_type)??((T=t==null?void 0:t.resource)==null?void 0:T.elementType)??(s==null?void 0:s.element_type)??(s==null?void 0:s.elementType)??"";return String(n).trim().toUpperCase()},x=t=>{const s=(t==null?void 0:t.interaction_date)??(t==null?void 0:t.created_at)??0;return new Date(s).getTime()||0},w=b(()=>_.value.filter(t=>y(t)==="TRANSACTION").sort((t,s)=>x(s)-x(t))),g=b(()=>w.value.slice(0,4)),o=async t=>{if(!t){_.value=[];return}h.value=!0;try{const s=await q.get(`/analysis/${t}/elements`);_.value=Array.isArray(s.data)?s.data:[]}catch(s){console.error(`Error loading analysis elements for analysis ${t}:`,s),_.value=[]}finally{h.value=!1}};J(()=>{var t;return(t=i.value)==null?void 0:t.id},async()=>{var s;const t=(s=i.value)==null?void 0:s.id;if(!t){_.value=[];return}await o(t)},{immediate:!0});const r=t=>{const s=d(t),n=(s==null?void 0:s.target)??(t==null?void 0:t.target);return typeof n=="string"&&n.trim().length>0?n.trim():n!=null&&String(n).trim()||"Sans cible"},e=t=>{const s=d(t),n=(s==null?void 0:s.status)??(t==null?void 0:t.status);return typeof n=="string"&&n.trim().length>0?n.trim():n!=null&&String(n).trim()||"Sans statut"},u=t=>{const s=d(t),n=(s==null?void 0:s.verb)??(t==null?void 0:t.verb);return typeof n=="string"&&n.trim().length>0?n.trim():n!=null&&String(n).trim()||"Sans verbe"},m=t=>`${e(t)} - ${u(t)} - ${r(t)}`;return(t,s)=>{var v;const n=N("router-link");return l(),c("section",X,[j(i)?h.value?(l(),c("div",Z," Chargement... ")):g.value.length===0?(l(),c("div",tt," Aucun élément ")):(l(),c("div",et,[a("ul",st,[(l(!0),c(H,null,F(g.value,(T,W)=>(l(),c("li",{key:T.id??`element-${W}`,class:"text-slate-300 marker:text-slate-500"},[a("div",at,S(m(T)),1)]))),128))]),a("div",ot,[(v=j(i))!=null&&v.id?(l(),B(n,{key:0,to:{name:"analysis",query:{id:j(i).id}},class:"text-xs text-slate-400 underline hover:text-slate-200 transition-colors"},{default:L(()=>[k(" voir plus ")]),_:1},8,["to"])):C("",!0)])])):(l(),c("div",Y," Aucune analyse courante "))])}}}),rt={class:"font-inter"},it={key:0,class:"text-sm text-slate-500 mt-3"},lt={key:1,class:"text-sm text-slate-500 mt-3"},ct={key:2,class:"text-sm text-slate-500 mt-3"},ut={key:3,class:"mt-3"},dt={class:"list-disc list-outside pl-4 space-y-1"},pt={class:"text-slate-500"},_t={class:"mt-2 flex justify-end"},mt=M({__name:"MostFrequentLandmarksSection",setup($){const{displayLandmarks:i,displayLandscapeAnalysis:_,isLoadingLandmarks:h}=R(),p=A({}),d=A(!1),y=async o=>{var r;if(o&&p.value[o]==null)try{const e=await q.get(`/landmarks/${o}`),u=Array.isArray((r=e.data)==null?void 0:r.related_elements)?e.data.related_elements:[];p.value[o]=u.length}catch(e){console.error(`Error loading related elements count for landmark ${o}:`,e),p.value[o]=0}},x=b(()=>[...i.value].sort((o,r)=>{const e=p.value[o.id]??0,u=p.value[r.id]??0;if(e!==u)return u-e;const m=new Date(o.created_at||0).getTime();return new Date(r.created_at||0).getTime()-m})),w=b(()=>x.value.slice(0,4)),g=o=>p.value[o]??0;return J(()=>i.value.map(o=>o.id).join(","),async()=>{if(i.value.length!==0){d.value=!0;try{await Promise.all(i.value.map(o=>y(o.id)))}finally{d.value=!1}}},{immediate:!0}),(o,r)=>{var u;const e=N("router-link");return l(),c("section",rt,[j(_)?j(h)||d.value?(l(),c("div",lt," Chargement... ")):w.value.length===0?(l(),c("div",ct," Aucun landmark ")):(l(),c("div",ut,[a("ul",dt,[(l(!0),c(H,null,F(w.value,m=>(l(),c("li",{key:m.id,class:"text-slate-300 marker:text-slate-500"},[f(e,{to:`/app/landmarks/${m.id}`,class:"text-xs leading-[0.95rem] text-slate-200 hover:text-slate-100 transition-colors whitespace-normal break-words"},{default:L(()=>[a("span",null,S(m.title||"Sans titre"),1),a("span",pt," ("+S(g(m.id))+" éléments)",1)]),_:2},1032,["to"])]))),128))]),a("div",_t,[(u=j(_))!=null&&u.id?(l(),B(e,{key:0,to:{name:"analysis",query:{id:j(_).id,tab:"compare"}},class:"text-xs text-slate-400 underline hover:text-slate-200 transition-colors"},{default:L(()=>[k(" voir plus ")]),_:1},8,["to"])):C("",!0)])])):(l(),c("div",it," Aucune analyse courante "))])}}}),ft={key:0,class:"flex items-center"},xt=["title"],vt={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center p-40"},ht={class:"relative z-10 w-[min(98vw,1600px)] max-h-[95vh] overflow-auto"},yt={class:"rounded-2xl border border-slate-700 bg-slate-900 p-4 shadow-2xl"},gt={key:0,class:"text-lg font-semibold text-slate-200"},bt={class:"flex items-center gap-3"},$t={key:0,class:"text-xs text-slate-500"},wt=M({__name:"HeatmapSection",props:{compact:{type:Boolean,default:!1},compactWeeksLimit:{default:25},frameless:{type:Boolean,default:!1},title:{default:"Activité"}},setup($){const i=$,{user:_}=D(),{launchSnackbar:h}=G(),p=A(!1),d=A([]),y=A(!1),x=b(()=>d.value.length===0?0:Math.max(...d.value.map(r=>r.value||0))),w=()=>{i.compact&&(y.value=!0)},g=()=>{y.value=!1},o=async()=>{var r;if((r=_.value)!=null&&r.id){p.value=!0;try{const e=await q.get(`/users/${_.value.id}/heatmaps`);d.value=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Error fetching heatmaps:",e),h(`Error loading heatmap: ${e}`,"error"),d.value=[]}finally{p.value=!1}}};return O(async()=>{await o()}),(r,e)=>r.compact?(l(),c("div",ft,[a("button",{type:"button",class:V(["transition-colors",i.frameless?"p-0 border-0 bg-transparent rounded-none hover:bg-transparent":"rounded-lg border border-slate-700 bg-slate-900/60 p-2.5 hover:border-slate-500"]),title:i.title?`Voir la heatmap ${i.title}`:"Voir la heatmap",onClick:w},[f(P,{compact:"",days:d.value,loading:p.value,title:i.title,"empty-text":"Aucune donnée","month-locale":"fr-FR","hide-first-compact-month-label":!0,"compact-weeks-limit":i.compactWeeksLimit},null,8,["days","loading","title","compact-weeks-limit"])],10,xt),(l(),B(U,{to:"body"},[y.value?(l(),c("div",vt,[a("div",{class:"absolute inset-0 bg-slate-950/70",onClick:g}),a("div",ht,[a("div",yt,[a("div",{class:V(["flex items-center mb-3",i.title?"justify-between":"justify-end"])},[i.title?(l(),c("h2",gt,S(i.title),1)):C("",!0),a("div",bt,[x.value>0?(l(),c("div",$t,"Max: "+S(x.value),1)):C("",!0),a("button",{type:"button",class:"text-xs px-2 py-1 rounded border border-slate-600 text-slate-300 hover:bg-slate-800",onClick:g}," Fermer ")])],2),f(P,{days:d.value,loading:p.value,title:i.title,"show-max":!1,"empty-text":"Aucune donnée","month-locale":"fr-FR"},null,8,["days","loading","title"])])])])):C("",!0)]))])):(l(),c("div",{key:1,class:V(i.frameless?"":"rounded-2xl border border-slate-800 bg-slate-900/60 p-4")},[f(P,{days:d.value,loading:p.value,title:i.title,"empty-text":"Aucune donnée","month-locale":"fr-FR"},null,8,["days","loading","title"])],2))}}),E=$=>(I("data-v-9a15c407"),$=$(),z(),$),kt={class:"min-h-screen text-slate-100 p-2 md:p-6 md:w-11/12 mx-auto"},Lt={class:"flex justify-between items-center mb-4"},St=E(()=>a("h1",{class:"text-2xl font-bold"},"Mon studio",-1)),jt={class:"flex items-center gap-3"},At={class:"flex flex-col gap-4"},Tt={class:"rounded-xl border border-slate-800",style:{"background-color":"rgb(32, 32, 32)"}},Ct={class:"flex flex-col xl:flex-row"},Et={class:"flex-1 p-3 md:p-4 xl:min-h-[170px]"},Mt={class:"text-lg font-semibold text-slate-200 mb-2"},Bt={class:"flex items-start gap-2 font-inter"},Vt=["src","alt"],Pt={class:"text-xs leading-4 text-slate-300 whitespace-pre-line"},Jt={class:"mt-4 flex justify-end"},Nt={class:"flex-1 border-t xl:border-t-0 xl:border-l border-slate-800 p-3 md:p-4 xl:min-h-[170px] font-inter"},Ht=E(()=>a("div",{class:"text-lg font-semibold text-slate-200 mb-2"}," Tes grands projets ",-1)),Ft={class:"space-y-1.5 text-xs leading-4 text-slate-300"},qt={class:"grid grid-cols-1 xl:grid-cols-3 gap-8 px-3"},Rt={class:"col-span-1"},Wt={class:"mb-4 font-inter"},Dt=E(()=>a("div",{class:"mb-1 flex items-center justify-between gap-3"},[a("h2",{class:"text-lg font-semibold text-slate-300"},"Métriques")],-1)),Ot={class:"mt-1 w-fit"},Ut={class:"mt-2 flex justify-end"},Gt=E(()=>a("div",{class:"flex items-center justify-between gap-3"},[a("h2",{class:"text-lg font-semibold text-slate-300"},"Activité récente")],-1)),It=E(()=>a("div",{class:"mt-4 flex items-center justify-between gap-3"},[a("h2",{class:"text-lg font-semibold text-slate-300"},"Les plus utilisés")],-1)),zt={class:"col-span-2"},Qt=M({__name:"HomePage",setup($){const{user:i}=D(),{displayLandscapeAnalysis:_,displayLandmarks:h,loadUserLenses:p}=R(),d=b(()=>{var e;const o=(e=_.value)==null?void 0:e.id,r={tab:"compare"};return o&&(r.id=o),{name:"analysis",query:r}}),y=b(()=>{var e;const o=(e=_.value)==null?void 0:e.id,r={tab:"timeline"};return o&&(r.id=o),{name:"analysis",query:r}}),x={name:"Gon",image:"https://i.pinimg.com/originals/93/d7/e8/93d7e8cb60b17a0d12ac40e26f71064e.jpg"},w=b(()=>{var r,e;return[`Bonjour ${((e=(r=i.value)==null?void 0:r.first_name)==null?void 0:e.trim())||"toi"}-San !`,"Bienvenue sur Matière Grise, je suis si content de te voir ici ! Je suis Gon, ton mentor. Je suis ici pour t'aider à progresser dans tes projets. L'important c'est de s'amuser et de relever des défis. Ensemble, on va soulever des montagnes !","Hoooooosss !!!"].join(`
`)}),g=b(()=>{const o=h.value.filter(e=>String((e==null?void 0:e.landmark_type)??(e==null?void 0:e.landmarkType)??"").trim().toUpperCase()==="HIGH_LEVEL_PROJECT");if(o.length===0)return[{id:null,text:"Partant.e pour travailler sur tes grands projets ??"}];const r=o.map(e=>{const u=typeof(e==null?void 0:e.id)=="string"?e.id:null,m=String((e==null?void 0:e.title)??"").trim(),t=String((e==null?void 0:e.content)??"").trim();return m&&t&&t!==m?{id:u,text:`${m}
${t}`}:m?{id:u,text:m}:t?{id:u,text:t}:{id:u,text:""}}).filter(e=>e.text.length>0);return r.length>0?r:[{id:null,text:"Partant.e pour travailler sur tes grands projets ??"}]});return J(()=>{var o;return(o=i.value)==null?void 0:o.id},async o=>{o&&await p()},{immediate:!0}),(o,r)=>{const e=N("router-link");return l(),c("div",kt,[a("div",Lt,[St,a("div",jt,[f(e,{to:{name:"journalPad"},class:"text-sm underline text-slate-300 hover:text-slate-100 transition-colors"},{default:L(()=>[k(" Continuer le journal ")]),_:1}),f(e,{to:d.value,class:"text-sm underline text-slate-300 hover:text-slate-100 transition-colors"},{default:L(()=>[k(" Analyse > ")]),_:1},8,["to"])])]),a("div",At,[a("section",Tt,[a("div",Ct,[a("article",Et,[a("div",Mt," Message de ton mentor "+S(x.name),1),a("div",Bt,[a("img",{src:x.image,alt:`Mentor ${x.name}`,class:"w-9 h-9 rounded-lg object-cover flex-none"},null,8,Vt),a("span",Pt,S(w.value),1)]),a("div",Jt,[f(e,{to:"/app/mentor",class:"text-xs underline text-slate-400 hover:text-slate-100 transition-colors"},{default:L(()=>[k(" Voir 4 autres messages ")]),_:1})])]),a("article",Nt,[Ht,a("ul",Ft,[(l(!0),c(H,null,F(g.value,u=>(l(),c("li",{key:u.id??u.text,class:"whitespace-pre-line"},[k(" • "+S(u.text)+" ",1),u.id?(l(),B(e,{key:0,to:{name:"seeLandmark",params:{id:u.id}},class:"ml-1 underline text-slate-400 hover:text-slate-200 transition-colors"},{default:L(()=>[k(" voir plus ")]),_:2},1032,["to"])):C("",!0)]))),128))])])])]),a("div",qt,[a("div",Rt,[a("section",Wt,[Dt,a("div",Ot,[f(wt,{compact:"","compact-weeks-limit":22,frameless:!0,title:null})]),a("div",Ut,[f(e,{to:y.value,class:"text-xs text-slate-400 underline hover:text-slate-200 transition-colors"},{default:L(()=>[k(" voir plus ")]),_:1},8,["to"])])]),Gt,f(nt),It,f(mt)]),a("div",zt,[f(K,{class:"mb-10"})])])])])}}});const se=Q(Qt,[["__scopeId","data-v-9a15c407"]]);export{se as default};
