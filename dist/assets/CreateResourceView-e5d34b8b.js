import{s as h,d as g,b as r,h as I,o as n,f as v,i as s,v as L,c as w,w as D,m as A,n as d,l as E,a as V,_ as N,q as T}from"./index-358482ac.js";import{_}from"./TextInput.vue_vue_type_script_setup_true_lang-bf1abd80.js";import{_ as p}from"./ActionButton.vue_vue_type_script_setup_true_lang-bd9451a6.js";import{_ as B}from"./UserPicker.vue_vue_type_script_setup_true_lang-7ba279ba.js";import{u as F}from"./useResource-396cd41f.js";import{u as K}from"./useInteraction-84c03a67.js";async function S(f){return(await h.post("/link_preview",f)).data}function q(){return{postLinkPreview:S}}const O=g({__name:"ExternalResourcePreview",emits:["change"],setup(f,{emit:o}){const{postLinkPreview:y}=q(),x=async()=>{const u=await y({external_content_url:e.value});console.log(u),m.value=e.value,o("change",u)},e=r(""),m=r(""),b=I(()=>m.value!==e.value);return(u,i)=>(n(),v("div",null,[s(_,{modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=c=>e.value=c),class:"mb-4",onKeyup:L(x,["enter"]),label:"Lien ressource externe"},null,8,["modelValue","onKeyup"]),b.value?(n(),w(p,{key:0,class:"mb-4",text:"Preview",onClick:x,type:"valid"},{default:D(()=>[A("Générer")]),_:1})):d("",!0)]))}}),G={class:"mt-10 mx-5"},W={key:0},j={key:1},z={key:2},H={key:1},J=["src"],M=g({__name:"CreateResourceProcess",setup(f){const o=r(0),{newResource:y,createResource:x}=F(),e=r({id:"",title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"",maturing_state:"",image_url:"",resource_type:"",comment:"",is_local_draft:!0}),m=a=>{c.value=a,a?(o.value=1,e.value.maturing_state="fnsh"):(u.value=b.value.id,e.value.maturing_state="idea",o.value=1,i.value=new Date(Date.now()).toISOString().split("T")[0])},{user:b}=T(),u=r(null),i=r(null),c=r(!1),k=r(!1),P=a=>{console.log("apply preview : ",a),e.value.title=a.title,e.value.subtitle=a.subtitle,e.value.image_url=a.image_url,e.value.content=a.content,e.value.resource_type=a.resource_type,e.value.external_content_url=a.external_content_url,k.value=!0},C=r([{text:"Livre",value:"book"},{text:"Fiche de lecture",value:"shet"},{text:"Article de média",value:"natc"},{text:"Article de recherche",value:"ratc"},{text:"Film",value:"movi"},{text:"Podcast",value:"pcst"}]),{createInteractionForResource:R,newInteraction:X}=K(),U=E(),$=async()=>{const a=await x(e.value),t={interaction_user_id:u.value,resource_id:a.id,interaction_progress:c?100:0,interaction_date:new Date(i.value),interaction_comment:"",interaction_is_public:!!c.value};await R(a.id,t),U.push({path:"/resources/"+a.id,query:{editing:"false"}})};return(a,t)=>(n(),v("div",G,[o.value===0?(n(),v("div",W,[V("div",null,[s(p,{class:"mb-2",text:"Resource Externe",type:"valid",onClick:t[0]||(t[0]=l=>m(!0))}),s(p,{text:"Production personnelle",type:"valid",onClick:t[1]||(t[1]=l=>m(!1))})])])):d("",!0),o.value===1?(n(),v("div",j,[s(B,{class:"mb-4",modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=l=>u.value=l)},null,8,["modelValue"]),u.value?(n(),w(_,{key:0,class:"text-2xs mb-4",label:"Date d'écriture","model-value":i.value,"onUpdate:modelValue":t[3]||(t[3]=l=>i.value=l),type:"date"},null,8,["model-value"])):d("",!0),s(p,{type:"valid",text:"Valider",onClick:t[4]||(t[4]=l=>o.value=2)})])):d("",!0),o.value===2?(n(),v("div",z,[V("div",null,[c.value?(n(),w(O,{key:0,onChange:t[5]||(t[5]=l=>P(l))})):d("",!0),!c.value||k.value?(n(),v("div",H,[s(_,{class:"mb-4",modelValue:e.value.title,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.title=l),label:"Titre"},null,8,["modelValue"]),s(_,{class:"mb-4",modelValue:e.value.subtitle,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.subtitle=l),label:"Description"},null,8,["modelValue"]),s(_,{class:"mb-4",modelValue:e.value.image_url,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.image_url=l),label:"Url de l'image"},null,8,["modelValue"]),V("img",{class:"mb-4",src:e.value.image_url},null,8,J),s(N,{label:"Type de ressource",class:"mb-4",choices:C.value,modelValue:e.value.resource_type,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.resource_type=l)},null,8,["choices","modelValue"]),s(p,{class:"mb-4",text:"Créer",onClick:$,type:"valid"})])):d("",!0)])])):d("",!0)]))}}),Q={class:"w-full"},se=g({__name:"CreateResourceView",setup(f){return(o,y)=>(n(),v("div",Q,[s(M)]))}});export{se as default};
