import{o as s,c as v,f as n,d as k,t as b,r as h,j as A,u as q,a as w,i as y,h as i,_ as T,e as K,k as Q,l as W,F as X,m as Y,n as S,p as Z,q as H,s as re,w as O,v as ne,x as ie,y as G,z as J}from"./index-6c02f670.js";import{_ as ee,a as de}from"./ThoughtInputsList.vue_vue_type_script_setup_true_lang-96ed16e6.js";import{u as ce}from"./useThoughtInputs-35710700.js";import{u as te,a as me}from"./useThoughtOutput-ec10b25f.js";import{_ as pe,u as ve}from"./TextInterface.vue_vue_type_script_setup_true_lang-a0d3e21a.js";import{_ as V}from"./TextInput.vue_vue_type_script_setup_true_lang-273045be.js";function _e(f,d){return s(),v("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}const ge={class:"m-4"},he={class:"block text-2xs text-slate-800"},fe=["value","placeholder"],N=k({__name:"TextAreaInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue"],setup(f,{emit:d}){const c=t=>{d("update:modelValue",t.target.value)};return(t,m)=>(s(),v("div",ge,[n("label",he,b(t.label),1),n("textarea",{class:"border border-neutral-800 block h-full w-full",value:t.modelValue,placeholder:t.placeholder,onInput:m[0]||(m[0]=r=>c(r))},null,40,fe)]))}}),be={key:0},ye={key:2},xe={class:"flex flex-row-reverse"},Ve=k({__name:"CreateThoughtInputUsageForm",props:{thoughtOutput:{}},emits:["close","refresh"],setup(f,{emit:d}){const c=f,{user:t}=K(),m=h([]),r=h(null),o=h(""),{createThoughtInputUsage:l}=te(),e=async()=>{if(console.log("create"),!r.value)return;const C={thought_output_id:c.thoughtOutput.id,thought_input_id:r.value.id,usage_reason:o.value};await l(C),d("refresh"),d("close")},{getUserThoughtInputs:a}=ce(),I=C=>{r.value=C};return A(async()=>{!t.value||!t.value.id||(m.value=await a(t.value.id))}),(C,x)=>(s(),v("div",null,[q(t)?(s(),v("div",be,"Nouvelle utilisation par "+b(q(t).first_name)+" "+b(q(t).last_name),1)):w("",!0),r.value?(s(),v("div",ye,[i(N,{label:"Pourquoi ajouter cet élément ?",modelValue:o.value,"onUpdate:modelValue":x[1]||(x[1]=$=>o.value=$)},null,8,["modelValue"]),n("div",xe,[i(T,{type:"valid",onClick:e,text:"Ajouter"}),i(T,{type:"abort",onClick:x[2]||(x[2]=$=>d("close")),text:"Ajouter"})])])):(s(),y(ee,{key:1,"thought-inputs":m.value,center:"",onSelect:x[0]||(x[0]=$=>I($))},null,8,["thought-inputs"]))]))}}),ke={class:"justify-items-center mx-auto flex flex-wrap max-w-full"},$e=k({__name:"ToggleButtonGroup",props:{choices:{},default:{}},setup(f){const d=f,c=h(null),t=Q(),m=W(),r=o=>{c.value=o;const l=m.query,e=m.path;t.push({path:e,query:{...l,tab:o}}),console.log(`route : ${JSON.stringify(m)}`)};return A(()=>r(d.default??"")),(o,l)=>(s(),v("div",ke,[(s(!0),v(X,null,Y(o.choices,e=>(s(),y(T,{key:e.value,class:"w-24 my-1 mx-1",text:e.text,onClick:a=>r(e.value),type:e.value==c.value?"valid":"abort"},null,8,["text","onClick","type"]))),128))]))}}),Ce={class:"block text-2xs text-slate-800"},Ue=["value"],we=["value"],L=k({__name:"SelectInput",props:{label:{},choices:{},modelValue:{}},emits:["update:modelValue"],setup(f,{emit:d}){const c=t=>{d("update:modelValue",t.target.value)};return(t,m)=>(s(),v("div",null,[n("label",Ce,b(t.label),1),n("select",{value:t.modelValue,name:"Stade d'écriture",class:"text-xs w-full p-1 block rounded border-2 border-neutral-400",onInput:m[0]||(m[0]=r=>c(r))},[(s(!0),v(X,null,Y(t.choices,r=>(s(),v("option",{key:r.value,value:r.value},b(r.text),9,we))),128))],40,Ue)]))}}),Te={class:"m-4"},Ie={class:"block text-2xs text-slate-800"},Oe=["value","placeholder"],le=k({__name:"NumberInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue","input"],setup(f,{emit:d}){const c=t=>{d("update:modelValue",t.target.value),d("input",t.target.value)};return(t,m)=>(s(),v("div",Te,[n("label",Ie,b(t.label),1),n("input",{class:"border border-neutral-400 block h-full w-full rounded-md border-2 p-1 pl-2 text-xs",type:"number",value:t.modelValue,placeholder:t.placeholder,onInput:m[0]||(m[0]=r=>c(r))},null,40,Oe)]))}}),qe={class:"flex"},Ae={class:"ml-auto h-6 m-4 w-1/3"},Se={class:"ml-auto h-6 m-4 w-1/3"},Be={class:"flex"},je=k({__name:"ArticleForm",props:{article:{}},emits:["change"],setup(f,{emit:d}){const c=f,t=h([{text:"Terminé",value:"fnsh"},{text:"Relecture",value:"rvew"},{text:"Idée",value:"idea"}]),{categories:m}=Z(),r=S(()=>m.value.map(l=>({text:l.display_name,value:l.id}))),o=(l,e)=>{let a={...c.article};a[l]=e,d("change",a)};return(l,e)=>(s(),v("div",null,[i(V,{label:"Titre",modelValue:l.article.resource_title,"onUpdate:modelValue":e[0]||(e[0]=a=>o("resource_title",a))},null,8,["modelValue"]),i(V,{class:"h-6",label:"Sous-titre",modelValue:l.article.resource_subtitle,"onUpdate:modelValue":e[1]||(e[1]=a=>o("resource_subtitle",a))},null,8,["modelValue"]),n("div",qe,[i(le,{class:"mr-auto h-6",label:"Progression",modelValue:l.article.progress,"onUpdate:modelValue":e[2]||(e[2]=a=>o("progress",a))},null,8,["modelValue"]),n("div",Ae,[i(L,{label:"Catégorie",choices:r.value,"model-value":l.article.resource_category_id,"onUpdate:modelValue":e[3]||(e[3]=a=>o("resource_category_id",a))},null,8,["choices","model-value"])]),n("div",Se,[i(L,{label:"Stade d'écriture",choices:t.value,"model-value":l.article.maturing_state,"onUpdate:modelValue":e[4]||(e[4]=a=>o("maturing_state",a))},null,8,["choices","model-value"])])]),n("div",Be,[i(V,{class:"h-6",label:"Lien contenu externe",modelValue:l.article.resource_external_content_url,"onUpdate:modelValue":e[5]||(e[5]=a=>o("resource_external_content_url",a))},null,8,["modelValue"]),i(V,{class:"h-6",label:"Lien image",modelValue:l.article.resource_image_url,"onUpdate:modelValue":e[6]||(e[6]=a=>o("resource_image_url",a))},null,8,["modelValue"]),i(V,{class:"h-6",label:"Suffix url",modelValue:l.article.url_slug,"onUpdate:modelValue":e[7]||(e[7]=a=>o("url_slug",a))},null,8,["modelValue"])]),i(N,{label:"Pistes d'amélioration",modelValue:l.article.resource_comment,"onUpdate:modelValue":e[8]||(e[8]=a=>o("resource_comment",a))},null,8,["modelValue"])]))}}),Pe={class:"flex"},Fe={class:"ml-auto h-6 m-4 w-1/3"},Le={class:"flex"},Ne=k({__name:"ProblemForm",props:{problem:{}},emits:["change"],setup(f,{emit:d}){const c=f,{categories:t}=Z(),m=S(()=>t.value.map(o=>({text:o.display_name,value:o.id}))),r=(o,l)=>{let e={...c.problem};e[o]=l,d("change",e)};return(o,l)=>(s(),v("div",null,[i(V,{label:"Titre",modelValue:o.problem.resource_title,"onUpdate:modelValue":l[0]||(l[0]=e=>r("resource_title",e))},null,8,["modelValue"]),i(V,{class:"h-6",label:"Description",modelValue:o.problem.resource_subtitle,"onUpdate:modelValue":l[1]||(l[1]=e=>r("resource_subtitle",e))},null,8,["modelValue"]),n("div",Pe,[i(le,{class:"mr-auto h-6",label:"Progression",modelValue:o.problem.progress,"onUpdate:modelValue":l[2]||(l[2]=e=>r("progress",e))},null,8,["modelValue"]),n("div",Fe,[i(L,{label:"Catégorie",choices:m.value,"model-value":o.problem.resource_category_id,"onUpdate:modelValue":l[3]||(l[3]=e=>r("resource_category_id",e))},null,8,["choices","model-value"])])]),n("div",Le,[i(V,{class:"h-6",label:"Lien image",modelValue:o.problem.resource_image_url,"onUpdate:modelValue":l[4]||(l[4]=e=>r("resource_image_url",e))},null,8,["modelValue"])])]))}}),De={key:0,class:"px-8 mx-auto"},Me={key:0},Re={class:"my-8"},ze=["src"],Ee={class:"text-3xl my-3 font-mplus md:text-center text-left"},He={class:"md:text-center text-left"},Ge={class:"md:text-center text-left"},Je={class:"md:flex my-8"},Ke=["href"],Qe={key:1},We={class:"flex flex-row-reverse"},Xe={key:1,class:"p-2 border rounded bg-neutral-100"},Ye=n("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Ze={key:2},et={key:3},rt=k({__name:"SeeArticle",props:{id:{}},setup(f){const d=f,c=W(),t=S(()=>u.value),m=h([{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli"}]),r=h(c.query.tab&&typeof c.query.tab=="string"?c.query.tab:"ctnt"),o=h(null);H(()=>c.query.tab,_=>{console.log("new route query",_),typeof _=="string"&&(o.value=_)});const{getThoughtInputUsagesForThoughtOutput:l}=te(),e=h([]),a=h(!1),I=async()=>{e.value=await l(G(d).id.value)};A(()=>I());const{newThoughtOutput:C,getThoughtOutput:x,updateThoughtOutput:$}=me(),B=h(null),u=h(C()),oe=Q();H(()=>c.query.editing,_=>{console.log("Editing : ",_),j.value=_==="false"?!1:!!_});const j=h(!1),D=_=>{oe.push({query:{editing:_.toString()}})},ue=()=>{!u.value||!u.value.id||(u.value.publishing_state="pbsh",$(u.value.id,u.value))},P=(_,p)=>{u.value=p,B.value!==null&&clearTimeout(B.value),B.value=setTimeout(async()=>{try{await $(_,u.value)}catch(F){console.log("An error : ",F)}},1e3)},M=_=>{_!=`
`&&P(G(d).id.value,{...u.value,resource_content:_})},{user:R,getUserById:se}=K(),z=S(()=>R.value?u.value.author_id==R.value.id:!1),U=h(null),{getCommentsForThoughtOutput:ae}=ve(),E=h([]);return A(async()=>{u.value=await x(d.id),E.value=await ae(d.id),u.value.author_id&&(U.value=await se(u.value.author_id));const _=c.query.editing;j.value=_==="false"?!1:!!_}),(_,p)=>{const F=re("router-link");return u.value?(s(),v("div",De,[j.value?(s(),v("div",Qe,[u.value.resource_type=="atcl"?(s(),y(je,{key:0,article:t.value,onChange:p[1]||(p[1]=g=>P(u.value.id,g))},null,8,["article"])):(s(),y(Ne,{key:1,problem:u.value,onChange:p[2]||(p[2]=g=>P(u.value.id,g))},null,8,["problem"])),n("div",We,[i(T,{class:"mx-4",onClick:p[3]||(p[3]=g=>D(!1)),type:"valid",text:"Preview"},{default:O(()=>[J("Ok")]),_:1}),u.value.publishing_state=="drft"?(s(),y(T,{key:0,onClick:ue,type:"valid",text:"Publier"})):(s(),v("div",Xe,"Publié"))])])):(s(),v("div",Me,[n("div",Re,[n("img",{src:u.value.resource_image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto"},null,8,ze)]),n("h1",Ee,b(u.value.resource_title),1),n("div",He,b(u.value.resource_subtitle),1),n("div",Ge,[U.value?(s(),y(F,{key:0,to:"/users/"+U.value.id,class:"text-sm underline"},{default:O(()=>[J(b(U.value.first_name)+" "+b(U.value.last_name),1)]),_:1},8,["to"])):w("",!0)]),z.value?(s(),y(ne,{key:0,onClick:p[0]||(p[0]=g=>D(!0))},{default:O(()=>[i(q(_e),{class:"m-1"})]),_:1})):w("",!0),n("div",Je,[i(ie,{"progress-value":u.value.progress,class:"m-2 w-1/3"},null,8,["progress-value"]),u.value.resource_type==="atcl"?(s(),v("a",{key:0,class:"ml-auto underline",href:t.value.resource_external_content_url}," Ajouter un commentaire ",8,Ke)):w("",!0)])])),n("div",null,[i($e,{choices:m.value,default:r.value},null,8,["choices","default"])]),Ye,o.value=="ctnt"?(s(),v("div",Ze,[u.value.publishing_state!="drft"?(s(),y(pe,{key:0,"ext-comments":E.value,"ressource-id":u.value.id,"full-text":u.value.resource_content,editable:z.value,onChange:p[4]||(p[4]=g=>M(g))},null,8,["ext-comments","ressource-id","full-text","editable"])):(s(),y(N,{key:1,class:"h-96",label:"Contenu",modelValue:u.value.resource_content,"onUpdate:modelValue":p[5]||(p[5]=g=>M(g))},null,8,["modelValue"]))])):(s(),v("div",et,[i(de,{open:a.value,onClose:p[7]||(p[7]=g=>a.value=!1)},{default:O(()=>[i(Ve,{onRefresh:I,onClose:p[6]||(p[6]=g=>a.value=!1),"thought-output":u.value},null,8,["thought-output"])]),_:1},8,["open"]),n("div",{onClick:p[8]||(p[8]=g=>a.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),i(ee,{"thought-inputs":e.value.map(g=>g.thought_input),"usage-reasons":e.value.map(g=>g.usage_reason)},null,8,["thought-inputs","usage-reasons"])]))])):w("",!0)}}});export{rt as default};
