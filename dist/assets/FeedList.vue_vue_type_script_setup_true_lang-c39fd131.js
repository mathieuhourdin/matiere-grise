import{o as r,f as s,a as n,d as k,i as c,p as m,n as P,I as j,b as f,h as x,G as M,t as v,m as B,e as R,r as z,c as F,L as A,w as C,q as I,F as V,g as H,A as N}from"./index-e6722798.js";import{u as S}from"./useResourceRelations-e4293372.js";import{u as U}from"./useResource-9f996768.js";const q=i=>{if(!i)return[];const e=i.replace(/\?/g,"?.").split(".");let t=0;const l=[];for(;t<e.length;){let a=0,_=[];if(e[t].length>=270)l.push(e[t].replace("/?./g","?")),t++;else{for(;t<e.length&&a+e[t].length<270;)_.push(e[t]),a+=e[t].length,t++;l.push(_.join(". ").replace("/?./g","?"))}}return l},D=i=>i?i.split(`
`).map(t=>q(t)).flat():[],T={splitTextForPanel:D};function E(i,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 15.75L3 12m0 0l3.75-3.75M3 12h18"})])}function G(i,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3"})])}function O(i,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function J(i,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})])}function K(i,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z"})])}function Q(i,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}function W(i,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"})])}const X={class:"flex"},Y={class:"w-8 mr-1"},Z={key:0,title:"Production"},ee={key:1,title:"Consommation"},te={class:"w-7"},oe={key:0,title:"Article d'actualité"},re={key:1,title:"Problématique"},ne={key:2,title:"Autre"},se=k({__name:"FeedCardTypeIcon",props:{interaction:{}},setup(i){return(e,t)=>(r(),s("div",X,[n("div",Y,[e.interaction.interaction_type==="outp"?(r(),s("div",Z,[c(m(G))])):e.interaction.interaction_type==="inpt"?(r(),s("div",ee,[c(m(E))])):P("",!0)]),n("div",te,[e.interaction.resource.resource_type==="natc"?(r(),s("div",oe,[c(m(K),{class:"w-full my-auto text-red-800"})])):e.interaction.resource.resource_type==="pblm"?(r(),s("div",re,[c(m(W),{class:"w-full my-auto text-blue-800"})])):(r(),s("div",ne,[c(m(j),{class:"w-full my-auto text-red-800"})]))])]))}}),ie=["src"],ae={class:"text-bold mb-2"},le={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},ce=k({__name:"FeedCardTextInterface",props:{interaction:{}},setup(i){const e=i,t=u=>{if(u>0&&u<=p.value.length){const d=p.value[u-1];return{text:d.replace(/#/g,""),header:u===1?"Commentaire : ":null,class:{"font-black":d.charAt(0)==="#","bg-gray-700":!0}}}else{const d=g.value[u-p.value.length-1];return{text:d.replace(/#/g,""),header:u===p.value.length+1?"Contenu : ":null,class:{"font-black":d.charAt(0)==="#","bg-slate-700":!0}}}},l=f(0),a=()=>{l.value=(l.value+1)%h.value},_=x(()=>`${l.value+1}/${h.value}`),h=x(()=>p.value.length+g.value.length+1),g=x(()=>T.splitTextForPanel(e.interaction.resource.content)),p=x(()=>T.splitTextForPanel(e.interaction.context_comment)),y=()=>{const u=w.value.offsetHeight;w.value.style.height=`${u}px`},w=f(null);return(u,d)=>(r(),s("div",{onClick:a,class:"overflow-auto relative w-full md:h-4/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:w},[l.value==0?(r(),s("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:u.interaction.resource.image_url,onLoad:y},null,40,ie)):(r(),s("div",{key:1,class:M(["overflow-auto h-full overflow-scroll p-1 pt-8 border",t(l.value).class])},[n("div",{class:M([t(l.value).class,"text-center text-sm my-auto text-white"])},[n("div",ae,v(t(l.value).header),1),B(" "+v(t(l.value).text),1)],2)],2)),n("div",le,v(_.value),1)],512))}}),ue={class:"flex flex-col border p-1.5 overflow-auto"},de={class:"flex"},he={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},pe={class:"flex"},me={title:"Coming Soon ;)",class:"w-6"},_e={title:"Coming Soon ;)",class:"w-6"},ve={class:"flex"},fe={class:"text-2xs"},ge={class:""},we={class:"mb-2 font-bold text-sm"},xe={class:"text-2xs mb-auto"},ke=k({__name:"FeedCard",props:{interaction:{}},setup(i){const e=i,t=o=>o?o.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",l=o=>o==="outp"?"Production personnelle":"Bibliographie",{resourceTypeOptions:a}=U(),_=o=>a.find($=>$.value===o).text;f(null);const h=f(null),g=o=>o?o.length>200?o.slice(0,150)+"...":o:"",p=f([]),{getResourceRelationsForResource:y}=S(),w=async()=>{e.interaction.id&&(p.value=await y(e.interaction.resource.id))},{getUserById:u}=I(),d=f(!1),L=async()=>{try{h.value=await u(e.interaction.user_id)}catch(o){console.log(o)}d.value=!0};return R(async()=>{await w(),await L()}),(o,$)=>{const b=z("router-link");return r(),s("div",ue,[n("div",de,[d.value?(r(),F(A,{key:0,class:"flex mb-1.5 h-8",user:h.value,secondText:t(o.interaction.date),firstBottomText:l(o.interaction.interaction_type),secondBottomText:o.$t(_(o.interaction.resource.resource_type))},null,8,["user","secondText","firstBottomText","secondBottomText"])):(r(),s("div",he)),c(se,{interaction:o.interaction,class:"ml-auto"},null,8,["interaction"])]),c(ce,{interaction:o.interaction},null,8,["interaction"]),n("div",pe,[n("div",me,[c(m(J),{class:"w-full my-auto"})]),n("div",_e,[c(m(Q),{class:"w-full my-auto"})]),c(b,{to:"/resources/"+o.interaction.resource.id+"/feed",class:"ml-auto"},{default:C(()=>[c(m(O),{class:"w-8"})]),_:1},8,["to"])]),n("div",ve,[n("div",fe,v(Math.floor(Math.random()*100))+" likes",1),c(b,{to:"/resources/"+o.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:C(()=>[B(v(p.value.length)+" relations ",1)]),_:1},8,["to"])]),c(b,{class:"",to:"/resources/"+o.interaction.resource.id},{default:C(()=>[n("div",ge,[n("div",we,v(o.interaction.resource.title),1),n("div",xe,v(g(o.interaction.resource.subtitle)),1)])]),_:1},8,["to"])])}}}),ye={class:"flex flex-col"},Me=k({__name:"FeedList",props:{interactionsList:{}},setup(i){const e=i,{feedFilter:t}=N(),l=x(()=>e.interactionsList.filter(a=>t.value==="production"?a.interaction_type==="outp"&&!a.resource.is_external&&a.resource.resource_type!=="pblm":t.value==="draft"?a.interaction_type==="outp"&&!a.resource.is_external&&a.resource.resource_type!=="pblm"&&a.resource.publishing_state==="drft":t.value==="reviews"?a.interaction_type==="rvew":t.value==="problem"?a.resource.resource_type==="pblm":t.value==="biblio"?a.interaction_type==="inpt":!0));return(a,_)=>(r(),s("div",ye,[(r(!0),s(V,null,H(l.value,(h,g)=>(r(),F(ke,{class:"md:mb-2 flex-grow md:rounded max-h-screen border-b-1 border-black",interaction:h,key:h.id},null,8,["interaction"]))),128))]))}});export{Me as _};
