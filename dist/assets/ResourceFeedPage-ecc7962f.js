import{_ as w}from"./FeedList.vue_vue_type_script_setup_true_lang-ea791a7f.js";import{u as k}from"./useResourceRelations-81e23492.js";import{d as b,r as d,o as F,a0 as R,c as a,e as D,F as A,g as C,s as V,n as B,b as s,l as m,t as c,k as N}from"./index-b61a6c83.js";import"./UserMini.vue_vue_type_script_setup_true_lang-1ae7b261.js";import"./PaperAirplaneIcon-a591468d.js";const $={key:0,class:"mt-1 md:w-96 mx-auto"},L={key:1,class:"mt-10 mx-4 md:w-11/12 md:mx-auto"},M={key:0},P={class:"text-lg font-bold mb-2"},S={class:"text-sm dark:text-gray-300 text-gray-700 mb-2"},T={class:"text-sm dark:text-gray-300 text-gray-500 whitespace-pre-line"},z=b({__name:"ResourceFeedPage",props:{id:{}},setup(v){const l=v,{getResource:h,getAuthorInteractionForResource:y}=V(),{headerValue:_}=B(),o=d(null),{getAllRelationsForResource:f}=k(),p=d([]),u=d([]),x=async()=>{const r=await Promise.all(p.value.map(async e=>{const t=e.origin_resource_id===l.id?e.target_resource:e.origin_resource;let i=e.created_at;try{const n=await y(t.id);n&&n.interaction_date&&(i=n.interaction_date)}catch(n){console.warn(`Could not fetch author interaction for resource ${t.id}:`,n)}return{resource:t,date:i,user_id:e.user_id,context_comment:e.relation_comment,interaction_type:"bibl",progress:null,id:e.id,...e}}));u.value=r.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())},g=r=>{const e=r.toLocaleString("fr-FR",{weekday:"long",day:"numeric",month:"short",year:"numeric"});return e.charAt(0).toUpperCase()+e.slice(1)};return F(async()=>{p.value=await f(l.id),o.value=await h(l.id),o.value&&(_.value={text:o.value.title,link:`/resources/${o.value.id}`}),await x()}),R(()=>{_.value=null}),(r,e)=>(s(),a("div",null,[o.value&&o.value.resource_type!=="jrnl"?(s(),a("div",$,[D(w,{"interactions-list":u.value},null,8,["interactions-list"])])):(s(),a("div",L,[(s(!0),a(A,null,C(u.value,(t,i)=>(s(),a("div",{key:i,class:"mb-6"},[t.resource?(s(),a("div",M,[m("div",P,c(g(new Date(t.date)))+" - "+c(t.resource.title),1),m("div",S,c(t.resource.subtitle),1),m("div",T,c(t.resource.content),1)])):N("",!0)]))),128))]))]))}});export{z as default};
