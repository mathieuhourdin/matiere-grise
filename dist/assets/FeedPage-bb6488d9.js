import{_ as g}from"./FeedList.vue_vue_type_script_setup_true_lang-7656f691.js";import{d as u,q as b,r as x,o as l,j as w,w as y,b as i,s as R,v as D,t as k,k as f,l as v,c as d,F,n as A,x as B,a as p,y as P}from"./index-2358f579.js";import{u as $}from"./useResourceRelations-b6b35d9c.js";import"./UserMini.vue_vue_type_script_setup_true_lang-5faff31f.js";const C={class:"w-16 md:w-12 mx-auto"},j=["src"],z={class:"text-center overflow-hidden mt-1 text-xs",style:{display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":"3"}},I=u({__name:"FollowedProblem",props:{problem:{}},setup(c){const r=c,s=b(()=>r.problem.lastRelationAddedDate>new Date(0)&&r.problem.lastRelationAddedDate>new Date(Date.now()-1e5*60*60*24*7));return(t,n)=>{const a=x("router-link");return l(),w(a,{to:"/me/resources/"+t.problem.id+"/feed",class:"m-1"},{default:y(()=>[i("div",C,[i("img",{src:t.problem.image_url,class:R(["border-2 border-zinc-400 rounded-full max-w-full aspect-[2/2] object-cover object-center w-full",s.value?"border-red-500 border-4":""]),style:D(s.value?"border-color: rgb(106, 45, 45)":"")},null,14,j)]),i("div",z,k(t.problem.title),1)]),_:1},8,["to"])}}}),N={class:"flex"},S=u({__name:"FollowedProblemsList",setup(c){const{getResources:r}=B(),{getResourceRelationsForResource:s}=$(),t=f([]);return v(async()=>{const n=await r({is_external:!1,resource_type:"pblm"}),a=await Promise.all(n.map(async e=>{const o=await s(e.id),h=o.reduce((m,_)=>new Date(_.created_at)>m?new Date(_.created_at):m,new Date(0));return{...e,bibliography:o,lastRelationAddedDate:h}}));t.value=a.sort((e,o)=>o.lastRelationAddedDate.getTime()-e.lastRelationAddedDate.getTime())}),(n,a)=>(l(),d("div",N,[(l(!0),d(F,null,A(t.value,e=>(l(),w(I,{problem:e,class:"shrink-0 grow-0 w-16"},null,8,["problem"]))),256))]))}}),L={class:"mt-1"},E=u({__name:"FeedPage",setup(c){const{getReadAndWriteInteractions:r,interactionSortFunction:s}=P(),t=f([]),n=b(()=>t.value.map(e=>({resource:e.resource,date:e.interaction_date,post_date:e.interaction_type==="inpt"?e.interaction_date:new Date(e.resource.created_at),user_id:e.interaction_user_id,context_comment:e.interaction_comment,progress:e.interaction_progress,...e})).sort((e,o)=>s(o)-s(e))),a=async()=>t.value=await r();return v(async()=>{await a()}),(e,o)=>(l(),d("div",L,[p(S,{class:"overflow-x-scroll mb-2 md:mx-8",style:{"scrollbar-width":"none","-ms-overflow-style":"none"}}),p(g,{"interactions-list":n.value,class:"md:w-2/3 mx-auto"},null,8,["interactions-list"])]))}});export{E as default};
