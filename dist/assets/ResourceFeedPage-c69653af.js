import{_ as C}from"./FeedList.vue_vue_type_script_setup_true_lang-713b8704.js";import{u as I}from"./useResourceRelations-69f23967.js";import{d as k,j as x,b as o,c as n,l as u,t as g,p as F,r as v,o as R,e as b,z as D,F as $,g as A,h as L,k as w,O as z,B,s as j,n as T}from"./index-51450bb9.js";import"./UserMini.vue_vue_type_script_setup_true_lang-27ac5549.js";import"./PaperAirplaneIcon-9f02bb95.js";const V=["title"],N={class:"truncate max-w-[200px]"},E=k({__name:"Chip",props:{text:{},tooltip:{default:""},maxLength:{default:30}},setup(d){const r=d,m=x(()=>r.text.length<=r.maxLength?r.text:r.text.substring(0,r.maxLength)+"..."),l=x(()=>r.tooltip||r.text);return(i,a)=>(o(),n("div",{class:F(["inline-flex items-center px-2 py-1 rounded-md text-xs font-medium transition-colors duration-200","bg-slate-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200","border border-slate-300 dark:border-gray-600","hover:bg-slate-300 dark:hover:bg-gray-600"]),title:l.value},[u("span",N,g(m.value),1)],8,V))}}),M={key:0},P={class:"flex justify-between items-center"},S={class:"text-lg font-bold mb-2"},W={key:0,class:"flex flex-wrap gap-2 mb-2"},J={class:"text-sm dark:text-gray-300 text-gray-700 mb-2"},O={class:"text-sm dark:text-gray-300 text-gray-500 whitespace-pre-line"},U=k({__name:"JournalItem",props:{resourceItem:{}},setup(d){const r=d,{getAllRelationsForResource:m}=I(),l=v([]),i=v(!1),a=async()=>{i.value=!0;try{const e=await z.post("/lens",{target_trace_id:r.resourceItem.resource.id});console.log("Lens created:",e.data)}catch(e){console.error("Error creating lens:",e)}finally{i.value=!1}},h=x(()=>l.value.filter(e=>e.origin_resource)),f=e=>e.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),_=e=>{if(!e.origin_resource)return"";const s=[];return s.push(e.origin_resource.title),e.origin_resource.subtitle&&s.push(e.origin_resource.subtitle),e.relation_comment&&s.push(`Commentaire: ${e.relation_comment}`),e.origin_resource.content&&s.push(e.origin_resource.content),s.join(`
`)};return R(async()=>{const e=await m(r.resourceItem.resource.id);l.value=e.filter(s=>s.relation_type==="elmt")}),(e,s)=>(o(),n("div",null,[e.resourceItem.resource?(o(),n("div",M,[u("div",P,[u("div",S,g(f(new Date(e.resourceItem.date)))+" - "+g(e.resourceItem.resource.title),1),u("div",null,[b(D,{type:"valid",size:"sm",text:i.value?"Analyse en cours...":"Analyser",disabled:i.value,onClick:a},null,8,["text","disabled"])])]),h.value.length>0?(o(),n("div",W,[(o(!0),n($,null,A(h.value,t=>(o(),L(E,{key:t.id,text:t.origin_resource.title,tooltip:_(t)},null,8,["text","tooltip"]))),128))])):w("",!0),u("div",J,g(e.resourceItem.resource.subtitle),1),u("div",O,g(e.resourceItem.resource.content),1)])):w("",!0)]))}}),q={key:0,class:"mt-1 md:w-96 mx-auto"},G={key:1,class:"mt-10 mx-4 md:w-11/12 md:mx-auto"},Z=k({__name:"ResourceFeedPage",props:{id:{}},setup(d){const r=d,{getResource:m,getAuthorInteractionForResource:l}=j(),{headerValue:i}=T(),a=v(null),{getAllRelationsForResource:h}=I(),f=v([]),_=v([]),e=async()=>{const s=await Promise.all(f.value.map(async t=>{const c=t.origin_resource_id===r.id?t.target_resource:t.origin_resource;let y=t.created_at;try{const p=await l(c.id);p&&p.interaction_date&&(y=p.interaction_date)}catch(p){console.warn(`Could not fetch author interaction for resource ${c.id}:`,p)}return{resource:c,date:y,user_id:t.user_id,context_comment:t.relation_comment,interaction_type:"bibl",progress:null,id:t.id,...t}}));_.value=s.sort((t,c)=>new Date(c.date).getTime()-new Date(t.date).getTime())};return R(async()=>{f.value=await h(r.id),a.value=await m(r.id),a.value&&(i.value={text:a.value.title,link:`/resources/${a.value.id}`}),await e()}),B(()=>{i.value=null}),(s,t)=>(o(),n("div",null,[a.value&&a.value.resource_type!=="jrnl"?(o(),n("div",q,[b(C,{"interactions-list":_.value},null,8,["interactions-list"])])):(o(),n("div",G,[(o(!0),n($,null,A(_.value,(c,y)=>(o(),n("div",{key:y,class:"mb-6"},[b(U,{resourceItem:c},null,8,["resourceItem"])]))),128))]))]))}});export{Z as default};
