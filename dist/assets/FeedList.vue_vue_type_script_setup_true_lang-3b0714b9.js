import{o as i,f as c,a as n,d as C,b as v,h as x,D as F,t as m,l as L,e as R,r as P,c as $,J as I,i as f,p as b,w as k,q as S,F as j,g as z,x as A}from"./index-fea9a0e5.js";import{u as N}from"./useResourceRelations-722f0325.js";import{u as D}from"./useResource-062115cd.js";const H=a=>{if(!a)return[];const o=a.replace(/\?/g,"?.").split(".");let e=0;const s=[];for(;e<o.length;){let r=0,p=[];if(o[e].length>=270)s.push(o[e].replace("/?./g","?")),e++;else{for(;e<o.length&&r+o[e].length<270;)p.push(o[e]),r+=o[e].length,e++;s.push(p.join(". ").replace("/?./g","?"))}}return s},U=a=>a?a.split(`
`).map(e=>H(e)).flat():[],B={splitTextForPanel:U};function V(a,o){return i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function q(a,o){return i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})])}function E(a,o){return i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}const J=["src"],O={class:"text-bold mb-2"},G={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},K=C({__name:"FeedCardTextInterface",props:{interaction:{}},setup(a){const o=a,e=l=>{if(l>0&&l<=h.value.length){const u=h.value[l-1];return{text:u.replace(/#/g,""),header:l===1?"Commentaire : ":null,class:{"font-black":u.charAt(0)==="#","bg-gray-700":!0}}}else{const u=_.value[l-h.value.length-1];return{text:u.replace(/#/g,""),header:l===h.value.length+1?"Contenu : ":null,class:{"font-black":u.charAt(0)==="#","bg-slate-700":!0}}}},s=v(0),r=()=>{s.value=(s.value+1)%d.value},p=x(()=>`${s.value+1}/${d.value}`),d=x(()=>h.value.length+_.value.length+1),_=x(()=>B.splitTextForPanel(o.interaction.resource.content)),h=x(()=>B.splitTextForPanel(o.interaction.context_comment)),w=()=>{const l=g.value.offsetHeight;g.value.style.height=`${l}px`},g=v(null);return(l,u)=>(i(),c("div",{onClick:r,class:"overflow-auto relative w-full md:h-4/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:g},[s.value==0?(i(),c("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:l.interaction.resource.image_url,onLoad:w},null,40,J)):(i(),c("div",{key:1,class:F(["overflow-auto h-full overflow-scroll p-1 pt-8 border",e(s.value).class])},[n("div",{class:F([e(s.value).class,"text-center text-sm my-auto text-white"])},[n("div",O,m(e(s.value).header),1),L(" "+m(e(s.value).text),1)],2)],2)),n("div",G,m(p.value),1)],512))}}),Q={class:"flex flex-col border p-1.5 overflow-auto"},W={class:"flex"},X={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},Y={class:"flex"},Z={title:"Coming Soon ;)",class:"w-6"},ee={title:"Coming Soon ;)",class:"w-6"},te={class:"flex"},oe={class:"text-2xs"},re={class:""},se={class:"mb-2 font-bold text-sm"},ne={class:"text-2xs mb-auto"},ae=C({__name:"FeedCard",props:{interaction:{}},setup(a){const o=a,e=t=>t?t.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",s=t=>t==="outp"?"Production personnelle":"Bibliographie",{resourceTypeOptions:r}=D(),p=t=>r.find(T=>T.value===t).text;v(null);const d=v(null),_=t=>t?t.length>200?t.slice(0,150)+"...":t:"",h=v([]),{getResourceRelationsForResource:w}=N(),g=async()=>{o.interaction.id&&(h.value=await w(o.interaction.resource.id))},{getUserById:l}=S(),u=v(!1),M=async()=>{try{d.value=await l(o.interaction.user_id)}catch(t){console.log(t)}u.value=!0};return R(async()=>{await g(),await M()}),(t,T)=>{const y=P("router-link");return i(),c("div",Q,[n("div",W,[u.value?(i(),$(I,{key:0,class:"flex mb-1.5 h-8",user:d.value,secondText:e(t.interaction.date),firstBottomText:s(t.interaction.interaction_type),secondBottomText:t.$t(p(t.interaction.resource.resource_type))},null,8,["user","secondText","firstBottomText","secondBottomText"])):(i(),c("div",X))]),f(K,{interaction:t.interaction},null,8,["interaction"]),n("div",Y,[n("div",Z,[f(b(q),{class:"w-full my-auto"})]),n("div",ee,[f(b(E),{class:"w-full my-auto"})]),f(y,{to:"/resources/"+t.interaction.resource.id+"/feed",class:"ml-auto"},{default:k(()=>[f(b(V),{class:"w-8"})]),_:1},8,["to"])]),n("div",te,[n("div",oe,m(Math.floor(Math.random()*100))+" likes",1),f(y,{to:"/resources/"+t.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:k(()=>[L(m(h.value.length)+" relations ",1)]),_:1},8,["to"])]),f(y,{class:"",to:"/resources/"+t.interaction.resource.id},{default:k(()=>[n("div",re,[n("div",se,m(t.interaction.resource.title),1),n("div",ne,m(_(t.interaction.resource.subtitle)),1)])]),_:1},8,["to"])])}}}),le={class:"flex flex-col"},de=C({__name:"FeedList",props:{interactionsList:{}},setup(a){const o=a,{feedFilter:e}=A(),s=x(()=>o.interactionsList.filter(r=>e.value==="production"?r.interaction_type==="outp"&&!r.resource.is_external&&r.resource.resource_type!=="pblm":e.value==="draft"?r.interaction_type==="outp"&&!r.resource.is_external&&(r.resource.maturing_state==="drft"||r.resource.maturing_state==="rvew"):e.value==="reviews"?r.interaction_type==="rvew":e.value==="problem"?r.resource.resource_type==="pblm":e.value==="biblio"?r.interaction_type==="inpt":!0));return(r,p)=>(i(),c("div",le,[(i(!0),c(j,null,z(s.value,(d,_)=>(i(),$(ae,{class:"md:mb-2 flex-grow md:rounded max-h-screen border-b-1 border-black",interaction:d,key:d.id},null,8,["interaction"]))),128))]))}});export{de as _};
