import{d as P,p as z,b as l,h as L,e as F,f as u,a as e,s as y,t as m,m as p,v as J,x as W,j as q,o as i}from"./index-d7b3786f.js";const G={class:"p-6"},H=e("h1",{class:"text-2xl font-bold mb-6"},"Enregistrement Audio",-1),K={class:"flex flex-col items-center space-y-4"},Q={key:0,class:"flex items-center space-x-2 text-red-600"},X=e("div",{class:"w-3 h-3 bg-red-500 rounded-full animate-pulse"},null,-1),Y=e("span",{class:"text-sm font-medium"},"Enregistrement en cours...",-1),Z=[X,Y],ee={key:1,class:"text-lg font-mono"},te={key:2,class:"w-full max-w-md"},se=e("h3",{class:"text-lg font-medium mb-2"},"Aper√ßu de l'enregistrement:",-1),ae=["src"],re={class:"mt-4 space-y-3"},oe=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Message accompagnant l'audio: ",-1),ne=["disabled"],le={key:0,class:"animate-spin"},ue={key:1},ie={key:3,class:"w-full max-w-2xl mt-6"},de=e("h3",{class:"text-lg font-medium mb-3 text-gray-800"},"R√©ponse de l'API:",-1),ce={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},ve={class:"mb-3"},me=e("span",{class:"font-medium text-gray-700"},"Statut:",-1),pe={key:0,class:"space-y-2"},ge=e("div",{class:"font-medium text-gray-700"},"Donn√©es re√ßues:",-1),_e={class:"bg-white border border-gray-200 rounded p-3 text-sm text-gray-800 overflow-x-auto"},fe={key:1,class:"mt-3"},be=e("div",{class:"font-medium text-red-700"},"D√©tails de l'erreur:",-1),he={class:"text-red-600 text-sm"},we=P({__name:"AudioView",setup(xe){const C=z(),c=l(!1),d=l(null),v=l([]),g=l(""),h=l(0),x=l(null),b=l(""),_=l(!1),t=l(""),o=l(null),I=L(()=>t.value.includes("succ√®s")?"bg-green-100 text-green-800 border border-green-200":t.value.includes("Erreur")?"bg-red-100 text-red-800 border border-red-200":"bg-blue-100 text-blue-800 border border-blue-200");F(()=>{navigator!=null&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia({audio:!0}).then(s=>{d.value=new MediaRecorder(s),d.value.ondataavailable=n=>{v.value.push(n.data)},d.value.onstop=()=>{const n=new Blob(v.value,{type:"audio/webm"});g.value=URL.createObjectURL(n),w()}}).catch(s=>{console.error("Erreur d'acc√®s au microphone:",s)})});const T=()=>{d.value&&(c.value?U():M())},M=()=>{d.value&&(c.value=!0,v.value=[],g.value="",h.value=0,d.value.start(),B())},U=()=>{d.value&&(c.value=!1,d.value.stop(),w())},B=()=>{x.value=window.setInterval(()=>{h.value++},1e3)},w=()=>{x.value&&(clearInterval(x.value),x.value=null)},N=s=>{const n=Math.floor(s/60),f=s%60;return`${n.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`},j=async()=>{if(v.value.length!==0){_.value=!0,t.value="Pr√©paration de l'envoi...";try{const s=new Blob(v.value,{type:"audio/webm"});await V(s)}catch(s){console.error("Erreur lors de l'upload:",s),t.value="Erreur lors de l'envoi"}finally{_.value=!1}}};async function V(s){var n,f,E,k,R,S,A,D;try{t.value="Envoi en cours...";const a=new FormData;a.append("file",s,"note.webm"),a.append("message",b.value),a.append("duration",h.value.toString()),a.append("timestamp",new Date().toISOString());const r=await q.post("/process_audio",a,"multipart/form-data");if(o.value=r,r.status===200&&((n=r.data)!=null&&n.created_interaction)){t.value=`Enregistrement envoy√© avec succ√®s! ID: ${((f=r.data)==null?void 0:f.id)||"N/A"}`;const $=(k=(E=r.data)==null?void 0:E.created_interaction)==null?void 0:k.resource_id;$?(t.value="Enregistrement envoy√© avec succ√®s! Redirection vers la ressource...",setTimeout(()=>{v.value=[],g.value="",b.value="",t.value="",C.push(`/resources/${$}`)},2e3)):(t.value=`Enregistrement envoy√© avec succ√®s! ID: ${((R=r.data)==null?void 0:R.id)||"N/A"}`,setTimeout(()=>{v.value=[],g.value="",b.value="",t.value=""},3e3))}else r.status===200&&!((S=r.data)!=null&&S.created_interaction)?t.value=` Audio non reconnu par l'API: ${r.data.transcription} - ${((A=r.data)==null?void 0:A.message)||"Erreur inconnue"}`:t.value=`Erreur lors de l'upload: ${r.status} - ${((D=r.data)==null?void 0:D.message)||"Erreur inconnue"}`}catch(a){throw console.error("Erreur lors de l'upload:",a),t.value=`Erreur de connexion: ${a instanceof Error?a.message:"Erreur inconnue"}`,o.value={status:500,data:a instanceof Error?a.message:"Erreur inconnue"},a}}const O=()=>{o.value=null};return(s,n)=>(i(),u("div",G,[H,e("div",K,[e("button",{onClick:T,class:y(["px-6 py-3 rounded-lg font-medium transition-colors",c.value?"bg-red-500 hover:bg-red-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white"])},m(c.value?"‚èπÔ∏è Arr√™ter l'enregistrement":"üé§ Commencer l'enregistrement"),3),c.value?(i(),u("div",Q,Z)):p("",!0),c.value?(i(),u("div",ee,m(N(h.value)),1)):p("",!0),g.value?(i(),u("div",te,[se,e("audio",{controls:"",class:"w-full",src:g.value},null,8,ae),e("div",re,[e("div",null,[oe,J(e("textarea",{"onUpdate:modelValue":n[0]||(n[0]=f=>b.value=f),placeholder:"Ajoutez un message ou une description...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3"},null,512),[[W,b.value]])]),e("button",{onClick:j,disabled:_.value,class:y(["w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2",_.value?"bg-gray-400 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white"])},[_.value?(i(),u("span",le,"‚è≥")):(i(),u("span",ue,"üíæ")),e("span",null,m(_.value?"Envoi en cours...":"Envoyer l'enregistrement"),1)],10,ne),t.value?(i(),u("div",{key:0,class:y(["text-sm p-3 rounded-md",I.value])},m(t.value),3)):p("",!0)])])):p("",!0),o.value?(i(),u("div",ie,[de,e("div",ce,[e("div",ve,[me,e("span",{class:y(["ml-2 px-2 py-1 rounded text-xs font-medium",o.value.status===200?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},m(o.value.status===200?"Succ√®s":"Erreur"),3)]),o.value.data?(i(),u("div",pe,[ge,e("pre",_e,m(JSON.stringify(o.value.data,null,2)),1)])):p("",!0),o.value.status!==200&&o.value.data?(i(),u("div",fe,[be,e("div",he,m(o.value.data),1)])):p("",!0),e("button",{onClick:O,class:"mt-3 px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded text-sm transition-colors"}," Effacer la r√©ponse ")])])):p("",!0)])]))}});export{we as default};
