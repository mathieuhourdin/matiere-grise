import{u as M,a as $}from"./useProblem-5d9eaf46.js";import{d as w,r as f,q as R,o as A,s as N,b as t,c as l,f as C,_ as V,e as n,t as _,j as F,h as D,m as S,a as U,F as g,l as y,g as x,k as q,v as T,x as z}from"./index-e8afb69c.js";import{u as E}from"./useResource-ce2b8ceb.js";const W={class:"border p-1.5"},G={key:0,class:"flex mb-1.5"},H={class:"text-xs italic my-auto ml-2"},J=["src"],K={key:1,class:"h-full overflow-scroll bg-blue-100 p-1 pt-5 border"},O={class:"bg-blue-100 text-center my-auto"},Q={class:""},X={class:"mb-2"},Y={class:"text-2xs mb-auto"},Z={class:"flex mt-2"},ee={class:"text-2xs italic mt-auto"},te={class:"ml-auto text-2xs underline"},L=w({__name:"ProblemCard",props:{problem:{}},setup(b){const i=b,m=e=>e?e.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",d=f(0),p=f(null),c=f(null),h=R(()=>{const e=i.problem.content.replaceAll("?","?.").split(".");let a=0;const v=[];for(;a<e.length-1;){let k=0,P=[];if(e[a].length>=300)v.push(e[a].replaceAll("?.","?")),a++;else{for(;a<e.length&&k+e[a].length<300;)P.push(e[a]),k+=e[a].length,a++;v.push(P.join(". ").replaceAll("?.","?"))}}return v}),o=e=>e.length>200?e.slice(0,150)+"...":e,{getAuthorInteractionForResource:r}=E(),s=f([]),{getResourceRelationsForResource:u}=M(),B=async()=>{i.problem.id&&(s.value=await u(i.problem.id))},{getUserById:I}=S(),j=async()=>{p.value=await r(i.problem.id),p.value&&(c.value=await I(p.value.interaction_user_id))};return A(async()=>{await B(),await j()}),(e,a)=>{const v=N("router-link");return t(),l("div",W,[c.value?(t(),l("div",G,[C(V,{user:c.value},null,8,["user"]),n("div",H,_(c.value.first_name)+" "+_(c.value.last_name),1)])):F("",!0),n("div",{onClick:a[0]||(a[0]=k=>d.value+=1),class:"h-3/5 mb-2 bg-gray-700"},[d.value==0?(t(),l("img",{key:0,class:"object-contain w-full h-full mt-auto mx-auto",src:e.problem.image_url},null,8,J)):(t(),l("div",K,[n("div",O,_(h.value[d.value-1]),1)]))]),C(v,{to:"/thought_outputs/"+e.problem.id},{default:D(()=>[n("div",Q,[n("div",X,_(e.problem.title),1),n("div",Y,_(o(e.problem.subtitle)),1),n("div",Z,[n("div",ee,_(m(e.problem.created_at)),1),n("div",te,_(s.value.length)+" inputs",1)])])]),_:1},8,["to"])])}}}),se={class:"flex"},oe=n("hr",{class:"border-top border-slate-800 border-dashed my-1"},null,-1),re={class:"flex overflow-scroll"},le=w({__name:"CategoryProblemsCarousel",props:{problemsList:{},category:{}},setup(b){const i=b,{newProblem:m,createProblem:d}=$(),p=U(),c=async()=>{const o=m();o.resource.category_id=i.category.id;const r=await d(o);p.push({path:"/thought_outputs/"+r.resource.id,query:{editing:"true"}})},h=o=>o=="default"?"Autres":o;return(o,r)=>(t(),l("div",null,[n("div",se,[n("div",null,_(h(o.category.display_name)),1),n("div",{onClick:c,class:"ml-auto text-sm mr-2 underline"}," Ajouter ")]),oe,n("div",re,[(t(!0),l(g,null,y(o.problemsList,(s,u)=>(t(),l("div",{class:"mb-4",key:u},[C(L,{class:"w-80 h-96 mx-3 shadow-xl rounded",problem:s},null,8,["problem"])]))),128))])]))}}),ne=w({__name:"MobileProblemsFeed",props:{problemsList:{}},setup(b){return(i,m)=>(t(),l("div",null,[(t(!0),l(g,null,y(i.problemsList,(d,p)=>(t(),x(L,{class:"border-b-1 border-black",problem:d},null,8,["problem"]))),256))]))}}),ae={key:0,class:"md:m-4"},ue={key:0},ie={key:1},pe=w({__name:"ProblemsView",setup(b){const{getProblems:i}=$(),m=f(null),{categories:d}=T(),{isMobile:p}=z(),c=R(()=>d.value.map(r=>(r.problems=h(r),r.problems_count=r.problems?r.problems.length:0,r))),h=o=>{var r,s;return o.display_name=="default"?(r=m.value)==null?void 0:r.filter(u=>u.category_id==null):(s=m.value)==null?void 0:s.filter(u=>u.category_id==o.id)};return A(async()=>m.value=await i()),(o,r)=>(t(),l("div",null,[m.value?(t(),l("div",ae,[q(p)?(t(),l("div",ie,[(t(!0),l(g,null,y(c.value.sort((s,u)=>u.problems_count-s.problems_count),s=>(t(),x(ne,{"problems-list":s.problems},null,8,["problems-list"]))),256))])):(t(),l("div",ue,[(t(!0),l(g,null,y(c.value.sort((s,u)=>u.problems_count-s.problems_count),s=>(t(),x(le,{class:"mt-4",category:s,key:s.id,"problems-list":s.problems},null,8,["category","problems-list"]))),128))]))])):F("",!0)]))}});export{pe as default};
