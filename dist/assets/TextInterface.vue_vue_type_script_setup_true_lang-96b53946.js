import{d as N,x as O,v as b,o as l,c as n,f as h,t as _,h as L,_ as P,q as S,e as j,r as p,s as y,n as oe,D as ae,a as C,F as w,p as k,C as R,i as se}from"./index-da616e41.js";const le={class:"bg-slate-100 border p-1 m-1 rounded shadow-xl"},ne={class:"flex"},re={class:"text-xs mt-0.5 font-bold"},de={class:"text-2xs italic ml-auto mr-1 my-auto"},ie={key:0},ue=["value"],ce={class:"flex"},he={key:1,class:"text-xs mt-0.5"},ve=N({__name:"CommentCard",props:{editing:{type:Boolean},modelValue:{},author:{},createdAt:{}},emits:["update:modelValue","validate","abort"],setup(c,{emit:d}){const i=c,m=O(()=>{console.log(`date : ${i.createdAt}`),console.log(b(i).createdAt.value.split(".")[0]);const v=new Date(b(i).createdAt.value.split(".")[0]);return console.log(v),v.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"})}),s=v=>{d("update:modelValue",v.target.value)},a=()=>{d("validate")},$=()=>{d("abort")};return(v,V)=>(l(),n("div",le,[h("div",ne,[h("div",re,_(v.author.first_name)+" "+_(v.author.last_name),1),h("div",de,_(m.value),1)]),v.editing?(l(),n("div",ie,[h("textarea",{class:"w-full text-xs rounded-xl p-2",value:v.modelValue,onInput:s},null,40,ue),h("div",ce,[L(P,{onClick:a,class:"text-sm",rounded:"",size:"2xs",text:"Commenter",type:"valid"}),L(P,{onClick:$,class:"text-sm",rounded:"",size:"2xs",text:"Annuler",type:"abort"})])])):(l(),n("div",he,_(v.modelValue),1))]))}}),me=async(c,d)=>{const{user:i}=j(),m={start_index:d,end_index:d};try{const a=(await S.post("/thought_outputs/"+c+"/comments",m)).data;return i.value&&a.author_id==i.value.id&&(a.author=i.value),a}catch(s){console.log("error : ",s)}},fe=async(c,d=!0)=>{const i=d?"?author=true":"";try{return(await S.get("/thought_outputs/"+c+"/comments"+i)).data}catch(m){console.log("error : ",m)}},K=async c=>{try{return(await S.put("/comments/"+c.id,c)).data}catch(d){console.log("error : ",d)}},pe=async c=>{console.log("comments : ",c),c.map(d=>K(d))};function xe(){return{createComment:me,getCommentsForThoughtOutput:fe,updateComment:K,batchUpdateComments:pe}}const ge=h("div",{class:"text-sm align-middle flex items-center p-2",style:{height:"50px"}}," Corriger une faute ",-1),_e={class:"flex mx-auto max-w-full"},ye={class:"w-full"},Ce={key:0,class:"flex"},we=h("div",{class:"w-6"},[h("div",{class:"rounded-full ml-4 mr-2 mt-2 h-1 w-1 bg-black"})],-1),ke=[we],be={class:"flex flex-wrap"},$e=["id","onClick","onContextmenu"],Ve={key:0,style:{width:"5px"}},Ae={key:1,style:{height:"25px"}},Te={key:2},Ee={key:1,class:"absolute h-full",style:{right:"-2%",width:"27%"}},Fe={key:0,style:{width:"33%"}},Se=N({__name:"TextInterface",props:{ressourceId:{},fullText:{},extComments:{default:()=>[]},editable:{type:Boolean,default:!0}},emits:["change","changeComments"],setup(c,{emit:d}){const i=c,m=e=>{console.log("selectCursorPosition letter : ",e),i.editable&&(s.value={id:e.id,char:e.char})},s=p(null),a=p([]),$=O(()=>v(a.value)),v=e=>{console.log("textArrayFromString textString: ",e);let t=[{id:0,words:[{id:0,text:[]}],comments:[]}],o=0,x=0;for(var r=0;r<a.value.length;r++){a.value[r].char==`
`&&(o+=1,x=0,t.push({id:o,words:[{id:0,text:[]}],lineStyle:r<a.value.length-1?a.value[r+1].char:null,comments:[]}));const g=f.value.find(u=>u.start_index==r);g&&t[o].comments.push(g),t[o].words[x].text.push({id:r,char:a.value[r].char,comment:g}),a.value[r].char==" "&&(x+=1,t[o].words.push({id:x,text:[]}))}return t},V=e=>{e==1?f.value.forEach(t=>{t.start_index>s.value.id&&(t.start_index+=1),t.end_index>s.value.id&&(t.end_index+=1)}):e==-1&&f.value.forEach(t=>{t.start_index>=s.value.id&&(t.start_index-=1),t.end_index>=s.value.id&&(t.end_index-=1)})},A=e=>{a.value.filter(t=>t.id>=s.value.id+1).forEach(t=>t.id+=1),a.value.splice(s.value.id+1,0,{id:s.value.id+1,char:e,line:0}),V(1),s.value.id+=1},q=e=>{if(console.log("Writes : ",e.key),s.value===null)return;const t=e.key;if(T.value&&t=="v"){H();return}if(t.length==1)e.preventDefault(),A(t);else if(t=="Backspace")a.value.splice(s.value.id,1),a.value.filter(o=>o.id>s.value.id).forEach(o=>o.id-=1),V(-1),s.value.id-=1;else if(t=="Enter")A(`
`);else if(t=="ArrowRight"){let o=s.value.id;o<a.value.length-1&&m(a.value[o+1])}else if(t=="ArrowLeft"){let o=s.value.id;o>0&&m(a.value[o-1])}else t=="Control"&&(console.log("Control"),T.value=!0)},T=p(!1),H=async()=>{try{let t=await navigator.clipboard.readText();console.log("Clippedtext : ",t);for(var e=0;e<t.length;e++)A(t[e])}catch(t){console.log("Error with clippboard : ",t)}},M=e=>{e.key=="Control"&&(T.value=!1)},{createComment:X,batchUpdateComments:Y}=xe(),f=p([]),B=p(null),G=e=>{console.log("Comments loading : ",e),f.value=e},J=async()=>{console.log("Add Comment");const e=await X(i.ressourceId,D.value);f.value.push(e)};y(f,e=>{console.log("Watch comments triggered : ",e.value),I.value&&(console.log("Comments : ",e),d("changeComments",e.value),clearTimeout(B.value),B.value=setTimeout(()=>Y(e),1e3))},{deep:!0}),y(b(i).extComments,e=>{f.value=e});const E=p(!1),D=p(null),F=p({position:"absolute","z-index":90,top:0,left:0,height:"106px",width:"260px"}),{user:Q}=j(),Z=(e,t)=>{e.preventDefault(),Q.value&&(s.value=null,F.value.top=`${e.layerY}px`,F.value.left=`${e.layerX}px`,E.value=!0,D.value=t,console.log("event : ",e),console.log("Have a new right click"))},z=e=>{if(console.log("textArrayFromString textString: ",e),a.value=[],e===void 0||e==""){a.value=[{id:0,char:`
`}],m({id:0,char:`
`});return}for(var t=0;t<e.length;t++){const o=f.value.find(x=>x.start_index==t);a.value.push({id:t,char:e[t],comment:o})}},ee=e=>e.reduce((t,o)=>t+o.char,""),I=p(!1);return oe(()=>{z(i.fullText),G(i.extComments),I.value=!0}),y(a,e=>{console.log("Watch triggered : ",e),I.value&&d("change",ee(e))},{deep:!0}),y(b(i).fullText,e=>{z(e)}),(e,t)=>(l(),n("div",{class:"relative p-4",tabindex:"0",onKeydown:q,onKeyup:M,onClick:t[0]||(t[0]=o=>E.value=!1)},[E.value?(l(),n("div",{key:0,class:"bg-white border-4",style:ae(F.value)},[h("div",{onClick:J,class:"text-sm border-b-2 flex items-center p-2",style:{height:"50px"}}," Ajouter un commentaire "),ge],4)):C("",!0),h("div",_e,[h("div",ye,[(l(!0),n(w,null,k($.value,(o,x)=>(l(),n("div",{key:x,class:"flex"},[o.lineStyle=="*"?(l(),n("div",Ce,ke)):C("",!0),h("div",be,[(l(!0),n(w,null,k(o.words,(r,g)=>(l(),n("div",{key:g,class:"flex flex-wrap"},[(l(!0),n(w,null,k(r.text,(u,te)=>{var U;return l(),n("div",{id:u.id,key:te,class:R(["border-blue-400",{"border-r-2":u.id==((U=s.value)==null?void 0:U.id),"bg-yellow-400":u.comment}]),onClick:W=>m(u),onContextmenu:W=>Z(W,u.id)},[u.char==" "?(l(),n("div",Ve)):u.char==`
`?(l(),n("div",Ae)):(u.char=="#"||u.char=="*")&&g==0?(l(),n("div",Te)):(l(),n("div",{key:3,class:R({"font-bold":o.lineStyle=="#"})},[h("div",null,_(u.char),1)],2))],42,$e)}),128))]))),128))]),f.value.length>0?(l(),n("div",Ee,[(l(!0),n(w,null,k(o.comments,(r,g)=>(l(),se(ve,{key:g,class:"w-full",modelValue:r.content,"onUpdate:modelValue":u=>r.content=u,editing:r.editing,onValidate:u=>r.editing=!1,author:r.author,"created-at":r.created_at},null,8,["modelValue","onUpdate:modelValue","editing","onValidate","author","created-at"]))),128))])):C("",!0)]))),128))]),f.value.length>0?(l(),n("div",Fe)):C("",!0)])],32))}});export{Se as _,xe as u};
