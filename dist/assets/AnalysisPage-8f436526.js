import{_ as m}from"./JournalItem.vue_vue_type_script_setup_true_lang-1b617799.js";import{d as F,x as L,u as C,r as b,o as S,B as V,c as o,l as a,t as h,e as i,w as j,z as E,F as _,g as v,s as N,n as z,b as n,f as M,L as O}from"./index-67386673.js";import{u as P}from"./useResourceRelations-22334af8.js";const U={class:"min-h-screen text-slate-100 p-2 md:p-10 md:w-11/12 mx-auto"},q={key:0,class:"text-center text-2xl pt-10"},Q={key:1},W={class:"mb-8"},G={class:"flex justify-between items-start mb-2"},H={class:"text-lg font-bold"},J={class:"text-sm dark:text-gray-300 text-gray-700 mb-2"},K={class:"text-sm dark:text-gray-300 text-gray-500 whitespace-pre-line"},X=a("div",{class:"mb-8"},"Last analysis",-1),Y={class:"mt-8"},Z=a("h2",{class:"text-2xl font-bold mb-4"},"Related Resources",-1),ee={class:"mt-10 mx-4 md:w-11/12 md:mx-auto"},te=a("h3",{class:"text-xl font-bold mb-4"},"Tasks",-1),se=a("h3",{class:"text-xl font-bold mb-4"},"Questions",-1),oe=a("h3",{class:"text-xl font-bold mb-4"},"Deliverables",-1),ne=a("h3",{class:"text-xl font-bold mb-4"},"Resources",-1),ae=a("div",{class:"text-xl font-bold mb-4"},"Elements simples",-1),re=a("h3",{class:"text-xl font-bold mb-4"},"Traces",-1),ue=F({__name:"AnalysisPage",props:{id:{}},setup(w){const y=w,k=L(),{getResource:I,getAuthorInteractionForResource:g}=N(),{headerValue:x}=z(),{deleteAnalysis:D}=C(),{launchSnackbar:R}=O(),r=b(null),{getAllRelationsForResource:A}=P(),p=b([]),c=b([]),f=b(!1),T=async()=>{const l=await Promise.all(p.value.map(async t=>{const e=t.origin_resource_id===y.id?t.target_resource:t.origin_resource;let s=t.created_at;try{const d=await g(e.id);d&&d.interaction_date&&(s=d.interaction_date)}catch(d){console.warn(`Could not fetch author interaction for resource ${e.id}:`,d)}return{resource:e,date:s,interaction_date:s,user_id:t.user_id,interaction_user_id:t.user_id,context_comment:t.relation_comment,interaction_comment:t.relation_comment,interaction_type:"bibl",interaction_progress:null,progress:null,id:t.id,...t}}));c.value=l.sort((t,e)=>{const s=t.interaction_date||t.date,d=e.interaction_date||e.date;return new Date(d).getTime()-new Date(s).getTime()})},u=(l,t)=>l.filter(e=>e.resource.resource_type===t),B=l=>l?(l instanceof Date?l:new Date(l)).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}):"",$=async()=>{var t;if(!(!((t=r.value)!=null&&t.id)||f.value||!window.confirm("Are you sure you want to delete this analysis? This action cannot be undone.")))try{f.value=!0,await D(r.value.id),R("Analysis deleted successfully","success"),k.push("/me/home")}catch(e){console.error("Error deleting analysis:",e),f.value=!1}};return S(async()=>{r.value=await I(y.id),r.value&&r.value.resource_type!=="anly"&&console.warn(`Resource ${y.id} is not of type 'anly', it is '${r.value.resource_type}'`),r.value&&(x.value={text:r.value.title,link:`/me/analysis/${r.value.id}`}),p.value=await A(y.id),await T()}),V(()=>{x.value=null}),(l,t)=>(n(),o("div",U,[r.value?(n(),o("div",Q,[a("div",W,[a("div",G,[a("div",H,h(B(r.value.created_at))+" - "+h(r.value.title),1),i(E,{type:"abort",size:"sm",onClick:$},{default:j(()=>[M(h(f.value?"Deleting...":"Delete"),1)]),_:1})]),a("div",J,h(r.value.subtitle),1),a("div",K,h(r.value.content),1)]),X,(n(!0),o(_,null,v(u(c.value,"anly"),(e,s)=>(n(),o("div",{key:s,class:"mb-6"},[i(m,{resourceItem:e},null,8,["resourceItem"])]))),128)),a("div",Y,[Z,a("div",ee,[te,(n(!0),o(_,null,v(u(c.value,"task"),(e,s)=>(n(),o("div",{key:s,class:"mb-6"},[i(m,{resourceItem:e},null,8,["resourceItem"])]))),128)),se,(n(!0),o(_,null,v(u(c.value,"qest"),(e,s)=>(n(),o("div",{key:s,class:"mb-6"},[i(m,{resourceItem:e},null,8,["resourceItem"])]))),128)),oe,(n(!0),o(_,null,v(u(c.value,"dlvr"),(e,s)=>(n(),o("div",{key:s,class:"mb-6"},[i(m,{resourceItem:e},null,8,["resourceItem"])]))),128)),ne,(n(!0),o(_,null,v(u(c.value,"rsrc"),(e,s)=>(n(),o("div",{key:s,class:"mb-6"},[i(m,{resourceItem:e},null,8,["resourceItem"])]))),128)),ae,(n(!0),o(_,null,v(u(c.value,"evnt"),(e,s)=>(n(),o("div",{key:s,class:"mb-6"},[i(m,{resourceItem:e},null,8,["resourceItem"])]))),128)),re,(n(!0),o(_,null,v(u(c.value,"trce"),(e,s)=>(n(),o("div",{key:s,class:"mb-6"},[i(m,{resourceItem:e},null,8,["resourceItem"])]))),128))])])])):(n(),o("div",q,"Loading..."))]))}});export{ue as default};
