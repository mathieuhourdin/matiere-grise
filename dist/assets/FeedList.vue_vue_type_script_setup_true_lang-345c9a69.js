import{o as s,f as c,a as i,d as L,b as f,h as x,e as I,r as M,t as u,G as B,c as k,i as m,w,l as P,n as N,L as S,q as $,m as F,F as z,g as V,x as H}from"./index-08ebbafb.js";import{u as j}from"./useResource-bc7f1fd2.js";import{u as U}from"./useResourceRelations-4f45c50e.js";const D=l=>{if(!l||l==="")return[];const t=l.replace(/\?/g,"?.").split(".");let r=0;const a=[];for(;r<t.length;){let n=0,h=[];if(t[r].length>=270)a.push(t[r].replace("/?./g","?")),r++;else{for(;r<t.length&&n+t[r].length<270;)h.push(t[r]),n+=t[r].length,r++;a.push(h.join(". ").replace("/?./g","?"))}}return a},q=l=>l?l.split(`
`).map(r=>D(r)).flat():[],R={splitTextForPanel:q};function E(l,t){return s(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function G(l,t){return s(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})])}function O(l,t){return s(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}const J=["src"],K={key:1,class:"bg-white h-full text-center flex items-center justify-center"},Q={class:"text-2xl text-black"},W={class:"text-lg text-bold mt-2"},X={class:"text-bold mb-2"},Y={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},Z={key:1},ee={key:1},te=L({__name:"FeedCardTextInterface",props:{interaction:{}},setup(l){const t=l,r=o=>{if(o>0&&o<=p.value.length){const e=p.value[o-1];return{text:e.replace(/#/g,""),header:o===1?"Commentaire : ":null,class:{"font-black":e.charAt(0)==="#","bg-gray-700":!0}}}else{const e=v.value[o-p.value.length-1];return{text:e?e.replace(/#/g,""):"",header:o===p.value.length+1?"Contenu : ":null,class:{"font-black":e&&e.charAt(0)==="#","bg-slate-700":!0}}}},a=f(0),n=()=>{a.value=(a.value+1)%d.value},h=x(()=>`${a.value+1}/${d.value}`),d=x(()=>p.value.length+v.value.length+1),v=x(()=>R.splitTextForPanel(t.interaction.resource.content)),p=x(()=>R.splitTextForPanel(t.interaction.context_comment)),b=()=>{if(t.interaction.interaction_type!="inpt"&&t.interaction.resource.image_url!==""){const o=_.value.offsetHeight;_.value.style.height=`${o}px`}},{getAuthorInteractionForResource:C}=j(),g=f(null),_=f(null);return I(async()=>{t.interaction.interaction_type!="inpt"&&t.interaction.resource.image_url===""&&(_.value.style.height="500px");const o=await C(t.interaction.resource.id);o&&(o.resource=t.interaction.resource,o.user_id=o.interaction_user_id,g.value=o)}),(o,e)=>{const y=M("router-link");return o.interaction.interaction_type!="inpt"?(s(),c("div",{key:0,onClick:n,class:"overflow-auto relative w-full md:h-4/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:_},[a.value==0&&o.interaction.resource.image_url!==""?(s(),c("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:o.interaction.resource.image_url,onLoad:b},null,40,J)):a.value==0?(s(),c("div",K,[i("div",null,[i("div",Q,u(o.interaction.resource.title),1),i("div",W,u(o.interaction.resource.subtitle),1)])])):(s(),c("div",{key:2,class:B(["h-full overflow-scroll p-1 pb-16 border flex items-center justify-center",r(a.value).class])},[i("div",{class:B([r(a.value).class,"text-center text-sm my-auto text-white"])},[i("div",null,[i("div",X,u(r(a.value).header),1),i("div",null,u(r(a.value).text),1)])],2)],2)),i("div",Y,u(h.value),1)],512)):(s(),c("div",Z,[g.value?(s(),k(A,{key:0,interaction:g.value,class:"h-96"},null,8,["interaction"])):(s(),c("div",ee,[m(y,{to:"/resources/"+o.interaction.resource.id},{default:w(()=>[P(u(o.interaction.resource.title),1)]),_:1},8,["to"])]))]))}}}),re={class:"flex flex-col border p-1.5 overflow-auto"},oe={class:"flex"},ne={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},se={key:0,class:"flex"},ie={title:"Coming Soon ;)",class:"w-6"},ae={title:"Coming Soon ;)",class:"w-6"},le={key:1,class:"flex"},ce={class:"text-2xs"},ue={class:""},de={class:"mb-2 font-bold text-sm"},pe={class:"text-2xs mb-auto"},A=L({__name:"FeedCard",props:{interaction:{}},setup(l){const t=l,r=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",a=e=>e==="outp"?"Production personnelle":"Bibliographie",{resourceTypeOptions:n}=j(),h=e=>n.find(y=>y.value===e).text;f(null);const d=f(null),v=e=>e?e.length>200?e.slice(0,150)+"...":e:"",p=f([]),{getResourceRelationsForResource:b}=U(),C=async()=>{t.interaction.id&&(p.value=await b(t.interaction.resource.id))},{getUserById:g}=N(),_=f(!1),o=async()=>{try{d.value=await g(t.interaction.user_id)}catch(e){console.log(e)}_.value=!0};return I(async()=>{await C(),await o()}),(e,y)=>{const T=M("router-link");return s(),c("div",re,[i("div",oe,[_.value?(s(),k(S,{key:0,class:"flex mb-1.5 h-8",user:d.value,secondText:r(e.interaction.date),firstBottomText:a(e.interaction.interaction_type),secondBottomText:e.$t(h(e.interaction.resource.resource_type))},null,8,["user","secondText","firstBottomText","secondBottomText"])):(s(),c("div",ne))]),m(te,{interaction:e.interaction},null,8,["interaction"]),e.interaction.interaction_type!="inpt"?(s(),c("div",se,[i("div",ie,[m($(G),{class:"w-full my-auto"})]),i("div",ae,[m($(O),{class:"w-full my-auto"})]),m(T,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto"},{default:w(()=>[m($(E),{class:"w-8"})]),_:1},8,["to"])])):F("",!0),e.interaction.interaction_type!="inpt"?(s(),c("div",le,[i("div",ce,u(Math.floor(Math.random()*100))+" likes",1),m(T,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:w(()=>[P(u(p.value.length)+" relations ",1)]),_:1},8,["to"])])):F("",!0),e.interaction.interaction_type!="inpt"?(s(),k(T,{key:2,class:"",to:"/resources/"+e.interaction.resource.id},{default:w(()=>[i("div",ue,[i("div",de,u(e.interaction.resource.title),1),i("div",pe,u(v(e.interaction.resource.subtitle)),1)])]),_:1},8,["to"])):F("",!0)])}}}),he={class:"flex flex-col"},ve=L({__name:"FeedList",props:{interactionsList:{}},setup(l){const t=l,{feedFilter:r}=H(),a=x(()=>t.interactionsList.filter(n=>r.value==="production"?n.interaction_type==="outp"&&!n.resource.is_external&&n.resource.resource_type!=="pblm"&&!n.resource.is_external:r.value==="draft"?n.interaction_type==="outp"&&!n.resource.is_external&&(n.resource.maturing_state==="drft"||n.resource.maturing_state==="rvew"):r.value==="reviews"?n.interaction_type==="rvew":r.value==="problem"?n.resource.resource_type==="pblm":r.value==="biblio"?n.interaction_type==="inpt":n.interaction_type==="inpt"||!n.resource.is_external));return(n,h)=>(s(),c("div",he,[(s(!0),c(z,null,V(a.value,(d,v)=>(s(),k(A,{class:"md:mb-2 flex-grow md:rounded max-h-screen border-b-1 border-black",interaction:d,key:d.id},null,8,["interaction"]))),128))]))}});export{ve as _};
