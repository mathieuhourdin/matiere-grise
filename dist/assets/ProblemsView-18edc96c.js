import{p as g,q as $,d as f,r as b,f as v,s as A,o as c,c as d,j as y,w as D,h as a,t as p,a as w,e as F,v as I,F as P,i as x,n as S,x as B,m as L}from"./index-254d6e81.js";import{u as N}from"./useResourceRelations-f96c85dd.js";import{u as V}from"./useResource-1f01d7c5.js";const{launchSnackbar:U}=$(),j=()=>{const t={title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"drft",maturing_state:"idea",image_url:"",resource_type:"pblm",comment:""};return{interaction_progress:0,interaction_comment:"",interaction_date:new Date(Date.now()),resource:t,interaction_is_public:!0}},q=t=>(t.created_at&&(t.created_at=new Date(t.created_at.split(".")[0])),t),E=async()=>(await g.get("/problems")).data.map(r=>q(r)),T=async t=>{var r;try{const s={...t,interaction_date:(r=t.interaction_date)==null?void 0:r.toISOString().split(".")[0]};return(await g.post("/thought_outputs",s)).data}catch(s){throw U(`Error updating resource : ${s}`,"error"),s}};function C(){return{newProblem:j,getProblems:E,createProblem:T}}const W={class:"border shadow-xl rounded m-2 p-4 h-72 w-60"},M={class:"max-h-full"},O=["src"],z={class:"h-full"},G={class:"mb-2"},H={key:0,class:"text-2xs italic",style:{"margin-top":"-8px"}},J={class:"text-2xs mb-auto"},K={class:"flex mt-2"},Q={class:"text-2xs italic mt-auto"},X={class:"ml-auto text-2xs underline"},Y=f({__name:"ProblemCard",props:{problem:{}},setup(t){const r=t,s=n=>n?n.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",i=b(null),u=b(null),_=n=>n.length>200?n.slice(0,150)+"...":n,{getAuthorInteractionForResource:m}=V(),e=b([]),{getResourceRelationsForResource:o}=N(),l=async()=>{r.problem.id&&(e.value=await o(r.problem.id))},{getUserById:h}=F(),k=async()=>{i.value=await m(r.problem.id),i.value&&(u.value=await h(i.value.interaction_user_id))};return v(async()=>{await l(),await k()}),(n,oe)=>{const R=A("router-link");return c(),d("div",W,[y(R,{to:"/thought_outputs/"+n.problem.id},{default:D(()=>[a("div",M,[a("img",{class:"h-28 mx-auto mb-4",src:n.problem.image_url},null,8,O),a("div",z,[a("div",G,p(n.problem.title),1),u.value?(c(),d("div",H,p(u.value.first_name)+" "+p(u.value.last_name),1)):w("",!0),a("div",J,p(_(n.problem.subtitle)),1),a("div",K,[a("div",Q,p(s(n.problem.created_at)),1),a("div",X,p(e.value.length)+" inputs",1)])])])]),_:1},8,["to"])])}}}),Z={class:"flex"},ee=a("hr",{class:"border-top border-slate-800 border-dashed my-1"},null,-1),te={class:"flex overflow-scroll"},re=f({__name:"CategoryProblemsCarousel",props:{problemsList:{},category:{}},setup(t){const r=t,{newProblem:s,createProblem:i}=C(),u=I(),_=async()=>{const e=s();e.resource.category_id=r.category.id;const o=await i(e);u.push({path:"/thought_outputs/"+o.resource.id,query:{editing:"true"}})},m=e=>e=="default"?"Autres":e;return(e,o)=>(c(),d("div",null,[a("div",Z,[a("div",null,p(m(e.category.display_name)),1),a("div",{onClick:_,class:"ml-auto text-sm mr-2 underline"},"Ajouter")]),ee,a("div",te,[(c(!0),d(P,null,x(e.problemsList,(l,h)=>(c(),d("div",{class:"mb-4",key:h},[y(Y,{problem:l},null,8,["problem"])]))),128))])]))}}),se={key:0,class:"m-4"},ce=f({__name:"ProblemsView",setup(t){const{getProblems:r}=C(),s=b(null),{categories:i}=B(),u=S(()=>i.value.map(e=>(e.problems=_(e),e.problems_count=e.problems?e.problems.length:0,e))),_=m=>{var e,o;return m.display_name=="default"?(e=s.value)==null?void 0:e.filter(l=>l.category_id==null):(o=s.value)==null?void 0:o.filter(l=>l.category_id==m.id)};return v(async()=>s.value=await r()),(m,e)=>(c(),d("div",null,[s.value?(c(),d("div",se,[(c(!0),d(P,null,x(u.value.sort((o,l)=>l.problems_count-o.problems_count),o=>(c(),L(re,{class:"mt-4",category:o,key:o.id,"problems-list":o.problems},null,8,["category","problems-list"]))),128))])):w("",!0)]))}});export{ce as default};
