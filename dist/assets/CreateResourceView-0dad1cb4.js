import{s as F,d as C,b as r,h as I,o,f as i,i as s,v as A,c as k,w as T,m as E,n as u,l as N,a as d,x as B,q as K,u as O}from"./index-071e5d8f.js";import{_}from"./TextInput.vue_vue_type_script_setup_true_lang-06cd4e2f.js";import{_ as x}from"./ActionButton.vue_vue_type_script_setup_true_lang-c41f146c.js";import{_ as S}from"./UserPicker.vue_vue_type_script_setup_true_lang-db5dc3fb.js";import{_ as j}from"./SelectionTextInterface.vue_vue_type_script_setup_true_lang-ce15bb6a.js";import"./SelectionTextInterface.vue_vue_type_style_index_0_lang-376e8865.js";import{u as q}from"./useResource-c3b9d785.js";import{u as G}from"./useFileConverter-f07a79dc.js";async function W(f){return(await F.post("/link_preview",f)).data}function z(){return{postLinkPreview:W}}const H=C({__name:"ExternalResourcePreview",emits:["change"],setup(f,{emit:n}){const{postLinkPreview:w}=z(),y=async()=>{const v=await w({external_content_url:e.value});console.log(v),m.value=e.value,n("change",v)},e=r(""),m=r(""),g=I(()=>m.value!==e.value);return(v,b)=>(o(),i("div",null,[s(_,{modelValue:e.value,"onUpdate:modelValue":b[0]||(b[0]=c=>e.value=c),class:"mb-4",onKeyup:A(y,["enter"]),label:"Lien ressource externe"},null,8,["modelValue","onKeyup"]),g.value?(o(),k(x,{key:0,class:"mb-4",text:"Preview",onClick:y,type:"valid"},{default:T(()=>[E("Générer")]),_:1})):u("",!0)]))}}),J={class:"mt-10 mx-5"},M={key:0},Q={key:1},X={key:2},Y=d("div",null,"Optionnel : ajouter le contenu à partir d'un fichier La-tex",-1),Z={key:1},ee=["src"],te={key:0},le=d("div",{class:"text-2xs text-slate-800"},"Text formaté",-1),ae=C({__name:"CreateResourceProcess",setup(f){const n=r(0),{newResource:w,createResource:y}=q(),e=r({id:"",title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"",maturing_state:"",image_url:"",resource_type:"",comment:"",is_local_draft:!0,is_external:!1}),m=a=>{p.value=a,a?(n.value=1,e.value.maturing_state="fnsh",e.is_external=!0):(c.value=b.value.id,e.value.maturing_state="idea",e.is_external=!1,n.value=1,V.value=new Date(Date.now()).toISOString().split("T")[0])},{postFileConversion:g}=G(),v=async a=>{const t=a.target.files[0],l=new FormData;l.append(t.name,t);const P=await g(l);e.value.content=P.content,e.value.title=P.name},{user:b}=K(),c=r(null),V=r(null),p=r(!1),h=r(!1),R=a=>{console.log("apply preview : ",a),e.value.title=a.title,e.value.subtitle=a.subtitle,e.value.image_url=a.image_url,e.value.content=a.content,e.value.resource_type=a.resource_type,e.value.external_content_url=a.external_content_url,h.value=!0},$=r([{text:"Livre",value:"book"},{text:"Fiche de lecture",value:"shet"},{text:"Article de média",value:"natc"},{text:"Article de recherche",value:"ratc"},{text:"Film",value:"movi"},{text:"Podcast",value:"pcst"},{text:"Poême",value:"poem"}]),{createInteractionForResource:U,newInteraction:oe}=O(),D=N(),L=async()=>{const a=await y(e.value),t={interaction_user_id:c.value,resource_id:a.id,interaction_progress:p?100:0,interaction_date:new Date(V.value),interaction_comment:"",interaction_is_public:!!p.value};await U(a.id,t),D.push({path:"/resources/"+a.id,query:{editing:"false"}})};return(a,t)=>(o(),i("div",J,[n.value===0?(o(),i("div",M,[d("div",null,[s(x,{class:"mb-2",text:"Resource Externe",type:"valid",onClick:t[0]||(t[0]=l=>m(!0))}),s(x,{text:"Production personnelle",type:"valid",onClick:t[1]||(t[1]=l=>m(!1))})])])):u("",!0),n.value===1?(o(),i("div",Q,[s(S,{class:"mb-4",modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=l=>c.value=l)},null,8,["modelValue"]),c.value?(o(),k(_,{key:0,class:"text-2xs mb-4",label:"Date d'écriture","model-value":V.value,"onUpdate:modelValue":t[3]||(t[3]=l=>V.value=l),type:"date"},null,8,["model-value"])):u("",!0),s(x,{type:"valid",text:"Valider",onClick:t[4]||(t[4]=l=>n.value=2)})])):u("",!0),n.value===2?(o(),i("div",X,[d("div",null,[p.value?(o(),k(H,{key:0,onChange:t[5]||(t[5]=l=>R(l))})):u("",!0),Y,d("input",{id:"file",type:"file",onChange:v,placeholder:"Ajouter depuis un fichier"},null,32),!p.value||h.value?(o(),i("div",Z,[s(_,{class:"mb-4",modelValue:e.value.title,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.title=l),label:"Titre"},null,8,["modelValue"]),s(_,{class:"mb-4",modelValue:e.value.subtitle,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.subtitle=l),label:"Description"},null,8,["modelValue"]),s(_,{class:"mb-4",modelValue:e.value.image_url,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.image_url=l),label:"Url de l'image"},null,8,["modelValue"]),d("img",{class:"mb-4",src:e.value.image_url},null,8,ee),s(B,{label:"Type de ressource",class:"mb-4",choices:$.value,modelValue:e.value.resource_type,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.resource_type=l)},null,8,["choices","modelValue"]),e.value.content!==""?(o(),i("div",te,[le,s(j,{class:"max-h-40 overflow-scroll border border-slate-400 mb-4 p-2 rounded",type:"textarea",text:e.value.content},null,8,["text"])])):u("",!0),s(x,{class:"mb-4",text:"Créer",onClick:L,type:"valid"})])):u("",!0)])])):u("",!0)]))}}),se={class:"w-full"},pe=C({__name:"CreateResourceView",setup(f){return(n,w)=>(o(),i("div",se,[s(ae)]))}});export{pe as default};
