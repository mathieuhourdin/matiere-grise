import{d as x,r as u,c as f,o as k,a as I,b as o,e as n,f as t,g,_ as L,t as c,w as B,u as S,F as U,h as V,i as j}from"./index-beadb412.js";import{u as z}from"./useResourceRelations-cc695e3a.js";import{u as D}from"./useInteraction-78c629a0.js";const H={class:"flex flex-col border p-1.5 overflow-auto"},M={key:0,class:"flex mb-1.5 h-8"},N={class:"h-full flex flex-col w-full"},T={class:"flex w-auto shrink overflow-auto"},q={key:0,class:"text-xs font-semibold ml-2"},E={key:1,class:"text-xs italic ml-2"},P=t("div",{class:"mx-1 my-auto rounded-full bg-gray-800 w-1 h-1"},null,-1),W={class:"text-2xs my-auto"},G=t("div",{class:"text-2xs italic ml-2 grow shrink-0 overflow-auto"},"ProblÃ©matique",-1),J={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},K=["src"],O={key:1,class:"overflow-auto h-full overflow-scroll bg-blue-100 p-1 pt-8 border"},Q={class:"bg-blue-100 text-center my-auto"},X={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},Y={class:""},Z={class:"mb-2"},ee={class:"text-2xs mb-auto"},te={class:"flex mt-2"},se={class:"ml-auto text-2xs underline"},oe=x({__name:"FeedCard",props:{interaction:{}},setup(m){const a=m,d=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",r=u(0);u(null);const i=u(null),l=f(()=>`${r.value}/${_.value.length}`),_=f(()=>{if(!a.interaction.resource.content)return[];const e=a.interaction.resource.content.replaceAll("?","?.").split(".");let s=0;const h=[];for(;s<e.length-1;){let p=0,y=[];if(e[s].length>=270)h.push(e[s].replaceAll("?.","?")),s++;else{for(;s<e.length&&p+e[s].length<270;)y.push(e[s]),p+=e[s].length,s++;h.push(y.join(". ").replaceAll("?.","?"))}}return h}),C=e=>e?e.length>200?e.slice(0,150)+"...":e:"",b=u([]),{getResourceRelationsForResource:R}=z(),F=async()=>{a.interaction.id&&(b.value=await R(a.interaction.resource.id))},{getUserById:$}=S(),w=u(!1),A=async()=>{try{i.value=await $(a.interaction.user_id)}catch(e){console.log(e)}w.value=!0},v=u(null);return k(async()=>{await F(),await A();const e=v.value.offsetHeight;v.value.style.height=`${e}px`}),(e,s)=>{const h=I("router-link");return o(),n("div",H,[t("div",null,[w.value?(o(),n("div",M,[g(L,{user:i.value},null,8,["user"]),t("div",N,[t("div",T,[i.value?(o(),n("div",q,c(i.value.first_name)+" "+c(i.value.last_name),1)):(o(),n("div",E,"Connectez vous pour voir l'auteur")),P,t("div",W,c(d(e.interaction.date)),1)]),G])])):(o(),n("div",J))]),t("div",{onClick:s[0]||(s[0]=p=>r.value=(r.value+1)%(_.value.length+1)),class:"overflow-auto relative md:h-3/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:v},[r.value==0?(o(),n("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:e.interaction.resource.image_url},null,8,K)):(o(),n("div",O,[t("div",Q,c(_.value[r.value-1]),1)])),t("div",X,c(l.value),1)],512),g(h,{class:"overflow-auto",to:"/thought_outputs/"+e.interaction.resource.id},{default:B(()=>[t("div",Y,[t("div",Z,c(e.interaction.resource.title),1),t("div",ee,c(C(e.interaction.resource.subtitle)),1),t("div",te,[t("div",se,c(b.value.length)+" inputs",1)])])]),_:1},8,["to"])])}}}),ne=x({__name:"FeedList",props:{interactionsList:{}},setup(m){return(a,d)=>(o(),n("div",null,[(o(!0),n(U,null,V(a.interactionsList,(r,i)=>(o(),j(oe,{class:"max-h-screen border-b-1 border-black",interaction:r},null,8,["interaction"]))),256))]))}}),ae={class:"mt-4 md:mx-40"},ce=x({__name:"FeedView",setup(m){const{getReadAndWriteInteractions:a}=D(),d=u([]),r=f(()=>d.value.map(l=>({resource:l.resource,date:l.interaction_date,user_id:l.interaction_user_id,context_comment:l.interaction_comment,progress:l.interaction_progress})).sort((l,_)=>.5-Math.random())),i=async()=>d.value=await a();return k(async()=>{await i()}),(l,_)=>(o(),n("div",ae,[g(ne,{"interactions-list":r.value},null,8,["interactions-list"])]))}});export{ce as default};
