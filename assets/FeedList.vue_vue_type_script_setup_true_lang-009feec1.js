import{_ as M}from"./UserMini.vue_vue_type_script_setup_true_lang-14fa25ac.js";import{d as L,r as h,j as x,o as P,a as A,b as a,c,l as i,t as u,p as R,h as C,e as f,w,f as N,s as S,u as V,m as $,k as I,F as H,g as U,n as z}from"./index-67386673.js";import{u as D}from"./useResourceRelations-22334af8.js";import{a as O,b as E,r as q}from"./PaperAirplaneIcon-e301c639.js";const G=l=>{if(!l||l==="")return[];const r=l.replace(/\?/g,"?.").split(".");let o=0;const n=[];for(;o<r.length;){let s=0,m=[];if(r[o].length>=270)n.push(r[o].replace("/?./g","?")),o++;else{for(;o<r.length&&s+r[o].length<270;)m.push(r[o]),s+=r[o].length,o++;n.push(m.join(". ").replace("/?./g","?"))}}return n},J=l=>l?l.split(`
`).map(o=>G(o)).flat():[],B={splitTextForPanel:J},K=["src"],Q={key:1,class:"bg-white h-full text-center flex items-center justify-center"},W={class:"text-2xl text-black"},X={class:"text-lg text-bold mt-2"},Y={class:"text-bold mb-2"},Z={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},ee={key:1},te={key:1},re=L({__name:"FeedCardTextInterface",props:{interaction:{}},setup(l){const r=l,o=t=>{if(t>0&&t<=p.value.length){const e=p.value[t-1];return{text:e.replace(/#/g,""),header:t===1?"Commentaire : ":null,class:{"font-black":e.charAt(0)==="#","bg-gray-700":!0}}}else{const e=k.value[t-p.value.length-1];return{text:e?e.replace(/#/g,""):"",header:t===p.value.length+1?"Contenu : ":null,class:{"font-black":e&&e.charAt(0)==="#","bg-slate-700":!0}}}},n=h(0),s=()=>{n.value=(n.value+1)%d.value},m=()=>{n.value===0?n.value=d.value-1:n.value=(n.value-1)%d.value},_=x(()=>`${n.value+1}/${d.value}`),d=x(()=>p.value.length+k.value.length+1),k=x(()=>B.splitTextForPanel(r.interaction.resource.content)),p=x(()=>B.splitTextForPanel(r.interaction.context_comment)),F=()=>{if(r.interaction.interaction_type!="inpt"&&r.interaction.resource.image_url!==""){const t=g.value.offsetHeight;g.value.style.height=`${t}px`}},{getAuthorInteractionForResource:T}=S(),v=h(null),g=h(null);return P(async()=>{(r.interaction.interaction_type!="inpt"&&r.interaction.resource.image_url===""||r.interaction.resource.image_url===null)&&(n.value=1);try{const t=await T(r.interaction.resource.id);t&&(t.resource=r.interaction.resource,t.user_id=t.interaction_user_id,v.value=t)}catch(t){console.error("Failed to fetch author interaction:",t)}}),(t,e)=>{const y=A("router-link");return t.interaction.interaction_type!="inpt"&&t.interaction.interaction_type!="bibl"?(a(),c("div",{key:0,class:"relative w-full md:h-96 h-96 mb-2 bg-gray-700",ref_key:"parentCard",ref:g},[n.value==0&&t.interaction.resource.image_url!==""?(a(),c("img",{key:0,class:"object-contain w-full h-full mt-auto mx-auto",src:t.interaction.resource.image_url,onLoad:F},null,40,K)):n.value==0?(a(),c("div",Q,[i("div",null,[i("div",W,u(t.interaction.resource.title),1),i("div",X,u(t.interaction.resource.subtitle),1)])])):(a(),c("div",{key:2,class:R(["h-full p-1 pb-16 border flex items-center justify-center",o(n.value).class])},[i("div",{class:R([o(n.value).class,"text-center text-sm text-white"])},[i("div",null,[i("div",Y,u(o(n.value).header),1),i("div",null,u(o(n.value).text),1)])],2)],2)),i("div",Z,u(_.value),1),i("div",{class:"absolute h-full w-full left-0 top-0 flex"},[i("div",{class:"w-1/2 h-full",onClick:m}),i("div",{class:"w-1/2 h-full",onClick:s})])],512)):(a(),c("div",ee,[v.value?(a(),C(j,{key:0,interaction:v.value,class:"mx-1.5 mb-0.5 h-96 border-1 border border-slate-600 rounded"},null,8,["interaction"])):(a(),c("div",te,[f(y,{to:"/app/resources/"+t.interaction.resource.id},{default:w(()=>[N(u(t.interaction.resource.title),1)]),_:1},8,["to"])]))]))}}}),oe={class:"flex flex-col py-1.5 overflow-auto dark:border-gray-600 border-t border-black"},ne={class:"flex mx-1.5"},se={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},ie={key:0,class:"flex mx-1.5"},ae={title:"Coming Soon ;)",class:"w-6"},le={title:"Coming Soon ;)",class:"w-6"},ce={key:1,class:"flex mx-1.5"},ue={class:"text-2xs"},de={class:""},pe={class:"mb-2 font-bold text-sm"},me={class:"text-2xs mb-auto"},j=L({__name:"FeedCard",props:{interaction:{}},setup(l){const r=l,o=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",n=e=>e==="outp"?"Production personnelle":"Bibliographie",{resourceTypeOptions:s,getAuthorInteractionForResource:m}=S(),_=e=>{const y=s.find(b=>b.value===e);return y?y.text:e};h(null);const d=h(null),k=e=>e?e.length>200?e.slice(0,150)+"...":e:"",p=h([]),{getResourceRelationsForResource:F}=D(),T=async()=>{r.interaction.id&&(p.value=await F(r.interaction.resource.id))},{getUserById:v}=V(),g=h(!1),t=async()=>{if(r.interaction.user_id){try{d.value=await v(r.interaction.user_id)}catch(e){console.log(e)}g.value=!0}else{const e=await m(r.interaction.resource.id);d.value=await v(e.value)}};return P(async()=>{await T(),await t()}),(e,y)=>{const b=A("router-link");return a(),c("div",oe,[i("div",ne,[g.value?(a(),C(M,{key:0,class:"flex mb-1.5 h-8",user:d.value,secondText:o(e.interaction.interaction_date),firstBottomText:n(e.interaction.interaction_type),secondBottomText:e.$t(_(e.interaction.resource.resource_type))},null,8,["user","secondText","firstBottomText","secondBottomText"])):(a(),c("div",se))]),f(re,{class:"border-1 border-black",interaction:e.interaction},null,8,["interaction"]),e.interaction.interaction_type!="inpt"?(a(),c("div",ie,[i("div",ae,[f($(O),{class:"w-full my-auto"})]),i("div",le,[f($(E),{class:"w-full my-auto"})]),f(b,{to:"/social/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto"},{default:w(()=>[f($(q),{class:"w-8"})]),_:1},8,["to"])])):I("",!0),e.interaction.interaction_type!="inpt"?(a(),c("div",ce,[i("div",ue,u(Math.floor(Math.random()*100))+" likes",1),f(b,{to:"/social/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:w(()=>[N(u(p.value.length)+" relations ",1)]),_:1},8,["to"])])):I("",!0),e.interaction.interaction_type!="inpt"?(a(),C(b,{key:2,class:"mx-1.5",to:"/app/resources/"+e.interaction.resource.id},{default:w(()=>[i("div",de,[i("div",pe,u(e.interaction.resource.title),1),i("div",me,u(k(e.interaction.resource.subtitle)),1)])]),_:1},8,["to"])):I("",!0)])}}}),fe={class:"flex flex-col"},ye=L({__name:"FeedList",props:{interactionsList:{}},setup(l){const r=l,{feedFilter:o}=z(),n=x(()=>r.interactionsList.filter(s=>o.value==="production"?s.interaction_type==="outp"&&!s.resource.is_external&&s.resource.resource_type!=="pblm"&&!s.resource.is_external:o.value==="draft"?s.interaction_type==="outp"&&!s.resource.is_external&&(s.resource.maturing_state==="drft"||s.resource.maturing_state==="rvew"):o.value==="reviews"?s.interaction_type==="rvew":o.value==="problem"?s.resource.resource_type==="pblm":o.value==="biblio"?s.interaction_type==="inpt":s.interaction_type==="bibl"||s.interaction_type==="inpt"||!s.resource.is_external));return(s,m)=>(a(),c("div",fe,[(a(!0),c(H,null,U(n.value,(_,d)=>(a(),C(j,{class:"md:mb-2 md:mx-1 flex-grow md:rounded max-h-screen border-t-[1px] md:border-[1px] border-black",interaction:_,key:_.id},null,8,["interaction"]))),128))]))}});export{ye as _};
