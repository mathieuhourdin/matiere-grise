import{_ as N}from"./ActionButton.vue_vue_type_script_setup_true_lang-263fb2a9.js";import{b as s,c as l,e as d,d as K,q as re,j as y,t as C,f as F,D as P,E as M,m as q,r as x,w as b,y as O,o as ue,C as z,k as ie,I as ce,F as $,l as T,g as de}from"./index-c476b275.js";function ve(r,u){return s(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"})])}const he={class:"bg-slate-100 border p-1 m-1 rounded shadow-xl"},me={class:"flex"},fe={key:0,class:"text-xs mt-0.5 mb-1 font-bold flex"},pe=["src"],xe={class:"my-auto"},_e={class:"text-2xs italic ml-auto mr-1 my-auto"},ge={key:0},ye=["value"],Ce={class:"flex"},we={key:1,class:"text-xs mt-0.5"},ke=K({__name:"CommentCard",props:{editing:{type:Boolean},modelValue:{},author:{},createdAt:{}},emits:["update:modelValue","validate","abort"],setup(r,{emit:u}){const c=r,h=re(()=>c.createdAt?c.createdAt.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):""),o=i=>{u("update:modelValue",i.target.value)},n=()=>{u("validate")},p=()=>{u("abort")};return(i,V)=>(s(),l("div",he,[d("div",me,[i.author?(s(),l("div",fe,[i.author.profile_picture_url?(s(),l("img",{key:0,class:"h-5 w-5 rounded-full mr-1",src:i.author.profile_picture_url},null,8,pe)):y("",!0),d("div",xe,C(i.author.first_name)+" "+C(i.author.last_name),1)])):y("",!0),d("div",_e,C(h.value),1)]),i.editing?(s(),l("div",ge,[d("textarea",{class:"w-full text-xs rounded-xl p-2",value:i.modelValue,onInput:o},null,40,ye),d("div",Ce,[F(N,{onClick:n,class:"text-sm",rounded:"",size:"2xs",text:"Commenter",type:"valid"}),F(N,{onClick:p,class:"text-sm",rounded:"",size:"2xs",text:"Annuler",type:"abort"})])])):(s(),l("div",we,C(i.modelValue),1))]))}}),{launchSnackbar:U}=M(),be=async(r,u,c,h)=>{const{user:o}=q(),n={start_index:u,end_index:u,content:c,editing:h};try{const p=await P.post("/resources/"+r+"/comments",n),i=W(p.data);return o.value&&i.author_id==o.value.id&&(i.author=o.value),i}catch(p){throw console.log("error : ",p),U(`Error creating comment : ${p}`,"error"),p}},W=r=>(r.updated_at=new Date(r.updated_at.split(".")[0]),r.created_at=new Date(r.created_at.split(".")[0]),r),$e=async(r,u=!0)=>{const c=u?"?author=true":"";try{return(await P.get("/resources/"+r+"/comments"+c)).data.map(o=>W(o))}catch(h){throw console.log("error : ",h),U(`Error getting comments : ${h}`,"error"),h}},X=async r=>{try{const u=await P.put("/comments/"+r.id,r);return W(u.data)}catch(u){console.log("error : ",u),U(`Error updating comment : ${u}`,"error")}},Te=async r=>{console.log("comments : ",r),r.map(u=>X(u))};function Ve(){return{createComment:be,getCommentsForThoughtOutput:$e,updateComment:X,batchUpdateComments:Te}}const Ae={key:0},Ee=d("div",{class:"text-sm align-middle flex items-center p-2",style:{height:"50px"}}," Corriger une faute ",-1),Ie={class:"flex mx-auto max-w-full"},Be={class:"w-full"},Se={key:0,class:"flex"},De=d("div",{class:"w-6"},[d("div",{class:"rounded-full ml-4 mr-2 mt-2 h-1 w-1 bg-black"})],-1),ze=[De],Fe={class:"flex flex-wrap flex-1"},Pe=["onClick","onContextmenu"],Ue={key:0,style:{width:"5px"}},We={key:1,style:{height:"25px"}},Le={key:2},Re=["onClick"],je={key:1,class:"absolute h-full",style:{right:"-2%",width:"27%"}},He={key:0,style:{width:"33%"}},Ke=K({__name:"TextInterface",props:{resourceId:{},fullText:{},extComments:{default:()=>[]},editable:{type:Boolean,default:!0}},emits:["change","changeComments"],setup(r,{emit:u}){const c=r,h=e=>{console.log("selectCursorPosition letter : ",e),c.editable&&(o.value={id:e.id,char:e.char})},o=x(null),n=x([]),p=x([]),i=async()=>{await new Promise(v=>setTimeout(v,10));let e=[{id:0,words:[{id:0,text:[]}],comments:[]}],t=0,a=0;for(var m=0;m<n.value.length;m++){n.value[m].char==`
`&&(t+=1,a=0,e.push({id:t,words:[{id:0,text:[]}],lineStyle:m<n.value.length-1?n.value[m+1].char:null,comments:[]}));const v=_.value.find(g=>g.start_index==m);v&&e[t].comments.push(v),e[t].words[a].text.push({id:m,char:n.value[m].char,comment:v}),n.value[m].char==" "&&(a+=1,e[t].words.push({id:a,text:[]}))}return e},V=e=>{e==1?_.value.forEach(t=>{o.value&&t.start_index>o.value.id&&(t.start_index+=1),o.value&&t.end_index>o.value.id&&(t.end_index+=1)}):e==-1&&_.value.forEach(t=>{o.value&&t.start_index>=o.value.id&&(t.start_index-=1),o.value&&t.end_index>=o.value.id&&(t.end_index-=1)})},A=e=>{o.value&&(n.value.filter(t=>o.value&&t.id>=o.value.id+1).forEach(t=>t.id+=1),n.value.splice(o.value.id+1,0,{id:o.value.id+1,char:e}),V(1),o.value.id+=1)},Y=e=>{if(console.log("Writes : ",e.key),o.value===null)return;const t=e.key;if(E.value&&t=="v"){G();return}if(t.length==1)e.preventDefault(),A(t);else if(t=="Backspace")n.value.splice(o.value.id,1),n.value.filter(a=>o.value&&a.id>o.value.id).forEach(a=>a.id-=1),V(-1),o.value.id-=1;else if(t=="Enter")A(`
`);else if(t=="ArrowRight"){let a=o.value.id;a<n.value.length-1&&h(n.value[a+1])}else if(t=="ArrowLeft"){let a=o.value.id;a>0&&h(n.value[a-1])}else t=="Control"&&(console.log("Control"),E.value=!0)},E=x(!1),G=async()=>{try{let t=await navigator.clipboard.readText();console.log("Clippedtext : ",t);for(var e=0;e<t.length;e++)A(t[e])}catch(t){console.log("Error with clippboard : ",t)}},J=e=>{e.key=="Control"&&(E.value=!1)},I=x(!1),{launchSnackbar:Q}=M(),Z=async()=>{try{await navigator.clipboard.writeText(c.fullText),I.value=!0,Q("Text copied to clipboard","success"),setTimeout(()=>I.value=!1,2e3)}catch(e){console.log(`Error with copy : ${e}`)}},{createComment:ee,batchUpdateComments:te}=Ve(),_=x([]),B=x(null),L=e=>{_.value=e.filter(t=>t.start_index!=null)},oe=async()=>{if(console.log("Add Comment"),console.log(c.resourceId),console.log(w.value),!c.resourceId||!w.value)return;console.log("Add Comment 2");const e=await ee(c.resourceId,w.value);_.value.push(e)};b(_,e=>{console.log("Watch comments triggered : ",e),k.value&&(console.log("Comments : ",e),u("changeComments",e),B.value!==null&&clearTimeout(B.value),B.value=setTimeout(()=>te(e),1e3))},{deep:!0}),b(O(c).extComments,e=>{L(e)});const S=x(!1),w=x(null),D=x({position:"absolute","z-index":90,top:"0px",left:"0px",height:"106px",width:"260px"}),{user:ae}=q(),se=(e,t)=>{e.preventDefault(),ae.value&&(o.value=null,D.value.top=`${e.layerY}px`,D.value.left=`${e.layerX}px`,S.value=!0,w.value=t,console.log("event : ",e),console.log("Have a new right click"))},R=e=>{if(n.value=[],e===void 0||e==""){n.value=[{id:0,char:`
`}],h({id:0,char:`
`});return}for(var t=0;t<e.length;t++){const a=_.value.find(m=>m.start_index==t);n.value.push({id:t,char:e[t],comment:a})}},le=e=>e.reduce((t,a)=>t+a.char,""),k=x(!1);return ue(async()=>{await R(c.fullText),await L(c.extComments),p.value=await i(),k.value=!0}),b(n,e=>{console.log("Watch triggered : ",e),k.value&&u("change",le(e))},{deep:!0}),b(O(c).fullText,e=>{R(e),p.value=i()}),(e,t)=>(s(),l("div",null,[F(ie(ve),{onClick:Z,class:z(["absolute h-6 right-2",{"text-slate-400":I.value}])},null,8,["class"]),k.value?(s(),l("div",{key:1,class:"relative md:p-4",tabindex:"0",onKeydown:Y,onKeyup:J,onClick:t[0]||(t[0]=a=>S.value=!1)},[S.value?(s(),l("div",{key:0,class:"bg-white border-4",style:ce(D.value)},[d("div",{onClick:oe,class:"text-sm border-b-2 flex items-center p-2",style:{height:"50px"}}," Ajouter un commentaire "),Ee],4)):y("",!0),d("div",Ie,[d("div",Be,[(s(!0),l($,null,T(p.value,(a,m)=>(s(),l("div",{key:m,class:"flex"},[a.lineStyle=="*"?(s(),l("div",Se,ze)):y("",!0),d("div",Fe,[(s(!0),l($,null,T(a.words,(v,g)=>(s(),l("div",{key:g,class:"flex flex-wrap"},[(s(!0),l($,null,T(v.text,(f,ne)=>{var j;return s(),l("div",{key:ne,class:z(["border-blue-400",{"border-r-2":f.id==((j=o.value)==null?void 0:j.id),"bg-yellow-400":f.comment}]),onClick:H=>h(f),onContextmenu:H=>se(H,f.id)},[f.char==" "?(s(),l("div",Ue)):f.char==`
`?(s(),l("div",We)):(f.char=="#"||f.char=="*")&&g==0?(s(),l("div",Le)):(s(),l("div",{key:3,class:z({"font-bold":a.lineStyle=="#"})},[d("div",null,C(f.char),1)],2))],42,Pe)}),128))]))),128)),d("div",{class:"flex-1",onClick:v=>h(a.words.slice(-1)[0].text.slice(-1)[0])},null,8,Re)]),_.value.length>0?(s(),l("div",je,[(s(!0),l($,null,T(a.comments,(v,g)=>(s(),de(ke,{key:g,class:"w-full",modelValue:v.content,"onUpdate:modelValue":f=>v.content=f,editing:v.editing,onValidate:f=>v.editing=!1,author:v.author,"created-at":v.created_at},null,8,["modelValue","onUpdate:modelValue","editing","onValidate","author","created-at"]))),128))])):y("",!0)]))),128))]),_.value.length>0?(s(),l("div",He)):y("",!0)])],32)):(s(),l("div",Ae,[d("span",null,C(e.fullText),1)]))]))}});export{Ke as _,ke as a,Ve as u};
