import{Y as E,d as h,r as u,j as F,b as n,c as i,e as s,K as N,h as R,w as p,f,z as y,k as r,u as A,x as B,l as d,m as K,Z as j,s as O,v as S}from"./index-97bf9060.js";import{_ as x}from"./TextInput.vue_vue_type_script_setup_true_lang-00c10724.js";import{_ as q}from"./UserPicker.vue_vue_type_script_setup_true_lang-46637df3.js";import{_ as z}from"./SelectionTextInterface.vue_vue_type_style_index_0_lang-65f49df9.js";import{u as G}from"./useFileConverter-00373f76.js";import"./ClipboardIcon-bae7e61b.js";async function W(b){return(await E.post("/link_preview",b)).data}function Y(){return{postLinkPreview:W}}const Z=h({__name:"ExternalResourcePreview",emits:["change"],setup(b,{emit:o}){const{postLinkPreview:C}=Y(),V=async()=>{const m=await C({external_content_url:c.value});console.log(m),e.value=c.value,o("change",m)},c=u(""),e=u(""),g=F(()=>e.value!==c.value);return(m,w)=>(n(),i("div",null,[s(x,{modelValue:c.value,"onUpdate:modelValue":w[0]||(w[0]=P=>c.value=P),class:"mb-4",onKeyup:N(V,["enter"]),label:"Lien ressource externe"},null,8,["modelValue","onKeyup"]),g.value?(n(),R(y,{key:0,class:"mb-4",onClick:V,type:"valid"},{default:p(()=>[f("Générer")]),_:1})):r("",!0)]))}}),H={class:"mt-10 mx-5"},J={key:0},M={key:1},Q={key:2},X=d("div",null,"Optionnel : ajouter le contenu à partir d'un fichier La-tex",-1),ee={key:1},te=["src"],le={key:0},ae=d("div",{class:"text-2xs text-slate-800"},"Text formaté",-1),se=h({__name:"CreateResourceProcess",setup(b){const o=u(0),{newResource:C,createResource:V,resourceTypeOptions:c}=O(),e=u({id:"",title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"",maturing_state:"",image_url:"",resource_type:"",comment:"",is_local_draft:!0,is_external:!1}),g=a=>{_.value=a,a?(o.value=1,e.value.maturing_state="fnsh",e.value.is_external=!0):(v.value=P.value.id,e.value.maturing_state="drft",e.value.is_external=!1,o.value=1,k.value=new Date(Date.now()).toISOString().split("T")[0])},{postFileConversion:m}=G(),w=async a=>{const t=a.target.files[0],l=new FormData;l.append(t.name,t);const U=await m(l);e.value.content=U.content,e.value.title=U.name},{user:P}=A(),v=u(null),k=u(null),_=u(!1),$=u(!1),D=a=>{console.log("apply preview : ",a),e.value.title=a.title,e.value.subtitle=a.subtitle,e.value.image_url=a.image_url,e.value.content=a.content,e.value.resource_type=a.resource_type,e.value.external_content_url=a.external_content_url,$.value=!0},{createInteractionForResource:I,newInteraction:oe}=S(),L=B(),T=async()=>{const a=await V(e.value),t={interaction_user_id:v.value,resource_id:a.id,interaction_progress:_?100:0,interaction_date:new Date(k.value),interaction_comment:"",interaction_is_public:!!_.value};await I(a.id,t),L.push({path:"/app/resources/"+a.id,query:{editing:"false"}})};return(a,t)=>(n(),i("div",H,[o.value===0?(n(),i("div",J,[d("div",null,[s(y,{class:"mb-2",type:"valid",onClick:t[0]||(t[0]=l=>g(!0))},{default:p(()=>[f("Resource Externe")]),_:1}),s(y,{type:"valid",onClick:t[1]||(t[1]=l=>g(!1))},{default:p(()=>[f("Production personnelle")]),_:1})])])):r("",!0),o.value===1?(n(),i("div",M,[s(q,{class:"mb-4",modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=l=>v.value=l)},null,8,["modelValue"]),v.value?(n(),R(x,{key:0,class:"text-2xs mb-4",label:"Date d'écriture","model-value":k.value,"onUpdate:modelValue":t[3]||(t[3]=l=>k.value=l),type:"date"},null,8,["model-value"])):r("",!0),s(y,{type:"valid",onClick:t[4]||(t[4]=l=>o.value=2)},{default:p(()=>[f("Valider")]),_:1})])):r("",!0),o.value===2?(n(),i("div",Q,[d("div",null,[_.value?(n(),R(Z,{key:0,onChange:t[5]||(t[5]=l=>D(l))})):r("",!0),X,d("input",{id:"file",type:"file",onChange:w,placeholder:"Ajouter depuis un fichier"},null,32),!_.value||$.value?(n(),i("div",ee,[s(x,{class:"mb-4",modelValue:e.value.title,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.title=l),label:"Titre"},null,8,["modelValue"]),s(x,{class:"mb-4",modelValue:e.value.subtitle,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.subtitle=l),label:"Description"},null,8,["modelValue"]),s(x,{class:"mb-4",modelValue:e.value.image_url,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.image_url=l),label:"Url de l'image"},null,8,["modelValue"]),d("img",{class:"mb-4",src:e.value.image_url},null,8,te),s(j,{label:"Type de ressource",class:"mb-4",choices:K(c),modelValue:e.value.resource_type,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.resource_type=l)},null,8,["choices","modelValue"]),e.value.content!==""?(n(),i("div",le,[ae,s(z,{class:"max-h-40 overflow-scroll border border-slate-400 mb-4 p-2 rounded",type:"textarea",text:e.value.content},null,8,["text"])])):r("",!0),s(y,{class:"mb-4",onClick:T,type:"valid"},{default:p(()=>[f("Créer")]),_:1})])):r("",!0)])])):r("",!0)]))}}),ne={class:"w-full"},ve=h({__name:"CreateResourcePage",setup(b){return(o,C)=>(n(),i("div",ne,[s(se)]))}});export{ve as default};
