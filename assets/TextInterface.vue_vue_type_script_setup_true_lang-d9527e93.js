import{e as V,r as u,g as j,m as w,h as q,l as H,o as a,c as s,n as M,b as d,k as F,F as x,p,q as U,t as B}from"./index-777f25a2.js";const X=d("div",{class:"text-sm align-middle flex items-center p-2",style:{height:"50px"}}," Corriger une faute ",-1),Y={class:"flex mx-auto max-w-full"},G={class:"flex flex-wrap"},J=["onClick","onContextmenu"],Q={key:0,style:{width:"5px"}},Z={key:1,style:{height:"25px"}},ee={key:2},te={class:"absolute h-full",style:{right:"-100px"}},le={key:0,style:{width:"200px"}},ne=V({__name:"TextInterface",props:{fullText:{},extComments:{default:()=>[]},editable:{type:Boolean,default:!0}},emits:["change","changeComments"],setup(S,{emit:b}){const h=S,f=e=>{console.log("selectCursorPosition letter : ",e),h.editable&&(r.value={id:e.id,char:e.char})},r=u(null),o=u([]),W=j(()=>$(o.value)),$=e=>{console.log("textArrayFromString textString: ",e);let t=[{id:0,words:[{id:0,text:[]}],text:[],comments:[]}],l=0,i=0;for(var n=0;n<o.value.length;n++){o.value[n].char==`
`&&(l+=1,i=0,t.push({id:l,words:[{id:0,text:[]}],text:[],comments:[]})),t[l].words[i].text.push({id:n,char:o.value[n].char,comment:o.value[n].comment}),o.value[n].char==" "&&(i+=1,t[l].words.push({id:i,text:[{id:n,char:o.value[n].char}]}));const m=v.value.find(c=>c.startIndex==n);m&&t[l].comments.push(m)}return t},g=e=>{o.value.filter(t=>t.id>=r.value.id+1).forEach(t=>t.id+=1),o.value.splice(r.value.id+1,0,{id:r.value.id+1,char:e,line:0}),r.value.id+=1},z=e=>{if(console.log("Writes : ",e.key),r.value===null)return;const t=e.key;if(y.value&&t=="v"){L();return}if(t.length==1)g(t);else if(t=="Backspace")o.value.splice(r.value.id,1),o.value.filter(l=>l.id>r.value.id).forEach(l=>l.id-=1),r.value.id-=1;else if(t=="Enter")g(`
`);else if(t=="ArrowRight"){let l=r.value.id;l<o.value.length-1&&f(o.value[l+1])}else if(t=="ArrowLeft"){let l=r.value.id;l>0&&f(o.value[l-1])}else t=="Control"&&(console.log("Control"),y.value=!0)},y=u(!1),L=async()=>{try{let t=await navigator.clipboard.readText();console.log("Clippedtext : ",t);for(var e=0;e<t.length;e++)g(t[e])}catch(t){console.log("Error with clippboard : ",t)}},N=e=>{e.key=="Control"&&(y.value=!1)},v=u([{id:0,startIndex:12,text:"Ceci est un commentaire"},{id:1,startIndex:16,text:"Un autre commentaire"}]),P=e=>{console.log("Comments loading : ",e),v.value=e};w(v,e=>{console.log("Watch comments triggered : ",e.value),_.value&&b("changeComments",e.value)},{deep:!0});const C=u(!1),I=u(null),R=()=>{console.log("Add Comment"),v.value.push({id:0,startIndex:I.value,text:"Nouveau commentaire"})},k=u({position:"absolute","z-index":90,top:0,left:0,height:"106px",width:"260px"}),D=(e,t)=>{e.preventDefault(),k.value.top=`${e.layerY}px`,k.value.left=`${e.layerX}px`,C.value=!0,I.value=t,console.log("event : ",e),console.log("Have a new right click")},A=e=>{if(console.log("textArrayFromString textString: ",e),o.value=[],e===void 0||e==""){o.value=[{id:0,char:`
`}],f({id:0,char:`
`});return}for(var t=0;t<e.length;t++){const l=v.value.find(i=>i.startIndex==t);o.value.push({id:t,char:e[t],comment:l})}},K=e=>e.reduce((t,l)=>t+l.char,""),_=u(!1);return q(()=>{A(h.fullText),P(h.extComments),_.value=!0}),w(o,e=>{console.log("Watch triggered : ",e),_.value&&b("change",K(e))},{deep:!0}),w(H(h).fullText,e=>{A(e)}),(e,t)=>(a(),s("div",{class:"relative p-4",tabindex:"0",onKeydown:z,onKeyup:N,onClick:t[0]||(t[0]=l=>C.value=!1)},[C.value?(a(),s("div",{key:0,class:"bg-white border-4",style:M(k.value)},[d("div",{onClick:R,class:"text-sm border-b-2 flex items-center p-2",style:{height:"50px"}}," Ajouter un commentaire "),X],4)):F("",!0),d("div",Y,[d("div",null,[(a(!0),s(x,null,p(W.value,(l,i)=>(a(),s("div",{key:i,class:"flex flex-wrap"},[d("div",G,[(a(!0),s(x,null,p(l.words,(n,m)=>(a(),s("div",{key:m,class:"flex flex-wrap"},[(a(!0),s(x,null,p(n.text,(c,O)=>{var T;return a(),s("div",{key:O,class:U(["border-blue-400",{"border-r-2":c.id==((T=r.value)==null?void 0:T.id)}]),onClick:E=>f(c),onContextmenu:E=>D(E,c.id)},[c.char==" "?(a(),s("div",Q)):c.char==`
`?(a(),s("div",Z)):(a(),s("div",ee,[d("div",null,B(c.char),1)]))],42,J)}),128))]))),128))]),d("div",te,[(a(!0),s(x,null,p(l.comments,(n,m)=>(a(),s("div",{key:m,class:"bg-slate-100 border-2 p-4 m-1",style:{width:"200px"}},B(n.text),1))),128))])]))),128))]),v.value.length>0?(a(),s("div",le,"Espace")):F("",!0)])],32))}});export{ne as _};
