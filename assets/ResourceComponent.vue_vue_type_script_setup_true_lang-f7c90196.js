import{o as a,c as d,h as r,d as I,t as b,F as ye,i as xe,r as p,p as U,f as B,j as u,e as J,z as Ae,x as te,A as oe,l as De,B as Te,C as Se,a as w,q as be,n as C,w as A,g as q,D as we,E as Fe,G as D,u as M,H as ke,m as H,I as Be,v as Oe,k as Pe,s as Ee,y as ie}from"./index-3a1f6e15.js";import{_ as ce,u as Le}from"./TextInterface.vue_vue_type_script_setup_true_lang-28204294.js";import{_ as L}from"./TextInput.vue_vue_type_script_setup_true_lang-3d22b14b.js";import{u as de}from"./useResource-9006ff58.js";import{a as Ne,u as $e}from"./useProblem-db096daa.js";function je(o,e){return a(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 8.25H7.5a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25H15M9 12l3 3m0 0l3-3m-3 3V2.25"})])}function qe(o,e){return a(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}function Me(o,e){return a(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z"})])}const ze={class:"block text-2xs text-slate-800"},He=["value"],Je=["value"],z=I({__name:"SelectInput",props:{label:{},choices:{},modelValue:{},displayFunction:{type:Function,default:o=>o.text}},emits:["update:modelValue"],setup(o,{emit:e}){const n=t=>{console.log(t.target.value),e("update:modelValue",t.target.value)};return(t,l)=>(a(),d("div",null,[r("label",ze,b(t.label),1),r("select",{value:t.modelValue,name:"Stade d'écriture",class:"text-xs w-full p-1 block rounded border-2 border-neutral-400",onInput:l[0]||(l[0]=i=>n(i))},[(a(!0),d(ye,null,xe(t.choices,i=>(a(),d("option",{key:i.value,value:i.value},b(t.displayFunction(i)),9,Je))),128))],40,He)]))}}),Ke={class:"m-4"},We={class:"block text-2xs text-slate-800"},Ge=["value","placeholder"],ne=I({__name:"TextAreaInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue"],setup(o,{emit:e}){const n=t=>{e("update:modelValue",t.target.value)};return(t,l)=>(a(),d("div",Ke,[r("label",We,b(t.label),1),r("textarea",{class:"border border-neutral-800 block h-full w-full",value:t.modelValue,placeholder:t.placeholder,onInput:l[0]||(l[0]=i=>n(i))},null,40,Ge)]))}}),Qe=r("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Xe=r("div",{class:"text-xs italic"},"Raison de la lecture",-1),Ye=I({__name:"SeeThoughtInput",props:{thoughtInput:{}},setup(o){const e=o,{getUserById:n,user:t}=J(),l=p(null),i=U(()=>t.value?e.thoughtInput.interaction_user_id===t.value.id:!1);return B(async()=>{e.thoughtInput.interaction_user_id&&(l.value=await n(e.thoughtInput.interaction_user_id))}),(g,m)=>(a(),d("div",null,[u(yo,{id:g.thoughtInput.resource_id,"second-level":""},null,8,["id"]),Qe,Xe,u(ce,{"full-text":g.thoughtInput.interaction_comment,editable:i.value},null,8,["full-text","editable"])]))}}),Ze={class:"flex"},ee=I({__name:"ModalSheet",props:{open:{type:Boolean,default:!1}},emits:["close"],setup(o,{emit:e}){const n=o,t=p(!1);return B(()=>{t.value=n.open}),Ae(()=>{const l=i=>{(i.key==="Escape"||i.key==="Enter"||i.key==="Esc"||i.keyCode===27)&&e("close")};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}}),te(oe(n).open,l=>t.value=l),(l,i)=>t.value?(a(),d("div",{key:0,tabindex:"0",onKeyup:i[2]||(i[2]=Se(g=>e("close"),["esc"])),class:"fixed top-0 left-0 w-full h-full z-10 bg-slate-500/50",onClick:i[3]||(i[3]=g=>e("close"))},[r("div",{class:"max-w-xl overflow-y-scroll max-h-screen mb-10 bg-white mx-auto mt-6 p-4 rounded shadow",onClick:i[1]||(i[1]=Te(()=>{},["stop"]))},[r("div",Ze,[r("div",{class:"ml-auto",onClick:i[0]||(i[0]=g=>e("close"))},"x")]),De(l.$slots,"default")])],32)):w("",!0)}}),et={class:"w-full md:w-96"},tt={key:0,class:"text-xs italic mb-2"},ot={class:"flex flex-wrap"},nt={key:1,class:"text-2xs italic ml-2"},st={key:2,class:"ml-auto m-1 w-1/3"},at={key:1,class:"border shadow-lg rounded p-4 md:w-96"},lt={class:"flex"},rt=["src"],ut={class:"flex flex-wrap w-full",style:{"margin-top":"-8px"}},it={class:"text-2xs"},ct={class:"flex flex-wrap"},dt={key:0,class:"text-2xs italic"},pt=I({__name:"ThoughtInputCard",props:{contextualResource:{}},setup(o){const e=o,{getUserById:n}=J(),{getAuthorInteractionForResource:t}=de(),l=p(null),i=p(null),g=p(null);B(async()=>{e.contextualResource.user_id&&(g.value=await n(e.contextualResource.user_id)),e.contextualResource.resource&&(i.value=await t(e.contextualResource.resource.id)),i.value&&(l.value=await n(i.value.interaction_user_id))});const m=s=>s?s.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",y=s=>s.length>200?s.slice(0,150)+"...":s;return(s,v)=>{const x=be("router-link");return a(),d("div",et,[s.contextualResource.context_comment?(a(),d("div",tt,[r("div",null,b(s.contextualResource.context_comment),1),r("div",ot,[g.value?(a(),C(x,{key:0,to:"/users/"+g.value.id,class:"text-2xs underline"},{default:A(()=>[q(b(g.value.first_name)+" "+b(g.value.last_name),1)]),_:1},8,["to"])):w("",!0),s.contextualResource.date?(a(),d("div",nt,b(m(s.contextualResource.date)),1)):w("",!0),s.contextualResource.progress?(a(),d("div",st,[u(we,{"progress-value":s.contextualResource.progress},null,8,["progress-value"])])):w("",!0)])])):w("",!0),s.contextualResource.resource?(a(),d("div",at,[r("div",lt,[s.contextualResource.resource?(a(),d("img",{key:0,class:"w-8 h-fit mr-4",src:s.contextualResource.resource.image_url},null,8,rt)):w("",!0),r("div",null,[r("div",null,[u(x,{to:"/resources/"+s.contextualResource.resource.id},{default:A(()=>[q(b(s.contextualResource.resource.title)+" "+b(s.contextualResource.resource.subtitle),1)]),_:1},8,["to"])]),r("div",ut,[l.value?(a(),C(x,{key:0,to:"/users/"+l.value.id,class:"text-2xs underline"},{default:A(()=>[q(b(l.value.first_name)+" "+b(l.value.last_name),1)]),_:1},8,["to"])):w("",!0)]),r("div",it,b(y(s.contextualResource.resource.comment)),1)])]),r("div",ct,[s.contextualResource.date?(a(),d("div",dt,b(m(s.contextualResource.resourcedate)),1)):w("",!0)])])):w("",!0)])}}}),mt={class:"w-fit"},vt=I({__name:"ThoughtInputCardWithPopup",props:{thoughtInput:{},usageReason:{}},setup(o){const e=p(!1);return(n,t)=>(a(),d("div",mt,[u(ee,{open:e.value,onClose:t[0]||(t[0]=l=>e.value=!1)},{default:A(()=>[u(Ye,{"thought-input":n.thoughtInput,"usage-reason":n.usageReason},null,8,["thought-input","usage-reason"])]),_:1},8,["open"]),u(pt,{class:"md:w-96","contextual-resource":n.thoughtInput,onClick:t[1]||(t[1]=l=>e.value=!0)},null,8,["contextual-resource"])]))}}),_t={class:"relative max-w-full"},gt={key:0,class:"absolute md:border h-full start-1/2"},X=I({__name:"ThoughtInputsList",props:{contextualResources:{},center:{type:Boolean,default:!1}},emits:["select"],setup(o,{emit:e}){const n=l=>l.sort((i,g)=>+(g.date>i.date)),t=l=>{console.log("Select"),e("select",l)};return(l,i)=>(a(),d("div",_t,[l.center?w("",!0):(a(),d("div",gt)),(a(!0),d(ye,null,xe(n(l.contextualResources),(g,m)=>(a(),C(vt,{key:g.id,class:Fe(["mb-4 md:mb-1 mx-auto max-w-full max-w-fit p-1",{"md:ml-0":m%2==0&&!l.center,"md:mr-0":!l.center}]),"thought-input":g,onClick:y=>t(g)},null,8,["class","thought-input","onClick"]))),128))]))}});function ft(){const o={title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"pbsh",maturing_state:"fnsh",image_url:"",resource_type:"",comment:""};return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0,resource:o}}function se(o){return console.log("Date : ",o.interaction_date),o.interaction_date=new Date(o.interaction_date),o}async function ht(){return(await D.get("/thought_inputs")).data.map(e=>se(e))}async function yt(o){const e=await D.get("/thought_inputs/"+o);return se(e.data)}async function xt(o){return(await D.get("/users/"+o+"/thought_inputs")).data.map(n=>se(n))}async function bt(o){const e=new Date(o.interaction_date);console.log("Date : ",e);const n=e.toISOString().split(".")[0];o.interaction_progress=Number(o.interaction_progress);const t=await D.post("/thought_inputs",{...o,interaction_date:n});return se(t.data)}function wt(){return{getUserThoughtInputs:xt,newThoughtInput:ft,createThoughtInput:bt,getThoughtInputs:ht,getThoughtInput:yt}}const kt={key:0,class:"mb-4"},$t={key:1},Rt={key:1},Vt={key:2},Ct={class:"flex flex-row-reverse"},he=I({__name:"CreateResourceRelationForm",props:{targetResource:{},originResource:{}},emits:["close","refresh"],setup(o,{emit:e}){const n=o,{user:t}=J(),l=p(),i=$=>{console.log("Event : ",$),l.value=$},g=p([{text:"Externes",value:"extr"},{text:"Internes",value:"artl"},{text:"Problème",value:"pblm"}]),m=p([{text:"Biblio",value:"bibl"},{text:"Résumé",value:"sumr"},{text:"Sujet principal",value:"main"},{text:"Evocation",value:"mino"}]),y=p([]),s=p(null),v=p([]),x=p([]),V=p([]),j=p(""),T=p(""),{createResourceRelation:K}=$e(),{getResources:P}=de(),{getArticles:f}=Be(),{getProblems:k}=Ne(),S=U(()=>y.value.map($=>({resource:$.resource}))),W=$=>$.map(c=>({resource:c})),ae=U(()=>({extr:W(v.value),artl:W(x.value),pblm:W(V.value)})),le=async()=>{if(console.log("create"),!s.value)return;const $={target_resource_id:n.targetResource?n.targetResource.id:s.value.id,origin_resource_id:n.originResource?n.originResource.id:s.value.id,relation_comment:j.value,relation_type:T.value};await K($),e("refresh"),e("close")},{getUserThoughtInputs:Y}=wt(),G=$=>{s.value=$.resource};return B(async()=>{!t.value||!t.value.id||(n.targetResource&&(y.value=await Y(t.value.id)),n.originResource&&(v.value=await P(),x.value=await f({author:!0}),V.value=await k()))}),($,c)=>(a(),d("div",null,[M(t)?(a(),d("div",kt," Nouvelle relation entre ressources par "+b(M(t).first_name)+" "+b(M(t).last_name),1)):w("",!0),s.value?(a(),d("div",Vt,[u(z,{class:"m-4",label:"Type de lien",choices:m.value,modelValue:T.value,"onUpdate:modelValue":c[2]||(c[2]=F=>T.value=F)},null,8,["choices","modelValue"]),u(ne,{class:"m-4",label:"Pourquoi ajouter cet élément ?",modelValue:j.value,"onUpdate:modelValue":c[3]||(c[3]=F=>j.value=F)},null,8,["modelValue"]),r("div",Ct,[u(H,{type:"valid",onClick:le,text:"Ajouter"}),u(H,{type:"abort",onClick:c[4]||(c[4]=F=>e("close")),text:"Annuler",class:"mr-1"})])])):(a(),d("div",$t,[$.targetResource?(a(),C(X,{key:0,"contextual-resources":S.value,center:"",onSelect:c[0]||(c[0]=F=>G(F))},null,8,["contextual-resources"])):(a(),d("div",Rt,[r("div",null,[q(" Choisir une ressource cible "),u(ke,{center:"",choices:g.value,default:"pblm",onUpdate:i},null,8,["choices"]),u(X,{"contextual-resources":ae.value[l.value]||[],center:"",onSelect:c[1]||(c[1]=F=>G(F))},null,8,["contextual-resources"])])]))]))]))}});function It(){return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0}}function N(o){return console.log("Date : ",o.interaction_date),o.interaction_date=new Date(o.interaction_date),o}async function Ut(){return(await D.get("/thought_inputs")).data.map(e=>N(e))}async function At(o){const e=await D.get("/thought_inputs/"+o);return N(e.data)}async function Dt(o){return(await D.get("/users/"+o+"/thought_inputs")).data.map(n=>N(n))}async function Tt(o,e){const n=new Date(e.interaction_date);console.log("Date : ",n);const t=n.toISOString().split(".")[0];e.interaction_progress=Number(e.interaction_progress);const l=await D.put("/interactions/"+o,{...e,interaction_date:t});return N(l.data)}async function St(o){const e=new Date(o.interaction_date);console.log("Date : ",e);const n=e.toISOString().split(".")[0];o.interaction_progress=Number(o.interaction_progress);const t=await D.post("/thought_inputs",{...o,interaction_date:n});return N(t.data)}async function Ft(o,e){const n=new Date(e.interaction_date);console.log("Date : ",n);const t=n.toISOString().split(".")[0];e.interaction_progress=Number(e.interaction_progress);const l=await D.post(`/resources/${o}/interactions`,{...e,interaction_date:t});return N(l.data)}async function Bt(o){return(await D.get(`/resources/${o}/interactions`)).data.map(n=>N(n))}function pe(){return{getUserInteractions:Dt,newInteraction:It,createInteraction:St,getInteractions:Ut,getInteraction:At,updateInteraction:Tt,createInteractionForResource:Ft,getInteractionsForResource:Bt}}const Ot={class:"flex flex-wrap"},Pt={class:"flex flex-row-reverse"},Et=I({__name:"CreateInteraction",props:{resource:{}},emits:["close","refresh"],setup(o,{emit:e}){const n=o,t=p([{text:"Lecture / Visionage",value:"inpt"},{text:"Envie",value:"wish"}]),{newInteraction:l,createInteractionForResource:i}=pe(),{user:g}=J(),m=p(l());B(()=>{m.value.interaction_type||(m.value.interaction_type="inpt")});const y=()=>{m.value.resource_id=n.resource.id,m.value.interaction_user_id=g.value.id,i(n.resource.id,m.value),e("refresh"),s()},s=()=>e("close");return(v,x)=>(a(),d("div",null,[r("div",null,"Nouvelle interaction, avec la ressource : "+b(v.resource.title),1),r("div",Ot,[u(L,{label:"Avancement de l'ouvrage",class:"my-auto",modelValue:m.value.interaction_progress,"onUpdate:modelValue":x[0]||(x[0]=V=>m.value.interaction_progress=V),type:"number"},null,8,["modelValue"]),u(z,{label:"Type d'interaction",class:"m-4 w-full md:w-5/12 md:ml-auto",choices:t.value,modelValue:m.value.interaction_type,"onUpdate:modelValue":x[1]||(x[1]=V=>m.value.interaction_type=V)},null,8,["choices","modelValue"])]),u(L,{label:"Date de lecture",modelValue:m.value.interaction_date,"onUpdate:modelValue":x[2]||(x[2]=V=>m.value.interaction_date=V),type:"date"},null,8,["modelValue"]),u(ne,{label:"Pourquoi s'y être interessé ?",modelValue:m.value.interaction_comment,"onUpdate:modelValue":x[3]||(x[3]=V=>m.value.interaction_comment=V)},null,8,["modelValue"]),r("div",Pt,[u(H,{onClick:y,class:"m-4",text:"Valider",type:"valid"}),u(H,{onClick:s,class:"m-4",text:"Annuler",type:"abort"})])]))}}),Lt=I({__name:"DateField",props:{date:{}},setup(o){const e=o,n=U(()=>new Date(e.date).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}));return(t,l)=>(a(),d("div",null,b(n.value),1))}}),Nt={class:"m-4"},jt={class:"block text-2xs text-slate-800"},qt=["value","placeholder"],Re=I({__name:"NumberInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue","input"],setup(o,{emit:e}){const n=t=>{e("update:modelValue",t.target.value),e("input",t.target.value)};return(t,l)=>(a(),d("div",Nt,[r("label",jt,b(t.label),1),r("input",{class:"border border-neutral-400 block h-full w-full rounded-md border-2 p-1 pl-2 text-xs",type:"number",value:t.modelValue,placeholder:t.placeholder,onInput:l[0]||(l[0]=i=>n(i))},null,40,qt)]))}}),Mt={class:"flex"},zt={class:"ml-auto h-6 m-4 w-1/3"},Ht={class:"ml-auto h-6 m-4 w-1/3"},Jt={class:"ml-auto h-6 m-4 w-1/3"},Kt={class:"flex"},Wt=I({__name:"ArticleForm",props:{article:{}},emits:["change"],setup(o,{emit:e}){const n=o,t=p([{text:"Terminé",value:"fnsh"},{text:"Relecture",value:"rvew"},{text:"Idée",value:"idea"}]),l=p([{text:"Livre",value:"book"},{text:"Fiche de lecture",value:"shet"},{text:"Article de média",value:"natc"},{text:"Article de recherche",value:"ratc"},{text:"Film",value:"movi"},{text:"Podcast",value:"pcst"}]),{categories:i}=Oe(),g=U(()=>i.value.map(y=>({text:y.display_name,value:y.id}))),m=(y,s)=>{let v={...n.article};v[y]=s,e("change",v)};return(y,s)=>(a(),d("div",null,[u(L,{label:"Titre",modelValue:y.article.title,"onUpdate:modelValue":s[0]||(s[0]=v=>m("title",v))},null,8,["modelValue"]),u(L,{class:"h-6",label:"Sous-titre",modelValue:y.article.subtitle,"onUpdate:modelValue":s[1]||(s[1]=v=>m("subtitle",v))},null,8,["modelValue"]),r("div",Mt,[u(Re,{class:"mr-auto h-6",label:"Progression",modelValue:y.article.interaction_progress,"onUpdate:modelValue":s[2]||(s[2]=v=>m("progress",v))},null,8,["modelValue"]),r("div",zt,[u(z,{label:"Catégorie",choices:g.value,"model-value":y.article.category_id,"onUpdate:modelValue":s[3]||(s[3]=v=>m("category_id",v))},null,8,["choices","model-value"])]),r("div",Ht,[u(z,{label:"Stade d'écriture",choices:t.value,"model-value":y.article.maturing_state,"onUpdate:modelValue":s[4]||(s[4]=v=>m("maturing_state",v))},null,8,["choices","model-value"])]),r("div",Jt,[u(z,{label:"Type de ressource",choices:l.value,"onUpdate:modelValue":s[5]||(s[5]=v=>m("resource_type",v)),"model-value":y.article.resource_type},null,8,["choices","model-value"])])]),r("div",Kt,[u(L,{class:"h-6",label:"Lien contenu externe",modelValue:y.article.external_content_url,"onUpdate:modelValue":s[6]||(s[6]=v=>m("external_content_url",v))},null,8,["modelValue"]),u(L,{class:"h-6",label:"Lien image",modelValue:y.article.image_url,"onUpdate:modelValue":s[7]||(s[7]=v=>m("image_url",v))},null,8,["modelValue"])]),u(ne,{label:"Pistes d'amélioration",modelValue:y.article.comment,"onUpdate:modelValue":s[8]||(s[8]=v=>m("comment",v))},null,8,["modelValue"])]))}}),Gt={class:"flex flex-wrap"},Qt=I({__name:"ResourceAuthorPicker",props:{interaction:{},resourceId:{}},emits:["update"],setup(o,{emit:e}){const n=o,t=p(null),l=p([]),i=f=>{if(f)return{text:`${f.first_name} ${f.last_name}`,value:f.id}},g=U(()=>{var f;return(f=t.value)==null?void 0:f.id}),m=U(()=>{if(l.value)return l.value.map(f=>i(f))}),{getUsers:y,getUserById:s}=J(),v=async f=>t.value=await s(f.interaction_user_id),{createInteractionForResource:x,newInteraction:V,createInteraction:j,updateInteraction:T}=pe(),K=async f=>{if(console.log(`newUser : ${JSON.stringify(f)}`),n.interaction){const k={...n.interaction};k.interaction_user_id=f,console.log("newUserid : ",f.id),console.log(`Interaction payload : ${JSON.stringify(k)}`),await T(n.interaction.id,k),e("update")}else{console.log("create interaction");const k=V();k.interaction_user_id=f,k.resource_id=n.resourceId,await x(n.resourceId,k),e("update")}},P=async f=>{await T(n.interaction.id,f),e("update")};return B(async()=>{l.value=await y(),await v(n.interaction)}),te(oe(n).interaction,async f=>await v(f)),(f,k)=>(a(),d("div",null,[r("div",Gt,[u(z,{label:"Auteur",class:"my-auto",choices:m.value,"model-value":g.value,"onUpdate:modelValue":k[0]||(k[0]=S=>K(S))},null,8,["choices","model-value"]),f.interaction?(a(),C(L,{key:0,class:"my-auto",label:"Date d'écriture","model-value":f.interaction.interaction_date.split("T")[0],"onUpdate:modelValue":k[1]||(k[1]=S=>P({...f.interaction,interaction_date:S})),type:"date"},null,8,["model-value"])):w("",!0),f.interaction?(a(),C(Re,{key:1,class:"my-auto",label:"Progression",modelValue:f.interaction.interaction_progress,"onUpdate:modelValue":k[2]||(k[2]=S=>P({...f.interaction,interaction_progress:S}))},null,8,["modelValue"])):w("",!0)])]))}}),Xt={key:0,class:"mx-auto"},Yt={key:0},Zt={class:"my-8"},eo=["src"],to={class:"text-3xl my-3 font-mplus md:text-center text-left"},oo={class:"md:text-center text-left"},no={class:"md:text-center text-left"},so={class:"md:flex my-8"},ao=["href"],lo={key:1},ro={class:"flex flex-row-reverse"},uo={key:1,class:"p-2 border rounded bg-neutral-100"},io=r("hr",{class:"border-top border-zinc-400 my-4"},null,-1),co={key:2},po=r("div",{class:"text-xs italic"},"Commentaire",-1),mo=r("hr",{class:"border-top border-zinc-400 my-4"},null,-1),vo=r("div",{class:"text-xs italic"},"Contenu",-1),_o={key:3},go={key:4},fo={key:5},ho={class:"fixed right-3 bottom-5"},yo=I({__name:"ResourceComponent",props:{id:{},secondLevel:{type:Boolean}},setup(o){const e=o,n=Pe(),t=U(()=>e.secondLevel?"popup_tab":"tab"),l=U(()=>[{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli",count:s.value.length},{text:"Sujets",value:"pblm",count:k.value.length},{text:"Interactions",value:"inpt",count:T.value.length}]),i=p(n.query[t.value]&&typeof n.query[t.value]=="string"?n.query[t.value]:"ctnt"),g=p(n.query[t.value]);te(()=>n.query[t.value],_=>{console.log("new route query",_),typeof _=="string"&&(g.value=_)});const{getResourceRelationsForResource:m,getUsagesForResource:y}=$e(),s=p([]),v=p(!1),x=p(!1),V=async()=>{s.value=await m(oe(e).id.value)},j=U(()=>s.value.map(_=>({resource:_.origin_resource,date:_.created_at,user_id:_.user_id,context_comment:_.relation_comment,progress:null})));B(()=>V());const T=p([]),{getInteractionsForResource:K}=pe(),P=async()=>{T.value=await K(e.id)};B(async()=>await P());const f=U(()=>T.value.map(_=>({resource:null,date:_.interaction_date,user_id:_.interaction_user_id,context_comment:_.interaction_comment,progress:_.interaction_progress}))),k=p([]);B(async()=>await S());const S=async()=>{k.value=await y(e.id)},W=U(()=>k.value.map(_=>({resource:_.target_resource,date:_.created_at,user_id:_.user_id,context_comment:_.relation_comment,progress:null}))),{newResource:ae,getResource:le,updateResource:Y,getAuthorInteractionForResource:G}=de(),$=p(null),c=p(ae()),F=Ee();te(()=>n.query.editing,_=>{console.log("Editing : ",_),re.value=_==="false"?!1:!!_});const re=p(!1),me=_=>{F.push({query:{editing:_.toString()}})},Ve=()=>{!c.value||!c.value.id||(c.value.publishing_state="pbsh",Y(c.value.id,c.value))},ve=(_,h)=>{c.value=h,$.value!==null&&clearTimeout($.value),$.value=setTimeout(async()=>{try{await Y(_,c.value)}catch(ue){console.log("An error : ",ue)}},1e3)},_e=_=>{_!=`
`&&ve(oe(e).id.value,{...c.value,content:_})},{user:ge,getUserById:Ce}=J(),Q=U(()=>c.value.is_external?!0:!ge.value||!E.value?!1:E.value.id==ge.value.id),E=p(null),O=p(null),Z=p(!1),Ie=async()=>{O.value=await G(e.id)},{getCommentsForThoughtOutput:Ue}=Le(),fe=p([]);return B(async()=>{c.value=await le(e.id),fe.value=await Ue(e.id),O.value=await G(e.id),O.value&&(E.value=await Ce(O.value.interaction_user_id));const _=n.query.editing;re.value=_==="false"?!1:!!_}),(_,h)=>{const ue=be("router-link");return c.value?(a(),d("div",Xt,[re.value?(a(),d("div",lo,[u(Wt,{article:c.value,onChange:h[0]||(h[0]=R=>ve(c.value.id,R))},null,8,["article"]),u(Qt,{class:"mx-4",interaction:O.value,"resource-id":_.id,onChange:Ie},null,8,["interaction","resource-id"]),r("div",ro,[u(H,{class:"mx-4",onClick:h[1]||(h[1]=R=>me(!1)),type:"valid",text:"Preview"},{default:A(()=>[q("Ok")]),_:1}),c.value.publishing_state=="drft"?(a(),C(H,{key:0,onClick:Ve,type:"valid",text:"Publier"})):(a(),d("div",uo,"Publié"))])])):(a(),d("div",Yt,[r("div",Zt,[r("img",{src:c.value.image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto",style:{"max-height":"20rem"}},null,8,eo)]),r("h1",to,b(c.value.title),1),r("div",oo,b(c.value.subtitle),1),r("div",no,[E.value?(a(),C(ue,{key:0,to:"/users/"+E.value.id,class:"text-sm underline"},{default:A(()=>[q(b(E.value.first_name)+" "+b(E.value.last_name),1)]),_:1},8,["to"])):w("",!0),O.value?(a(),C(Lt,{key:1,date:O.value.interaction_date},null,8,["date"])):w("",!0)]),r("div",so,[O.value?(a(),C(we,{key:0,"progress-value":O.value.interaction_progress,class:"m-2 w-1/3"},null,8,["progress-value"])):w("",!0),c.value.resource_type==="atcl"?(a(),d("a",{key:1,class:"ml-auto underline",href:c.value.external_content_url}," Ajouter un commentaire ",8,ao)):w("",!0)])])),r("div",null,[u(ke,{choices:l.value,default:i.value,"url-key":t.value,url:""},null,8,["choices","default","url-key"])]),io,g.value=="ctnt"?(a(),d("div",co,[po,u(ce,{"full-text":c.value.comment,editable:Q.value},null,8,["full-text","editable"]),mo,vo,c.value.publishing_state!="drft"?(a(),C(ce,{key:0,"ext-comments":fe.value,"resource-id":c.value.id,"full-text":c.value.content,editable:Q.value,onChange:h[2]||(h[2]=R=>_e(R))},null,8,["ext-comments","resource-id","full-text","editable"])):(a(),C(ne,{key:1,class:"h-96",label:"Contenu",modelValue:c.value.content,"onUpdate:modelValue":h[3]||(h[3]=R=>_e(R))},null,8,["modelValue"]))])):g.value=="bbli"?(a(),d("div",_o,[u(ee,{open:v.value,onClose:h[5]||(h[5]=R=>v.value=!1)},{default:A(()=>[u(he,{onRefresh:V,onClose:h[4]||(h[4]=R=>v.value=!1),"target-resource":c.value},null,8,["target-resource"])]),_:1},8,["open"]),r("div",{onClick:h[6]||(h[6]=R=>v.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),u(X,{"contextual-resources":j.value},null,8,["contextual-resources"])])):g.value=="pblm"?(a(),d("div",go,[u(X,{"contextual-resources":W.value},null,8,["contextual-resources"])])):g.value=="inpt"?(a(),d("div",fo,[u(X,{"contextual-resources":f.value},null,8,["contextual-resources"])])):w("",!0),r("div",ho,[Q.value?(a(),C(ie,{key:0,title:"Modifier",onClick:h[7]||(h[7]=R=>me(!0))},{default:A(()=>[u(M(qe),{class:"m-1"})]),_:1})):w("",!0),Q.value?(a(),C(ie,{key:1,class:"mt-2",color:"red",title:"Marquer comme lu",onClick:h[8]||(h[8]=R=>Z.value=!0)},{default:A(()=>[u(M(je),{class:"m-1"})]),_:1})):w("",!0),u(ee,{open:Z.value,onClose:h[10]||(h[10]=R=>Z.value=!1)},{default:A(()=>[u(Et,{onRefresh:P,onClose:h[9]||(h[9]=R=>Z.value=!1),resource:c.value},null,8,["resource"])]),_:1},8,["open"]),Q.value?(a(),C(ie,{key:2,class:"mt-2",color:"green",title:"Relier à d'autres ressources",onClick:h[11]||(h[11]=R=>x.value=!0)},{default:A(()=>[u(M(Me),{class:"m-1"})]),_:1})):w("",!0),u(ee,{open:x.value,onClose:h[13]||(h[13]=R=>x.value=!1)},{default:A(()=>[u(he,{onRefresh:S,onClose:h[12]||(h[12]=R=>x.value=!1),"origin-resource":c.value},null,8,["origin-resource"])]),_:1},8,["open"])])])):w("",!0)}}});export{yo as _,Ye as a,ee as b,X as c,z as d,qe as r,wt as u};
