import{d as F,a3 as le,r as E,j as c,y as ee,a as te,b as l,c as o,l as T,t as g,p as b,k as p,e as ue,m as oe,K as ae,F as D,g as I,h as G,w as se,f as re,q as ce,O as de,o as fe,B as me}from"./index-7b431e64.js";import{r as pe}from"./ChevronDownIcon-baccdbe7.js";const ge={class:"flex items-start justify-between gap-2"},he={class:"min-w-0"},ve={class:"text-sm font-semibold leading-5 break-words"},be={key:0,class:"mt-2"},ye={key:1,class:"mt-2 flex flex-wrap gap-1.5"},xe={key:2,class:"mt-2 flex flex-wrap gap-1.5"},_e={class:"uppercase tracking-wide opacity-80"},De=F({__name:"ElementDisplayCard",props:{element:{},associatedLandmarks:{default:()=>[]},accentColor:{default:""},showId:{type:Boolean,default:!1},initiallyExpanded:{type:Boolean,default:!1},tone:{default:"dark"}},setup(C){const i=C,k=le(),d=E(i.initiallyExpanded),x=E([]),$=E(0),J=c(()=>!!k.meta),N=c(()=>(Array.isArray(i.associatedLandmarks)?i.associatedLandmarks:[]).map((s,r)=>{const t=(s==null?void 0:s.id)!=null?String(s.id).trim():"",m=(typeof(s==null?void 0:s.title)=="string"?s.title.trim():"")||"Sans nom",h=t||`${m}-${r}`;return{id:t,title:m,key:h}}).filter(s=>s.title.length>0)),z=c(()=>{var s,r,t,u,m;const e=[(s=i.element)==null?void 0:s.id,(t=(r=i.element)==null?void 0:r.resource)==null?void 0:t.id,(u=i.element)==null?void 0:u.element_id,(m=i.element)==null?void 0:m.elementId];for(const h of e){if(h==null)continue;const _=String(h).trim();if(_.length>0)return _}return""}),B=e=>e==null?"":String(e).trim(),O=e=>{var r,t;const s=[e==null?void 0:e.relation_type,e==null?void 0:e.relationType,e==null?void 0:e.type,(r=e==null?void 0:e.relation)==null?void 0:r.relation_type,(t=e==null?void 0:e.relation)==null?void 0:t.relationType,e==null?void 0:e.element_type,e==null?void 0:e.elementType].map(u=>B(u)).find(u=>u.length>0);return s?s.replace(/[_-]+/g," "):"relation"},j=e=>{var r,t,u,m,h,_,w,V,L,A;return!e||typeof e!="object"?"":[e==null?void 0:e.title,e==null?void 0:e.name,e==null?void 0:e.display_name,e==null?void 0:e.displayName,e==null?void 0:e.mention,(r=e==null?void 0:e.resource)==null?void 0:r.title,(t=e==null?void 0:e.element)==null?void 0:t.title,(u=e==null?void 0:e.target_resource)==null?void 0:u.title,(m=e==null?void 0:e.origin_resource)==null?void 0:m.title,(h=e==null?void 0:e.target_element)==null?void 0:h.title,(_=e==null?void 0:e.origin_element)==null?void 0:_.title,(w=e==null?void 0:e.data)==null?void 0:w.title,(V=e==null?void 0:e.landmark)==null?void 0:V.title,(L=e==null?void 0:e.target_landmark)==null?void 0:L.title,(A=e==null?void 0:e.related_landmark)==null?void 0:A.title].map(q=>B(q)).find(q=>q.length>0)??""},n=c(()=>{const e=new Set,s=[];return x.value.forEach((r,t)=>{const u=typeof r=="string"?r.trim():j(r);if(!u)return;const m=typeof r=="string"?"relation":O(r),h=(r==null?void 0:r.id)!=null?String(r.id).trim():"",_=h||`${m}-${u}-${t}`,w=`${h}|${m}|${u}`;e.has(w)||(e.add(w),s.push({key:_,relationType:m,title:u}))}),s}),a=e=>{if(Array.isArray(e))return e;if(!e||typeof e!="object")return[];const s=[e==null?void 0:e.relations,e==null?void 0:e.data,e==null?void 0:e.items,e==null?void 0:e.results];for(const t of s)if(Array.isArray(t))return t;if(e!=null&&e.data&&typeof e.data=="object"){const t=e.data,u=[t==null?void 0:t.data,t==null?void 0:t.relations,t==null?void 0:t.items,t==null?void 0:t.results];for(const m of u)if(Array.isArray(m))return m;if((t==null?void 0:t.id)!=null||(t==null?void 0:t.title)!=null||(t==null?void 0:t.relation_type)!=null||(t==null?void 0:t.type)!=null)return[t]}if((e==null?void 0:e.id)!=null||(e==null?void 0:e.title)!=null||(e==null?void 0:e.relation_type)!=null||(e==null?void 0:e.type)!=null)return[e];const r=Object.values(e).filter(t=>t&&typeof t=="object");return r.length>0?r:[]},y=async e=>{if(!e){x.value=[];return}const s=$.value+1;$.value=s;try{const r=await de.get(`/elements/${e}/relations`),t=a(r==null?void 0:r.data);if($.value!==s)return;x.value=t}catch{if($.value!==s)return;x.value=[]}};ee(z,e=>{y(e)},{immediate:!0});const W=c(()=>{if(i.accentColor)return{borderColor:i.accentColor}}),ne=e=>{if(typeof e!="string")return null;let s=e.trim();if(!s)return null;for(let r=0;r<3;r++){if(typeof s!="string")return s;const t=s.trim();if(!t)return null;if(!(t.startsWith("{")||t.startsWith("[")||t.startsWith('"')))return r===0?null:s;try{s=JSON.parse(t)}catch{return r===0?null:s}}return s},ie=c(()=>{var e,s,r;return ne(((e=i.element)==null?void 0:e.content)??((r=(s=i.element)==null?void 0:s.resource)==null?void 0:r.content)??"")}),f=(e,s)=>{var t,u;const r=ie.value;if(r&&typeof r=="object"){if(r[e]!=null)return r[e];if(s&&r[s]!=null)return r[s]}return((t=i.element)==null?void 0:t[e])!=null?i.element[e]:s&&((u=i.element)==null?void 0:u[s])!=null?i.element[s]:null},S=c(()=>{const e=f("spans")??f("span");return Array.isArray(e)?e.map(s=>typeof s=="string"?s.trim():"").filter(s=>s.length>0):typeof e=="string"&&e.trim().length>0?[e.trim()]:[]}),M=c(()=>{const e=f("status");return typeof e=="string"?e.trim().toUpperCase():""}),K=c(()=>{const e=f("verb");return typeof e=="string"?e.trim():""}),U=c(()=>{const e=f("target");return typeof e=="string"?e.trim():""}),Q=c(()=>{if(!K.value&&!U.value)return"";const e=[K.value,U.value].filter(Boolean).join(" ").trim();return e?M.value==="DONE"?`J'ai ${e}`:M.value==="IN_PROGRESS"?`Je suis en train de ${e}`:M.value==="INTENDED"?`Je voudrais ${e}`:e:""}),H=c(()=>{var s,r,t;const e=((s=i.element)==null?void 0:s.title)??((t=(r=i.element)==null?void 0:r.resource)==null?void 0:t.title)??"";return typeof e=="string"&&e.trim().length>0?e.trim():""}),X=c(()=>{var s,r,t;if(H.value)return H.value;if(Q.value)return Q.value;if(S.value.length>0)return S.value[0];const e=((s=i.element)==null?void 0:s.title)??((t=(r=i.element)==null?void 0:r.resource)==null?void 0:t.title)??"";return typeof e=="string"&&e.trim().length>0?e.trim():"Élément"}),Y=c(()=>{if(S.value.length===0)return"";const e=S.value[0];return!e||e.trim()===X.value.trim()?"":e}),Z=c(()=>{const e=f("theme"),s=f("kind");return[e,s].map(t=>typeof t=="string"?t.trim():"").filter(t=>t.length>0).join(" · ")}),R=c(()=>{const e=f("interaction_date","interactionDate")??f("created_at","createdAt");if(!e)return"";const s=new Date(String(e));if(!Number.isNaN(s.getTime()))return`interaction: ${s.toLocaleString()}`;const r=String(e).trim();return r?`interaction: ${r}`:""}),v=e=>{if(e==null)return"";if(Array.isArray(e))return e.map(r=>v(r)).filter(r=>r.length>0).join(", ");if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e).trim()},P=c(()=>{const e=[],s=v(f("id")),r=v(f("element_type","elementType")),t=v(f("element_subtype","elementSubtype")),u=v(f("status")),m=v(f("verb")),h=v(f("target")),_=v(f("theme")),w=v(f("scope")),V=v(f("life_domain","lifeDomain")),L=v(f("date_offset","dateOffset")),A=v(f("references_tags_id","referencesTagsId"));return i.showId&&s&&e.push(`id: ${s}`),r&&t?e.push(`type: ${r} / ${t}`):r?e.push(`type: ${r}`):t&&e.push(`type: ${t}`),u&&e.push(`status: ${u}`),m&&e.push(`verbe: ${m}`),h&&e.push(`cible: ${h}`),_&&e.push(`thème: ${_}`),w&&e.push(`scope: ${w}`),V&&e.push(`domaine: ${V}`),L&&e.push(`temporalité: ${L}`),R.value&&e.push(R.value),A&&e.push(`references_tags_id: ${A}`),S.value.length>1&&e.push(`spans: ${S.value.slice(1).join(" | ")}`),e});return(e,s)=>{const r=te("router-link");return l(),o("article",{class:b(["h-full p-3 rounded-lg border",e.tone==="light"?"border-slate-300 bg-white text-slate-800":"border-slate-700 bg-slate-800/40 text-slate-200"]),style:ce(W.value)},[T("div",ge,[T("div",he,[T("div",ve,g(X.value),1),Y.value?(l(),o("div",{key:0,class:b(["mt-1 text-xs leading-5 whitespace-pre-wrap break-words",e.tone==="light"?"text-slate-700":"text-slate-200"])},g(Y.value),3)):p("",!0),Z.value?(l(),o("div",{key:1,class:b(["mt-1 text-xs",e.tone==="light"?"text-slate-500":"text-slate-400"])},g(Z.value),3)):p("",!0),R.value?(l(),o("div",{key:2,class:b(["mt-1 text-xs",e.tone==="light"?"text-slate-500":"text-slate-400"])},g(R.value),3)):p("",!0)]),P.value.length>0?(l(),o("button",{key:0,type:"button",class:b(["inline-flex items-center justify-center w-6 h-6 rounded transition-colors flex-none",e.tone==="light"?"text-slate-500 hover:text-slate-700 hover:bg-slate-100":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/60"]),onClick:s[0]||(s[0]=t=>d.value=!d.value)},[ue(oe(pe),{class:b(["w-4 h-4 transition-transform",d.value?"rotate-180":""])},null,8,["class"])],2)):p("",!0)]),J.value?(l(),o("div",be,[ae(e.$slots,"meta")])):p("",!0),N.value.length>0?(l(),o("div",ye,[(l(!0),o(D,null,I(N.value,t=>(l(),o(D,{key:t.key},[t.id?(l(),G(r,{key:0,to:`/app/landmarks/${t.id}`,class:b(["text-[10px] px-1.5 py-0.5 rounded-full border transition-colors",e.tone==="light"?"border-slate-300 text-slate-600 bg-slate-100/70 hover:border-slate-400 hover:text-slate-800":"border-slate-600 text-slate-300 bg-slate-900/60 hover:border-slate-500 hover:text-slate-100"])},{default:se(()=>[re(g(t.title),1)]),_:2},1032,["to","class"])):(l(),o("span",{key:1,class:b(["text-[10px] px-1.5 py-0.5 rounded-full border",e.tone==="light"?"border-slate-300 text-slate-600 bg-slate-100/70":"border-slate-600 text-slate-300 bg-slate-900/60"])},g(t.title),3))],64))),128))])):p("",!0),n.value.length>0?(l(),o("div",xe,[(l(!0),o(D,null,I(n.value,t=>(l(),o("span",{key:t.key,class:b(["inline-flex items-center gap-1 text-[10px] px-1.5 py-0.5 rounded-full border",e.tone==="light"?"border-slate-300 text-slate-600 bg-slate-100/70":"border-slate-600 text-slate-300 bg-slate-900/60"])},[T("span",_e,g(t.relationType),1),T("span",{class:b(e.tone==="light"?"text-slate-700 font-medium":"text-slate-100 font-medium")},g(t.title),3)],2))),128))])):p("",!0),d.value&&P.value.length>0?(l(),o("div",{key:3,class:b(["mt-2 space-y-1 text-xs",e.tone==="light"?"text-slate-600":"text-slate-300"])},[(l(!0),o(D,null,I(P.value,(t,u)=>(l(),o("div",{key:`line-${u}`},g(t),1))),128))],2)):p("",!0)],6)}}}),ke={class:"flex flex-wrap items-center gap-2"},$e={class:"text-sm font-semibold text-slate-200"},we={key:0,class:"text-[10px] px-1.5 py-0.5 rounded-full border border-slate-600 text-slate-400"},Te={key:0,class:"text-xs text-slate-400 mt-1"},Se={key:1,class:"text-xs text-slate-300 mt-1.5 whitespace-pre-line line-clamp-3"},Ce=F({__name:"LandmarkCard",props:{title:{default:""},subtitle:{default:""},content:{default:""},badge:{default:""},linkTo:{default:null}},setup(C){const i=C,k=c(()=>{const d="h-full p-3 rounded-lg border border-slate-700 bg-slate-800/40",x=i.linkTo?"hover:border-slate-600 transition-colors":"";return`${d} ${x}`.trim()});return(d,x)=>{const $=te("router-link");return l(),o("div",{class:b(k.value)},[T("div",ke,[T("div",$e,g(d.title),1),d.badge?(l(),o("span",we,g(d.badge),1)):p("",!0)]),d.subtitle?(l(),o("div",Te,g(d.subtitle),1)):p("",!0),d.content?(l(),o("div",Se,g(d.content),1)):p("",!0),d.linkTo?(l(),G($,{key:2,to:d.linkTo,class:"inline-block mt-2 text-xs underline text-slate-400 hover:text-slate-200 transition-colors"},{default:se(()=>[re(" voir plus ")]),_:1},8,["to"])):p("",!0)],2)}}}),je={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3"},Ve={key:2,class:"text-sm text-slate-500"},Ee=F({__name:"LandmarksDisplayGrid",props:{landmarks:{},emptyText:{default:"Aucun landmark"},contentMax:{default:200}},setup(C){const i=C,k=E(!1),d=E(typeof window<"u"?window.innerWidth:1280),x=c(()=>d.value>=1280?3:d.value>=768?2:1),$=c(()=>k.value?i.landmarks:i.landmarks.slice(0,x.value)),J=c(()=>!k.value&&i.landmarks.length>x.value),N=n=>{if(!n)return"";const a=n.trim().toLowerCase();return a==="rsrc"?"Ressource":a==="autr"?"Auteur":a==="them"?"Thème":a==="task"?"Tâche":a==="qest"?"Question":a==="dlvr"?"Livrable":a==="proc"?"Processus":a==="topic"?"Sujet":a==="project"?"Projet":a==="person"?"Personne":n.trim()},z=n=>{if(!n)return"";const a=n.replace(/\s+/g," ").trim();return a.length<=i.contentMax?a:`${a.slice(0,i.contentMax)}...`},B=n=>typeof n.display_badge=="string"?n.display_badge:N(n.landmark_type??n.landmarkType),O=n=>{if(typeof n.display_content=="string")return z(n.display_content);const a=z(n.content??n.description??n.summary);return a||(typeof n.count=="number"?`${n.count} co-occurrences`:"")},j=()=>{typeof window>"u"||(d.value=window.innerWidth)};return ee(()=>i.landmarks.map(n=>String((n==null?void 0:n.id)??"")).join(","),()=>{k.value=!1}),fe(()=>{j(),window.addEventListener("resize",j)}),me(()=>{window.removeEventListener("resize",j)}),(n,a)=>(l(),o("div",null,[n.landmarks.length>0?(l(),o("div",je,[(l(!0),o(D,null,I($.value,(y,W)=>(l(),G(Ce,{key:y.id??W,title:y.title??"",subtitle:y.display_subtitle??y.subtitle,content:O(y),badge:B(y),"link-to":y.id?`/app/landmarks/${y.id}`:null},null,8,["title","subtitle","content","badge","link-to"]))),128))])):p("",!0),J.value?(l(),o("button",{key:1,type:"button",class:"mt-3 text-sm underline text-slate-400 hover:text-slate-200 transition-colors",onClick:a[0]||(a[0]=y=>k.value=!0)}," voir plus ")):p("",!0),n.landmarks.length===0?(l(),o("div",Ve,g(n.emptyText),1)):p("",!0)]))}});export{De as _,Ee as a};
