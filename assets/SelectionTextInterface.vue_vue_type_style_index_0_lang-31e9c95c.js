import{b as s}from"./index-ed5f751f.js";const a=s([]),v=s(null),p=(e,t,l)=>e.slice(0,l)+t+e.slice(l),m=(e,t)=>e.slice(0,t-1)+e.slice(t),d=s(0),r=async e=>{if(e.value){if(e.value.startOffset!==0)a.value[e.value.line].text=m(a.value[e.value.line].text,e.value.startOffset),e.value.startOffset-=1;else{if(a.value[e.value.line].chip){a.value[e.value.line].chip=!1,d.value+=1;return}if(a.value[e.value.line].chip){a.value[e.value.line].chip=!1,d.value+=1;return}if(e.value.line===0)return;await new Promise(t=>setTimeout(t,10)),e.value={line:e.value.line-1,startOffset:a.value[e.value.line-1].text.length,endOffset:a.value[e.value.line-1].text.length},a.value[e.value.line].text+=a.value[e.value.line+1].text,a.value.splice(e.value.line+1,1)}d.value+=1}},C=async(e,t)=>{if(t.value){if(v.value==="Dead")switch(e){case"e":e="ê";break;case"o":e="ô";break;case"a":e="â";break;case"u":e="û";break}e==="#"&&t.value.startOffset===0?a.value[t.value.line].bold=!0:e==="*"&&t.value.startOffset===0?a.value[t.value.line].chip=!0:(a.value[t.value.line].text=p(a.value[t.value.line].text,e,t.value.startOffset),await new Promise(l=>setTimeout(l,1)),t.value.startOffset+=1),d.value+=1}},b=async e=>{if(!e.value)return;const t=e.value.line,l=e.value.startOffset,n=a.value[e.value.line].text,u=n.slice(0,l),h={index:440,text:n.substring(l,n.length),bold:!1,chip:!1};a.value.splice(t+1,0,h),await new Promise(w=>setTimeout(w,10)),e.value={line:t+1,startOffset:0,endOffset:0},a.value[t].text=u,d.value+=1},i=s(""),g=e=>{if(!e.value)return;const t=a.value[e.value.line].text.slice(e.value.startOffset,e.value.endOffset);i.value=t,console.log("CopiedText : ",t)},T=e=>{if(!e.value)return;g(e);const t=a.value[e.value.line].text,l=e.value.endOffset;e.value.endOffset=e.value.endOffset,a.value[e.value.line].text=t.slice(0,e.value.startOffset)+t.slice(l)},y=e=>{e.value&&(a.value[e.value.line].text=p(a.value[e.value.line].text,i.value,e.value.startOffset),e.value.startOffset+=i.value.length,e.value.endOffset=e.value.startOffset)},L=async(e,t)=>{if(!t.value)return;const l=e.key;if(e.preventDefault(),console.log("Keydown : ",l),l==="c"&&v.value==="Control"){g(t),v.value=l;return}if(l==="x"&&v.value==="Control"){T(t),v.value=l;return}if(l==="v"&&v.value==="Control"){y(t),v.value=l;return}l.length===1?await C(l,t):l==="Enter"?await b(t):l==="Backspace"?await r(t):l==="ArrowRight"?t.value.startOffset===a.value[t.value.line].text.length?t.value={line:t.value.line+1,startOffset:1,endOffset:1}:t.value.startOffset+=1:l==="ArrowLeft"&&(t.value.startOffset===0?t.value={line:t.value.line-1,startOffset:a.value[t.value.line-1].text.length,endOffset:a.value[t.value.line-1].text.length}:t.value.startOffset-=1),v.value=l},R=e=>e.split(`
`).map((t,l)=>{let n=!1,u=!1;return t[0]==="#"&&(t=t.slice(1),n=!0),t[0]==="*"&&(t=t.slice(1),u=!0),{index:l,text:t,bold:n,chip:u}}),S=()=>a.value.map(e=>(e.bold?"#":"")+(e.chip?"*":"")+e.text).join(`
`);function _(){return{textLines:a,keydown:L,editCount:d,parseTextLines:R,formatText:S}}const{keydown:$}=_(),O=s(""),A=e=>{console.log(e);const t=window.getSelection();if(!t)return;console.log("selection : ",t);const l=t.getRangeAt(0);console.log("range : ",l)},N=e=>{const t=window.getSelection();if(!t)return;const l=t.getRangeAt(0);f.value={line:e,startOffset:l.startOffset,endOffset:l.endOffset}},k=()=>{if(!f.value)return;console.log(`CursorPosition : ${JSON.stringify(f.value)}`);const e=document.createRange(),t=document.getElementById(`line-${O.value}-${f.value.line}`);if(console.log("Selected LIne : ",t),!t)return;const l=window.getComputedStyle(t).lineHeight;if(!t.firstChild)return;const n=t.firstChild.firstChild;if(!n||(e.setStart(n,0),!f.value.startOffset))return;e.setEnd(n,f.value.startOffset);const u=e.getClientRects(),c=u[u.length-1];x.value={left:`${c.right}px`,bottom:`${c.bottom}px`,top:`${c.top-3}px`,height:l}},E=e=>{f.value&&$(e,f)},x=s({left:"0px",bottom:"0px",top:"0px",height:"0px"}),f=s(null);function H(){return{componentUuid:O,cursorPosition:f,cursorCoordinates:x,mouseupHandler:A,handleKeydown:E,getCursorCoordinates:k,setCursorPositionFromClick:N}}export{H as a,_ as u};
