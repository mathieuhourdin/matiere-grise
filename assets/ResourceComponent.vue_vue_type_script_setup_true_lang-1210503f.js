import{o as a,c,h as u,d as y,t as b,r as _,v as D,f as C,j as p,e as O,z as me,A as M,B as H,k as he,C as ve,D as _e,a as w,q as te,w as I,g as q,E as se,m as x,F as W,i as J,G as ge,n as E,u as B,l as A,s as oe,H as le,x as ne,y as fe}from"./index-fb06ad61.js";import{_ as G,u as be}from"./TextInterface.vue_vue_type_script_setup_true_lang-3b1eb831.js";import{_ as V}from"./TextInput.vue_vue_type_script_setup_true_lang-80273c46.js";import{u as ye}from"./useResource-4d35d0fb.js";import{u as ae}from"./useThoughtInputUsages-507e4025.js";function xe(r,o){return a(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}const we={class:"m-4"},$e={class:"block text-2xs text-slate-800"},ke=["value","placeholder"],Q=y({__name:"TextAreaInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue"],setup(r,{emit:o}){const n=t=>{o("update:modelValue",t.target.value)};return(t,d)=>(a(),c("div",we,[u("label",$e,b(t.label),1),u("textarea",{class:"border border-neutral-800 block h-full w-full",value:t.modelValue,placeholder:t.placeholder,onInput:d[0]||(d[0]=l=>n(l))},null,40,ke)]))}}),Ie=u("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Ve=u("div",{class:"text-xs italic"},"Raison de la lecture",-1),Ce=y({__name:"SeeThoughtInput",props:{thoughtInput:{}},setup(r){const o=r,{getUserById:n,user:t}=O(),d=_(null),l=D(()=>t.value?o.thoughtInput.interaction_user_id===t.value.id:!1);return C(async()=>{o.thoughtInput.interaction_user_id&&(d.value=await n(o.thoughtInput.interaction_user_id))}),(e,i)=>(a(),c("div",null,[p(Et,{id:e.thoughtInput.resource_id},null,8,["id"]),Ie,Ve,p(G,{"full-text":e.thoughtInput.interaction_comment,editable:l.value},null,8,["full-text","editable"])]))}}),Ue={class:"flex"},ue=y({__name:"ModalSheet",props:{open:{type:Boolean,default:!1}},emits:["close"],setup(r,{emit:o}){const n=r,t=_(!1);return C(()=>{t.value=n.open}),me(()=>{const d=l=>{(l.key==="Escape"||l.key==="Enter"||l.key==="Esc"||l.keyCode===27)&&o("close")};return window.addEventListener("keydown",d),()=>{window.removeEventListener("keydown",d)}}),M(H(n).open,d=>t.value=d),(d,l)=>t.value?(a(),c("div",{key:0,tabindex:"0",onKeyup:l[2]||(l[2]=_e(e=>o("close"),["esc"])),class:"fixed top-0 left-0 w-full h-full z-10 bg-slate-500/50",onClick:l[3]||(l[3]=e=>o("close"))},[u("div",{class:"max-w-xl overflow-y-scroll max-h-screen mb-10 bg-white mx-auto mt-6 p-4 rounded shadow",onClick:l[1]||(l[1]=ve(()=>{},["stop"]))},[u("div",Ue,[u("div",{class:"ml-auto",onClick:l[0]||(l[0]=e=>o("close"))},"x")]),he(d.$slots,"default")])],32)):w("",!0)}}),Re={class:"w-full md:w-96"},Te={key:0,class:"text-xs italic mb-2"},Ae={class:"border shadow-lg rounded p-4 md:w-96"},Se={class:"flex"},Be=["src"],qe={class:"flex flex-wrap w-full",style:{"margin-top":"-8px"}},De=u("div",{class:"text-2xs italic"}," Nom de l'auteur ",-1),Oe={class:"ml-auto m-1 w-1/3"},Ee={class:"text-2xs"},Le={class:"flex flex-wrap"},Fe={key:0,class:"text-2xs italic"},Ne=y({__name:"ThoughtInputCard",props:{thoughtInput:{},usageReason:{}},setup(r){const o=r,{getUserById:n}=O(),t=_(null);C(async()=>{o.thoughtInput.interaction_user_id&&(t.value=await n(o.thoughtInput.interaction_user_id))});const d=e=>e.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}),l=e=>e.length>200?e.slice(0,150)+"...":e;return(e,i)=>{const s=te("router-link");return a(),c("div",Re,[e.usageReason?(a(),c("div",Te,b(e.usageReason),1)):w("",!0),u("div",Ae,[u("div",Se,[e.thoughtInput.resource?(a(),c("img",{key:0,class:"w-8 h-fit mr-4",src:e.thoughtInput.resource.image_url},null,8,Be)):w("",!0),u("div",null,[u("div",null,[p(s,{to:"/thought_inputs/"+e.thoughtInput.id},{default:I(()=>[q(b(e.thoughtInput.resource.title),1)]),_:1},8,["to"])]),u("div",qe,[De,u("div",Oe,[p(se,{"progress-value":e.thoughtInput.interaction_progress},null,8,["progress-value"])])]),u("div",Ee,b(l(e.thoughtInput.interaction_comment)),1)])]),u("div",Le,[e.thoughtInput.interaction_date?(a(),c("div",Fe,b(d(e.thoughtInput.interaction_date)),1)):w("",!0),t.value?(a(),x(s,{key:1,to:"/users/"+t.value.id,class:"ml-auto text-2xs underline"},{default:I(()=>[q(b(t.value.first_name)+" "+b(t.value.last_name),1)]),_:1},8,["to"])):w("",!0)])])])}}}),je={class:"w-fit"},ze=y({__name:"ThoughtInputCardWithPopup",props:{thoughtInput:{},usageReason:{}},setup(r){const o=_(!1);return(n,t)=>(a(),c("div",je,[p(ue,{open:o.value,onClose:t[0]||(t[0]=d=>o.value=!1)},{default:I(()=>[p(Ce,{"thought-input":n.thoughtInput,"usage-reason":n.usageReason},null,8,["thought-input","usage-reason"])]),_:1},8,["open"]),p(Ne,{class:"md:w-96","thought-input":n.thoughtInput,"usage-reason":n.usageReason,onClick:t[1]||(t[1]=d=>o.value=!0)},null,8,["thought-input","usage-reason"])]))}}),Pe={class:"relative max-w-full"},Me={key:0,class:"absolute md:border h-full start-1/2"},re=y({__name:"ThoughtInputsList",props:{thoughtInputs:{},usageReasons:{},center:{type:Boolean,default:!1}},emits:["select"],setup(r,{emit:o}){const n=r,t=e=>{if(n.usageReasons&&n.usageReasons.length===n.thoughtInputs.length)return n.usageReasons[e]},d=e=>e.sort((i,s)=>+(s.interaction_date>i.interaction_date)),l=e=>{console.log("Select"),o("select",e)};return(e,i)=>(a(),c("div",Pe,[e.center?w("",!0):(a(),c("div",Me)),(a(!0),c(W,null,J(d(e.thoughtInputs),(s,m)=>(a(),x(ze,{key:s.id,class:ge(["mb-4 md:mb-1 mx-auto max-w-full max-w-fit p-1",{"md:ml-0":m%2==0&&!e.center,"md:mr-0":!e.center}]),"thought-input":s,"usage-reason":t(m),onClick:S=>l(s)},null,8,["class","thought-input","usage-reason","onClick"]))),128))]))}});function He(){const r={title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"pbsh",maturing_state:"fnsh",image_url:"",resource_type:"",comment:""};return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0,resource:r}}function L(r){return console.log("Date : ",r.interaction_date),r.interaction_date=new Date(r.interaction_date),r}async function Ge(){return(await E.get("/thought_inputs")).data.map(o=>L(o))}async function Ke(r){const o=await E.get("/thought_inputs/"+r);return L(o.data)}async function We(r){return(await E.get("/users/"+r+"/thought_inputs")).data.map(n=>L(n))}async function Je(r){const o=new Date(r.interaction_date);console.log("Date : ",o);const n=o.toISOString().split(".")[0];r.interaction_progress=Number(r.interaction_progress);const t=await E.post("/thought_inputs",{...r,interaction_date:n});return L(t.data)}function Qe(){return{getUserThoughtInputs:We,newThoughtInput:He,createThoughtInput:Je,getThoughtInputs:Ge,getThoughtInput:Ke}}const Xe={key:0},Ye={key:2},Ze={class:"flex flex-row-reverse"},et=y({__name:"CreateThoughtInputUsageForm",props:{thoughtOutput:{}},emits:["close","refresh"],setup(r,{emit:o}){const n=r,{user:t}=O(),d=_([]),l=_(null),e=_(""),{createThoughtInputUsage:i}=ae(),s=async()=>{if(console.log("create"),!l.value)return;const U={thought_output_id:n.thoughtOutput.id,thought_input_id:l.value.id,usage_reason:e.value};await i(U),o("refresh"),o("close")},{getUserThoughtInputs:m}=Qe(),S=U=>{l.value=U};return C(async()=>{!t.value||!t.value.id||(d.value=await m(t.value.id))}),(U,$)=>(a(),c("div",null,[B(t)?(a(),c("div",Xe,"Nouvelle utilisation par "+b(B(t).first_name)+" "+b(B(t).last_name),1)):w("",!0),l.value?(a(),c("div",Ye,[p(Q,{label:"Pourquoi ajouter cet élément ?",modelValue:e.value,"onUpdate:modelValue":$[1]||($[1]=R=>e.value=R)},null,8,["modelValue"]),u("div",Ze,[p(A,{type:"valid",onClick:s,text:"Ajouter"}),p(A,{type:"abort",onClick:$[2]||($[2]=R=>o("close")),text:"Ajouter"})])])):(a(),x(re,{key:1,"thought-inputs":d.value,center:"",onSelect:$[0]||($[0]=R=>S(R))},null,8,["thought-inputs"]))]))}}),tt={class:"justify-items-center mx-auto flex flex-wrap max-w-full"},st=y({__name:"ToggleButtonGroup",props:{choices:{},default:{}},setup(r){const o=r,n=_(null),t=oe(),d=le(),l=e=>{n.value=e;const i=d.query,s=d.path;t.push({path:s,query:{...i,tab:e}}),console.log(`route : ${JSON.stringify(d)}`)};return C(()=>l(o.default??"")),(e,i)=>(a(),c("div",tt,[(a(!0),c(W,null,J(e.choices,s=>(a(),x(A,{key:s.value,class:"w-24 my-1 mx-1",text:s.text,onClick:m=>l(s.value),type:s.value==n.value?"valid":"abort"},null,8,["text","onClick","type"]))),128))]))}}),ot={class:"block text-2xs text-slate-800"},lt=["value"],nt=["value"],K=y({__name:"SelectInput",props:{label:{},choices:{},modelValue:{}},emits:["update:modelValue"],setup(r,{emit:o}){const n=t=>{o("update:modelValue",t.target.value)};return(t,d)=>(a(),c("div",null,[u("label",ot,b(t.label),1),u("select",{value:t.modelValue,name:"Stade d'écriture",class:"text-xs w-full p-1 block rounded border-2 border-neutral-400",onInput:d[0]||(d[0]=l=>n(l))},[(a(!0),c(W,null,J(t.choices,l=>(a(),c("option",{key:l.value,value:l.value},b(l.text),9,nt))),128))],40,lt)]))}}),at={class:"m-4"},ut={class:"block text-2xs text-slate-800"},rt=["value","placeholder"],it=y({__name:"NumberInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue","input"],setup(r,{emit:o}){const n=t=>{o("update:modelValue",t.target.value),o("input",t.target.value)};return(t,d)=>(a(),c("div",at,[u("label",ut,b(t.label),1),u("input",{class:"border border-neutral-400 block h-full w-full rounded-md border-2 p-1 pl-2 text-xs",type:"number",value:t.modelValue,placeholder:t.placeholder,onInput:d[0]||(d[0]=l=>n(l))},null,40,rt)]))}}),dt={class:"flex"},ct={class:"ml-auto h-6 m-4 w-1/3"},pt={class:"ml-auto h-6 m-4 w-1/3"},mt={class:"flex"},ht=y({__name:"ArticleForm",props:{article:{}},emits:["change"],setup(r,{emit:o}){const n=r,t=_([{text:"Terminé",value:"fnsh"},{text:"Relecture",value:"rvew"},{text:"Idée",value:"idea"}]),{categories:d}=ne(),l=D(()=>d.value.map(i=>({text:i.display_name,value:i.id}))),e=(i,s)=>{let m={...n.article};m[i]=s,o("change",m)};return(i,s)=>(a(),c("div",null,[p(V,{label:"Titre",modelValue:i.article.title,"onUpdate:modelValue":s[0]||(s[0]=m=>e("title",m))},null,8,["modelValue"]),p(V,{class:"h-6",label:"Sous-titre",modelValue:i.article.subtitle,"onUpdate:modelValue":s[1]||(s[1]=m=>e("subtitle",m))},null,8,["modelValue"]),u("div",dt,[p(it,{class:"mr-auto h-6",label:"Progression",modelValue:i.article.interaction_progress,"onUpdate:modelValue":s[2]||(s[2]=m=>e("progress",m))},null,8,["modelValue"]),u("div",ct,[p(K,{label:"Catégorie",choices:l.value,"model-value":i.article.category_id,"onUpdate:modelValue":s[3]||(s[3]=m=>e("category_id",m))},null,8,["choices","model-value"])]),u("div",pt,[p(K,{label:"Stade d'écriture",choices:t.value,"model-value":i.article.maturing_state,"onUpdate:modelValue":s[4]||(s[4]=m=>e("maturing_state",m))},null,8,["choices","model-value"])])]),u("div",mt,[p(V,{class:"h-6",label:"Lien contenu externe",modelValue:i.article.external_content_url,"onUpdate:modelValue":s[5]||(s[5]=m=>e("external_content_url",m))},null,8,["modelValue"]),p(V,{class:"h-6",label:"Lien image",modelValue:i.article.image_url,"onUpdate:modelValue":s[6]||(s[6]=m=>e("image_url",m))},null,8,["modelValue"])]),p(Q,{label:"Pistes d'amélioration",modelValue:i.article.comment,"onUpdate:modelValue":s[7]||(s[7]=m=>e("comment",m))},null,8,["modelValue"])]))}}),vt={class:"flex"},_t={class:"ml-auto h-6 m-4 w-1/3"},gt={class:"flex"},ft=y({__name:"ProblemForm",props:{problem:{}},emits:["change"],setup(r,{emit:o}){const n=r,{categories:t}=ne(),d=D(()=>t.value.map(e=>({text:e.display_name,value:e.id}))),l=(e,i)=>{let s={...n.problem};s[e]=i,o("change",s)};return(e,i)=>(a(),c("div",null,[p(V,{label:"Titre",modelValue:e.problem.title,"onUpdate:modelValue":i[0]||(i[0]=s=>l("title",s))},null,8,["modelValue"]),p(V,{class:"h-6",label:"Description",modelValue:e.problem.subtitle,"onUpdate:modelValue":i[1]||(i[1]=s=>l("subtitle",s))},null,8,["modelValue"]),u("div",vt,[u("div",_t,[p(K,{label:"Catégorie",choices:d.value,"model-value":e.problem.category_id,"onUpdate:modelValue":i[2]||(i[2]=s=>l("category_id",s))},null,8,["choices","model-value"])])]),u("div",gt,[p(V,{class:"h-6",label:"Lien image",modelValue:e.problem.image_url,"onUpdate:modelValue":i[3]||(i[3]=s=>l("image_url",s))},null,8,["modelValue"])])]))}}),bt={key:0,class:"mx-auto"},yt={key:0},xt={class:"my-8"},wt=["src"],$t={class:"text-3xl my-3 font-mplus md:text-center text-left"},kt={class:"md:text-center text-left"},It={class:"md:text-center text-left"},Vt={class:"md:flex my-8"},Ct=["href"],Ut={key:1},Rt={class:"flex flex-row-reverse"},Tt={key:1,class:"p-2 border rounded bg-neutral-100"},At=u("hr",{class:"border-top border-zinc-400 my-4"},null,-1),St={key:2},Bt=u("div",{class:"text-xs italic"},"Commentaire",-1),qt=u("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Dt=u("div",{class:"text-xs italic"},"Contenu",-1),Ot={key:3},Et=y({__name:"ResourceComponent",props:{id:{}},setup(r){const o=r,n=le(),t=_([{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli"}]),d=_(n.query.tab&&typeof n.query.tab=="string"?n.query.tab:"ctnt"),l=_(null);M(()=>n.query.tab,g=>{console.log("new route query",g),typeof g=="string"&&(l.value=g)});const{getThoughtInputUsagesForResource:e}=ae(),i=_([]),s=_(!1),m=async()=>{i.value=await e(H(o).id.value)};C(()=>m());const{newResource:S,getResource:U,updateResource:$,getAuthorInteractionForResource:R}=ye(),F=_(null),h=_(S()),ie=oe();M(()=>n.query.editing,g=>{console.log("Editing : ",g),N.value=g==="false"?!1:!!g});const N=_(!1),X=g=>{ie.push({query:{editing:g.toString()}})},de=()=>{!h.value||!h.value.id||(h.value.publishing_state="pbsh",$(h.value.id,h.value))},j=(g,v)=>{h.value=v,F.value!==null&&clearTimeout(F.value),F.value=setTimeout(async()=>{try{await $(g,h.value)}catch(P){console.log("An error : ",P)}},1e3)},Y=g=>{g!=`
`&&j(H(o).id.value,{...h.value,content:g})},{user:Z,getUserById:ce}=O(),z=D(()=>!Z.value||!k.value?!1:k.value.id==Z.value.id),k=_(null),T=_(null),{getCommentsForThoughtOutput:pe}=be(),ee=_([]);return C(async()=>{h.value=await U(o.id),ee.value=await pe(o.id),T.value=await R(o.id),T.value&&(k.value=await ce(T.value.interaction_user_id));const g=n.query.editing;N.value=g==="false"?!1:!!g}),(g,v)=>{const P=te("router-link");return h.value?(a(),c("div",bt,[N.value?(a(),c("div",Ut,[h.value.resource_type=="atcl"?(a(),x(ht,{key:0,article:h.value,onChange:v[1]||(v[1]=f=>j(h.value.id,f))},null,8,["article"])):(a(),x(ft,{key:1,problem:h.value,onChange:v[2]||(v[2]=f=>j(h.value.id,f))},null,8,["problem"])),u("div",Rt,[p(A,{class:"mx-4",onClick:v[3]||(v[3]=f=>X(!1)),type:"valid",text:"Preview"},{default:I(()=>[q("Ok")]),_:1}),h.value.publishing_state=="drft"?(a(),x(A,{key:0,onClick:de,type:"valid",text:"Publier"})):(a(),c("div",Tt,"Publié"))])])):(a(),c("div",yt,[u("div",xt,[u("img",{src:h.value.image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto",style:{"max-height":"20rem"}},null,8,wt)]),u("h1",$t,b(h.value.title),1),u("div",kt,b(h.value.subtitle),1),u("div",It,[k.value?(a(),x(P,{key:0,to:"/users/"+k.value.id,class:"text-sm underline"},{default:I(()=>[q(b(k.value.first_name)+" "+b(k.value.last_name),1)]),_:1},8,["to"])):w("",!0)]),z.value?(a(),x(fe,{key:0,onClick:v[0]||(v[0]=f=>X(!0))},{default:I(()=>[p(B(xe),{class:"m-1"})]),_:1})):w("",!0),u("div",Vt,[T.value?(a(),x(se,{key:0,"progress-value":T.value.interaction_progress,class:"m-2 w-1/3"},null,8,["progress-value"])):w("",!0),h.value.resource_type==="atcl"?(a(),c("a",{key:1,class:"ml-auto underline",href:h.value.external_content_url}," Ajouter un commentaire ",8,Ct)):w("",!0)])])),u("div",null,[p(st,{choices:t.value,default:d.value},null,8,["choices","default"])]),At,l.value=="ctnt"?(a(),c("div",St,[Bt,p(G,{"full-text":h.value.comment,editable:z.value},null,8,["full-text","editable"]),qt,Dt,h.value.publishing_state!="drft"?(a(),x(G,{key:0,"ext-comments":ee.value,"resource-id":h.value.id,"full-text":h.value.content,editable:z.value,onChange:v[4]||(v[4]=f=>Y(f))},null,8,["ext-comments","resource-id","full-text","editable"])):(a(),x(Q,{key:1,class:"h-96",label:"Contenu",modelValue:h.value.content,"onUpdate:modelValue":v[5]||(v[5]=f=>Y(f))},null,8,["modelValue"]))])):(a(),c("div",Ot,[p(ue,{open:s.value,onClose:v[7]||(v[7]=f=>s.value=!1)},{default:I(()=>[p(et,{onRefresh:m,onClose:v[6]||(v[6]=f=>s.value=!1),"thought-output":h.value},null,8,["thought-output"])]),_:1},8,["open"]),u("div",{onClick:v[8]||(v[8]=f=>s.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),p(re,{"thought-inputs":i.value.map(f=>f.thought_input),"usage-reasons":i.value.map(f=>f.usage_reason)},null,8,["thought-inputs","usage-reasons"])]))])):w("",!0)}}});export{Et as _,Ce as a,ue as b,re as c,Qe as u};
