import{o as i,h as p,b as C,d as K,f as o,j as k,n as j,v as c,P as S,q as ne,k as U,c as le,g as se,G as D,e as N,F as ue,i as re,a as ce,w as oe,K as de,p as ie,t as H}from"./index-938ca061.js";function ve(e,t){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[C("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"})])}function fe(e,t){return i(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[C("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"})])}const pe=K({__name:"ClipboardButton",props:{text:{}},setup(e){const t=e,a=o(!1),{launchSnackbar:n}=S(),s=async()=>{try{await navigator.clipboard.writeText(t.text),a.value=!0,n("Text copied to clipboard","success"),setTimeout(()=>a.value=!1,2e3)}catch(r){console.log(`Error with copy : ${r}`)}};return(r,x)=>(i(),p("div",null,[k(c(fe),{onClick:s,class:j({"text-slate-400":a.value})},null,8,["class"])]))}});let _;const me=new Uint8Array(16);function he(){if(!_&&(_=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _(me)}const u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function ge(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}const xe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F={randomUUID:xe};function we(e,t,a){if(F.randomUUID&&!t&&!e)return F.randomUUID();e=e||{};const n=e.random||(e.rng||he)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){a=a||0;for(let s=0;s<16;++s)t[a+s]=n[s];return t}return ge(n)}const l=o([]),f=o(null),M=(e,t,a)=>e.slice(0,a)+t+e.slice(a),ye=(e,t)=>e.slice(0,t-1)+e.slice(t),g=o(0),Ce=async e=>{if(e.value){if(e.value.startOffset!==0)l.value[e.value.line].text=ye(l.value[e.value.line].text,e.value.startOffset),e.value.startOffset-=1;else{if(l.value[e.value.line].chip){l.value[e.value.line].chip=!1,g.value+=1;return}if(l.value[e.value.line].chip){l.value[e.value.line].chip=!1,g.value+=1;return}if(e.value.line===0)return;await new Promise(t=>setTimeout(t,10)),e.value={line:e.value.line-1,startOffset:l.value[e.value.line-1].text.length,endOffset:l.value[e.value.line-1].text.length},l.value[e.value.line].text+=l.value[e.value.line+1].text,l.value.splice(e.value.line+1,1)}g.value+=1}},Oe=async(e,t)=>{if(t.value){if(f.value==="Dead")switch(e){case"e":e="ê";break;case"o":e="ô";break;case"a":e="â";break;case"u":e="û";break}e==="#"&&t.value.startOffset===0?l.value[t.value.line].bold=!0:e==="*"&&t.value.startOffset===0?l.value[t.value.line].chip=!0:(l.value[t.value.line].text=M(l.value[t.value.line].text,e,t.value.startOffset),await new Promise(a=>setTimeout(a,1)),t.value.startOffset+=1),g.value+=1}},_e=async e=>{if(!e.value)return;const t=e.value.line,a=e.value.startOffset,n=l.value[e.value.line].text,s=n.slice(0,a),x={index:440,text:n.substring(a,n.length),bold:!1,chip:!1};l.value.splice(t+1,0,x),await new Promise(d=>setTimeout(d,10)),e.value={line:t+1,startOffset:0,endOffset:0},l.value[t].text=s,g.value+=1},T=o(""),z=e=>{if(!e.value)return;const t=l.value[e.value.line].text.slice(e.value.startOffset,e.value.endOffset);T.value=t,console.log("CopiedText : ",t)},be=e=>{if(!e.value)return;z(e);const t=l.value[e.value.line].text,a=e.value.endOffset;e.value.endOffset=e.value.endOffset,l.value[e.value.line].text=t.slice(0,e.value.startOffset)+t.slice(a)},ke=e=>{e.value&&(l.value[e.value.line].text=M(l.value[e.value.line].text,T.value,e.value.startOffset),e.value.startOffset+=T.value.length,e.value.endOffset=e.value.startOffset)},Te=async(e,t)=>{if(!t.value)return;const a=e.key;if(e.preventDefault(),console.log("Keydown : ",a),a==="c"&&f.value==="Control"){z(t),f.value=a;return}if(a==="x"&&f.value==="Control"){be(t),f.value=a;return}if(a==="v"&&f.value==="Control"){ke(t),f.value=a;return}a.length===1?await Oe(a,t):a==="Enter"?await _e(t):a==="Backspace"?await Ce(t):a==="ArrowRight"?t.value.startOffset===l.value[t.value.line].text.length?t.value={line:t.value.line+1,startOffset:1,endOffset:1}:t.value.startOffset+=1:a==="ArrowLeft"&&(t.value.startOffset===0?t.value={line:t.value.line-1,startOffset:l.value[t.value.line-1].text.length,endOffset:l.value[t.value.line-1].text.length}:t.value.startOffset-=1),f.value=a},Se=e=>e.split(`
`).map((t,a)=>{let n=!1,s=!1;return t[0]==="#"&&(t=t.slice(1),n=!0),t[0]==="*"&&(t=t.slice(1),s=!0),{index:a,text:t,bold:n,chip:s}}),Ue=()=>l.value.map(e=>(e.bold?"#":"")+(e.chip?"*":"")+e.text).join(`
`);function W(){return{textLines:l,keydown:Te,editCount:g,parseTextLines:Se,formatText:Ue}}const{keydown:$e}=W(),q=o(""),Le=e=>{console.log(e);const t=window.getSelection();if(!t)return;console.log("selection : ",t);const a=t.getRangeAt(0);console.log("range : ",a)},Ee=e=>{const t=window.getSelection();if(!t)return;const a=t.getRangeAt(0);v.value={line:e,startOffset:a.startOffset,endOffset:a.endOffset}},Ie=()=>{if(!v.value)return;console.log(`CursorPosition : ${JSON.stringify(v.value)}`);const e=document.createRange(),t=document.getElementById(`line-${q.value}-${v.value.line}`);if(console.log("Selected LIne : ",t),!t)return;const a=window.getComputedStyle(t).lineHeight;if(!t.firstChild)return;const n=t.firstChild.firstChild;if(!n||(e.setStart(n,0),!v.value.startOffset))return;e.setEnd(n,v.value.startOffset);const s=e.getClientRects(),r=s[s.length-1];G.value={left:`${r.right}px`,bottom:`${r.bottom}px`,top:`${r.top-3}px`,height:a}},Be=e=>{v.value&&$e(e,v)},G=o({left:"0px",bottom:"0px",top:"0px",height:"0px"}),v=o(null);function Ve(){return{componentUuid:q,cursorPosition:v,cursorCoordinates:G,mouseupHandler:Le,handleKeydown:Be,getCursorCoordinates:Ie,setCursorPositionFromClick:Ee}}const{launchSnackbar:$}=S(),Re=async(e,t,a,n,s)=>{const{user:r}=ne(),x={start_index:t,end_index:a,content:n,editing:s};try{const d=await U.post("/resources/"+e+"/comments",x),w=L(d.data);return r.value&&w.author_id==r.value.id&&(w.author=r.value),w}catch(d){throw console.log("error : ",d),$(`Error creating comment : ${d}`,"error"),d}},L=e=>(e.updated_at=new Date(e.updated_at.split(".")[0]),e.created_at=new Date(e.created_at.split(".")[0]),e),Ae=async(e,t=!0)=>{const a=t?"?author=true":"";try{return(await U.get("/resources/"+e+"/comments"+a)).data.map(s=>L(s))}catch(n){throw console.log("error : ",n),$(`Error getting comments : ${n}`,"error"),n}},J=async e=>{try{const t=await U.put("/comments/"+e.id,e);return L(t.data)}catch(t){console.log("error : ",t),$(`Error updating comment : ${t}`,"error")}},De=async e=>{console.log("comments : ",e),e.map(t=>J(t))};function Ne(){return{createComment:Re,getCommentsForThoughtOutput:Ae,updateComment:J,batchUpdateComments:De}}const He={class:""},Fe=C("div",{class:"cursor bg-blue-400"},null,-1),Ke=[Fe],je=["onClick","id"],Me={key:0},ze={key:1,class:"ml-4"},Ge=K({__name:"SelectionTextInterface",props:{resourceId:{},text:{},editable:{type:Boolean}},emits:["change"],setup(e,{emit:t}){const a=e,{launchSnackbar:n}=S(),{formatText:s,textLines:r,keydown:x,editCount:d,parseTextLines:w}=W(),{getCursorCoordinates:E,cursorPosition:h,cursorCoordinates:I,componentUuid:B,handleKeydown:Q,mouseupHandler:V,setCursorPositionFromClick:X}=Ve(),Y=le(()=>{if(h.value)return h.value.startOffset<h.value.endOffset}),{getCommentsForThoughtOutput:Z,createComment:P,batchUpdateComments:We}=Ne(),ee=o([]),te=async()=>{P(a.resourceId,h.value.startOffset,h.value.endOffset)};se(async()=>{B.value=we(),r.value=w(a.text),document.getElementById("router-view").addEventListener("scroll",()=>{E()}),ee.value=await Z(a.resourceId)});const b=o(null),ae=()=>{b.value!==null&&clearTimeout(b.value),b.value=setTimeout(async()=>{const y=s();y===""||!y?n("Try to update with empty content","error"):t("change",s())},1e3)};return D(d,()=>{ae()}),D(h,()=>{E()},{deep:!0}),(y,O)=>(i(),p("div",He,[C("div",{style:N(c(I)),class:"absolute flex flex-column"},Ke,4),k(pe,{class:"ml-auto h-6 w-6",text:y.text},null,8,["text"]),C("div",{id:"editor-interface",tabindex:"0",onKeydown:O[1]||(O[1]=m=>c(Q)(m))},[(i(!0),p(ue,null,re(c(r),(m,R)=>(i(),p("div",{class:j(["whitespace-pre-wrap",{"font-bold":m.bold}]),onClick:A=>c(X)(R),onMouseup:O[0]||(O[0]=(...A)=>c(V)&&c(V)(...A)),id:`line-${c(B)}-${R}`},[m.chip?(i(),p("li",ze,H(m.text),1)):(i(),p("div",Me,H(m.text===""?" ":m.text),1))],42,je))),256))],32),Y.value?(i(),ce(de,{key:0,class:"absolute right-2 w-9",style:N({top:c(I).top}),onClick:te},{default:oe(()=>[k(c(ve))]),_:1},8,["style"])):ie("",!0)]))}});export{Ge as _,pe as a,Ne as u};
