import{d as K,r as o,c as g,e as _,p as j,m as c,b as p,M as S,u as ne,Y as U,j as le,o as se,y as V,l as T,q as A,F as ue,g as re,h as ce,w as oe,_ as de,k as ve,t as F}from"./index-82f2043c.js";import{a as ie,r as fe}from"./ClipboardIcon-6f7842e4.js";const pe=K({__name:"ClipboardButton",props:{text:{}},setup(e){const t=e,a=o(!1),{launchSnackbar:n}=S(),s=async()=>{try{await navigator.clipboard.writeText(t.text),a.value=!0,n("Text copied to clipboard","success"),setTimeout(()=>a.value=!1,2e3)}catch(r){console.log(`Error with copy : ${r}`)}};return(r,x)=>(p(),g("div",null,[_(c(ie),{onClick:s,class:j({"text-slate-400":a.value})},null,8,["class"])]))}});let C;const me=new Uint8Array(16);function ge(){if(!C&&(C=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!C))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return C(me)}const u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function he(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}const xe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),H={randomUUID:xe};function we(e,t,a){if(H.randomUUID&&!t&&!e)return H.randomUUID();e=e||{};const n=e.random||(e.rng||ge)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){a=a||0;for(let s=0;s<16;++s)t[a+s]=n[s];return t}return he(n)}const l=o([]),i=o(null),M=(e,t,a)=>e.slice(0,a)+t+e.slice(a),ye=(e,t)=>e.slice(0,t-1)+e.slice(t),h=o(0),Oe=async e=>{if(e.value){if(e.value.startOffset!==0)l.value[e.value.line].text=ye(l.value[e.value.line].text,e.value.startOffset),e.value.startOffset-=1;else{if(l.value[e.value.line].chip){l.value[e.value.line].chip=!1,h.value+=1;return}if(l.value[e.value.line].chip){l.value[e.value.line].chip=!1,h.value+=1;return}if(e.value.line===0)return;await new Promise(t=>setTimeout(t,10)),e.value={line:e.value.line-1,startOffset:l.value[e.value.line-1].text.length,endOffset:l.value[e.value.line-1].text.length},l.value[e.value.line].text+=l.value[e.value.line+1].text,l.value.splice(e.value.line+1,1)}h.value+=1}},Ce=async(e,t)=>{if(t.value){if(i.value==="Dead")switch(e){case"e":e="ê";break;case"o":e="ô";break;case"a":e="â";break;case"u":e="û";break}e==="#"&&t.value.startOffset===0?l.value[t.value.line].bold=!0:e==="*"&&t.value.startOffset===0?l.value[t.value.line].chip=!0:(l.value[t.value.line].text=M(l.value[t.value.line].text,e,t.value.startOffset),await new Promise(a=>setTimeout(a,1)),t.value.startOffset+=1),h.value+=1}},be=async e=>{if(!e.value)return;const t=e.value.line,a=e.value.startOffset,n=l.value[e.value.line].text,s=n.slice(0,a),x={index:440,text:n.substring(a,n.length),bold:!1,chip:!1};l.value.splice(t+1,0,x),await new Promise(d=>setTimeout(d,10)),e.value={line:t+1,startOffset:0,endOffset:0},l.value[t].text=s,h.value+=1},k=o(""),W=e=>{if(!e.value)return;const t=l.value[e.value.line].text.slice(e.value.startOffset,e.value.endOffset);k.value=t,console.log("CopiedText : ",t)},_e=e=>{if(!e.value)return;W(e);const t=l.value[e.value.line].text,a=e.value.endOffset;e.value.endOffset=e.value.endOffset,l.value[e.value.line].text=t.slice(0,e.value.startOffset)+t.slice(a)},Te=e=>{e.value&&(l.value[e.value.line].text=M(l.value[e.value.line].text,k.value,e.value.startOffset),e.value.startOffset+=k.value.length,e.value.endOffset=e.value.startOffset)},ke=async(e,t)=>{if(!t.value)return;const a=e.key;if(e.preventDefault(),console.log("Keydown : ",a),a==="c"&&i.value==="Control"){W(t),i.value=a;return}if(a==="x"&&i.value==="Control"){_e(t),i.value=a;return}if(a==="v"&&i.value==="Control"){Te(t),i.value=a;return}a.length===1?await Ce(a,t):a==="Enter"?await be(t):a==="Backspace"?await Oe(t):a==="ArrowRight"?t.value.startOffset===l.value[t.value.line].text.length?t.value={line:t.value.line+1,startOffset:1,endOffset:1}:t.value.startOffset+=1:a==="ArrowLeft"&&(t.value.startOffset===0?t.value={line:t.value.line-1,startOffset:l.value[t.value.line-1].text.length,endOffset:l.value[t.value.line-1].text.length}:t.value.startOffset-=1),i.value=a},Se=e=>e.split(`
`).map((t,a)=>{let n=!1,s=!1;return t[0]==="#"&&(t=t.slice(1),n=!0),t[0]==="*"&&(t=t.slice(1),s=!0),{index:a,text:t,bold:n,chip:s}}),Ue=()=>l.value.map(e=>(e.bold?"#":"")+(e.chip?"*":"")+e.text).join(`
`);function z(){return{textLines:l,keydown:ke,editCount:h,parseTextLines:Se,formatText:Ue}}const{keydown:$e}=z(),q=o(""),Le=e=>{console.log(e);const t=window.getSelection();if(!t)return;console.log("selection : ",t);const a=t.getRangeAt(0);console.log("range : ",a)},Ee=e=>{const t=window.getSelection();if(!t)return;const a=t.getRangeAt(0);v.value={line:e,startOffset:a.startOffset,endOffset:a.endOffset}},Ie=()=>{if(!v.value)return;console.log(`CursorPosition : ${JSON.stringify(v.value)}`);const e=document.createRange(),t=document.getElementById(`line-${q.value}-${v.value.line}`);if(console.log("Selected LIne : ",t),!t)return;const a=window.getComputedStyle(t).lineHeight;if(!t.firstChild)return;const n=t.firstChild.firstChild;if(!n||(e.setStart(n,0),!v.value.startOffset))return;e.setEnd(n,v.value.startOffset);const s=e.getClientRects(),r=s[s.length-1];J.value={left:`${r.right}px`,bottom:`${r.bottom}px`,top:`${r.top-3}px`,height:a}},Re=e=>{v.value&&$e(e,v)},J=o({left:"0px",bottom:"0px",top:"0px",height:"0px"}),v=o(null);function Be(){return{componentUuid:q,cursorPosition:v,cursorCoordinates:J,mouseupHandler:Le,handleKeydown:Re,getCursorCoordinates:Ie,setCursorPositionFromClick:Ee}}const{launchSnackbar:$}=S(),De=async(e,t,a,n,s)=>{const{user:r}=ne(),x={start_index:t,end_index:a,content:n,editing:s};try{const d=await U.post("/resources/"+e+"/comments",x),w=L(d.data);return r.value&&w.author_id==r.value.id&&(w.author=r.value),w}catch(d){throw console.log("error : ",d),$(`Error creating comment : ${d}`,"error"),d}},L=e=>(e.updated_at=new Date(e.updated_at.split(".")[0]),e.created_at=new Date(e.created_at.split(".")[0]),e),Ne=async(e,t=!0)=>{const a=t?"?author=true":"";try{return(await U.get("/resources/"+e+"/comments"+a)).data.map(s=>L(s))}catch(n){throw console.log("error : ",n),$(`Error getting comments : ${n}`,"error"),n}},Y=async e=>{try{const t=await U.put("/comments/"+e.id,e);return L(t.data)}catch(t){console.log("error : ",t),$(`Error updating comment : ${t}`,"error")}},Ve=async e=>{console.log("comments : ",e),e.map(t=>Y(t))};function Ae(){return{createComment:De,getCommentsForThoughtOutput:Ne,updateComment:Y,batchUpdateComments:Ve}}const Fe={class:""},He=T("div",{class:"cursor bg-blue-400"},null,-1),Ke=[He],je=["onClick","id"],Me={key:0},We={key:1,class:"ml-4"},Ye=K({__name:"SelectionTextInterface",props:{resourceId:{},text:{},editable:{type:Boolean}},emits:["change"],setup(e,{emit:t}){const a=e,{launchSnackbar:n}=S(),{formatText:s,textLines:r,keydown:x,editCount:d,parseTextLines:w}=z(),{getCursorCoordinates:E,cursorPosition:m,cursorCoordinates:I,componentUuid:R,handleKeydown:G,mouseupHandler:B,setCursorPositionFromClick:Q}=Be(),X=le(()=>{if(m.value)return m.value.startOffset<m.value.endOffset}),{getCommentsForThoughtOutput:Z,createComment:P,batchUpdateComments:ze}=Ae(),ee=o([]),te=async()=>{P(a.resourceId,m.value.startOffset,m.value.endOffset)};se(async()=>{R.value=we(),r.value=w(a.text),document.getElementById("router-view").addEventListener("scroll",()=>{E()}),ee.value=await Z(a.resourceId)});const b=o(null),ae=()=>{b.value!==null&&clearTimeout(b.value),b.value=setTimeout(async()=>{const y=s();y===""||!y?n("Try to update with empty content","error"):t("change",s())},1e3)};return V(d,()=>{ae()}),V(m,()=>{E()},{deep:!0}),(y,O)=>(p(),g("div",Fe,[T("div",{style:A(c(I)),class:"absolute flex flex-column"},Ke,4),_(pe,{class:"ml-auto h-6 w-6",text:y.text},null,8,["text"]),T("div",{id:"editor-interface",tabindex:"0",onKeydown:O[1]||(O[1]=f=>c(G)(f))},[(p(!0),g(ue,null,re(c(r),(f,D)=>(p(),g("div",{class:j(["whitespace-pre-wrap",{"font-bold":f.bold}]),onClick:N=>c(Q)(D),onMouseup:O[0]||(O[0]=(...N)=>c(B)&&c(B)(...N)),id:`line-${c(R)}-${D}`},[f.chip?(p(),g("li",We,F(f.text),1)):(p(),g("div",Me,F(f.text===""?" ":f.text),1))],42,je))),256))],32),X.value?(p(),ce(de,{key:0,class:"absolute right-2 w-9",style:A({top:c(I).top}),onClick:te},{default:oe(()=>[_(c(fe))]),_:1},8,["style"])):ve("",!0)]))}});export{Ye as _,pe as a,Ae as u};
