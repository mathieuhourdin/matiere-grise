import{u as N,a as A}from"./useProblem-0b038f4a.js";import{d as k,r as b,q as C,o as F,s as V,b as t,c as r,e as l,f as $,_ as D,t as p,h as S,m as U,a as q,F as f,l as y,g as P,k as H,j as T,v as z,x as E}from"./index-a0ed7445.js";import{u as W}from"./useResource-eaf9f8f2.js";const G={key:0,class:"flex mb-1.5"},J={class:"text-xs italic my-auto ml-2"},K={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},O=["src"],Q={key:1,class:"h-full overflow-scroll bg-blue-100 p-1 pt-8 border"},X={class:"bg-blue-100 text-center my-auto"},Y={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},Z={class:""},ee={class:"mb-2"},te={class:"text-2xs mb-auto"},se={class:"flex mt-2"},oe={class:"text-2xs italic mt-auto"},le={class:"ml-auto text-2xs underline"},L=k({__name:"ProblemCard",props:{problem:{}},setup(h){const c=h,d=e=>e?e.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",i=b(0),_=b(null),m=b(null),v=C(()=>`${i.value}/${s.value.length}`),s=C(()=>{const e=c.problem.content.replaceAll("?","?.").split(".");let u=0;const g=[];for(;u<e.length-1;){let x=0,R=[];if(e[u].length>=270)g.push(e[u].replaceAll("?.","?")),u++;else{for(;u<e.length&&x+e[u].length<270;)R.push(e[u]),x+=e[u].length,u++;g.push(R.join(". ").replaceAll("?.","?"))}}return g}),n=e=>e.length>200?e.slice(0,150)+"...":e,{getAuthorInteractionForResource:o}=W(),a=b([]),{getResourceRelationsForResource:B}=N(),I=async()=>{c.problem.id&&(a.value=await B(c.problem.id))},{getUserById:j}=U(),M=async()=>{_.value=await o(c.problem.id),_.value&&(m.value=await j(_.value.interaction_user_id))},w=b(null);return F(async()=>{await I(),await M();const e=w.value.offsetHeight;w.value.style.height=`${e}px`}),(e,u)=>{const g=V("router-link");return t(),r("div",{ref_key:"parentCard",ref:w,class:"border p-1.5"},[l("div",null,[m.value?(t(),r("div",G,[$(D,{user:m.value},null,8,["user"]),l("div",J,p(m.value.first_name)+" "+p(m.value.last_name),1)])):(t(),r("div",K))]),l("div",{onClick:u[0]||(u[0]=x=>i.value=(i.value+1)%(s.value.length+1)),class:"relative h-3/5 mb-2 bg-gray-700"},[i.value==0?(t(),r("img",{key:0,class:"object-contain w-full h-full mt-auto mx-auto",src:e.problem.image_url},null,8,O)):(t(),r("div",Q,[l("div",X,p(s.value[i.value-1]),1)])),l("div",Y,p(v.value),1)]),$(g,{to:"/thought_outputs/"+e.problem.id},{default:S(()=>[l("div",Z,[l("div",ee,p(e.problem.title),1),l("div",te,p(n(e.problem.subtitle)),1),l("div",se,[l("div",oe,p(d(e.problem.created_at)),1),l("div",le,p(a.value.length)+" inputs",1)])])]),_:1},8,["to"])],512)}}}),re={class:"flex"},ne=l("hr",{class:"border-top border-slate-800 border-dashed my-1"},null,-1),ae={class:"flex overflow-scroll"},ue=k({__name:"CategoryProblemsCarousel",props:{problemsList:{},category:{}},setup(h){const c=h,{newProblem:d,createProblem:i}=A(),_=q(),m=async()=>{const s=d();s.resource.category_id=c.category.id;const n=await i(s);_.push({path:"/thought_outputs/"+n.resource.id,query:{editing:"true"}})},v=s=>s=="default"?"Autres":s;return(s,n)=>(t(),r("div",null,[l("div",re,[l("div",null,p(v(s.category.display_name)),1),l("div",{onClick:m,class:"ml-auto text-sm mr-2 underline"}," Ajouter ")]),ne,l("div",ae,[(t(!0),r(f,null,y(s.problemsList,(o,a)=>(t(),r("div",{class:"mb-4",key:a},[$(L,{class:"w-80 h-96 mx-3 shadow-xl rounded",problem:o},null,8,["problem"])]))),128))])]))}}),ie=k({__name:"MobileProblemsFeed",props:{problemsList:{}},setup(h){return(c,d)=>(t(),r("div",null,[(t(!0),r(f,null,y(c.problemsList,(i,_)=>(t(),P(L,{class:"border-b-1 border-black",problem:i},null,8,["problem"]))),256))]))}}),ce={key:0,class:"md:m-4"},me={key:0},de={key:1},he=k({__name:"ProblemsView",setup(h){const{getProblems:c}=A(),d=b(null),{categories:i}=z(),{isMobile:_}=E(),m=C(()=>i.value.map(n=>(n.problems=v(n),n.problems_count=n.problems?n.problems.length:0,n))),v=s=>{var n,o;return s.display_name=="default"?(n=d.value)==null?void 0:n.filter(a=>a.category_id==null):(o=d.value)==null?void 0:o.filter(a=>a.category_id==s.id)};return F(async()=>d.value=await c()),(s,n)=>(t(),r("div",null,[d.value?(t(),r("div",ce,[H(_)?(t(),r("div",de,[(t(!0),r(f,null,y(m.value.sort((o,a)=>a.problems_count-o.problems_count),o=>(t(),P(ie,{"problems-list":o.problems},null,8,["problems-list"]))),256))])):(t(),r("div",me,[(t(!0),r(f,null,y(m.value.sort((o,a)=>a.problems_count-o.problems_count),o=>(t(),P(ue,{class:"mt-4",category:o,key:o.id,"problems-list":o.problems},null,8,["category","problems-list"]))),128))]))])):T("",!0)]))}});export{he as default};
