import{d as N,r as V,j as d,y as A,c as e,t as c,F as g,g as x,k as B,b as n,l as b,p as L}from"./index-ae4d109a.js";const D={key:0,class:"text-sm text-slate-500"},O={key:1},$={key:0,class:"mb-3 inline-flex rounded-md border border-slate-700 bg-slate-900/60 p-[2px]"},J=["onClick"],I={key:1,class:"text-sm text-slate-500"},R={key:2,class:"list-disc list-outside pl-4 space-y-1"},W={class:"text-xs leading-[0.95rem] text-slate-200 whitespace-normal break-words"},z=N({__name:"TransactionElementsList",props:{elements:{},isLoading:{type:Boolean,default:!1},maxVisible:{default:4},emptyText:{default:"Aucun élément"},loadingText:{default:"Chargement..."},showFilter:{type:Boolean,default:!0}},setup(_){const u=_,o=V("done"),h=[{key:"done",label:"Fait"},{key:"intended",label:"Todo"},{key:"in_progress",label:"En cours"},{key:"all",label:"Tous"}],v=t=>{if(typeof t!="string")return null;let s=t.trim();if(!s)return null;for(let r=0;r<3;r++){if(typeof s!="string")return s;const a=s.trim();if(!a)return null;if(!(a.startsWith("{")||a.startsWith("[")||a.startsWith('"')))return r===0?null:s;try{s=JSON.parse(a)}catch{return r===0?null:s}}return s},i=t=>{var r;const s=v((t==null?void 0:t.content)??((r=t==null?void 0:t.resource)==null?void 0:r.content)??"");return s&&typeof s=="object"&&!Array.isArray(s)?s:null},k=t=>{var a,l;const s=i(t),r=(t==null?void 0:t.element_type)??(t==null?void 0:t.elementType)??((a=t==null?void 0:t.resource)==null?void 0:a.element_type)??((l=t==null?void 0:t.resource)==null?void 0:l.elementType)??(s==null?void 0:s.element_type)??(s==null?void 0:s.elementType)??"";return String(r).trim().toUpperCase()},S=t=>{var a;const s=i(t),r=(s==null?void 0:s.status)??(t==null?void 0:t.status)??((a=t==null?void 0:t.resource)==null?void 0:a.status)??"";return String(r).trim().toUpperCase()},p=t=>{const s=(t==null?void 0:t.interaction_date)??(t==null?void 0:t.created_at)??0;return new Date(s).getTime()||0},y=d(()=>(Array.isArray(u.elements)?u.elements:[]).filter(s=>k(s)==="TRANSACTION").sort((s,r)=>p(r)-p(s))),T=d(()=>{if(o.value==="all")return y.value;const s={done:"DONE",intended:"INTENDED",in_progress:"IN_PROGRESS"}[o.value];return y.value.filter(r=>S(r)===s)}),f=d(()=>T.value.slice(0,Math.max(1,u.maxVisible))),E=t=>{const s=i(t),r=(s==null?void 0:s.target)??(t==null?void 0:t.target);return typeof r=="string"&&r.trim().length>0?r.trim():r!=null&&String(r).trim()||"Sans cible"},C=t=>{const s=i(t),r=(s==null?void 0:s.status)??(t==null?void 0:t.status);return typeof r=="string"&&r.trim().length>0?r.trim():r!=null&&String(r).trim()||"Sans statut"},w=t=>{const s=i(t),r=(s==null?void 0:s.verb)??(t==null?void 0:t.verb);return typeof r=="string"&&r.trim().length>0?r.trim():r!=null&&String(r).trim()||"Sans verbe"},F=t=>`${C(t)} - ${w(t)} - ${E(t)}`;return A(()=>u.elements,()=>{o.value="done"}),(t,s)=>(n(),e("div",null,[t.isLoading?(n(),e("div",D,c(t.loadingText),1)):(n(),e("div",O,[t.showFilter?(n(),e("div",$,[(n(),e(g,null,x(h,r=>b("button",{key:r.key,type:"button",class:L(["px-2 py-0.5 text-[11px] rounded-sm transition-colors",o.value===r.key?"bg-slate-700 text-slate-100":"text-slate-400 hover:text-slate-200"]),onClick:a=>o.value=r.key},c(r.label),11,J)),64))])):B("",!0),f.value.length===0?(n(),e("div",I,c(t.emptyText),1)):(n(),e("ul",R,[(n(!0),e(g,null,x(f.value,(r,a)=>(n(),e("li",{key:r.id??`transaction-element-${a}`,class:"text-slate-300 marker:text-slate-500"},[b("div",W,c(F(r)),1)]))),128))]))]))]))}});export{z as _};
