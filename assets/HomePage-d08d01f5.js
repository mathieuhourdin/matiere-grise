import{d as M,r as j,j as b,y as P,a as J,b as i,c,m as L,l as a,F as N,g as H,t as k,h as F,w as S,f as T,k as C,O as q,e as f,u as D,o as O,p as B,P as U,Q as G,S as z,U as I,M as Q}from"./index-51450bb9.js";import{u as R}from"./useLens-721b20a0.js";import"./useJournal-9a5ba446.js";import{_ as V}from"./HeatmapDisplay.vue_vue_type_script_setup_true_lang-a2f87dae.js";import{J as K}from"./JournalPadComponent-325cace9.js";import"./PlusIcon-3896210c.js";const X={class:"font-inter"},Y={key:0,class:"text-sm text-slate-500 mt-3"},Z={key:1,class:"text-sm text-slate-500 mt-3"},tt={key:2,class:"text-sm text-slate-500 mt-3"},et={key:3,class:"mt-3"},st={class:"list-disc list-outside pl-4 space-y-1"},at={class:"text-xs leading-[0.95rem] text-slate-200 whitespace-normal break-words"},ot={class:"mt-2 flex justify-end"},rt=M({__name:"LastElementsSection",setup($){const{displayLandscapeAnalysis:l}=R(),_=j([]),h=j(!1),p=t=>{if(typeof t!="string")return null;let s=t.trim();if(!s)return null;for(let r=0;r<3;r++){if(typeof s!="string")return s;const x=s.trim();if(!x)return null;if(!(x.startsWith("{")||x.startsWith("[")||x.startsWith('"')))return r===0?null:s;try{s=JSON.parse(x)}catch{return r===0?null:s}}return s},d=t=>{var r;const s=p((t==null?void 0:t.content)??((r=t==null?void 0:t.resource)==null?void 0:r.content)??"");return s&&typeof s=="object"&&!Array.isArray(s)?s:null},y=t=>{var x,A;const s=d(t),r=(t==null?void 0:t.element_type)??(t==null?void 0:t.elementType)??((x=t==null?void 0:t.resource)==null?void 0:x.element_type)??((A=t==null?void 0:t.resource)==null?void 0:A.elementType)??(s==null?void 0:s.element_type)??(s==null?void 0:s.elementType)??"";return String(r).trim().toUpperCase()},v=t=>{const s=(t==null?void 0:t.interaction_date)??(t==null?void 0:t.created_at)??0;return new Date(s).getTime()||0},w=b(()=>_.value.filter(t=>y(t)==="TRANSACTION").sort((t,s)=>v(s)-v(t))),g=b(()=>w.value.slice(0,4)),o=async t=>{if(!t){_.value=[];return}h.value=!0;try{const s=await q.get(`/analysis/${t}/elements`);_.value=Array.isArray(s.data)?s.data:[]}catch(s){console.error(`Error loading analysis elements for analysis ${t}:`,s),_.value=[]}finally{h.value=!1}};P(()=>{var t;return(t=l.value)==null?void 0:t.id},async()=>{var s;const t=(s=l.value)==null?void 0:s.id;if(!t){_.value=[];return}await o(t)},{immediate:!0});const n=t=>{const s=d(t),r=(s==null?void 0:s.target)??(t==null?void 0:t.target);return typeof r=="string"&&r.trim().length>0?r.trim():r!=null&&String(r).trim()||"Sans cible"},e=t=>{const s=d(t),r=(s==null?void 0:s.status)??(t==null?void 0:t.status);return typeof r=="string"&&r.trim().length>0?r.trim():r!=null&&String(r).trim()||"Sans statut"},u=t=>{const s=d(t),r=(s==null?void 0:s.verb)??(t==null?void 0:t.verb);return typeof r=="string"&&r.trim().length>0?r.trim():r!=null&&String(r).trim()||"Sans verbe"},m=t=>`${e(t)} - ${u(t)} - ${n(t)}`;return(t,s)=>{var x;const r=J("router-link");return i(),c("section",X,[L(l)?h.value?(i(),c("div",Z," Chargement... ")):g.value.length===0?(i(),c("div",tt," Aucun élément ")):(i(),c("div",et,[a("ul",st,[(i(!0),c(N,null,H(g.value,(A,W)=>(i(),c("li",{key:A.id??`element-${W}`,class:"text-slate-300 marker:text-slate-500"},[a("div",at,k(m(A)),1)]))),128))]),a("div",ot,[(x=L(l))!=null&&x.id?(i(),F(r,{key:0,to:{name:"analysis",query:{id:L(l).id}},class:"text-xs text-slate-400 underline hover:text-slate-200 transition-colors"},{default:S(()=>[T(" voir plus ")]),_:1},8,["to"])):C("",!0)])])):(i(),c("div",Y," Aucune analyse courante "))])}}}),nt={class:"font-inter"},lt={key:0,class:"text-sm text-slate-500 mt-3"},it={key:1,class:"text-sm text-slate-500 mt-3"},ct={key:2,class:"text-sm text-slate-500 mt-3"},ut={key:3,class:"mt-3"},dt={class:"list-disc list-outside pl-4 space-y-1"},pt={class:"text-slate-500"},_t={class:"mt-2 flex justify-end"},mt=M({__name:"MostFrequentLandmarksSection",setup($){const{displayLandmarks:l,displayLandscapeAnalysis:_,isLoadingLandmarks:h}=R(),p=j({}),d=j(!1),y=async o=>{var n;if(o&&p.value[o]==null)try{const e=await q.get(`/landmarks/${o}`),u=Array.isArray((n=e.data)==null?void 0:n.related_elements)?e.data.related_elements:[];p.value[o]=u.length}catch(e){console.error(`Error loading related elements count for landmark ${o}:`,e),p.value[o]=0}},v=b(()=>[...l.value].sort((o,n)=>{const e=p.value[o.id]??0,u=p.value[n.id]??0;if(e!==u)return u-e;const m=new Date(o.created_at||0).getTime();return new Date(n.created_at||0).getTime()-m})),w=b(()=>v.value.slice(0,4)),g=o=>p.value[o]??0;return P(()=>l.value.map(o=>o.id).join(","),async()=>{if(l.value.length!==0){d.value=!0;try{await Promise.all(l.value.map(o=>y(o.id)))}finally{d.value=!1}}},{immediate:!0}),(o,n)=>{var u;const e=J("router-link");return i(),c("section",nt,[L(_)?L(h)||d.value?(i(),c("div",it," Chargement... ")):w.value.length===0?(i(),c("div",ct," Aucun landmark ")):(i(),c("div",ut,[a("ul",dt,[(i(!0),c(N,null,H(w.value,m=>(i(),c("li",{key:m.id,class:"text-slate-300 marker:text-slate-500"},[f(e,{to:`/app/landmarks/${m.id}`,class:"text-xs leading-[0.95rem] text-slate-200 hover:text-slate-100 transition-colors whitespace-normal break-words"},{default:S(()=>[a("span",null,k(m.title||"Sans titre"),1),a("span",pt," ("+k(g(m.id))+" éléments)",1)]),_:2},1032,["to"])]))),128))]),a("div",_t,[(u=L(_))!=null&&u.id?(i(),F(e,{key:0,to:{name:"analysis",query:{id:L(_).id,tab:"compare"}},class:"text-xs text-slate-400 underline hover:text-slate-200 transition-colors"},{default:S(()=>[T(" voir plus ")]),_:1},8,["to"])):C("",!0)])])):(i(),c("div",lt," Aucune analyse courante "))])}}}),ft={key:0,class:"flex items-center"},vt=["title"],xt={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center p-40"},ht={class:"relative z-10 w-[min(98vw,1600px)] max-h-[95vh] overflow-auto"},yt={class:"rounded-2xl border border-slate-700 bg-slate-900 p-4 shadow-2xl"},gt={key:0,class:"text-lg font-semibold text-slate-200"},bt={class:"flex items-center gap-3"},$t={key:0,class:"text-xs text-slate-500"},wt=M({__name:"HeatmapSection",props:{compact:{type:Boolean,default:!1},compactWeeksLimit:{default:25},frameless:{type:Boolean,default:!1},title:{default:"Activité"}},setup($){const l=$,{user:_}=D(),{launchSnackbar:h}=G(),p=j(!1),d=j([]),y=j(!1),v=b(()=>d.value.length===0?0:Math.max(...d.value.map(n=>n.value||0))),w=()=>{l.compact&&(y.value=!0)},g=()=>{y.value=!1},o=async()=>{var n;if((n=_.value)!=null&&n.id){p.value=!0;try{const e=await q.get(`/users/${_.value.id}/heatmaps`);d.value=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Error fetching heatmaps:",e),h(`Error loading heatmap: ${e}`,"error"),d.value=[]}finally{p.value=!1}}};return O(async()=>{await o()}),(n,e)=>n.compact?(i(),c("div",ft,[a("button",{type:"button",class:B(["transition-colors",l.frameless?"p-0 border-0 bg-transparent rounded-none hover:bg-transparent":"rounded-lg border border-slate-700 bg-slate-900/60 p-2.5 hover:border-slate-500"]),title:l.title?`Voir la heatmap ${l.title}`:"Voir la heatmap",onClick:w},[f(V,{compact:"",days:d.value,loading:p.value,title:l.title,"empty-text":"Aucune donnée","month-locale":"fr-FR","hide-first-compact-month-label":!0,"compact-weeks-limit":l.compactWeeksLimit},null,8,["days","loading","title","compact-weeks-limit"])],10,vt),(i(),F(U,{to:"body"},[y.value?(i(),c("div",xt,[a("div",{class:"absolute inset-0 bg-slate-950/70",onClick:g}),a("div",ht,[a("div",yt,[a("div",{class:B(["flex items-center mb-3",l.title?"justify-between":"justify-end"])},[l.title?(i(),c("h2",gt,k(l.title),1)):C("",!0),a("div",bt,[v.value>0?(i(),c("div",$t,"Max: "+k(v.value),1)):C("",!0),a("button",{type:"button",class:"text-xs px-2 py-1 rounded border border-slate-600 text-slate-300 hover:bg-slate-800",onClick:g}," Fermer ")])],2),f(V,{days:d.value,loading:p.value,title:l.title,"show-max":!1,"empty-text":"Aucune donnée","month-locale":"fr-FR"},null,8,["days","loading","title"])])])])):C("",!0)]))])):(i(),c("div",{key:1,class:B(l.frameless?"":"rounded-2xl border border-slate-800 bg-slate-900/60 p-4")},[f(V,{days:d.value,loading:p.value,title:l.title,"empty-text":"Aucune donnée","month-locale":"fr-FR"},null,8,["days","loading","title"])],2))}}),E=$=>(z("data-v-9dadca54"),$=$(),I(),$),kt={class:"min-h-screen text-slate-100 p-2 md:p-6 md:w-11/12 mx-auto"},Lt={class:"flex justify-between items-center mb-4"},St=E(()=>a("h1",{class:"text-2xl font-bold"},"Mon studio",-1)),jt={class:"flex items-center gap-3"},At={class:"flex flex-col gap-4"},Tt={class:"rounded-xl border border-slate-800",style:{"background-color":"rgb(32, 32, 32)"}},Ct={class:"flex flex-col xl:flex-row"},Et={class:"flex-1 p-3 md:p-4 xl:min-h-[170px]"},Mt={class:"text-lg font-semibold text-slate-200 mb-2"},Bt={class:"flex items-start gap-2 font-inter"},Vt=["src","alt"],Pt={class:"text-xs leading-4 text-slate-300 whitespace-pre-line"},Jt={class:"mt-4 flex justify-end"},Nt={class:"flex-1 border-t xl:border-t-0 xl:border-l border-slate-800 p-3 md:p-4 xl:min-h-[170px] font-inter"},Ht=E(()=>a("div",{class:"text-lg font-semibold text-slate-200 mb-2"}," Tes grands projets ",-1)),Ft={class:"space-y-1.5 text-xs leading-4 text-slate-300"},qt={class:"grid grid-cols-1 xl:grid-cols-3 gap-8 px-3"},Rt={class:"col-span-1"},Wt={class:"mb-4 font-inter"},Dt=E(()=>a("div",{class:"mb-1 flex items-center justify-between gap-3"},[a("h2",{class:"text-lg font-semibold text-slate-300"},"Métriques")],-1)),Ot={class:"mt-1 w-fit"},Ut={class:"mt-2 flex justify-end"},Gt=E(()=>a("div",{class:"flex items-center justify-between gap-3"},[a("h2",{class:"text-lg font-semibold text-slate-300"},"Activité récente")],-1)),zt=E(()=>a("div",{class:"mt-4 flex items-center justify-between gap-3"},[a("h2",{class:"text-lg font-semibold text-slate-300"},"Les plus utilisés")],-1)),It={class:"col-span-2"},Qt=M({__name:"HomePage",setup($){const{user:l}=D(),{displayLandscapeAnalysis:_,displayLandmarks:h,loadUserLenses:p}=R(),d=b(()=>{var e;const o=(e=_.value)==null?void 0:e.id,n={tab:"compare"};return o&&(n.id=o),{name:"analysis",query:n}}),y=b(()=>{var e;const o=(e=_.value)==null?void 0:e.id,n={tab:"timeline"};return o&&(n.id=o),{name:"analysis",query:n}}),v={name:"Gon",image:"https://i.pinimg.com/originals/93/d7/e8/93d7e8cb60b17a0d12ac40e26f71064e.jpg"},w=b(()=>{var n,e;return[`Bonjour ${((e=(n=l.value)==null?void 0:n.first_name)==null?void 0:e.trim())||"toi"},`,"Bienvenue sur Matière Grise ! Je suis Gon, ton mentor. Je suis ici pour t'aider à progresser dans tes projets. L'important c'est de s'amuser et de relever des défis. Ensemble, on va soulever des montagnes !","Hoooooosss !!!"].join(`
`)}),g=b(()=>{const o=h.value.filter(e=>String((e==null?void 0:e.landmark_type)??(e==null?void 0:e.landmarkType)??"").trim().toUpperCase()==="HIGH_LEVEL_PROJECT");if(o.length===0)return["Partant.e pour travailler sur tes grands projets ??"];const n=o.map(e=>{const u=String((e==null?void 0:e.title)??"").trim(),m=String((e==null?void 0:e.content)??"").trim();return u&&m&&m!==u?`${u}
${m}`:u||m||""}).filter(e=>e.length>0);return n.length>0?n:["Partant.e pour travailler sur tes grands projets ??"]});return P(()=>{var o;return(o=l.value)==null?void 0:o.id},async o=>{o&&await p()},{immediate:!0}),(o,n)=>{const e=J("router-link");return i(),c("div",kt,[a("div",Lt,[St,a("div",jt,[f(e,{to:{name:"journalPad"},class:"text-sm underline text-slate-300 hover:text-slate-100 transition-colors"},{default:S(()=>[T(" Continuer le journal ")]),_:1}),f(e,{to:d.value,class:"text-sm underline text-slate-300 hover:text-slate-100 transition-colors"},{default:S(()=>[T(" Analyse > ")]),_:1},8,["to"])])]),a("div",At,[a("section",Tt,[a("div",Ct,[a("article",Et,[a("div",Mt," Message de ton mentor "+k(v.name),1),a("div",Bt,[a("img",{src:v.image,alt:`Mentor ${v.name}`,class:"w-9 h-9 rounded-lg object-cover flex-none"},null,8,Vt),a("span",Pt,k(w.value),1)]),a("div",Jt,[f(e,{to:"/app/mentor",class:"text-xs underline text-slate-400 hover:text-slate-100 transition-colors"},{default:S(()=>[T(" Voir 4 autres messages ")]),_:1})])]),a("article",Nt,[Ht,a("ul",Ft,[(i(!0),c(N,null,H(g.value,u=>(i(),c("li",{key:u,class:"whitespace-pre-line"},"• "+k(u),1))),128))])])])]),a("div",qt,[a("div",Rt,[a("section",Wt,[Dt,a("div",Ot,[f(wt,{compact:"","compact-weeks-limit":22,frameless:!0,title:null})]),a("div",Ut,[f(e,{to:y.value,class:"text-xs text-slate-400 underline hover:text-slate-200 transition-colors"},{default:S(()=>[T(" voir plus ")]),_:1},8,["to"])])]),Gt,f(rt),zt,f(mt)]),a("div",It,[f(K,{class:"mb-10"})])])])])}}});const se=Q(Qt,[["__scopeId","data-v-9dadca54"]]);export{se as default};
