import{o as l,c as v,f as n,d as V,r as d,j as U,t as $,u as S,i as _,h as i,_ as T,e as E,k as H,l as G,F as te,m as oe,n as J,p as se,q as N,s as le,w,a as B,v as ue,x as ae,y as z,z as R}from"./index-40ff7ad7.js";import{_ as K,a as ne,b as re,c as ie}from"./ArticleForm.vue_vue_type_script_setup_true_lang-4435222d.js";import{_ as Q,a as de}from"./ThoughtInputsList.vue_vue_type_script_setup_true_lang-211e0530.js";import{u as ce}from"./useThoughtInputs-74ac05b1.js";import{u as W,a as pe}from"./useThoughtOutput-175396ad.js";import{_ as me,u as ve}from"./TextInterface.vue_vue_type_script_setup_true_lang-371f49cb.js";import{_ as j}from"./TextInput.vue_vue_type_script_setup_true_lang-4571d742.js";function he(f,c){return l(),v("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}const ge={key:1},_e={class:"flex flex-row-reverse"},fe=V({__name:"CreateThoughtInputUsageForm",props:{thoughtOutput:{}},emits:["close","refresh"],setup(f,{emit:c}){const p=f,{user:y}=E(),h=d([]),r=d(null),s=d(""),{createThoughtInputUsage:u}=W(),t=async()=>{console.log("create");const x={thought_output_id:p.thoughtOutput.id,thought_input_id:r.value.id,usage_reason:s.value};await u(x),c("refresh"),c("close")},{getUserThoughtInputs:k}=ce(),O=x=>{r.value=x};return U(async()=>h.value=await k(y.value.id)),(x,g)=>(l(),v("div",null,[n("div",null,$(S(y).first_name),1),r.value?(l(),v("div",ge,[i(K,{label:"Pourquoi ajouter cet élément ?",modelValue:s.value,"onUpdate:modelValue":g[1]||(g[1]=b=>s.value=b)},null,8,["modelValue"]),n("div",_e,[i(T,{type:"valid",onClick:t,text:"Ajouter"}),i(T,{type:"abort",onClick:g[2]||(g[2]=b=>c("close")),text:"Ajouter"})])])):(l(),_(Q,{key:0,"thought-inputs":h.value,center:"",onSelect:g[0]||(g[0]=b=>O(b))},null,8,["thought-inputs"]))]))}}),ye={class:"justify-items-center mx-auto flex flex-wrap max-w-full"},be=V({__name:"ToggleButtonGroup",props:{choices:{},default:{}},setup(f){const c=f,p=d(null),y=H(),h=G(),r=s=>{p.value=s;const u=h.query,t=h.path;y.push({path:t,query:{...u,tab:s}}),console.log(`route : ${JSON.stringify(h)}`)};return U(()=>r(c.default)),(s,u)=>(l(),v("div",ye,[(l(!0),v(te,null,oe(s.choices,t=>(l(),_(T,{key:t.value,class:"w-24 my-1 mx-1",text:t.text,onClick:k=>r(t.value),type:t.value==p.value?"valid":"abort"},null,8,["text","onClick","type"]))),128))]))}}),xe={class:"flex"},ke={class:"ml-auto h-6 m-4 w-1/3"},Ce={class:"flex"},$e=V({__name:"ProblemForm",props:{problem:{}},emits:["change"],setup(f,{emit:c}){const p=f,{categories:y}=se(),h=J(()=>y.value.map(s=>({text:s.display_name,value:s.id}))),r=(s,u)=>{let t={...p.problem};t[s]=u,c("change",t)};return(s,u)=>(l(),v("div",null,[i(j,{label:"Titre",modelValue:s.problem.title,"onUpdate:modelValue":u[0]||(u[0]=t=>r("title",t))},null,8,["modelValue"]),i(j,{class:"h-6",label:"Description",modelValue:s.problem.description,"onUpdate:modelValue":u[1]||(u[1]=t=>r("description",t))},null,8,["modelValue"]),n("div",xe,[i(ne,{class:"mr-auto h-6",label:"Progression",modelValue:s.problem.progress,"onUpdate:modelValue":u[2]||(u[2]=t=>r("progress",t))},null,8,["modelValue"]),n("div",ke,[i(re,{label:"Catégorie",choices:h.value,"model-value":s.problem.category_id,"onUpdate:modelValue":u[3]||(u[3]=t=>r("category_id",t))},null,8,["choices","model-value"])])]),n("div",Ce,[i(j,{class:"h-6",label:"Lien image",modelValue:s.problem.image_url,"onUpdate:modelValue":u[4]||(u[4]=t=>r("image_url",t))},null,8,["modelValue"])])]))}}),Te={key:0,class:"px-8 mx-auto"},we={key:0},Ue={class:"my-8"},Ve=["src"],Oe={class:"text-3xl my-3 font-mplus md:text-center text-left"},qe={class:"md:text-center text-left"},Ie={class:"md:text-center text-left"},Ae={class:"md:flex my-8"},Be=["href"],je={key:1},Fe={class:"flex flex-row-reverse"},Pe={key:1,class:"p-2 border rounded bg-neutral-100"},De=n("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Le={key:2},Me={key:3},Je=V({__name:"SeeArticle",props:{id:{}},setup(f){const c=f,p=G(),y=d([{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli"}]),h=d(p.query.tab&&typeof p.query.tab=="string"?p.query.tab:"ctnt"),r=d(null);N(()=>p.query.tab,a=>{console.log("new route query",a),typeof a=="string"&&(r.value=a)});const{getThoughtInputUsagesForThoughtOutput:s}=W(),u=d([]),t=d(!1),k=async()=>{const a=await s(z(c).id.value);u.value=a.map(o=>({...o.thought_input,usage_reason:o.usage_reason}))};U(()=>k());const{newThoughtOutput:O,getThoughtOutput:x,updateThoughtOutput:g}=pe(),b=d(null),e=d(O()),X=H();N(()=>p.query.editing,a=>{console.log("Editing : ",a),q.value=a==="false"?!1:!!a});const q=d(!1),F=a=>{X.push({query:{editing:a}})},Y=()=>{!e.value||!e.value.id||(e.value.publishing_state="pbsh",g(e.value.id,e.value))},I=(a,o)=>{e.value=o,b.value!==null&&clearTimeout(b.value),b.value=setTimeout(async()=>{try{await g(a,e.value)}catch(A){console.log("An error : ",A)}},1e3)},P=a=>{a!=`
`&&I(z(c).id.value,{...e.value,content:a})},{user:D,getUserById:Z}=E(),L=J(()=>D.value?e.value.author_id==D.value.id:!1),C=d(null),{getCommentsForThoughtOutput:ee}=ve(),M=d([]);return U(async()=>{e.value=await x(c.id),M.value=await ee(c.id),e.value.author_id&&(C.value=await Z(e.value.author_id));const a=p.query.editing;q.value=a==="false"?!1:!!a}),(a,o)=>{const A=le("router-link");return e.value?(l(),v("div",Te,[q.value?(l(),v("div",je,[e.value.output_type=="atcl"?(l(),_(ie,{key:0,article:e.value,onChange:o[1]||(o[1]=m=>I(e.value.id,m))},null,8,["article"])):(l(),_($e,{key:1,problem:e.value,onChange:o[2]||(o[2]=m=>I(e.value.id,m))},null,8,["problem"])),n("div",Fe,[i(T,{class:"mx-4",onClick:o[3]||(o[3]=m=>F(!1)),type:"valid",text:"Preview"},{default:w(()=>[R("Ok")]),_:1}),e.value.publishing_state=="drft"?(l(),_(T,{key:0,onClick:Y,type:"valid",text:"Publier"})):(l(),v("div",Pe,"Publié"))])])):(l(),v("div",we,[n("div",Ue,[n("img",{src:e.value.image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto"},null,8,Ve)]),n("h1",Oe,$(e.value.title),1),n("div",qe,$(e.value.description),1),n("div",Ie,[C.value?(l(),_(A,{key:0,to:"/users/"+C.value.id,class:"text-sm underline"},{default:w(()=>[R($(C.value.first_name)+" "+$(C.value.last_name),1)]),_:1},8,["to"])):B("",!0)]),L.value?(l(),_(ue,{key:0,onClick:o[0]||(o[0]=m=>F(!0))},{default:w(()=>[i(S(he),{class:"m-1"})]),_:1})):B("",!0),n("div",Ae,[i(ae,{"progress-value":e.value.progress,class:"m-2 w-1/3"},null,8,["progress-value"]),n("a",{class:"ml-auto underline",href:e.value.gdoc_url}," Ajouter un commentaire ",8,Be)])])),n("div",null,[i(be,{choices:y.value,default:h.value},null,8,["choices","default"])]),De,r.value=="ctnt"?(l(),v("div",Le,[e.value.publishing_state!="drft"?(l(),_(me,{key:0,"ext-comments":M.value,"ressource-id":e.value.id,"full-text":e.value.content,editable:L.value,onChange:o[4]||(o[4]=m=>P(m))},null,8,["ext-comments","ressource-id","full-text","editable"])):(l(),_(K,{key:1,class:"h-96",label:"Contenu",modelValue:e.value.content,"onUpdate:modelValue":o[5]||(o[5]=m=>P(m))},null,8,["modelValue"]))])):(l(),v("div",Me,[i(de,{open:t.value,onClose:o[7]||(o[7]=m=>t.value=!1)},{default:w(()=>[i(fe,{onRefresh:k,onClose:o[6]||(o[6]=m=>t.value=!1),"thought-output":e.value},null,8,["thought-output"])]),_:1},8,["open"]),n("div",{onClick:o[8]||(o[8]=m=>t.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),i(Q,{"thought-inputs":u.value},null,8,["thought-inputs"])]))])):B("",!0)}}});export{Je as default};
