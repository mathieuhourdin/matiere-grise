import{o as i,f as l,a as s,d as B,b as v,h as b,e as I,r as M,t as u,s as L,c as k,i as f,w,l as P,n as N,N as S,q as $,m as F,F as z,g as V,A as H}from"./index-d7b3786f.js";import{u as A}from"./useResource-4f3bf91c.js";import{u as U}from"./useResourceRelations-560160e4.js";const D=a=>{if(!a||a==="")return[];const t=a.replace(/\?/g,"?.").split(".");let r=0;const o=[];for(;r<t.length;){let n=0,d=[];if(t[r].length>=270)o.push(t[r].replace("/?./g","?")),r++;else{for(;r<t.length&&n+t[r].length<270;)d.push(t[r]),n+=t[r].length,r++;o.push(d.join(". ").replace("/?./g","?"))}}return o},q=a=>a?a.split(`
`).map(r=>D(r)).flat():[],R={splitTextForPanel:q};function E(a,t){return i(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function O(a,t){return i(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})])}function G(a,t){return i(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}const J=["src"],K={key:1,class:"bg-white h-full text-center flex items-center justify-center"},Q={class:"text-2xl text-black"},W={class:"text-lg text-bold mt-2"},X={class:"text-bold mb-2"},Y={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},Z={key:1},ee={key:1},te=B({__name:"FeedCardTextInterface",props:{interaction:{}},setup(a){const t=a,r=e=>{if(e>0&&e<=m.value.length){const c=m.value[e-1];return{text:c.replace(/#/g,""),header:e===1?"Commentaire : ":null,class:{"font-black":c.charAt(0)==="#","bg-gray-700":!0}}}else{const c=g.value[e-m.value.length-1];return{text:c?c.replace(/#/g,""):"",header:e===m.value.length+1?"Contenu : ":null,class:{"font-black":c&&c.charAt(0)==="#","bg-slate-700":!0}}}},o=v(0),n=()=>{o.value=(o.value+1)%h.value},d=()=>{o.value===0?o.value=h.value-1:o.value=(o.value-1)%h.value},p=b(()=>`${o.value+1}/${h.value}`),h=b(()=>m.value.length+g.value.length+1),g=b(()=>R.splitTextForPanel(t.interaction.resource.content)),m=b(()=>R.splitTextForPanel(t.interaction.context_comment)),C=()=>{if(t.interaction.interaction_type!="inpt"&&t.interaction.resource.image_url!==""){const e=x.value.offsetHeight;x.value.style.height=`${e}px`}},{getAuthorInteractionForResource:T}=A(),_=v(null),x=v(null);return I(async()=>{(t.interaction.interaction_type!="inpt"&&t.interaction.resource.image_url===""||t.interaction.resource.image_url===null)&&(o.value=1);const e=await T(t.interaction.resource.id);e&&(e.resource=t.interaction.resource,e.user_id=e.interaction_user_id,_.value=e)}),(e,c)=>{const y=M("router-link");return e.interaction.interaction_type!="inpt"?(i(),l("div",{key:0,class:"overflow-auto relative w-full md:h-4/5 h-full min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:x},[o.value==0&&e.interaction.resource.image_url!==""?(i(),l("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:e.interaction.resource.image_url,onLoad:C},null,40,J)):o.value==0?(i(),l("div",K,[s("div",null,[s("div",Q,u(e.interaction.resource.title),1),s("div",W,u(e.interaction.resource.subtitle),1)])])):(i(),l("div",{key:2,class:L(["h-full overflow-scroll p-1 pb-16 border flex items-center justify-center",r(o.value).class])},[s("div",{class:L([r(o.value).class,"text-center text-sm my-auto text-white"])},[s("div",null,[s("div",X,u(r(o.value).header),1),s("div",null,u(r(o.value).text),1)])],2)],2)),s("div",Y,u(p.value),1),s("div",{class:"absolute h-full w-full left-0 top-0 flex"},[s("div",{class:"w-1/2 h-full",onClick:d}),s("div",{class:"w-1/2 h-full",onClick:n})])],512)):(i(),l("div",Z,[_.value?(i(),k(j,{key:0,interaction:_.value,class:"mx-1.5 mb-0.5 h-96 border-1 border border-slate-600 rounded"},null,8,["interaction"])):(i(),l("div",ee,[f(y,{to:"/resources/"+e.interaction.resource.id},{default:w(()=>[P(u(e.interaction.resource.title),1)]),_:1},8,["to"])]))]))}}}),re={class:"flex flex-col py-1.5 overflow-auto dark:border-gray-600 border-t border-black"},oe={class:"flex mx-1.5"},ne={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},se={key:0,class:"flex mx-1.5"},ie={title:"Coming Soon ;)",class:"w-6"},ae={title:"Coming Soon ;)",class:"w-6"},le={key:1,class:"flex mx-1.5"},ce={class:"text-2xs"},ue={class:""},de={class:"mb-2 font-bold text-sm"},pe={class:"text-2xs mb-auto"},j=B({__name:"FeedCard",props:{interaction:{}},setup(a){const t=a,r=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",o=e=>e==="outp"?"Production personnelle":"Bibliographie",{resourceTypeOptions:n}=A(),d=e=>n.find(c=>c.value===e).text;v(null);const p=v(null),h=e=>e?e.length>200?e.slice(0,150)+"...":e:"",g=v([]),{getResourceRelationsForResource:m}=U(),C=async()=>{t.interaction.id&&(g.value=await m(t.interaction.resource.id))},{getUserById:T}=N(),_=v(!1),x=async()=>{try{p.value=await T(t.interaction.user_id)}catch(e){console.log(e)}_.value=!0};return I(async()=>{await C(),await x()}),(e,c)=>{const y=M("router-link");return i(),l("div",re,[s("div",oe,[_.value?(i(),k(S,{key:0,class:"flex mb-1.5 h-8",user:p.value,secondText:r(e.interaction.date),firstBottomText:o(e.interaction.interaction_type),secondBottomText:e.$t(d(e.interaction.resource.resource_type))},null,8,["user","secondText","firstBottomText","secondBottomText"])):(i(),l("div",ne))]),f(te,{class:"border-1 border-black",interaction:e.interaction},null,8,["interaction"]),e.interaction.interaction_type!="inpt"?(i(),l("div",se,[s("div",ie,[f($(O),{class:"w-full my-auto"})]),s("div",ae,[f($(G),{class:"w-full my-auto"})]),f(y,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto"},{default:w(()=>[f($(E),{class:"w-8"})]),_:1},8,["to"])])):F("",!0),e.interaction.interaction_type!="inpt"?(i(),l("div",le,[s("div",ce,u(Math.floor(Math.random()*100))+" likes",1),f(y,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:w(()=>[P(u(g.value.length)+" relations ",1)]),_:1},8,["to"])])):F("",!0),e.interaction.interaction_type!="inpt"?(i(),k(y,{key:2,class:"mx-1.5",to:"/resources/"+e.interaction.resource.id},{default:w(()=>[s("div",ue,[s("div",de,u(e.interaction.resource.title),1),s("div",pe,u(h(e.interaction.resource.subtitle)),1)])]),_:1},8,["to"])):F("",!0)])}}}),he={class:"flex flex-col"},_e=B({__name:"FeedList",props:{interactionsList:{}},setup(a){const t=a,{feedFilter:r}=H(),o=b(()=>t.interactionsList.filter(n=>r.value==="production"?n.interaction_type==="outp"&&!n.resource.is_external&&n.resource.resource_type!=="pblm"&&!n.resource.is_external:r.value==="draft"?n.interaction_type==="outp"&&!n.resource.is_external&&(n.resource.maturing_state==="drft"||n.resource.maturing_state==="rvew"):r.value==="reviews"?n.interaction_type==="rvew":r.value==="problem"?n.resource.resource_type==="pblm":r.value==="biblio"?n.interaction_type==="inpt":n.interaction_type==="inpt"||!n.resource.is_external));return(n,d)=>(i(),l("div",he,[(i(!0),l(z,null,V(o.value,(p,h)=>(i(),k(j,{class:"md:mb-2 md:mx-1 flex-grow md:rounded max-h-screen border-t-[1px] md:border-[1px] border-black",interaction:p,key:p.id},null,8,["interaction"]))),128))]))}});export{_e as _};
