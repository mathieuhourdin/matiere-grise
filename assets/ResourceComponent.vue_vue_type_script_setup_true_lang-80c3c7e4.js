import{o as r,c as m,h as u,d as $,t as h,r as f,n as T,f as B,j as c,e as P,A as ye,y as J,B as K,k as xe,C as we,D as be,a as w,s as le,m as V,w as R,g as M,E as re,F as ue,i as ie,G as ke,p as D,u as N,l as E,x as $e,H as Ve,v as Re,I as Ce,z as Z}from"./index-254d6e81.js";import{_ as ee,u as Ie}from"./TextInterface.vue_vue_type_script_setup_true_lang-0216b530.js";import{_ as F}from"./TextInput.vue_vue_type_script_setup_true_lang-1c717fcf.js";import{u as ce}from"./useResource-1f01d7c5.js";import{u as de}from"./useResourceRelations-f96c85dd.js";function De(o,e){return r(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 8.25H7.5a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25H15M9 12l3 3m0 0l3-3m-3 3V2.25"})])}function Ue(o,e){return r(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}function Ae(o,e){return r(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z"})])}const Se={class:"m-4"},Te={class:"block text-2xs text-slate-800"},Be=["value","placeholder"],G=$({__name:"TextAreaInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue"],setup(o,{emit:e}){const n=t=>{e("update:modelValue",t.target.value)};return(t,s)=>(r(),m("div",Se,[u("label",Te,h(t.label),1),u("textarea",{class:"border border-neutral-800 block h-full w-full",value:t.modelValue,placeholder:t.placeholder,onInput:s[0]||(s[0]=i=>n(i))},null,40,Be)]))}}),Oe=u("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Fe=u("div",{class:"text-xs italic"},"Raison de la lecture",-1),Le=$({__name:"SeeThoughtInput",props:{thoughtInput:{}},setup(o){const e=o,{getUserById:n,user:t}=P(),s=f(null),i=T(()=>t.value?e.thoughtInput.interaction_user_id===t.value.id:!1);return B(async()=>{e.thoughtInput.interaction_user_id&&(s.value=await n(e.thoughtInput.interaction_user_id))}),(p,d)=>(r(),m("div",null,[c(to,{id:p.thoughtInput.resource_id,"second-level":""},null,8,["id"]),Oe,Fe,c(ee,{"full-text":p.thoughtInput.interaction_comment,editable:i.value},null,8,["full-text","editable"])]))}}),Ne={class:"flex"},te=$({__name:"ModalSheet",props:{open:{type:Boolean,default:!1}},emits:["close"],setup(o,{emit:e}){const n=o,t=f(!1);return B(()=>{t.value=n.open}),ye(()=>{const s=i=>{(i.key==="Escape"||i.key==="Enter"||i.key==="Esc"||i.keyCode===27)&&e("close")};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}}),J(K(n).open,s=>t.value=s),(s,i)=>t.value?(r(),m("div",{key:0,tabindex:"0",onKeyup:i[2]||(i[2]=be(p=>e("close"),["esc"])),class:"fixed top-0 left-0 w-full h-full z-10 bg-slate-500/50",onClick:i[3]||(i[3]=p=>e("close"))},[u("div",{class:"max-w-xl overflow-y-scroll max-h-screen mb-10 bg-white mx-auto mt-6 p-4 rounded shadow",onClick:i[1]||(i[1]=we(()=>{},["stop"]))},[u("div",Ne,[u("div",{class:"ml-auto",onClick:i[0]||(i[0]=p=>e("close"))},"x")]),xe(s.$slots,"default")])],32)):w("",!0)}}),Ee={class:"w-full md:w-96"},Pe={key:0,class:"text-xs italic mb-2"},je={class:"flex flex-wrap"},qe={key:1,class:"text-2xs italic ml-2"},Me={key:2,class:"ml-auto m-1 w-1/3"},ze={class:"border shadow-lg rounded p-4 md:w-96"},He={class:"flex"},Je=["src"],Ke={class:"flex flex-wrap w-full",style:{"margin-top":"-8px"}},We={class:"text-2xs"},Ge={class:"flex flex-wrap"},Qe={key:0,class:"text-2xs italic"},Xe=$({__name:"ThoughtInputCard",props:{contextualResource:{}},setup(o){const e=o,{getUserById:n}=P(),{getAuthorInteractionForResource:t}=ce(),s=f(null),i=f(null),p=f(null);B(async()=>{e.contextualResource.user_id&&(p.value=await n(e.contextualResource.user_id)),i.value=await t(e.contextualResource.resource.id),i.value&&(s.value=await n(i.value.interaction_user_id))});const d=a=>a?a.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",v=a=>a.length>200?a.slice(0,150)+"...":a;return(a,C)=>{const y=le("router-link");return r(),m("div",Ee,[a.contextualResource.context_comment?(r(),m("div",Pe,[u("div",null,h(a.contextualResource.context_comment),1),u("div",je,[p.value?(r(),V(y,{key:0,to:"/users/"+p.value.id,class:"text-2xs underline"},{default:R(()=>[M(h(p.value.first_name)+" "+h(p.value.last_name),1)]),_:1},8,["to"])):w("",!0),a.contextualResource.date?(r(),m("div",qe,h(d(a.contextualResource.date)),1)):w("",!0),a.contextualResource.progress?(r(),m("div",Me,[c(re,{"progress-value":a.contextualResource.progress},null,8,["progress-value"])])):w("",!0)])])):w("",!0),u("div",ze,[u("div",He,[a.contextualResource.resource?(r(),m("img",{key:0,class:"w-8 h-fit mr-4",src:a.contextualResource.resource.image_url},null,8,Je)):w("",!0),u("div",null,[u("div",null,[c(y,{to:"/resources/"+a.contextualResource.resource.id},{default:R(()=>[M(h(a.contextualResource.resource.title)+" "+h(a.contextualResource.resource.subtitle),1)]),_:1},8,["to"])]),u("div",Ke,[s.value?(r(),V(y,{key:0,to:"/users/"+s.value.id,class:"text-2xs underline"},{default:R(()=>[M(h(s.value.first_name)+" "+h(s.value.last_name),1)]),_:1},8,["to"])):w("",!0)]),u("div",We,h(v(a.contextualResource.resource.comment)),1)])]),u("div",Ge,[a.contextualResource.date?(r(),m("div",Qe,h(d(a.contextualResource.resourcedate)),1)):w("",!0)])])])}}}),Ye={class:"w-fit"},Ze=$({__name:"ThoughtInputCardWithPopup",props:{thoughtInput:{},usageReason:{}},setup(o){const e=f(!1);return(n,t)=>(r(),m("div",Ye,[c(te,{open:e.value,onClose:t[0]||(t[0]=s=>e.value=!1)},{default:R(()=>[c(Le,{"thought-input":n.thoughtInput,"usage-reason":n.usageReason},null,8,["thought-input","usage-reason"])]),_:1},8,["open"]),c(Xe,{class:"md:w-96","contextual-resource":n.thoughtInput,onClick:t[1]||(t[1]=s=>e.value=!0)},null,8,["contextual-resource"])]))}}),et={class:"relative max-w-full"},tt={key:0,class:"absolute md:border h-full start-1/2"},pe=$({__name:"ThoughtInputsList",props:{contextualResources:{},center:{type:Boolean,default:!1}},emits:["select"],setup(o,{emit:e}){const n=s=>s.sort((i,p)=>+(p.date>i.date)),t=s=>{console.log("Select"),e("select",s)};return(s,i)=>(r(),m("div",et,[s.center?w("",!0):(r(),m("div",tt)),(r(!0),m(ue,null,ie(n(s.contextualResources),(p,d)=>(r(),V(Ze,{key:p.id,class:ke(["mb-4 md:mb-1 mx-auto max-w-full max-w-fit p-1",{"md:ml-0":d%2==0&&!s.center,"md:mr-0":!s.center}]),"thought-input":p,onClick:v=>t(p)},null,8,["class","thought-input","onClick"]))),128))]))}});function ot(){const o={title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"pbsh",maturing_state:"fnsh",image_url:"",resource_type:"",comment:""};return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0,resource:o}}function Q(o){return console.log("Date : ",o.interaction_date),o.interaction_date=new Date(o.interaction_date),o}async function nt(){return(await D.get("/thought_inputs")).data.map(e=>Q(e))}async function st(o){const e=await D.get("/thought_inputs/"+o);return Q(e.data)}async function at(o){return(await D.get("/users/"+o+"/thought_inputs")).data.map(n=>Q(n))}async function lt(o){const e=new Date(o.interaction_date);console.log("Date : ",e);const n=e.toISOString().split(".")[0];o.interaction_progress=Number(o.interaction_progress);const t=await D.post("/thought_inputs",{...o,interaction_date:n});return Q(t.data)}function rt(){return{getUserThoughtInputs:at,newThoughtInput:ot,createThoughtInput:lt,getThoughtInputs:nt,getThoughtInput:st}}const ut={key:0},it={key:2},ct={class:"flex flex-row-reverse"},dt=$({__name:"CreateResourceRelationForm",props:{thoughtOutput:{}},emits:["close","refresh"],setup(o,{emit:e}){const n=o,{user:t}=P(),s=f([]),i=f(null),p=f(""),{createResourceRelation:d}=de(),v=T(()=>s.value.map(x=>({resource:x.resource}))),a=async()=>{if(console.log("create"),!i.value)return;const x={target_resource_id:n.thoughtOutput.id,origin_resource_id:i.value.id,relation_comment:p.value};await d(x),e("refresh"),e("close")},{getUserThoughtInputs:C}=rt(),y=x=>{i.value=x.resource};return B(async()=>{!t.value||!t.value.id||(s.value=await C(t.value.id))}),(x,U)=>(r(),m("div",null,[N(t)?(r(),m("div",ut,"Nouvelle utilisation par "+h(N(t).first_name)+" "+h(N(t).last_name),1)):w("",!0),i.value?(r(),m("div",it,[c(G,{label:"Pourquoi ajouter cet élément ?",modelValue:p.value,"onUpdate:modelValue":U[1]||(U[1]=I=>p.value=I)},null,8,["modelValue"]),u("div",ct,[c(E,{type:"valid",onClick:a,text:"Ajouter"}),c(E,{type:"abort",onClick:U[2]||(U[2]=I=>e("close")),text:"Ajouter"})])])):(r(),V(pe,{key:1,"contextual-resources":v.value,center:"",onSelect:U[0]||(U[0]=I=>y(I))},null,8,["contextual-resources"]))]))}}),pt={class:"block text-2xs text-slate-800"},mt=["value"],vt=["value"],W=$({__name:"SelectInput",props:{label:{},choices:{},modelValue:{},displayFunction:{type:Function,default:o=>o.text}},emits:["update:modelValue"],setup(o,{emit:e}){const n=t=>{console.log(t.target.value),e("update:modelValue",t.target.value)};return(t,s)=>(r(),m("div",null,[u("label",pt,h(t.label),1),u("select",{value:t.modelValue,name:"Stade d'écriture",class:"text-xs w-full p-1 block rounded border-2 border-neutral-400",onInput:s[0]||(s[0]=i=>n(i))},[(r(!0),m(ue,null,ie(t.choices,i=>(r(),m("option",{key:i.value,value:i.value},h(t.displayFunction(i)),9,vt))),128))],40,mt)]))}});function _t(){return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0}}function j(o){return console.log("Date : ",o.interaction_date),o.interaction_date=new Date(o.interaction_date),o}async function ft(){return(await D.get("/thought_inputs")).data.map(e=>j(e))}async function gt(o){const e=await D.get("/thought_inputs/"+o);return j(e.data)}async function ht(o){return(await D.get("/users/"+o+"/thought_inputs")).data.map(n=>j(n))}async function yt(o,e){const n=new Date(e.interaction_date);console.log("Date : ",n);const t=n.toISOString().split(".")[0];e.interaction_progress=Number(e.interaction_progress);const s=await D.put("/interactions/"+o,{...e,interaction_date:t});return j(s.data)}async function xt(o){const e=new Date(o.interaction_date);console.log("Date : ",e);const n=e.toISOString().split(".")[0];o.interaction_progress=Number(o.interaction_progress);const t=await D.post("/thought_inputs",{...o,interaction_date:n});return j(t.data)}async function wt(o,e){const n=new Date(e.interaction_date);console.log("Date : ",n);const t=n.toISOString().split(".")[0];e.interaction_progress=Number(e.interaction_progress);const s=await D.post(`/resources/${o}/interactions`,{...e,interaction_date:t});return j(s.data)}function me(){return{getUserInteractions:ht,newInteraction:_t,createInteraction:xt,getInteractions:ft,getInteraction:gt,updateInteraction:yt,createInteractionForResource:wt}}const bt={class:"flex flex-wrap"},kt={class:"flex flex-row-reverse"},$t=$({__name:"CreateInteraction",props:{resource:{}},emits:["close","refresh"],setup(o,{emit:e}){const n=o,t=f([{text:"Lecture / Visionage",value:"inpt"},{text:"Envie",value:"wish"}]),{newInteraction:s,createInteractionForResource:i}=me(),{user:p}=P(),d=f(s());B(()=>{d.value.interaction_type||(d.value.interaction_type="inpt")});const v=()=>{d.value.resource_id=n.resource.id,d.value.interaction_user_id=p.value.id,i(n.resource.id,d.value),e("refresh"),a()},a=()=>e("close");return(C,y)=>(r(),m("div",null,[u("div",null,"Nouvelle interaction, avec la ressource : "+h(C.resource.title),1),u("div",bt,[c(F,{label:"Avancement de l'ouvrage",class:"my-auto",modelValue:d.value.interaction_progress,"onUpdate:modelValue":y[0]||(y[0]=x=>d.value.interaction_progress=x),type:"number"},null,8,["modelValue"]),c(W,{label:"Type d'interaction",class:"m-4 w-full md:w-5/12 md:ml-auto",choices:t.value,modelValue:d.value.interaction_type,"onUpdate:modelValue":y[1]||(y[1]=x=>d.value.interaction_type=x)},null,8,["choices","modelValue"])]),c(F,{label:"Date de lecture",modelValue:d.value.interaction_date,"onUpdate:modelValue":y[2]||(y[2]=x=>d.value.interaction_date=x),type:"date"},null,8,["modelValue"]),c(G,{label:"Pourquoi s'y être interessé ?",modelValue:d.value.interaction_comment,"onUpdate:modelValue":y[3]||(y[3]=x=>d.value.interaction_comment=x)},null,8,["modelValue"]),u("div",kt,[c(E,{onClick:v,class:"m-4",text:"Valider",type:"valid"}),c(E,{onClick:a,class:"m-4",text:"Annuler",type:"abort"})])]))}}),Vt=$({__name:"DateField",props:{date:{}},setup(o){const e=o,n=T(()=>new Date(e.date).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}));return(t,s)=>(r(),m("div",null,h(n.value),1))}}),Rt={class:"m-4"},Ct={class:"block text-2xs text-slate-800"},It=["value","placeholder"],ve=$({__name:"NumberInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue","input"],setup(o,{emit:e}){const n=t=>{e("update:modelValue",t.target.value),e("input",t.target.value)};return(t,s)=>(r(),m("div",Rt,[u("label",Ct,h(t.label),1),u("input",{class:"border border-neutral-400 block h-full w-full rounded-md border-2 p-1 pl-2 text-xs",type:"number",value:t.modelValue,placeholder:t.placeholder,onInput:s[0]||(s[0]=i=>n(i))},null,40,It)]))}}),Dt={class:"flex"},Ut={class:"ml-auto h-6 m-4 w-1/3"},At={class:"ml-auto h-6 m-4 w-1/3"},St={class:"flex"},Tt=$({__name:"ArticleForm",props:{article:{}},emits:["change"],setup(o,{emit:e}){const n=o,t=f([{text:"Terminé",value:"fnsh"},{text:"Relecture",value:"rvew"},{text:"Idée",value:"idea"}]),{categories:s}=$e(),i=T(()=>s.value.map(d=>({text:d.display_name,value:d.id}))),p=(d,v)=>{let a={...n.article};a[d]=v,e("change",a)};return(d,v)=>(r(),m("div",null,[c(F,{label:"Titre",modelValue:d.article.title,"onUpdate:modelValue":v[0]||(v[0]=a=>p("title",a))},null,8,["modelValue"]),c(F,{class:"h-6",label:"Sous-titre",modelValue:d.article.subtitle,"onUpdate:modelValue":v[1]||(v[1]=a=>p("subtitle",a))},null,8,["modelValue"]),u("div",Dt,[c(ve,{class:"mr-auto h-6",label:"Progression",modelValue:d.article.interaction_progress,"onUpdate:modelValue":v[2]||(v[2]=a=>p("progress",a))},null,8,["modelValue"]),u("div",Ut,[c(W,{label:"Catégorie",choices:i.value,"model-value":d.article.category_id,"onUpdate:modelValue":v[3]||(v[3]=a=>p("category_id",a))},null,8,["choices","model-value"])]),u("div",At,[c(W,{label:"Stade d'écriture",choices:t.value,"model-value":d.article.maturing_state,"onUpdate:modelValue":v[4]||(v[4]=a=>p("maturing_state",a))},null,8,["choices","model-value"])])]),u("div",St,[c(F,{class:"h-6",label:"Lien contenu externe",modelValue:d.article.external_content_url,"onUpdate:modelValue":v[5]||(v[5]=a=>p("external_content_url",a))},null,8,["modelValue"]),c(F,{class:"h-6",label:"Lien image",modelValue:d.article.image_url,"onUpdate:modelValue":v[6]||(v[6]=a=>p("image_url",a))},null,8,["modelValue"])]),c(G,{label:"Pistes d'amélioration",modelValue:d.article.comment,"onUpdate:modelValue":v[7]||(v[7]=a=>p("comment",a))},null,8,["modelValue"])]))}}),Bt={class:"flex flex-wrap"},Ot=$({__name:"ResourceAuthorPicker",props:{interaction:{},resourceId:{}},emits:["update"],setup(o,{emit:e}){const n=o,t=f(null),s=f([]),i=l=>{if(l)return{text:`${l.first_name} ${l.last_name}`,value:l.id}},p=T(()=>{var l;return(l=t.value)==null?void 0:l.id}),d=T(()=>{if(s.value)return s.value.map(l=>i(l))}),{getUsers:v,getUserById:a}=P(),C=async l=>t.value=await a(l.interaction_user_id),{createInteractionForResource:y,newInteraction:x,createInteraction:U,updateInteraction:I}=me(),z=async l=>{if(console.log(`newUser : ${JSON.stringify(l)}`),n.interaction){const b={...n.interaction};b.interaction_user_id=l,console.log("newUserid : ",l.id),console.log(`Interaction payload : ${JSON.stringify(b)}`),await I(n.interaction.id,b),e("update")}else{console.log("create interaction");const b=x();b.interaction_user_id=l,b.resource_id=n.resourceId,await y(n.resourceId,b),e("update")}},L=async l=>{await I(n.interaction.id,l),e("update")};return B(async()=>{s.value=await v(),await C(n.interaction)}),J(K(n).interaction,async l=>await C(l)),(l,b)=>(r(),m("div",null,[u("div",Bt,[c(W,{label:"Auteur",class:"my-auto",choices:d.value,"model-value":p.value,"onUpdate:modelValue":b[0]||(b[0]=A=>z(A))},null,8,["choices","model-value"]),c(F,{class:"my-auto",label:"Date d'écriture","model-value":l.interaction.interaction_date.split("T")[0],"onUpdate:modelValue":b[1]||(b[1]=A=>L({...l.interaction,interaction_date:A})),type:"date"},null,8,["model-value"]),c(ve,{class:"my-auto",label:"Progression",modelValue:l.interaction.interaction_progress,"onUpdate:modelValue":b[2]||(b[2]=A=>L({...l.interaction,interaction_progress:A}))},null,8,["modelValue"])])]))}}),Ft={key:0,class:"mx-auto"},Lt={key:0},Nt={class:"my-8"},Et=["src"],Pt={class:"text-3xl my-3 font-mplus md:text-center text-left"},jt={class:"md:text-center text-left"},qt={class:"md:text-center text-left"},Mt={class:"md:flex my-8"},zt=["href"],Ht={key:1},Jt={class:"flex flex-row-reverse"},Kt={key:1,class:"p-2 border rounded bg-neutral-100"},Wt=u("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Gt={key:2},Qt=u("div",{class:"text-xs italic"},"Commentaire",-1),Xt=u("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Yt=u("div",{class:"text-xs italic"},"Contenu",-1),Zt={key:3},eo={class:"fixed right-3 bottom-5"},to=$({__name:"ResourceComponent",props:{id:{},secondLevel:{type:Boolean}},setup(o){const e=o,n=Ve(),t=T(()=>e.secondLevel?"popup_tab":"tab"),s=f([{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli"}]),i=f(n.query[t.value]&&typeof n.query[t.value]=="string"?n.query[t.value]:"ctnt"),p=f(n.query[t.value]);J(()=>n.query[t.value],g=>{console.log("new route query",g),typeof g=="string"&&(p.value=g)});const{getResourceRelationsForResource:d}=de(),v=f([]),a=f(!1),C=async()=>{v.value=await d(K(e).id.value)},y=T(()=>v.value.map(g=>({resource:g.origin_resource,date:g.created_at,user_id:g.user_id,context_comment:g.relation_comment,progress:null})));B(()=>C());const{newResource:x,getResource:U,updateResource:I,getAuthorInteractionForResource:z}=ce(),L=f(null),l=f(x()),b=Re();J(()=>n.query.editing,g=>{console.log("Editing : ",g),A.value=g==="false"?!1:!!g});const A=f(!1),X=g=>{b.push({query:{editing:g.toString()}})},_e=()=>{!l.value||!l.value.id||(l.value.publishing_state="pbsh",I(l.value.id,l.value))},oe=(g,_)=>{l.value=_,L.value!==null&&clearTimeout(L.value),L.value=setTimeout(async()=>{try{await I(g,l.value)}catch(Y){console.log("An error : ",Y)}},1e3)},ne=g=>{g!=`
`&&oe(K(e).id.value,{...l.value,content:g})},{user:se,getUserById:fe}=P(),q=T(()=>l.value.is_external?!0:!se.value||!O.value?!1:O.value.id==se.value.id),O=f(null),S=f(null),H=f(!1),ge=async()=>{S.value=await z(e.id)},{getCommentsForThoughtOutput:he}=Ie(),ae=f([]);return B(async()=>{l.value=await U(e.id),ae.value=await he(e.id),S.value=await z(e.id),S.value&&(O.value=await fe(S.value.interaction_user_id));const g=n.query.editing;A.value=g==="false"?!1:!!g}),(g,_)=>{const Y=le("router-link");return l.value?(r(),m("div",Ft,[A.value?(r(),m("div",Ht,[c(Tt,{article:l.value,onChange:_[0]||(_[0]=k=>oe(l.value.id,k))},null,8,["article"]),c(Ot,{class:"mx-4",interaction:S.value,"resource-id":g.id,onChange:ge},null,8,["interaction","resource-id"]),u("div",Jt,[c(E,{class:"mx-4",onClick:_[1]||(_[1]=k=>X(!1)),type:"valid",text:"Preview"},{default:R(()=>[M("Ok")]),_:1}),l.value.publishing_state=="drft"?(r(),V(E,{key:0,onClick:_e,type:"valid",text:"Publier"})):(r(),m("div",Kt,"Publié"))])])):(r(),m("div",Lt,[u("div",Nt,[u("img",{src:l.value.image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto",style:{"max-height":"20rem"}},null,8,Et)]),u("h1",Pt,h(l.value.title),1),u("div",jt,h(l.value.subtitle),1),u("div",qt,[O.value?(r(),V(Y,{key:0,to:"/users/"+O.value.id,class:"text-sm underline"},{default:R(()=>[M(h(O.value.first_name)+" "+h(O.value.last_name),1)]),_:1},8,["to"])):w("",!0),S.value?(r(),V(Vt,{key:1,date:S.value.interaction_date},null,8,["date"])):w("",!0)]),u("div",Mt,[S.value?(r(),V(re,{key:0,"progress-value":S.value.interaction_progress,class:"m-2 w-1/3"},null,8,["progress-value"])):w("",!0),l.value.resource_type==="atcl"?(r(),m("a",{key:1,class:"ml-auto underline",href:l.value.external_content_url}," Ajouter un commentaire ",8,zt)):w("",!0)])])),u("div",null,[c(Ce,{choices:s.value,default:i.value,"url-key":t.value},null,8,["choices","default","url-key"])]),Wt,p.value=="ctnt"?(r(),m("div",Gt,[Qt,c(ee,{"full-text":l.value.comment,editable:q.value},null,8,["full-text","editable"]),Xt,Yt,l.value.publishing_state!="drft"?(r(),V(ee,{key:0,"ext-comments":ae.value,"resource-id":l.value.id,"full-text":l.value.content,editable:q.value,onChange:_[2]||(_[2]=k=>ne(k))},null,8,["ext-comments","resource-id","full-text","editable"])):(r(),V(G,{key:1,class:"h-96",label:"Contenu",modelValue:l.value.content,"onUpdate:modelValue":_[3]||(_[3]=k=>ne(k))},null,8,["modelValue"]))])):(r(),m("div",Zt,[c(te,{open:a.value,onClose:_[5]||(_[5]=k=>a.value=!1)},{default:R(()=>[c(dt,{onRefresh:C,onClose:_[4]||(_[4]=k=>a.value=!1),"thought-output":l.value},null,8,["thought-output"])]),_:1},8,["open"]),u("div",{onClick:_[6]||(_[6]=k=>a.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),c(pe,{"contextual-resources":y.value},null,8,["contextual-resources"])])),u("div",eo,[q.value?(r(),V(Z,{key:0,title:"Modifier",onClick:_[7]||(_[7]=k=>X(!0))},{default:R(()=>[c(N(Ue),{class:"m-1"})]),_:1})):w("",!0),q.value?(r(),V(Z,{key:1,class:"mt-2",color:"red",title:"Marquer comme lu",onClick:_[8]||(_[8]=k=>H.value=!0)},{default:R(()=>[c(N(De),{class:"m-1"})]),_:1})):w("",!0),c(te,{open:H.value,onClose:_[10]||(_[10]=k=>H.value=!1)},{default:R(()=>[c($t,{onClose:_[9]||(_[9]=k=>H.value=!1),resource:l.value},null,8,["resource"])]),_:1},8,["open"]),q.value?(r(),V(Z,{key:2,class:"mt-2",color:"green",title:"Relier à d'autres ressources",onClick:_[11]||(_[11]=k=>X(!0))},{default:R(()=>[c(N(Ae),{class:"m-1"})]),_:1})):w("",!0)])])):w("",!0)}}});export{to as _,Le as a,te as b,pe as c,W as d,Ue as r,rt as u};
