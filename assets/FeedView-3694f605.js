import{d as b,r as c,c as g,o as C,a as B,b as n,e as a,f as t,g as x,_ as N,t as r,w as T,u as S,F as U,h as V,i as j}from"./index-5b3a11e5.js";import{u as z}from"./useResourceRelations-33a4bdab.js";import{u as D}from"./useInteraction-20490268.js";const H={class:"flex flex-col border p-1.5 overflow-auto"},M={key:0,class:"flex mb-1.5 h-8"},P={class:"h-full flex flex-col w-full"},q={class:"flex w-auto shrink overflow-auto"},E={key:0,class:"sm:text-xs text-sm font-semibold ml-2"},W={key:1,class:"sm:text-xs text-sm italic ml-2"},G=t("div",{class:"mx-1 my-auto rounded-full bg-gray-800 w-1 h-1"},null,-1),J={class:"text-2xs my-auto"},K={class:"flex ml-2 grow shrink-0 overflow-auto"},O={class:"text-2xs my-auto italic"},Q=t("div",{class:"mx-1 my-auto rounded-full bg-gray-800 w-1 h-1"},null,-1),X={class:"text-2xs my-auto italic"},Y={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},Z=["src"],ee={key:1,class:"overflow-auto h-full overflow-scroll bg-blue-100 p-1 pt-8 border"},te={class:"bg-blue-100 text-center text-sm my-auto"},se={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},oe={class:""},ne={class:"mb-2 font-bold text-sm"},re={class:"text-2xs mb-auto"},ae={class:"flex mt-2"},le={class:"ml-auto text-2xs underline"},ie=b({__name:"FeedCard",props:{interaction:{}},setup(h){const l=h,u=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",d=e=>e==="outp"?"Production personnelle":"Bibliographie",m=e=>{switch(e){case"pblm":return"ProblÃ©matique";case"book":return"Livre";case"atcl":return"Article";case"ratc":return"Article de recherche"}return e},s=c(0);c(null);const i=c(null),R=g(()=>`${s.value}/${v.value.length}`),v=g(()=>{if(!l.interaction.resource.content)return[];const e=l.interaction.resource.content.replaceAll("?","?.").split(".");let o=0;const _=[];for(;o<e.length-1;){let f=0,k=[];if(e[o].length>=270)_.push(e[o].replaceAll("?.","?")),o++;else{for(;o<e.length&&f+e[o].length<270;)k.push(e[o]),f+=e[o].length,o++;_.push(k.join(". ").replaceAll("?.","?"))}}return _}),F=e=>e?e.length>200?e.slice(0,150)+"...":e:"",y=c([]),{getResourceRelationsForResource:$}=z(),A=async()=>{l.interaction.id&&(y.value=await $(l.interaction.resource.id))},{getUserById:I}=S(),w=c(!1),L=async()=>{try{i.value=await I(l.interaction.user_id)}catch(e){console.log(e)}w.value=!0},p=c(null);return C(async()=>{await A(),await L();const e=p.value.offsetHeight;p.value.style.height=`${e}px`}),(e,o)=>{const _=B("router-link");return n(),a("div",H,[t("div",null,[w.value?(n(),a("div",M,[x(N,{user:i.value},null,8,["user"]),t("div",P,[t("div",q,[i.value?(n(),a("div",E,r(i.value.first_name)+" "+r(i.value.last_name),1)):(n(),a("div",W," Connectez vous pour voir l'auteur ")),G,t("div",J,r(u(e.interaction.date)),1)]),t("div",K,[t("div",O,r(d(e.interaction.interaction_type)),1),Q,t("div",X,r(m(e.interaction.resource.resource_type)),1)])])])):(n(),a("div",Y))]),t("div",{onClick:o[0]||(o[0]=f=>s.value=(s.value+1)%(v.value.length+1)),class:"overflow-auto relative w-full md:h-3/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:p},[s.value==0?(n(),a("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:e.interaction.resource.image_url},null,8,Z)):(n(),a("div",ee,[t("div",te,r(v.value[s.value-1]),1)])),t("div",se,r(R.value),1)],512),x(_,{class:"",to:"/thought_outputs/"+e.interaction.resource.id},{default:T(()=>[t("div",oe,[t("div",ne,r(e.interaction.resource.title),1),t("div",re,r(F(e.interaction.resource.subtitle)),1),t("div",ae,[t("div",le,r(y.value.length)+" inputs",1)])])]),_:1},8,["to"])])}}}),ce={class:"flex flex-col"},ue=b({__name:"FeedList",props:{interactionsList:{}},setup(h){return(l,u)=>(n(),a("div",ce,[(n(!0),a(U,null,V(l.interactionsList,(d,m)=>(n(),j(ie,{class:"md:mb-2 flex-grow md:rounded max-h-screen border-b-1 border-black",interaction:d},null,8,["interaction"]))),256))]))}}),de={class:"mt-1 md:w-96"},ve=b({__name:"FeedView",setup(h){const{getReadAndWriteInteractions:l}=D(),u=c([]),d=g(()=>u.value.map(s=>({resource:s.resource,date:s.interaction_date,user_id:s.interaction_user_id,context_comment:s.interaction_comment,progress:s.interaction_progress,...s})).sort((s,i)=>.5-Math.random())),m=async()=>u.value=await l();return C(async()=>{await m()}),(s,i)=>(n(),a("div",de,[x(ue,{"interactions-list":d.value},null,8,["interactions-list"])]))}});export{ve as default};
