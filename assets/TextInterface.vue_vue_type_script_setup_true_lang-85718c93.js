import{e as A,g as B,r,h as F,m as y,l as I,o as n,c as i,n as D,k as L,F as k,p as C,q as W,b as N,t as O}from"./index-5cb82f41.js";const R=["onClick"],S={key:0,style:{width:"5px"}},V={key:1,style:{height:"25px"}},q={key:2},M=A({__name:"TextInterface",props:{fullText:{}},emits:["change"],setup(_,{emit:b}){const h=_,w=B(()=>{console.log("Compute lines");let e=[{id:0,text:[]}].concat(o.value.filter(l=>l.char==`
`));console.log("Compute ids.length : ",e.length);for(let l=0;l<e.length-1;l++)console.log("Compute line : ",l),e[l].text=o.value.filter(t=>t.id>=e[l].id&&t.id<e[l+1].id);return e[e.length-1].text=o.value.filter(l=>l.id>=e[e.length-1].id),e}),o=r([]),c=e=>{console.log("selectCursorPosition letter : ",e),a.value={id:e.id,char:e.char}},a=r(null),p=e=>{o.value.filter(l=>l.id>=a.value.id+1).forEach(l=>l.id+=1),o.value.splice(a.value.id+1,0,{id:a.value.id+1,char:e,line:0}),a.value.id+=1},f=e=>{if(console.log("Writes : ",e.key),a.value===null)return;const l=e.key;if(l.length==1)p(l);else if(l=="Backspace")o.value.splice(a.value.id,1),o.value.filter(t=>t.id>a.value.id).forEach(t=>t.id-=1),a.value.id-=1;else if(l=="Enter")p(`
`);else if(l=="ArrowRight"){let t=a.value.id;t<o.value.length-1&&c(o.value[t+1])}else if(l=="ArrowLeft"){let t=a.value.id;t>0&&c(o.value[t-1])}},d=r(!1),s=r(null),E=e=>{console.log(e),e.preventDefault(),e.stopPropagation(),s.value&&s.value.remove(),s.value=document.createElement("input"),s.value.style.cssText=`opacity: 0; z-index: -1; position: absolute; top: ${e.y}px; left: ${e.x}px;`,s.value.addEventListener("keydown",l=>f(l)),document.body.appendChild(s.value),s.value.focus(),d.value=!1},v=r({position:"absolute","z-index":90,top:0,left:0,height:"100px",width:"150px"}),P=e=>{e.preventDefault(),v.value.top=`${e.layerY}px`,v.value.left=`${e.layerX}px`,d.value=!0,console.log("event : ",e),console.log("Have a new right click")},g=e=>{if(console.log("textArrayFromString textString: ",e),o.value=[],e===void 0||e==""){o.value=[{id:0,char:`
`}],c({id:0,char:`
`});return}for(var l=0;l<e.length;l++)o.value.push({id:l,char:e[l]})},T=e=>e.reduce((l,t)=>l+t.char,""),m=r(!1);return F(()=>{g(h.fullText),m.value=!0}),y(o,e=>{console.log("Watch triggered : ",e),m.value&&b("change",T(e))},{deep:!0}),y(I(h).fullText,e=>{g(e)}),(e,l)=>(n(),i("div",{autofocus:"",id:"board",class:"border-2 mx-auto relative p-4",tabindex:"0",onKeydown:f,onClick:E},[d.value?(n(),i("div",{key:0,class:"bg-white border-4",style:D(v.value)},null,4)):L("",!0),(n(!0),i(k,null,C(w.value,(t,$)=>(n(),i("div",{key:$,class:"flex flex-wrap w-full"},[(n(!0),i(k,null,C(t.text,(u,z)=>{var x;return n(),i("div",{key:z,class:W(["border-blue-400",{"border-r-2":u.id==((x=a.value)==null?void 0:x.id)}]),onClick:H=>c(u),onContextmenu:P},[u.char==" "?(n(),i("div",S)):u.char==`
`?(n(),i("div",V)):(n(),i("div",q,[N("div",null,O(u.char),1)]))],42,R)}),128))]))),128))],32))}});export{M as _};
