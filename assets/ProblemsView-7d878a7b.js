import{u as M,a as R}from"./useProblem-54f1adc7.js";import{d as w,r as g,q as x,o as A,s as N,b as t,c as r,e as l,f as C,_ as V,t as p,h as D,m as S,a as U,F as f,l as y,g as $,k as q,j as T,v as z,x as E}from"./index-edc2cee2.js";import{u as W}from"./useResource-cfe8ab73.js";const G={class:"border p-1.5"},H={key:0,class:"flex mb-1.5"},J={class:"text-xs italic my-auto ml-2"},K={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},O=["src"],Q={key:1,class:"h-full overflow-scroll bg-blue-100 p-1 pt-8 border"},X={class:"bg-blue-100 text-center my-auto"},Y={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},Z={class:""},ee={class:"mb-2"},te={class:"text-2xs mb-auto"},se={class:"flex mt-2"},oe={class:"text-2xs italic mt-auto"},le={class:"ml-auto text-2xs underline"},F=w({__name:"ProblemCard",props:{problem:{}},setup(b){const c=b,d=e=>e?e.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",i=g(0),_=g(null),m=g(null),h=x(()=>`${i.value}/${s.value.length}`),s=x(()=>{const e=c.problem.content.replaceAll("?","?.").split(".");let u=0;const v=[];for(;u<e.length-1;){let k=0,P=[];if(e[u].length>=270)v.push(e[u].replaceAll("?.","?")),u++;else{for(;u<e.length&&k+e[u].length<270;)P.push(e[u]),k+=e[u].length,u++;v.push(P.join(". ").replaceAll("?.","?"))}}return v}),n=e=>e.length>200?e.slice(0,150)+"...":e,{getAuthorInteractionForResource:o}=W(),a=g([]),{getResourceRelationsForResource:L}=M(),B=async()=>{c.problem.id&&(a.value=await L(c.problem.id))},{getUserById:I}=S(),j=async()=>{_.value=await o(c.problem.id),_.value&&(m.value=await I(_.value.interaction_user_id))};return A(async()=>{await B(),await j()}),(e,u)=>{const v=N("router-link");return t(),r("div",G,[l("div",null,[m.value?(t(),r("div",H,[C(V,{user:m.value},null,8,["user"]),l("div",J,p(m.value.first_name)+" "+p(m.value.last_name),1)])):(t(),r("div",K))]),l("div",{onClick:u[0]||(u[0]=k=>i.value=(i.value+1)%(s.value.length+1)),class:"relative h-3/5 mb-2 bg-gray-700"},[i.value==0?(t(),r("img",{key:0,class:"object-contain w-full h-full mt-auto mx-auto",src:e.problem.image_url},null,8,O)):(t(),r("div",Q,[l("div",X,p(s.value[i.value-1]),1)])),l("div",Y,p(h.value),1)]),C(v,{to:"/thought_outputs/"+e.problem.id},{default:D(()=>[l("div",Z,[l("div",ee,p(e.problem.title),1),l("div",te,p(n(e.problem.subtitle)),1),l("div",se,[l("div",oe,p(d(e.problem.created_at)),1),l("div",le,p(a.value.length)+" inputs",1)])])]),_:1},8,["to"])])}}}),re={class:"flex"},ne=l("hr",{class:"border-top border-slate-800 border-dashed my-1"},null,-1),ae={class:"flex overflow-scroll"},ue=w({__name:"CategoryProblemsCarousel",props:{problemsList:{},category:{}},setup(b){const c=b,{newProblem:d,createProblem:i}=R(),_=U(),m=async()=>{const s=d();s.resource.category_id=c.category.id;const n=await i(s);_.push({path:"/thought_outputs/"+n.resource.id,query:{editing:"true"}})},h=s=>s=="default"?"Autres":s;return(s,n)=>(t(),r("div",null,[l("div",re,[l("div",null,p(h(s.category.display_name)),1),l("div",{onClick:m,class:"ml-auto text-sm mr-2 underline"}," Ajouter ")]),ne,l("div",ae,[(t(!0),r(f,null,y(s.problemsList,(o,a)=>(t(),r("div",{class:"mb-4",key:a},[C(F,{class:"w-80 h-96 mx-3 shadow-xl rounded",problem:o},null,8,["problem"])]))),128))])]))}}),ie=w({__name:"MobileProblemsFeed",props:{problemsList:{}},setup(b){return(c,d)=>(t(),r("div",null,[(t(!0),r(f,null,y(c.problemsList,(i,_)=>(t(),$(F,{class:"border-b-1 border-black",problem:i},null,8,["problem"]))),256))]))}}),ce={key:0,class:"md:m-4"},me={key:0},de={key:1},he=w({__name:"ProblemsView",setup(b){const{getProblems:c}=R(),d=g(null),{categories:i}=z(),{isMobile:_}=E(),m=x(()=>i.value.map(n=>(n.problems=h(n),n.problems_count=n.problems?n.problems.length:0,n))),h=s=>{var n,o;return s.display_name=="default"?(n=d.value)==null?void 0:n.filter(a=>a.category_id==null):(o=d.value)==null?void 0:o.filter(a=>a.category_id==s.id)};return A(async()=>d.value=await c()),(s,n)=>(t(),r("div",null,[d.value?(t(),r("div",ce,[q(_)?(t(),r("div",de,[(t(!0),r(f,null,y(m.value.sort((o,a)=>a.problems_count-o.problems_count),o=>(t(),$(ie,{"problems-list":o.problems},null,8,["problems-list"]))),256))])):(t(),r("div",me,[(t(!0),r(f,null,y(m.value.sort((o,a)=>a.problems_count-o.problems_count),o=>(t(),$(ue,{class:"mt-4",category:o,key:o.id,"problems-list":o.problems},null,8,["category","problems-list"]))),128))]))])):T("",!0)]))}});export{he as default};
