import{o as r,f as l,a as o,d as T,b as u,h as m,e as j,r as A,c as B,H as N,t as c,i as d,n as _,w as g,l as z,p as I,F as H,g as U}from"./index-ae15bee7.js";import{u as V}from"./useResourceRelations-3b0701d2.js";const D=n=>{if(!n)return[];const t=n.replace("/?/g","?.").split(".");let s=0;const i=[];for(;s<t.length;){let h=0,a=[];if(t[s].length>=270)i.push(t[s].replace("/?./g","?")),s++;else{for(;s<t.length&&h+t[s].length<270;)a.push(t[s]),h+=t[s].length,s++;i.push(a.join(". ").replace("/?./g","?"))}}return i},q=n=>n?n.split(`
`).map(s=>D(s)).flat():[],C={splitTextForPanel:q};function E(n,t){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function G(n,t){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})])}function J(n,t){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}const K={class:"flex flex-col border p-1.5 overflow-auto"},O={class:"flex"},Q={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},W=["src"],X={key:1,class:"overflow-auto h-full overflow-scroll bg-red-100 p-1 pt-8 border"},Y={class:"bg-red-100 text-center text-sm my-auto"},Z={key:2,class:"overflow-auto h-full overflow-scroll bg-blue-100 p-1 pt-8 border"},ee={class:"bg-blue-100 text-center text-sm my-auto"},te={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},oe={class:"flex"},se={title:"Coming Soon ;)",class:"w-6"},re={title:"Coming Soon ;)",class:"w-6"},ne={class:"flex"},ae={class:"text-2xs"},le={class:""},ie={class:"mb-2 font-bold text-sm"},ce={class:"text-2xs mb-auto"},ue=T({__name:"FeedCard",props:{interaction:{}},setup(n){const t=n,s=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",i=e=>e==="outp"?"Production personnelle":"Bibliographie",h=e=>{switch(e){case"pblm":return"ProblÃ©matique";case"book":return"Livre";case"atcl":return"Article";case"ratc":return"Article de recherche"}return e},a=u(0);u(null);const w=u(null),L=()=>{a.value=(a.value+1)%x.value},F=m(()=>`${a.value+1}/${x.value}`),x=m(()=>p.value.length+b.value.length+1),b=m(()=>C.splitTextForPanel(t.interaction.resource.content)),p=m(()=>C.splitTextForPanel(t.interaction.context_comment)),M=e=>e?e.length>200?e.slice(0,150)+"...":e:"",k=u([]),{getResourceRelationsForResource:R}=V(),$=async()=>{t.interaction.id&&(k.value=await R(t.interaction.resource.id))},{getUserById:P}=I(),y=u(!1),S=async()=>{try{w.value=await P(t.interaction.user_id)}catch(e){console.log(e)}y.value=!0},f=u(null);return j(async()=>{await $(),await S();const e=f.value.offsetHeight;f.value.style.height=`${e}px`}),(e,he)=>{const v=A("router-link");return r(),l("div",K,[o("div",O,[y.value?(r(),B(N,{key:0,class:"flex mb-1.5 h-8",user:w.value,secondText:s(e.interaction.date),firstBottomText:i(e.interaction.interaction_type),secondBottomText:h(e.interaction.resource.resource_type)},null,8,["user","secondText","firstBottomText","secondBottomText"])):(r(),l("div",Q))]),o("div",{onClick:L,class:"overflow-auto relative w-full md:h-4/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:f},[a.value==0?(r(),l("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:e.interaction.resource.image_url},null,8,W)):a.value>0&&a.value<=p.value.length?(r(),l("div",X,[o("div",Y,c(p.value[a.value-1]),1)])):(r(),l("div",Z,[o("div",ee,c(b.value[a.value-p.value.length-1]),1)])),o("div",te,c(F.value),1)],512),o("div",oe,[o("div",se,[d(_(G),{class:"w-full my-auto"})]),o("div",re,[d(_(J),{class:"w-full my-auto"})]),d(v,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto"},{default:g(()=>[d(_(E),{class:"w-8"})]),_:1},8,["to"])]),o("div",ne,[o("div",ae,c(Math.floor(Math.random()*100))+" likes",1),d(v,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:g(()=>[z(c(k.value.length)+" relations ",1)]),_:1},8,["to"])]),d(v,{class:"",to:"/resources/"+e.interaction.resource.id},{default:g(()=>[o("div",le,[o("div",ie,c(e.interaction.resource.title),1),o("div",ce,c(M(e.interaction.resource.subtitle)),1)])]),_:1},8,["to"])])}}}),de={class:"flex flex-col"},fe=T({__name:"FeedList",props:{interactionsList:{}},setup(n){return(t,s)=>(r(),l("div",de,[(r(!0),l(H,null,U(t.interactionsList,(i,h)=>(r(),B(ue,{class:"md:mb-2 flex-grow md:rounded max-h-screen border-b-1 border-black",interaction:i},null,8,["interaction"]))),256))]))}});export{fe as _};
