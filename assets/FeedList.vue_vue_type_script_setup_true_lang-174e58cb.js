import{o as i,f as u,a as o,d as C,b as v,h as x,e as B,t as d,G as $,n as R,r as P,c as L,M as j,i as m,q as b,w as k,l as I,F as S,g as z,x as A}from"./index-4c6af3e5.js";import{u as N}from"./useResourceRelations-e399e438.js";import{u as H}from"./useResource-ef572ee1.js";const U=l=>{if(!l||l==="")return[];const r=l.replace(/\?/g,"?.").split(".");let e=0;const n=[];for(;e<r.length;){let s=0,f=[];if(r[e].length>=270)n.push(r[e].replace("/?./g","?")),e++;else{for(;e<r.length&&s+r[e].length<270;)f.push(r[e]),s+=r[e].length,e++;n.push(f.join(". ").replace("/?./g","?"))}}return n},V=l=>l?l.split(`
`).map(e=>U(e)).flat():[],F={splitTextForPanel:V};function D(l,r){return i(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function q(l,r){return i(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})])}function E(l,r){return i(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}const G=["src"],O={key:1,class:"bg-white h-full text-center flex items-center justify-center"},J={class:"text-2xl text-black"},K={class:"text-lg text-bold mt-2"},Q={class:"text-bold mb-2"},W={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},X=C({__name:"FeedCardTextInterface",props:{interaction:{}},setup(l){const r=l,e=a=>{if(a>0&&a<=p.value.length){const c=p.value[a-1];return{text:c.replace(/#/g,""),header:a===1?"Commentaire : ":null,class:{"font-black":c.charAt(0)==="#","bg-gray-700":!0}}}else{const c=g.value[a-p.value.length-1];return{text:c?c.replace(/#/g,""):"",header:a===p.value.length+1?"Contenu : ":null,class:{"font-black":c&&c.charAt(0)==="#","bg-slate-700":!0}}}},n=v(0),s=()=>{n.value=(n.value+1)%h.value},f=x(()=>`${n.value+1}/${h.value}`),h=x(()=>p.value.length+g.value.length+1),g=x(()=>F.splitTextForPanel(r.interaction.resource.content)),p=x(()=>F.splitTextForPanel(r.interaction.context_comment)),w=()=>{if(r.interaction.resource.image_url!==""){const a=_.value.offsetHeight;_.value.style.height=`${a}px`}},_=v(null);return B(()=>{r.interaction.resource.image_url===""&&(_.value.style.height="500px")}),(a,c)=>(i(),u("div",{onClick:s,class:"overflow-auto relative w-full md:h-4/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:_},[n.value==0&&a.interaction.resource.image_url!==""?(i(),u("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:a.interaction.resource.image_url,onLoad:w},null,40,G)):n.value==0?(i(),u("div",O,[o("div",null,[o("div",J,d(a.interaction.resource.title),1),o("div",K,d(a.interaction.resource.subtitle),1)])])):(i(),u("div",{key:2,class:$(["h-full overflow-scroll p-1 pb-16 border flex items-center justify-center",e(n.value).class])},[o("div",{class:$([e(n.value).class,"text-center text-sm my-auto text-white"])},[o("div",null,[o("div",Q,d(e(n.value).header),1),o("div",null,d(e(n.value).text),1)])],2)],2)),o("div",W,d(f.value),1)],512))}}),Y={class:"flex flex-col border p-1.5 overflow-auto"},Z={class:"flex"},ee={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},te={class:"flex"},re={title:"Coming Soon ;)",class:"w-6"},se={title:"Coming Soon ;)",class:"w-6"},oe={class:"flex"},ne={class:"text-2xs"},le={class:""},ae={class:"mb-2 font-bold text-sm"},ie={class:"text-2xs mb-auto"},ce=C({__name:"FeedCard",props:{interaction:{}},setup(l){const r=l,e=t=>t?t.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",n=t=>t==="outp"?"Production personnelle":"Bibliographie",{resourceTypeOptions:s}=H(),f=t=>s.find(T=>T.value===t).text;v(null);const h=v(null),g=t=>t?t.length>200?t.slice(0,150)+"...":t:"",p=v([]),{getResourceRelationsForResource:w}=N(),_=async()=>{r.interaction.id&&(p.value=await w(r.interaction.resource.id))},{getUserById:a}=R(),c=v(!1),M=async()=>{try{h.value=await a(r.interaction.user_id)}catch(t){console.log(t)}c.value=!0};return B(async()=>{await _(),await M()}),(t,T)=>{const y=P("router-link");return i(),u("div",Y,[o("div",Z,[c.value?(i(),L(j,{key:0,class:"flex mb-1.5 h-8",user:h.value,secondText:e(t.interaction.date),firstBottomText:n(t.interaction.interaction_type),secondBottomText:t.$t(f(t.interaction.resource.resource_type))},null,8,["user","secondText","firstBottomText","secondBottomText"])):(i(),u("div",ee))]),m(X,{interaction:t.interaction},null,8,["interaction"]),o("div",te,[o("div",re,[m(b(q),{class:"w-full my-auto"})]),o("div",se,[m(b(E),{class:"w-full my-auto"})]),m(y,{to:"/resources/"+t.interaction.resource.id+"/feed",class:"ml-auto"},{default:k(()=>[m(b(D),{class:"w-8"})]),_:1},8,["to"])]),o("div",oe,[o("div",ne,d(Math.floor(Math.random()*100))+" likes",1),m(y,{to:"/resources/"+t.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:k(()=>[I(d(p.value.length)+" relations ",1)]),_:1},8,["to"])]),m(y,{class:"",to:"/resources/"+t.interaction.resource.id},{default:k(()=>[o("div",le,[o("div",ae,d(t.interaction.resource.title),1),o("div",ie,d(g(t.interaction.resource.subtitle)),1)])]),_:1},8,["to"])])}}}),ue={class:"flex flex-col"},fe=C({__name:"FeedList",props:{interactionsList:{}},setup(l){const r=l,{feedFilter:e}=A(),n=x(()=>r.interactionsList.filter(s=>e.value==="production"?s.interaction_type==="outp"&&!s.resource.is_external&&s.resource.resource_type!=="pblm"&&!s.resource.is_external:e.value==="draft"?s.interaction_type==="outp"&&!s.resource.is_external&&(s.resource.maturing_state==="drft"||s.resource.maturing_state==="rvew"):e.value==="reviews"?s.interaction_type==="rvew":e.value==="problem"?s.resource.resource_type==="pblm":e.value==="biblio"?s.interaction_type==="inpt":s.interaction_type==="inpt"||!s.resource.is_external));return(s,f)=>(i(),u("div",ue,[(i(!0),u(S,null,z(n.value,(h,g)=>(i(),L(ce,{class:"md:mb-2 flex-grow md:rounded max-h-screen border-b-1 border-black",interaction:h,key:h.id},null,8,["interaction"]))),128))]))}});export{fe as _};
