import{u as N,a as R}from"./useProblem-4b24d6ee.js";import{d as w,r as g,q as k,o as A,s as V,b as t,c as n,f as C,_ as D,e as r,t as p,j as F,h as S,m as U,a as q,F as f,l as y,g as $,k as T,v as z,x as E}from"./index-f886ca68.js";import{u as W}from"./useResource-2f1efc3f.js";const G={class:"border p-1.5"},H={key:0,class:"flex mb-1.5"},J={class:"text-xs italic my-auto ml-2"},K=["src"],O={key:1,class:"h-full overflow-scroll bg-blue-100 p-1 pt-8 border"},Q={class:"bg-blue-100 text-center my-auto"},X={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},Y={class:""},Z={class:"mb-2"},ee={class:"text-2xs mb-auto"},te={class:"flex mt-2"},se={class:"text-2xs italic mt-auto"},oe={class:"ml-auto text-2xs underline"},L=w({__name:"ProblemCard",props:{problem:{}},setup(b){const c=b,d=e=>e?e.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",i=g(0),_=g(null),m=g(null),h=k(()=>`${i.value}/${s.value.length}`),s=k(()=>{const e=c.problem.content.replaceAll("?","?.").split(".");let u=0;const v=[];for(;u<e.length-1;){let x=0,P=[];if(e[u].length>=270)v.push(e[u].replaceAll("?.","?")),u++;else{for(;u<e.length&&x+e[u].length<270;)P.push(e[u]),x+=e[u].length,u++;v.push(P.join(". ").replaceAll("?.","?"))}}return v}),l=e=>e.length>200?e.slice(0,150)+"...":e,{getAuthorInteractionForResource:o}=W(),a=g([]),{getResourceRelationsForResource:B}=N(),I=async()=>{c.problem.id&&(a.value=await B(c.problem.id))},{getUserById:j}=U(),M=async()=>{_.value=await o(c.problem.id),_.value&&(m.value=await j(_.value.interaction_user_id))};return A(async()=>{await I(),await M()}),(e,u)=>{const v=V("router-link");return t(),n("div",G,[m.value?(t(),n("div",H,[C(D,{user:m.value},null,8,["user"]),r("div",J,p(m.value.first_name)+" "+p(m.value.last_name),1)])):F("",!0),r("div",{onClick:u[0]||(u[0]=x=>i.value=(i.value+1)%(s.value.length+1)),class:"relative h-3/5 mb-2 bg-gray-700"},[i.value==0?(t(),n("img",{key:0,class:"object-contain w-full h-full mt-auto mx-auto",src:e.problem.image_url},null,8,K)):(t(),n("div",O,[r("div",Q,p(s.value[i.value-1]),1)])),r("div",X,p(h.value),1)]),C(v,{to:"/thought_outputs/"+e.problem.id},{default:S(()=>[r("div",Y,[r("div",Z,p(e.problem.title),1),r("div",ee,p(l(e.problem.subtitle)),1),r("div",te,[r("div",se,p(d(e.problem.created_at)),1),r("div",oe,p(a.value.length)+" inputs",1)])])]),_:1},8,["to"])])}}}),le={class:"flex"},re=r("hr",{class:"border-top border-slate-800 border-dashed my-1"},null,-1),ne={class:"flex overflow-scroll"},ae=w({__name:"CategoryProblemsCarousel",props:{problemsList:{},category:{}},setup(b){const c=b,{newProblem:d,createProblem:i}=R(),_=q(),m=async()=>{const s=d();s.resource.category_id=c.category.id;const l=await i(s);_.push({path:"/thought_outputs/"+l.resource.id,query:{editing:"true"}})},h=s=>s=="default"?"Autres":s;return(s,l)=>(t(),n("div",null,[r("div",le,[r("div",null,p(h(s.category.display_name)),1),r("div",{onClick:m,class:"ml-auto text-sm mr-2 underline"}," Ajouter ")]),re,r("div",ne,[(t(!0),n(f,null,y(s.problemsList,(o,a)=>(t(),n("div",{class:"mb-4",key:a},[C(L,{class:"w-80 h-96 mx-3 shadow-xl rounded",problem:o},null,8,["problem"])]))),128))])]))}}),ue=w({__name:"MobileProblemsFeed",props:{problemsList:{}},setup(b){return(c,d)=>(t(),n("div",null,[(t(!0),n(f,null,y(c.problemsList,(i,_)=>(t(),$(L,{class:"border-b-1 border-black",problem:i},null,8,["problem"]))),256))]))}}),ie={key:0,class:"md:m-4"},ce={key:0},me={key:1},be=w({__name:"ProblemsView",setup(b){const{getProblems:c}=R(),d=g(null),{categories:i}=z(),{isMobile:_}=E(),m=k(()=>i.value.map(l=>(l.problems=h(l),l.problems_count=l.problems?l.problems.length:0,l))),h=s=>{var l,o;return s.display_name=="default"?(l=d.value)==null?void 0:l.filter(a=>a.category_id==null):(o=d.value)==null?void 0:o.filter(a=>a.category_id==s.id)};return A(async()=>d.value=await c()),(s,l)=>(t(),n("div",null,[d.value?(t(),n("div",ie,[T(_)?(t(),n("div",me,[(t(!0),n(f,null,y(m.value.sort((o,a)=>a.problems_count-o.problems_count),o=>(t(),$(ue,{"problems-list":o.problems},null,8,["problems-list"]))),256))])):(t(),n("div",ce,[(t(!0),n(f,null,y(m.value.sort((o,a)=>a.problems_count-o.problems_count),o=>(t(),$(ae,{class:"mt-4",category:o,key:o.id,"problems-list":o.problems},null,8,["category","problems-list"]))),128))]))])):F("",!0)]))}});export{be as default};
