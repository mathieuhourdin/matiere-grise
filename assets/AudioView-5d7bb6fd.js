import{d as j,p as V,b as n,h as O,e as z,f as l,a as e,s as y,t as m,m as g,v as L,x as P,j as F,o as u}from"./index-427107b6.js";const J={class:"p-6"},W=e("h1",{class:"text-2xl font-bold mb-6"},"Enregistrement Audio",-1),q={class:"flex flex-col items-center space-y-4"},G={key:0,class:"flex items-center space-x-2 text-red-600"},H=e("div",{class:"w-3 h-3 bg-red-500 rounded-full animate-pulse"},null,-1),K=e("span",{class:"text-sm font-medium"},"Enregistrement en cours...",-1),Q=[H,K],X={key:1,class:"text-lg font-mono"},Y={key:2,class:"w-full max-w-md"},Z=e("h3",{class:"text-lg font-medium mb-2"},"Aper√ßu de l'enregistrement:",-1),ee=["src"],te={class:"mt-4 space-y-3"},se=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Message accompagnant l'audio: ",-1),ae=["disabled"],oe={key:0,class:"animate-spin"},re={key:1},ne={key:3,class:"w-full max-w-2xl mt-6"},le=e("h3",{class:"text-lg font-medium mb-3 text-gray-800"},"R√©ponse de l'API:",-1),ue={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},ie={class:"mb-3"},de=e("span",{class:"font-medium text-gray-700"},"Statut:",-1),ce={key:0,class:"space-y-2"},ve=e("div",{class:"font-medium text-gray-700"},"Donn√©es re√ßues:",-1),me={class:"bg-white border border-gray-200 rounded p-3 text-sm text-gray-800 overflow-x-auto"},ge={key:1,class:"mt-3"},pe=e("div",{class:"font-medium text-red-700"},"D√©tails de l'erreur:",-1),_e={class:"text-red-600 text-sm"},he=j({__name:"AudioView",setup(fe){const D=V(),d=n(!1),i=n(null),c=n([]),p=n(""),h=n(0),x=n(null),b=n(""),_=n(!1),t=n(""),o=n(null),A=O(()=>t.value.includes("succ√®s")?"bg-green-100 text-green-800 border border-green-200":t.value.includes("Erreur")?"bg-red-100 text-red-800 border border-red-200":"bg-blue-100 text-blue-800 border border-blue-200");z(()=>{navigator!=null&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia({audio:!0}).then(s=>{i.value=new MediaRecorder(s),i.value.ondataavailable=r=>{c.value.push(r.data)},i.value.onstop=()=>{const r=new Blob(c.value,{type:"audio/webm"});p.value=URL.createObjectURL(r),w()}}).catch(s=>{console.error("Erreur d'acc√®s au microphone:",s)})});const C=()=>{i.value&&(d.value?T():I())},I=()=>{i.value&&(d.value=!0,c.value=[],p.value="",h.value=0,i.value.start(),$())},T=()=>{i.value&&(d.value=!1,i.value.stop(),w())},$=()=>{x.value=window.setInterval(()=>{h.value++},1e3)},w=()=>{x.value&&(clearInterval(x.value),x.value=null)},M=s=>{const r=Math.floor(s/60),f=s%60;return`${r.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`},U=async()=>{if(c.value.length!==0){_.value=!0,t.value="Pr√©paration de l'envoi...";try{const s=new Blob(c.value,{type:"audio/webm"});await B(s)}catch(s){console.error("Erreur lors de l'upload:",s),t.value="Erreur lors de l'envoi"}finally{_.value=!1}}};async function B(s){var r,f,E,k,R;try{t.value="Envoi en cours...";const a=new FormData;a.append("file",s,"note.webm"),a.append("message",b.value),a.append("duration",h.value.toString()),a.append("timestamp",new Date().toISOString());const v=await F.post("/process_audio",a,"multipart/form-data");if(o.value=v,v.status===200){t.value=`Enregistrement envoy√© avec succ√®s! ID: ${((r=v.data)==null?void 0:r.id)||"N/A"}`;const S=(E=(f=v.data)==null?void 0:f.created_interaction)==null?void 0:E.resource_id;S?(t.value="Enregistrement envoy√© avec succ√®s! Redirection vers la ressource...",setTimeout(()=>{c.value=[],p.value="",b.value="",t.value="",D.push(`/resources/${S}`)},2e3)):(t.value=`Enregistrement envoy√© avec succ√®s! ID: ${((k=v.data)==null?void 0:k.id)||"N/A"}`,setTimeout(()=>{c.value=[],p.value="",b.value="",t.value=""},3e3))}else t.value=`Erreur lors de l'upload: ${v.status} - ${((R=v.data)==null?void 0:R.message)||"Erreur inconnue"}`}catch(a){throw console.error("Erreur lors de l'upload:",a),t.value=`Erreur de connexion: ${a instanceof Error?a.message:"Erreur inconnue"}`,o.value={status:500,data:a instanceof Error?a.message:"Erreur inconnue"},a}}const N=()=>{o.value=null};return(s,r)=>(u(),l("div",J,[W,e("div",q,[e("button",{onClick:C,class:y(["px-6 py-3 rounded-lg font-medium transition-colors",d.value?"bg-red-500 hover:bg-red-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white"])},m(d.value?"‚èπÔ∏è Arr√™ter l'enregistrement":"üé§ Commencer l'enregistrement"),3),d.value?(u(),l("div",G,Q)):g("",!0),d.value?(u(),l("div",X,m(M(h.value)),1)):g("",!0),p.value?(u(),l("div",Y,[Z,e("audio",{controls:"",class:"w-full",src:p.value},null,8,ee),e("div",te,[e("div",null,[se,L(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=f=>b.value=f),placeholder:"Ajoutez un message ou une description...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3"},null,512),[[P,b.value]])]),e("button",{onClick:U,disabled:_.value,class:y(["w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2",_.value?"bg-gray-400 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white"])},[_.value?(u(),l("span",oe,"‚è≥")):(u(),l("span",re,"üíæ")),e("span",null,m(_.value?"Envoi en cours...":"Envoyer l'enregistrement"),1)],10,ae),t.value?(u(),l("div",{key:0,class:y(["text-sm p-3 rounded-md",A.value])},m(t.value),3)):g("",!0)])])):g("",!0),o.value?(u(),l("div",ne,[le,e("div",ue,[e("div",ie,[de,e("span",{class:y(["ml-2 px-2 py-1 rounded text-xs font-medium",o.value.status===200?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},m(o.value.status===200?"Succ√®s":"Erreur"),3)]),o.value.data?(u(),l("div",ce,[ve,e("pre",me,m(JSON.stringify(o.value.data,null,2)),1)])):g("",!0),o.value.status!==200&&o.value.data?(u(),l("div",ge,[pe,e("div",_e,m(o.value.data),1)])):g("",!0),e("button",{onClick:N,class:"mt-3 px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded text-sm transition-colors"}," Effacer la r√©ponse ")])])):g("",!0)])]))}});export{he as default};
