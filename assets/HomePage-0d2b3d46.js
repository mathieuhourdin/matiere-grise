import{d as C,r as L,y as T,a as I,b as i,c as d,m as w,e as x,l as t,h as E,w as b,f as g,k,O as S,j as $,F as H,g as q,t as j,u as N,o as R,p as B,P as J,Q as G,S as U,U as z,M as D}from"./index-ae4d109a.js";import{u as V}from"./useLens-550b3aef.js";import"./useJournal-b0ad00fa.js";import{_ as O}from"./TransactionElementsList.vue_vue_type_script_setup_true_lang-a38339c4.js";import{_ as P}from"./HeatmapDisplay.vue_vue_type_script_setup_true_lang-79485d76.js";import{J as W}from"./JournalPadComponent-108dc21c.js";import"./PlusIcon-a8ce81de.js";const Q={class:"font-inter"},K={key:0,class:"text-sm text-slate-500 mt-3"},X={key:1,class:"mt-3"},Y={class:"mt-2 flex justify-end"},Z=C({__name:"LastElementsSection",setup(y){const{displayLandscapeAnalysis:o}=V(),m=L([]),h=L(!1),u=n=>{const c=n==null?void 0:n.id;if(c==null)return null;const f=String(c).trim();return f.length>0?f:null},p=async n=>{if(!n){m.value=[];return}h.value=!0;try{const c=await S.get(`/analysis/${n}/parents`),f=Array.isArray(c.data)?c.data:[],v=[n,...f.map(r=>u(r)).filter(r=>!!r)],s=Array.from(new Set(v)),e=(await Promise.all(s.map(r=>S.get(`/analysis/${r}/elements`)))).flatMap(r=>Array.isArray(r.data)?r.data:[]),l=new Map,_=[];e.forEach(r=>{const F=r==null?void 0:r.id,M=F==null?"":String(F).trim();if(!M){_.push(r);return}l.has(M)||l.set(M,r)}),m.value=[...l.values(),..._]}catch(c){console.error(`Error loading elements for analysis lineage ${n}:`,c),m.value=[]}finally{h.value=!1}};return T(()=>{var n;return(n=o.value)==null?void 0:n.id},async()=>{var c;const n=(c=o.value)==null?void 0:c.id;if(!n){m.value=[];return}await p(n)},{immediate:!0}),(n,c)=>{var v;const f=I("router-link");return i(),d("section",Q,[w(o)?(i(),d("div",X,[x(O,{elements:m.value,"is-loading":h.value},null,8,["elements","is-loading"]),t("div",Y,[(v=w(o))!=null&&v.id?(i(),E(f,{key:0,to:{name:"analysis",query:{id:w(o).id}},class:"text-xs text-slate-400 underline hover:text-slate-200 transition-colors"},{default:b(()=>[g(" voir plus ")]),_:1},8,["to"])):k("",!0)])])):(i(),d("div",K," Aucune analyse courante "))])}}}),ee={class:"font-inter"},te={key:0,class:"text-sm text-slate-500 mt-3"},se={key:1,class:"text-sm text-slate-500 mt-3"},ae={key:2,class:"text-sm text-slate-500 mt-3"},oe={key:3,class:"mt-3"},ne={class:"list-disc list-outside pl-4 space-y-1"},le={class:"text-slate-500"},ie={class:"mt-2 flex justify-end"},re=C({__name:"MostFrequentLandmarksSection",setup(y){const{displayLandmarks:o,displayLandscapeAnalysis:m,isLoadingLandmarks:h}=V(),u=L({}),p=L(!1),n=async s=>{var a;if(s&&u.value[s]==null)try{const e=await S.get(`/landmarks/${s}`),l=Array.isArray((a=e.data)==null?void 0:a.related_elements)?e.data.related_elements:[];u.value[s]=l.length}catch(e){console.error(`Error loading related elements count for landmark ${s}:`,e),u.value[s]=0}},c=$(()=>[...o.value].sort((s,a)=>{const e=u.value[s.id]??0,l=u.value[a.id]??0;if(e!==l)return l-e;const _=new Date(s.created_at||0).getTime();return new Date(a.created_at||0).getTime()-_})),f=$(()=>c.value.slice(0,4)),v=s=>u.value[s]??0;return T(()=>o.value.map(s=>s.id).join(","),async()=>{if(o.value.length!==0){p.value=!0;try{await Promise.all(o.value.map(s=>n(s.id)))}finally{p.value=!1}}},{immediate:!0}),(s,a)=>{var l;const e=I("router-link");return i(),d("section",ee,[w(m)?w(h)||p.value?(i(),d("div",se," Chargement... ")):f.value.length===0?(i(),d("div",ae," Aucun landmark ")):(i(),d("div",oe,[t("ul",ne,[(i(!0),d(H,null,q(f.value,_=>(i(),d("li",{key:_.id,class:"text-slate-300 marker:text-slate-500"},[x(e,{to:`/app/landmarks/${_.id}`,class:"text-xs leading-[0.95rem] text-slate-200 hover:text-slate-100 transition-colors whitespace-normal break-words"},{default:b(()=>[t("span",null,j(_.title||"Sans titre"),1),t("span",le," ("+j(v(_.id))+" éléments)",1)]),_:2},1032,["to"])]))),128))]),t("div",ie,[(l=w(m))!=null&&l.id?(i(),E(e,{key:0,to:{name:"analysis",query:{id:w(m).id,tab:"compare"}},class:"text-xs text-slate-400 underline hover:text-slate-200 transition-colors"},{default:b(()=>[g(" voir plus ")]),_:1},8,["to"])):k("",!0)])])):(i(),d("div",te," Aucune analyse courante "))])}}}),ce={key:0,class:"flex items-center"},de=["title"],ue={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center p-40"},me={class:"relative z-10 w-[min(98vw,1600px)] max-h-[95vh] overflow-auto"},pe={class:"rounded-2xl border border-slate-700 bg-slate-900 p-4 shadow-2xl"},_e={key:0,class:"text-lg font-semibold text-slate-200"},fe={class:"flex items-center gap-3"},xe={key:0,class:"text-xs text-slate-500"},ve=C({__name:"HeatmapSection",props:{compact:{type:Boolean,default:!1},compactWeeksLimit:{default:25},frameless:{type:Boolean,default:!1},title:{default:"Activité"}},setup(y){const o=y,{user:m}=N(),{launchSnackbar:h}=G(),u=L(!1),p=L([]),n=L(!1),c=$(()=>p.value.length===0?0:Math.max(...p.value.map(a=>a.value||0))),f=()=>{o.compact&&(n.value=!0)},v=()=>{n.value=!1},s=async()=>{var a;if((a=m.value)!=null&&a.id){u.value=!0;try{const e=await S.get(`/users/${m.value.id}/heatmaps`);p.value=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Error fetching heatmaps:",e),h(`Error loading heatmap: ${e}`,"error"),p.value=[]}finally{u.value=!1}}};return R(async()=>{await s()}),(a,e)=>a.compact?(i(),d("div",ce,[t("button",{type:"button",class:B(["transition-colors",o.frameless?"p-0 border-0 bg-transparent rounded-none hover:bg-transparent":"rounded-lg border border-slate-700 bg-slate-900/60 p-2.5 hover:border-slate-500"]),title:o.title?`Voir la heatmap ${o.title}`:"Voir la heatmap",onClick:f},[x(P,{compact:"",days:p.value,loading:u.value,title:o.title,"empty-text":"Aucune donnée","month-locale":"fr-FR","hide-first-compact-month-label":!0,"compact-weeks-limit":o.compactWeeksLimit},null,8,["days","loading","title","compact-weeks-limit"])],10,de),(i(),E(J,{to:"body"},[n.value?(i(),d("div",ue,[t("div",{class:"absolute inset-0 bg-slate-950/70",onClick:v}),t("div",me,[t("div",pe,[t("div",{class:B(["flex items-center mb-3",o.title?"justify-between":"justify-end"])},[o.title?(i(),d("h2",_e,j(o.title),1)):k("",!0),t("div",fe,[c.value>0?(i(),d("div",xe,"Max: "+j(c.value),1)):k("",!0),t("button",{type:"button",class:"text-xs px-2 py-1 rounded border border-slate-600 text-slate-300 hover:bg-slate-800",onClick:v}," Fermer ")])],2),x(P,{days:p.value,loading:u.value,title:o.title,"show-max":!1,"empty-text":"Aucune donnée","month-locale":"fr-FR"},null,8,["days","loading","title"])])])])):k("",!0)]))])):(i(),d("div",{key:1,class:B(o.frameless?"":"rounded-2xl border border-slate-800 bg-slate-900/60 p-4")},[x(P,{days:p.value,loading:u.value,title:o.title,"empty-text":"Aucune donnée","month-locale":"fr-FR"},null,8,["days","loading","title"])],2))}}),A=y=>(U("data-v-1f45722a"),y=y(),z(),y),he={class:"min-h-screen text-slate-100 p-2 md:p-6 md:w-11/12 mx-auto"},ye={class:"flex justify-between items-center mb-4"},ge=A(()=>t("h1",{class:"text-2xl font-bold"},"Mon studio",-1)),be={class:"flex items-center gap-3"},we={class:"flex flex-col gap-4"},$e={class:"rounded-xl border border-slate-800",style:{"background-color":"rgb(32, 32, 32)"}},Le={class:"flex flex-col xl:flex-row"},je={class:"flex-1 p-3 md:p-4 xl:min-h-[170px]"},ke={class:"text-lg font-semibold text-slate-200 mb-2"},Ae={class:"flex items-start gap-2 font-inter"},Se=["src","alt"],Ce={class:"text-xs leading-4 text-slate-300 whitespace-pre-line"},Ee={class:"mt-4 flex justify-end"},Me={class:"flex-1 border-t xl:border-t-0 xl:border-l border-slate-800 p-3 md:p-4 xl:min-h-[170px] font-inter"},Be=A(()=>t("div",{class:"text-lg font-semibold text-slate-200 mb-2"}," Tes grands projets ",-1)),Pe={class:"space-y-1.5 text-xs leading-4 text-slate-300"},Te={class:"grid grid-cols-1 xl:grid-cols-3 gap-8 px-3"},Ie={class:"col-span-1"},Ve={class:"mb-4 font-inter"},Fe=A(()=>t("div",{class:"mb-1 flex items-center justify-between gap-3"},[t("h2",{class:"text-lg font-semibold text-slate-300"},"Métriques")],-1)),He={class:"mt-1 w-fit"},qe={class:"mt-2 flex justify-end"},Ne=A(()=>t("div",{class:"flex items-center justify-between gap-3"},[t("h2",{class:"text-lg font-semibold text-slate-300"},"Activité récente")],-1)),Re=A(()=>t("div",{class:"mt-4 flex items-center justify-between gap-3"},[t("h2",{class:"text-lg font-semibold text-slate-300"},"Les plus utilisés")],-1)),Je={class:"col-span-2"},Ge=C({__name:"HomePage",setup(y){const{user:o}=N(),{displayLandscapeAnalysis:m,displayLandmarks:h,loadUserLenses:u}=V(),p=$(()=>{var e;const s=(e=m.value)==null?void 0:e.id,a={tab:"compare"};return s&&(a.id=s),{name:"analysis",query:a}}),n=$(()=>{var e;const s=(e=m.value)==null?void 0:e.id,a={tab:"timeline"};return s&&(a.id=s),{name:"analysis",query:a}}),c={name:"Gon",image:"https://i.pinimg.com/originals/93/d7/e8/93d7e8cb60b17a0d12ac40e26f71064e.jpg"},f=$(()=>{var a,e;return[`Bonjour ${((e=(a=o.value)==null?void 0:a.first_name)==null?void 0:e.trim())||"toi"}-San !`,"Bienvenue sur Matière Grise, je suis si content de te voir ici ! Je suis Gon, ton mentor. Je suis ici pour t'aider à progresser dans tes projets. L'important c'est de s'amuser et de relever des défis. Ensemble, on va soulever des montagnes !","Hoooooosss !!!"].join(`
`)}),v=$(()=>{const s=h.value.filter(e=>String((e==null?void 0:e.landmark_type)??(e==null?void 0:e.landmarkType)??"").trim().toUpperCase()==="HIGH_LEVEL_PROJECT").slice(0,2);if(s.length===0)return[{id:null,text:"Partant.e pour travailler sur tes grands projets ??"}];const a=s.map(e=>{const l=typeof(e==null?void 0:e.id)=="string"?e.id:null,_=String((e==null?void 0:e.title)??"").trim(),r=String((e==null?void 0:e.content)??"").trim();return _&&r&&r!==_?{id:l,text:`${_}
${r}`}:_?{id:l,text:_}:r?{id:l,text:r}:{id:l,text:""}}).filter(e=>e.text.length>0);return a.length>0?a:[{id:null,text:"Partant.e pour travailler sur tes grands projets ??"}]});return T(()=>{var s;return(s=o.value)==null?void 0:s.id},async s=>{s&&await u()},{immediate:!0}),(s,a)=>{const e=I("router-link");return i(),d("div",he,[t("div",ye,[ge,t("div",be,[x(e,{to:{name:"journalPad"},class:"text-sm underline text-slate-300 hover:text-slate-100 transition-colors"},{default:b(()=>[g(" Continuer le journal ")]),_:1}),x(e,{to:p.value,class:"text-sm underline text-slate-300 hover:text-slate-100 transition-colors"},{default:b(()=>[g(" Analyse > ")]),_:1},8,["to"])])]),t("div",we,[t("section",$e,[t("div",Le,[t("article",je,[t("div",ke," Message de ton mentor "+j(c.name),1),t("div",Ae,[t("img",{src:c.image,alt:`Mentor ${c.name}`,class:"w-9 h-9 rounded-lg object-cover flex-none"},null,8,Se),t("span",Ce,j(f.value),1)]),t("div",Ee,[x(e,{to:"/app/mentor",class:"text-xs underline text-slate-400 hover:text-slate-100 transition-colors"},{default:b(()=>[g(" Voir 4 autres messages ")]),_:1})])]),t("article",Me,[Be,t("ul",Pe,[(i(!0),d(H,null,q(v.value,l=>(i(),d("li",{key:l.id??l.text,class:"whitespace-pre-line"},[g(" • "+j(l.text)+" ",1),l.id?(i(),E(e,{key:0,to:{name:"seeLandmark",params:{id:l.id}},class:"ml-1 underline text-slate-400 hover:text-slate-200 transition-colors"},{default:b(()=>[g(" voir plus ")]),_:2},1032,["to"])):k("",!0)]))),128))])])])]),t("div",Te,[t("div",Ie,[t("section",Ve,[Fe,t("div",He,[x(ve,{compact:"","compact-weeks-limit":22,frameless:!0,title:null})]),t("div",qe,[x(e,{to:n.value,class:"text-xs text-slate-400 underline hover:text-slate-200 transition-colors"},{default:b(()=>[g(" voir plus ")]),_:1},8,["to"])])]),Ne,x(Z),Re,x(re)]),t("div",Je,[x(W,{class:"mb-10"})])])])])}}});const Xe=D(Ge,[["__scopeId","data-v-1f45722a"]]);export{Xe as default};
