import{j as L,d as P,b as u,h as T,o as n,f as i,i as s,k as E,c as C,w as F,l as N,m as r,n as A,a as d,p as B,_ as j,q as K,u as O}from"./index-b043677b.js";import{_,a as f}from"./ActionButton.vue_vue_type_script_setup_true_lang-f035e1ec.js";import{_ as S}from"./UserPicker.vue_vue_type_script_setup_true_lang-21822d8d.js";import{_ as q}from"./SelectionTextInterface.vue_vue_type_script_setup_true_lang-0506384c.js";import"./SelectionTextInterface.vue_vue_type_style_index_0_lang-4ef3bee6.js";import{u as G}from"./useResource-2d02989f.js";import{u as W}from"./useFileConverter-a57749ce.js";async function z(x){return(await L.post("/link_preview",x)).data}function H(){return{postLinkPreview:z}}const J=P({__name:"ExternalResourcePreview",emits:["change"],setup(x,{emit:o}){const{postLinkPreview:g}=H(),y=async()=>{const m=await g({external_content_url:c.value});console.log(m),e.value=c.value,o("change",m)},c=u(""),e=u(""),b=T(()=>e.value!==c.value);return(m,V)=>(n(),i("div",null,[s(_,{modelValue:c.value,"onUpdate:modelValue":V[0]||(V[0]=k=>c.value=k),class:"mb-4",onKeyup:E(y,["enter"]),label:"Lien ressource externe"},null,8,["modelValue","onKeyup"]),b.value?(n(),C(f,{key:0,class:"mb-4",text:"Preview",onClick:y,type:"valid"},{default:F(()=>[N("Générer")]),_:1})):r("",!0)]))}}),M={class:"mt-10 mx-5"},Q={key:0},X={key:1},Y={key:2},Z=d("div",null,"Optionnel : ajouter le contenu à partir d'un fichier La-tex",-1),ee={key:1},te=["src"],le={key:0},ae=d("div",{class:"text-2xs text-slate-800"},"Text formaté",-1),se=P({__name:"CreateResourceProcess",setup(x){const o=u(0),{newResource:g,createResource:y,resourceTypeOptions:c}=G(),e=u({id:"",title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"",maturing_state:"",image_url:"",resource_type:"",comment:"",is_local_draft:!0,is_external:!1}),b=a=>{p.value=a,a?(o.value=1,e.value.maturing_state="fnsh",e.is_external=!0):(v.value=k.value.id,e.value.maturing_state="drft",e.is_external=!1,o.value=1,w.value=new Date(Date.now()).toISOString().split("T")[0])},{postFileConversion:m}=W(),V=async a=>{const t=a.target.files[0],l=new FormData;l.append(t.name,t);const h=await m(l);e.value.content=h.content,e.value.title=h.name},{user:k}=K(),v=u(null),w=u(null),p=u(!1),R=u(!1),$=a=>{console.log("apply preview : ",a),e.value.title=a.title,e.value.subtitle=a.subtitle,e.value.image_url=a.image_url,e.value.content=a.content,e.value.resource_type=a.resource_type,e.value.external_content_url=a.external_content_url,R.value=!0},{createInteractionForResource:U,newInteraction:oe}=O(),D=A(),I=async()=>{const a=await y(e.value),t={interaction_user_id:v.value,resource_id:a.id,interaction_progress:p?100:0,interaction_date:new Date(w.value),interaction_comment:"",interaction_is_public:!!p.value};await U(a.id,t),D.push({path:"/resources/"+a.id,query:{editing:"false"}})};return(a,t)=>(n(),i("div",M,[o.value===0?(n(),i("div",Q,[d("div",null,[s(f,{class:"mb-2",text:"Resource Externe",type:"valid",onClick:t[0]||(t[0]=l=>b(!0))}),s(f,{text:"Production personnelle",type:"valid",onClick:t[1]||(t[1]=l=>b(!1))})])])):r("",!0),o.value===1?(n(),i("div",X,[s(S,{class:"mb-4",modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=l=>v.value=l)},null,8,["modelValue"]),v.value?(n(),C(_,{key:0,class:"text-2xs mb-4",label:"Date d'écriture","model-value":w.value,"onUpdate:modelValue":t[3]||(t[3]=l=>w.value=l),type:"date"},null,8,["model-value"])):r("",!0),s(f,{type:"valid",text:"Valider",onClick:t[4]||(t[4]=l=>o.value=2)})])):r("",!0),o.value===2?(n(),i("div",Y,[d("div",null,[p.value?(n(),C(J,{key:0,onChange:t[5]||(t[5]=l=>$(l))})):r("",!0),Z,d("input",{id:"file",type:"file",onChange:V,placeholder:"Ajouter depuis un fichier"},null,32),!p.value||R.value?(n(),i("div",ee,[s(_,{class:"mb-4",modelValue:e.value.title,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.title=l),label:"Titre"},null,8,["modelValue"]),s(_,{class:"mb-4",modelValue:e.value.subtitle,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.subtitle=l),label:"Description"},null,8,["modelValue"]),s(_,{class:"mb-4",modelValue:e.value.image_url,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.image_url=l),label:"Url de l'image"},null,8,["modelValue"]),d("img",{class:"mb-4",src:e.value.image_url},null,8,te),s(j,{label:"Type de ressource",class:"mb-4",choices:B(c),modelValue:e.value.resource_type,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.resource_type=l)},null,8,["choices","modelValue"]),e.value.content!==""?(n(),i("div",le,[ae,s(q,{class:"max-h-40 overflow-scroll border border-slate-400 mb-4 p-2 rounded",type:"textarea",text:e.value.content},null,8,["text"])])):r("",!0),s(f,{class:"mb-4",text:"Créer",onClick:I,type:"valid"})])):r("",!0)])])):r("",!0)]))}}),ne={class:"w-full"},pe=P({__name:"CreateResourceView",setup(x){return(o,g)=>(n(),i("div",ne,[s(se)]))}});export{pe as default};
