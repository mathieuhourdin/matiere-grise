import{o as l,c as m,f as n,d as V,r as d,l as w,t as C,u as R,i as _,h as i,_ as $,e as S,m as E,n as H,F as ee,p as te,q as G,s as oe,v as M,x as se,w as T,y as N,a as q,z as le,A as ue,B as z}from"./index-a6212284.js";import{a as J,b as ae,c as ne,_ as re}from"./ArticleForm.vue_vue_type_script_setup_true_lang-f89c6b76.js";import{_ as K,a as ie}from"./ThoughtInputsList.vue_vue_type_script_setup_true_lang-67196faa.js";import{u as de}from"./useThoughtInputs-99c314d9.js";import{u as Q,a as ce}from"./useThoughtOutput-a4a32747.js";import{_ as pe,u as me}from"./TextInterface.vue_vue_type_script_setup_true_lang-f7898447.js";import{_ as B}from"./TextInput.vue_vue_type_script_setup_true_lang-2ec16d35.js";function ve(f,c){return l(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}const he={key:1},ge={class:"flex flex-row-reverse"},_e=V({__name:"CreateThoughtInputUsageForm",props:{thoughtOutput:{}},emits:["close","refresh"],setup(f,{emit:c}){const v=f,{user:b}=S(),h=d([]),r=d(null),s=d(""),{createThoughtInputUsage:u}=Q(),t=async()=>{console.log("create");const y={thought_output_id:v.thoughtOutput.id,thought_input_id:r.value.id,usage_reason:s.value};await u(y),c("refresh"),c("close")},{getUserThoughtInputs:x}=de(),U=y=>{r.value=y};return w(async()=>h.value=await x(b.value.id)),(y,g)=>(l(),m("div",null,[n("div",null,C(R(b).first_name),1),r.value?(l(),m("div",he,[i(J,{label:"Pourquoi ajouter cet élément ?",modelValue:s.value,"onUpdate:modelValue":g[1]||(g[1]=e=>s.value=e)},null,8,["modelValue"]),n("div",ge,[i($,{type:"valid",onClick:t,text:"Ajouter"}),i($,{type:"abort",onClick:g[2]||(g[2]=e=>c("close")),text:"Ajouter"})])])):(l(),_(K,{key:0,"thought-inputs":h.value,center:"",onSelect:g[0]||(g[0]=e=>U(e))},null,8,["thought-inputs"]))]))}}),fe={class:"mx-auto flex flex-wrap max-w-full"},be=V({__name:"ToggleButtonGroup",props:{choices:{},default:{}},setup(f){const c=f,v=d(null),b=E(),h=H(),r=s=>{v.value=s;const u=h.query,t=h.path;b.push({path:t,query:{...u,tab:s}}),console.log(`route : ${JSON.stringify(h)}`)};return w(()=>r(c.default)),(s,u)=>(l(),m("div",fe,[(l(!0),m(ee,null,te(s.choices,t=>(l(),_($,{key:t.value,class:"w-24 mx-auto my-1 md:mx-1",text:t.text,onClick:x=>r(t.value),type:t.value==v.value?"valid":"abort"},null,8,["text","onClick","type"]))),128))]))}}),ye={class:"flex"},xe={class:"ml-auto h-6 m-4 w-1/3"},ke={class:"flex"},Ce=V({__name:"ProblemForm",props:{problem:{}},emits:["change"],setup(f,{emit:c}){const v=f,{categories:b}=oe(),h=G(()=>b.value.map(s=>({text:s.display_name,value:s.id}))),r=(s,u)=>{let t={...v.problem};t[s]=u,c("change",t)};return(s,u)=>(l(),m("div",null,[i(B,{label:"Titre",modelValue:s.problem.title,"onUpdate:modelValue":u[0]||(u[0]=t=>r("title",t))},null,8,["modelValue"]),i(B,{class:"h-6",label:"Description",modelValue:s.problem.description,"onUpdate:modelValue":u[1]||(u[1]=t=>r("description",t))},null,8,["modelValue"]),n("div",ye,[i(ae,{class:"mr-auto h-6",label:"Progression",modelValue:s.problem.progress,"onUpdate:modelValue":u[2]||(u[2]=t=>r("progress",t))},null,8,["modelValue"]),n("div",xe,[i(ne,{label:"Catégorie",choices:h.value,"model-value":s.problem.category_id,"onUpdate:modelValue":u[3]||(u[3]=t=>r("category_id",t))},null,8,["choices","model-value"])])]),n("div",ke,[i(B,{class:"h-6",label:"Lien image",modelValue:s.problem.image_url,"onUpdate:modelValue":u[4]||(u[4]=t=>r("image_url",t))},null,8,["modelValue"])])]))}}),$e={key:0,class:"px-8 mx-auto"},Te={key:0},we={class:"my-8"},Ve=["src"],Ue={class:"text-3xl my-3 font-mplus md:text-center text-left"},Oe={class:"md:text-center text-left"},Ie={class:"md:text-center text-left"},Ae={class:"md:flex my-8"},qe=["href"],Be={key:1},je={class:"flex flex-row-reverse"},Fe={key:1,class:"p-2 border rounded bg-neutral-100"},Pe=n("hr",{class:"border-top border-zinc-400 my-4"},null,-1),De={key:2},Le={key:3},Ge=V({__name:"SeeArticle",props:{id:{}},setup(f){const c=f,v=H(),b=d([{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli"}]),h=d(v.query.tab??"ctnt"),r=d(null);M(()=>v.query.tab,a=>{console.log("new route query",a),r.value=a});const{getThoughtInputUsagesForThoughtOutput:s}=Q(),u=d([]),t=d(!1),x=async()=>{const a=await s(z(c).id.value);u.value=a.map(o=>({...o.thought_input,usage_reason:o.usage_reason}))};w(()=>x());const{getThoughtOutput:U,updateThoughtOutput:y}=ce(),g=d(null),e=d(null),W=E();M(()=>v.query.editing,a=>{console.log("Editing : ",a),O.value=a==="false"?!1:!!a});const O=d(!1),j=a=>{W.push({query:{editing:a}})},X=()=>{e.value.publishing_state="pbsh",y(e.value.id,e.value)},I=(a,o)=>{e.value=o,clearTimeout(g.value),g.value=setTimeout(async()=>{try{await y(a,e.value)}catch(A){console.log("An error : ",A)}},1e3)},F=a=>{a!=`
`&&I(z(c).id.value,{...e.value,content:a})},{user:P,getUserById:Y}=S(),D=G(()=>P.value?e.value.author_id==P.value.id:!1),k=d(null),{getCommentsForThoughtOutput:Z}=me(),L=d([]);return w(async()=>{e.value=await U(c.id),L.value=await Z(c.id),k.value=await Y(e.value.author_id);const a=v.query.editing;O.value=a==="false"?!1:!!a}),(a,o)=>{const A=se("router-link");return e.value?(l(),m("div",$e,[O.value?(l(),m("div",Be,[e.value.output_type=="atcl"?(l(),_(re,{key:0,article:e.value,onChange:o[1]||(o[1]=p=>I(e.value.id,p))},null,8,["article"])):(l(),_(Ce,{key:1,problem:e.value,onChange:o[2]||(o[2]=p=>I(e.value.id,p))},null,8,["problem"])),n("div",je,[i($,{class:"mx-4",onClick:o[3]||(o[3]=p=>j(!1)),type:"valid",text:"Preview"},{default:T(()=>[N("Ok")]),_:1}),e.value.publishing_state=="drft"?(l(),_($,{key:0,onClick:X,type:"valid",text:"Publier"})):(l(),m("div",Fe,"Publié"))])])):(l(),m("div",Te,[n("div",we,[n("img",{src:e.value.image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto"},null,8,Ve)]),n("h1",Ue,C(e.value.title),1),n("div",Oe,C(e.value.description),1),n("div",Ie,[k.value?(l(),_(A,{key:0,to:"/users/"+k.value.id,class:"text-sm underline"},{default:T(()=>[N(C(k.value.first_name)+" "+C(k.value.last_name),1)]),_:1},8,["to"])):q("",!0)]),D.value?(l(),_(le,{key:0,onClick:o[0]||(o[0]=p=>j(!0))},{default:T(()=>[i(R(ve),{class:"m-1"})]),_:1})):q("",!0),n("div",Ae,[i(ue,{"progress-value":e.value.progress,class:"m-2 w-1/3"},null,8,["progress-value"]),n("a",{class:"ml-auto underline",href:e.value.gdoc_url}," Ajouter un commentaire ",8,qe)])])),n("div",null,[i(be,{choices:b.value,default:h.value},null,8,["choices","default"])]),Pe,r.value=="ctnt"?(l(),m("div",De,[e.value.publishing_state!="drft"?(l(),_(pe,{key:0,"ext-comments":L.value,"ressource-id":e.value.id,"full-text":e.value.content,editable:D.value,onChange:o[4]||(o[4]=p=>F(p))},null,8,["ext-comments","ressource-id","full-text","editable"])):(l(),_(J,{key:1,class:"h-96",label:"Contenu",modelValue:e.value.content,"onUpdate:modelValue":o[5]||(o[5]=p=>F(p))},null,8,["modelValue"]))])):(l(),m("div",Le,[i(ie,{open:t.value,onClose:o[7]||(o[7]=p=>t.value=!1)},{default:T(()=>[i(_e,{onRefresh:x,onClose:o[6]||(o[6]=p=>t.value=!1),"thought-output":e.value},null,8,["thought-output"])]),_:1},8,["open"]),n("div",{onClick:o[8]||(o[8]=p=>t.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),i(K,{"thought-inputs":u.value},null,8,["thought-inputs"])]))])):q("",!0)}}});export{Ge as default};
