import{o as n,f as l,a as s,d as F,b as _,h as y,e as I,r as M,t as u,G as B,c as k,i as m,w,l as R,n as A,L as N,q as $,m as T,F as z,g as S,x as V}from"./index-ec4c61f7.js";import{u as P}from"./useResource-48de91c0.js";import{u as H}from"./useResourceRelations-70a41ec9.js";const U=a=>{if(!a||a==="")return[];const t=a.replace(/\?/g,"?.").split(".");let r=0;const i=[];for(;r<t.length;){let o=0,d=[];if(t[r].length>=270)i.push(t[r].replace("/?./g","?")),r++;else{for(;r<t.length&&o+t[r].length<270;)d.push(t[r]),o+=t[r].length,r++;i.push(d.join(". ").replace("/?./g","?"))}}return i},q=a=>a?a.split(`
`).map(r=>U(r)).flat():[],L={splitTextForPanel:q};function D(a,t){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function E(a,t){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})])}function G(a,t){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}const O=["src"],J={key:1,class:"bg-white h-full text-center flex items-center justify-center"},K={class:"text-2xl text-black"},Q={class:"text-lg text-bold mt-2"},W={class:"text-bold mb-2"},X={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},Y={key:1},Z={key:1},ee=F({__name:"FeedCardTextInterface",props:{interaction:{}},setup(a){const t=a,r=e=>{if(e>0&&e<=h.value.length){const c=h.value[e-1];return{text:c.replace(/#/g,""),header:e===1?"Commentaire : ":null,class:{"font-black":c.charAt(0)==="#","bg-gray-700":!0}}}else{const c=f.value[e-h.value.length-1];return{text:c?c.replace(/#/g,""):"",header:e===h.value.length+1?"Contenu : ":null,class:{"font-black":c&&c.charAt(0)==="#","bg-slate-700":!0}}}},i=_(0),o=()=>{i.value=(i.value+1)%p.value},d=y(()=>`${i.value+1}/${p.value}`),p=y(()=>h.value.length+f.value.length+1),f=y(()=>L.splitTextForPanel(t.interaction.resource.content)),h=y(()=>L.splitTextForPanel(t.interaction.context_comment)),b=()=>{if(t.interaction.interaction_type!="inpt"&&t.interaction.resource.image_url!==""){const e=g.value.offsetHeight;g.value.style.height=`${e}px`}},{getAuthorInteractionForResource:C}=P(),v=_(null),g=_(null);return I(async()=>{t.interaction.interaction_type!="inpt"&&t.interaction.resource.image_url===""&&(g.value.style.height="500px");const e=await C(t.interaction.resource.id);e&&(e.resource=t.interaction.resource,e.user_id=e.interaction_user_id,v.value=e)}),(e,c)=>{const x=M("router-link");return e.interaction.interaction_type!="inpt"?(n(),l("div",{key:0,onClick:o,class:"overflow-auto relative w-full md:h-4/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:g},[i.value==0&&e.interaction.resource.image_url!==""?(n(),l("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:e.interaction.resource.image_url,onLoad:b},null,40,O)):i.value==0?(n(),l("div",J,[s("div",null,[s("div",K,u(e.interaction.resource.title),1),s("div",Q,u(e.interaction.resource.subtitle),1)])])):(n(),l("div",{key:2,class:B(["h-full overflow-scroll p-1 pb-16 border flex items-center justify-center",r(i.value).class])},[s("div",{class:B([r(i.value).class,"text-center text-sm my-auto text-white"])},[s("div",null,[s("div",W,u(r(i.value).header),1),s("div",null,u(r(i.value).text),1)])],2)],2)),s("div",X,u(d.value),1)],512)):(n(),l("div",Y,[v.value?(n(),k(j,{key:0,interaction:v.value,class:"mx-1.5 h-96"},null,8,["interaction"])):(n(),l("div",Z,[m(x,{to:"/resources/"+e.interaction.resource.id},{default:w(()=>[R(u(e.interaction.resource.title),1)]),_:1},8,["to"])]))]))}}}),te={class:"flex flex-col border py-1.5 overflow-auto"},re={class:"flex ml-1.5"},oe={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},ne={key:0,class:"flex ml-1.5"},se={title:"Coming Soon ;)",class:"w-6"},ie={title:"Coming Soon ;)",class:"w-6"},ae={key:1,class:"flex ml-1.5"},le={class:"text-2xs"},ce={class:""},ue={class:"mb-2 font-bold text-sm"},de={class:"text-2xs mb-auto"},j=F({__name:"FeedCard",props:{interaction:{}},setup(a){const t=a,r=e=>e==="outp"?"Production personnelle":"Bibliographie",{resourceTypeOptions:i}=P(),o=e=>i.find(c=>c.value===e).text;_(null);const d=_(null),p=e=>e?e.length>200?e.slice(0,150)+"...":e:"",f=_([]),{getResourceRelationsForResource:h}=H(),b=async()=>{t.interaction.id&&(f.value=await h(t.interaction.resource.id))},{getUserById:C}=A(),v=_(!1),g=async()=>{try{d.value=await C(t.interaction.user_id)}catch(e){console.log(e)}v.value=!0};return I(async()=>{await b(),await g()}),(e,c)=>{const x=M("router-link");return n(),l("div",te,[s("div",re,[v.value?(n(),k(N,{key:0,class:"flex mb-1.5 h-8",user:d.value,firstBottomText:r(e.interaction.interaction_type),secondBottomText:e.$t(o(e.interaction.resource.resource_type))},null,8,["user","firstBottomText","secondBottomText"])):(n(),l("div",oe))]),m(ee,{interaction:e.interaction},null,8,["interaction"]),e.interaction.interaction_type!="inpt"?(n(),l("div",ne,[s("div",se,[m($(E),{class:"w-full my-auto"})]),s("div",ie,[m($(G),{class:"w-full my-auto"})]),m(x,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto"},{default:w(()=>[m($(D),{class:"w-8"})]),_:1},8,["to"])])):T("",!0),e.interaction.interaction_type!="inpt"?(n(),l("div",ae,[s("div",le,u(Math.floor(Math.random()*100))+" likes",1),m(x,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:w(()=>[R(u(f.value.length)+" relations ",1)]),_:1},8,["to"])])):T("",!0),e.interaction.interaction_type!="inpt"?(n(),k(x,{key:2,class:"ml-1.5",to:"/resources/"+e.interaction.resource.id},{default:w(()=>[s("div",ce,[s("div",ue,u(e.interaction.resource.title),1),s("div",de,u(p(e.interaction.resource.subtitle)),1)])]),_:1},8,["to"])):T("",!0)])}}}),pe={class:"flex flex-col"},fe=F({__name:"FeedList",props:{interactionsList:{}},setup(a){const t=a,{feedFilter:r}=V(),i=y(()=>t.interactionsList.filter(o=>r.value==="production"?o.interaction_type==="outp"&&!o.resource.is_external&&o.resource.resource_type!=="pblm"&&!o.resource.is_external:r.value==="draft"?o.interaction_type==="outp"&&!o.resource.is_external&&(o.resource.maturing_state==="drft"||o.resource.maturing_state==="rvew"):r.value==="reviews"?o.interaction_type==="rvew":r.value==="problem"?o.resource.resource_type==="pblm":r.value==="biblio"?o.interaction_type==="inpt":o.interaction_type==="inpt"||!o.resource.is_external));return(o,d)=>(n(),l("div",pe,[(n(!0),l(z,null,S(i.value,(p,f)=>(n(),k(j,{class:"md:mb-2 md:mx-1 flex-grow md:rounded max-h-screen border-t-1 border-black",interaction:p,key:p.id},null,8,["interaction"]))),128))]))}});export{fe as _};
