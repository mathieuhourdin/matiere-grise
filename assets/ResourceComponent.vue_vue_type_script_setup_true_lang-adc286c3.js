import{o as a,c as d,i as r,d as I,t as w,F as me,j as pe,r as v,q as U,g as A,k as u,e as q,z as Be,x as ne,A as z,m as Oe,B as Le,C as Pe,a as k,s as ke,p as R,w as S,h as Y,D as $e,E as Ee,G as T,H as Ve,u as M,I as Re,n as J,J as Ne,K as Me,L as qe,v as je,l as ze,f as He,y as ce}from"./index-02516f21.js";import{_ as de,a as be,u as Ce}from"./TextInterface.vue_vue_type_script_setup_true_lang-3274799e.js";import{_ as N}from"./TextInput.vue_vue_type_script_setup_true_lang-171da8b7.js";import{u as ve}from"./useResource-b69f0800.js";import{a as Je,u as Ie}from"./useProblem-298c3115.js";function Ke(n,e){return a(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 8.25H7.5a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25H15M9 12l3 3m0 0l3-3m-3 3V2.25"})])}function We(n,e){return a(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}function Ge(n,e){return a(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z"})])}const Qe={class:"block text-2xs text-slate-800"},Xe=["value"],Ye=["value"],H=I({__name:"SelectInput",props:{label:{},choices:{},modelValue:{},displayFunction:{type:Function,default:n=>n.text}},emits:["update:modelValue"],setup(n,{emit:e}){const t=o=>{console.log(o.target.value),e("update:modelValue",o.target.value)};return(o,l)=>(a(),d("div",null,[r("label",Qe,w(o.label),1),r("select",{value:o.modelValue,name:"Stade d'écriture",class:"text-xs w-full p-1 block rounded border-2 border-neutral-400",onInput:l[0]||(l[0]=i=>t(i))},[(a(!0),d(me,null,pe(o.choices,i=>(a(),d("option",{key:i.value,value:i.value},w(o.displayFunction(i)),9,Ye))),128))],40,Xe)]))}}),Ze={class:"m-4"},et={class:"block text-2xs text-slate-800"},tt=["value","placeholder"],Z=I({__name:"TextAreaInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue"],setup(n,{emit:e}){const t=o=>{e("update:modelValue",o.target.value)};return(o,l)=>(a(),d("div",Ze,[r("label",et,w(o.label),1),r("textarea",{class:"border border-neutral-800 block h-full w-full",value:o.modelValue,placeholder:o.placeholder,onInput:l[0]||(l[0]=i=>t(i))},null,40,tt)]))}}),ot=r("hr",{class:"border-top border-zinc-400 my-4"},null,-1),nt=r("div",{class:"text-xs italic"},"Raison de la lecture",-1),st=I({__name:"SeeThoughtInput",props:{thoughtInput:{}},setup(n){const e=n,{getUserById:t,user:o}=q(),l=v(null),i=U(()=>o.value?e.thoughtInput.interaction_user_id===o.value.id:!1);return A(async()=>{e.thoughtInput.interaction_user_id&&(l.value=await t(e.thoughtInput.interaction_user_id))}),(g,m)=>(a(),d("div",null,[u(Uo,{id:g.thoughtInput.resource_id,"second-level":""},null,8,["id"]),ot,nt,u(de,{"full-text":g.thoughtInput.interaction_comment,editable:i.value},null,8,["full-text","editable"])]))}}),at={class:"flex"},oe=I({__name:"ModalSheet",props:{open:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,o=v(!1);return A(()=>{o.value=t.open}),Be(()=>{const l=i=>{(i.key==="Escape"||i.key==="Enter"||i.key==="Esc"||i.keyCode===27)&&e("close")};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}}),ne(z(t).open,l=>o.value=l),(l,i)=>o.value?(a(),d("div",{key:0,tabindex:"0",onKeyup:i[2]||(i[2]=Pe(g=>e("close"),["esc"])),class:"fixed top-0 left-0 w-full h-full z-10 bg-slate-500/50",onClick:i[3]||(i[3]=g=>e("close"))},[r("div",{class:"max-w-xl overflow-y-scroll max-h-screen mb-10 bg-white mx-auto mt-6 p-4 rounded shadow",onClick:i[1]||(i[1]=Le(()=>{},["stop"]))},[r("div",at,[r("div",{class:"ml-auto",onClick:i[0]||(i[0]=g=>e("close"))},"x")]),Oe(l.$slots,"default")])],32)):k("",!0)}}),lt={class:"w-full md:w-96"},rt={key:0,class:"text-xs italic mb-2"},ut={class:"flex flex-wrap"},it={key:1,class:"text-2xs italic ml-2"},ct={key:2,class:"ml-auto m-1 w-1/3"},dt={key:0,class:"border shadow-lg rounded p-4 md:w-96"},mt={class:"flex"},pt=["src"],vt={class:"flex flex-wrap w-full",style:{"margin-top":"-8px"}},_t={class:"text-2xs"},gt={class:"flex flex-wrap"},ft={key:0,class:"text-2xs italic"},ht=I({__name:"ThoughtInputCard",props:{contextualResource:{}},setup(n){const e=n,{getUserById:t}=q(),{getAuthorInteractionForResource:o}=ve(),l=v(null),i=v(null),g=v(null);A(async()=>{e.contextualResource.user_id&&(g.value=await t(e.contextualResource.user_id)),e.contextualResource.resource&&(i.value=await o(e.contextualResource.resource.id)),i.value&&(l.value=await t(i.value.interaction_user_id))});const m=s=>s?s.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",f=s=>s.length>200?s.slice(0,150)+"...":s;return(s,p)=>{const x=ke("router-link");return a(),d("div",lt,[s.contextualResource.context_comment?(a(),d("div",rt,[r("div",null,w(s.contextualResource.context_comment),1),r("div",ut,[g.value?(a(),R(x,{key:0,to:"/users/"+g.value.id,class:"text-2xs underline"},{default:S(()=>[Y(w(g.value.first_name)+" "+w(g.value.last_name),1)]),_:1},8,["to"])):k("",!0),s.contextualResource.date?(a(),d("div",it,w(m(s.contextualResource.date)),1)):k("",!0),s.contextualResource.progress?(a(),d("div",ct,[u($e,{"progress-value":s.contextualResource.progress},null,8,["progress-value"])])):k("",!0)])])):k("",!0),u(x,{to:"/resources/"+s.contextualResource.resource.id+"?tab=ctnt"},{default:S(()=>[s.contextualResource.resource?(a(),d("div",dt,[r("div",mt,[s.contextualResource.resource?(a(),d("img",{key:0,class:"w-8 h-fit mr-4",src:s.contextualResource.resource.image_url},null,8,pt)):k("",!0),r("div",null,[r("div",null,w(s.contextualResource.resource.title)+" "+w(s.contextualResource.resource.subtitle),1),r("div",vt,[l.value?(a(),R(x,{key:0,to:"/users/"+l.value.id,class:"text-2xs underline"},{default:S(()=>[Y(w(l.value.first_name)+" "+w(l.value.last_name),1)]),_:1},8,["to"])):k("",!0)]),r("div",_t,w(f(s.contextualResource.resource.comment)),1)])]),r("div",gt,[s.contextualResource.date?(a(),d("div",ft,w(m(s.contextualResource.resourcedate)),1)):k("",!0)])])):k("",!0)]),_:1},8,["to"])])}}}),yt={class:"w-fit"},xt=I({__name:"ThoughtInputCardWithPopup",props:{thoughtInput:{},usageReason:{}},setup(n){const e=v(!1);return(t,o)=>(a(),d("div",yt,[u(oe,{open:e.value,onClose:o[0]||(o[0]=l=>e.value=!1)},{default:S(()=>[u(st,{"thought-input":t.thoughtInput,"usage-reason":t.usageReason},null,8,["thought-input","usage-reason"])]),_:1},8,["open"]),u(ht,{class:"md:w-96","contextual-resource":t.thoughtInput},null,8,["contextual-resource"])]))}}),bt={class:"relative max-w-full"},wt={key:0,class:"absolute md:border h-full start-1/2"},X=I({__name:"ThoughtInputsList",props:{contextualResources:{},center:{type:Boolean,default:!1}},emits:["select"],setup(n,{emit:e}){const t=l=>l.sort((i,g)=>+(g.date>i.date)),o=l=>{console.log("Select"),e("select",l)};return(l,i)=>(a(),d("div",bt,[l.center?k("",!0):(a(),d("div",wt)),(a(!0),d(me,null,pe(t(l.contextualResources),(g,m)=>(a(),R(xt,{key:g.id,class:Ee(["mb-4 md:mb-1 mx-auto max-w-full max-w-fit p-1",{"md:ml-0":m%2==0&&!l.center,"md:mr-0":!l.center}]),"thought-input":g,onClick:f=>o(g)},null,8,["class","thought-input","onClick"]))),128))]))}}),{launchSnackbar:kt}=Ve();function $t(){const n={title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"pbsh",maturing_state:"fnsh",image_url:"",resource_type:"",comment:""};return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0,resource:n}}function se(n){return console.log("Date : ",n.interaction_date),n.interaction_date=new Date(n.interaction_date),n}async function Vt(){return(await T.get("/thought_inputs?limit=60")).data.map(e=>se(e))}async function Rt(n){const e=await T.get("/thought_inputs/"+n);return se(e.data)}async function Ct(n){return(await T.get("/users/"+n+"/thought_inputs?limit=60")).data.map(t=>se(t))}async function It(n){const e=new Date(n.interaction_date);console.log("Date : ",e);const t=e.toISOString().split(".")[0];n.interaction_progress=Number(n.interaction_progress);const o=await T.post("/thought_inputs",{...n,interaction_date:t});return kt("Creation de l'input réussie","success"),se(o.data)}function Ut(){return{getUserThoughtInputs:Ct,newThoughtInput:$t,createThoughtInput:It,getThoughtInputs:Vt,getThoughtInput:Rt}}const St={key:0,class:"mb-4"},At={key:1},Tt={key:1},Dt={key:2},Ft={class:"flex flex-row-reverse"},we=I({__name:"CreateResourceRelationForm",props:{targetResource:{},originResource:{}},emits:["close","refresh"],setup(n,{emit:e}){const t=n,{user:o}=q(),l=v(),i=C=>{console.log("Event : ",C),l.value=C},g=v([{text:"Externes",value:"extr"},{text:"Internes",value:"artl"},{text:"Problème",value:"pblm"}]),m=v([{text:"Biblio",value:"bibl"},{text:"Résumé",value:"sumr"},{text:"Sujet principal",value:"main"},{text:"Evocation",value:"mino"}]),f=v([]),s=v(null),p=v([]),x=v([]),b=v([]),O=v(""),D=v(""),{createResourceRelation:K}=Ie(),{getResources:P}=ve(),{getArticles:y}=Ne(),{getProblems:$}=Je(),F=U(()=>f.value.map(C=>({resource:C.resource}))),W=C=>C.map(c=>({resource:c})),ae=U(()=>({extr:W(p.value),artl:W(x.value),pblm:W(b.value)})),le=async()=>{if(console.log("create"),!s.value)return;const C={target_resource_id:t.targetResource?t.targetResource.id:s.value.id,origin_resource_id:t.originResource?t.originResource.id:s.value.id,relation_comment:O.value,relation_type:D.value};await K(C),e("refresh"),e("close")},{getUserThoughtInputs:ee}=Ut(),G=C=>{s.value=C.resource};return A(async()=>{!o.value||!o.value.id||(t.targetResource&&(f.value=await ee(o.value.id)),t.originResource&&(p.value=await P(),x.value=await y({author:!0}),b.value=await $()))}),(C,c)=>(a(),d("div",null,[M(o)?(a(),d("div",St," Nouvelle relation entre ressources par "+w(M(o).first_name)+" "+w(M(o).last_name),1)):k("",!0),s.value?(a(),d("div",Dt,[u(H,{class:"m-4",label:"Type de lien",choices:m.value,modelValue:D.value,"onUpdate:modelValue":c[2]||(c[2]=B=>D.value=B)},null,8,["choices","modelValue"]),u(Z,{class:"m-4",label:"Pourquoi ajouter cet élément ?",modelValue:O.value,"onUpdate:modelValue":c[3]||(c[3]=B=>O.value=B)},null,8,["modelValue"]),r("div",Ft,[u(J,{type:"valid",onClick:le,text:"Ajouter"}),u(J,{type:"abort",onClick:c[4]||(c[4]=B=>e("close")),text:"Annuler",class:"mr-1"})])])):(a(),d("div",At,[C.targetResource?(a(),R(X,{key:0,"contextual-resources":F.value,center:"",onSelect:c[0]||(c[0]=B=>G(B))},null,8,["contextual-resources"])):(a(),d("div",Tt,[r("div",null,[Y(" Choisir une ressource cible "),u(Re,{center:"",choices:g.value,default:"pblm",onUpdate:i},null,8,["choices"]),u(X,{"contextual-resources":ae.value[l.value]||[],center:"",onSelect:c[1]||(c[1]=B=>G(B))},null,8,["contextual-resources"])])]))]))]))}}),Bt=I({__name:"CommentsThread",props:{resourceId:{}},setup(n){const e=n,{user:t}=q(),o=v([]),{createComment:l,getCommentsForThoughtOutput:i}=Ce(),g=async()=>{console.log("Comment thread"),console.log("Props id : ",e.resourceId),o.value=await i(e.resourceId)},m=U(()=>o.value.filter(p=>!p.start_index).sort((p,x)=>p.created_at-x.created_at)),f=v(""),s=async()=>{await l(e.resourceId,null,f.value,!1),f.value="",await g()};return A(async()=>await g()),(p,x)=>(a(),d("div",null,[(a(!0),d(me,null,pe(m.value,b=>(a(),R(be,{key:b.id,class:"w-full",modelValue:b.content,"onUpdate:modelValue":O=>b.content=O,editing:b.editing,onValidate:O=>b.editing=!1,author:b.author,"created-at":b.created_at},null,8,["modelValue","onUpdate:modelValue","editing","onValidate","author","created-at"]))),128)),u(be,{class:"w-full",modelValue:f.value,"onUpdate:modelValue":x[0]||(x[0]=b=>f.value=b),editing:!0,onValidate:s,author:M(t),"created-at":null},null,8,["modelValue","author"])]))}}),{launchSnackbar:Ue}=Ve();function Ot(){return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0}}function j(n){return console.log("Date : ",n.interaction_date),n.interaction_date=new Date(n.interaction_date),n}async function Lt(){return(await T.get("/thought_inputs?limit=60")).data.map(e=>j(e))}async function Pt(n){const e=await T.get("/thought_inputs/"+n);return j(e.data)}async function Et(n){return(await T.get("/users/"+n+"/thought_inputs")).data.map(t=>j(t))}async function Nt(n,e){const t=new Date(e.interaction_date);console.log("Date : ",t);const o=t.toISOString().split(".")[0];e.interaction_progress=Number(e.interaction_progress);const l=await T.put("/interactions/"+n,{...e,interaction_date:o});return j(l.data)}async function Mt(n){const e=new Date(n.interaction_date);console.log("Date : ",e);const t=e.toISOString().split(".")[0];n.interaction_progress=Number(n.interaction_progress);const o=await T.post("/thought_inputs",{...n,interaction_date:t});return Ue("Creation de l'input réussie","success"),j(o.data)}async function qt(n,e){const t=new Date(e.interaction_date);console.log("Date : ",t);const o=t.toISOString().split(".")[0];e.interaction_progress=Number(e.interaction_progress);const l=await T.post(`/resources/${n}/interactions`,{...e,interaction_date:o});return Ue("Creation de l'input réussie","success"),j(l.data)}async function jt(n){return(await T.get(`/resources/${n}/interactions`)).data.map(t=>j(t))}function _e(){return{getUserInteractions:Et,newInteraction:Ot,createInteraction:Mt,getInteractions:Lt,getInteraction:Pt,updateInteraction:Nt,createInteractionForResource:qt,getInteractionsForResource:jt}}const zt={class:"flex flex-wrap"},Ht={class:"flex flex-row-reverse"},Jt=I({__name:"CreateInteraction",props:{resource:{}},emits:["close","refresh"],setup(n,{emit:e}){const t=n,o=v([{text:"Lecture / Visionage",value:"inpt"},{text:"Envie",value:"wish"}]),{newInteraction:l,createInteractionForResource:i}=_e(),{user:g}=q(),m=v(l());A(()=>{m.value.interaction_type||(m.value.interaction_type="inpt")});const f=()=>{m.value.resource_id=t.resource.id,m.value.interaction_user_id=g.value.id,i(t.resource.id,m.value),e("refresh"),s()},s=()=>e("close");return(p,x)=>(a(),d("div",null,[r("div",null,"Nouvelle interaction, avec la ressource : "+w(p.resource.title),1),r("div",zt,[u(N,{label:"Avancement de l'ouvrage",class:"my-auto",modelValue:m.value.interaction_progress,"onUpdate:modelValue":x[0]||(x[0]=b=>m.value.interaction_progress=b),type:"number"},null,8,["modelValue"]),u(H,{label:"Type d'interaction",class:"m-4 w-full md:w-5/12 md:ml-auto",choices:o.value,modelValue:m.value.interaction_type,"onUpdate:modelValue":x[1]||(x[1]=b=>m.value.interaction_type=b)},null,8,["choices","modelValue"])]),u(N,{label:"Date de lecture",modelValue:m.value.interaction_date,"onUpdate:modelValue":x[2]||(x[2]=b=>m.value.interaction_date=b),type:"date"},null,8,["modelValue"]),u(Z,{label:"Pourquoi s'y être interessé ?",modelValue:m.value.interaction_comment,"onUpdate:modelValue":x[3]||(x[3]=b=>m.value.interaction_comment=b)},null,8,["modelValue"]),r("div",Ht,[u(J,{onClick:f,class:"m-4",text:"Valider",type:"valid"}),u(J,{onClick:s,class:"m-4",text:"Annuler",type:"abort"})])]))}}),Kt=I({__name:"DateField",props:{date:{}},setup(n){const e=n,t=U(()=>new Date(e.date).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}));return(o,l)=>(a(),d("div",null,w(t.value),1))}}),Wt=I({__name:"CheckboxInput",props:{label:{},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,o="checkbox-"+Math.random().toString(36).substr(2,9),l=v(z(t).modelValue),i=()=>{l.value=!l.value,console.log(l.value),e("update:modelValue",!t.modelValue)};return(g,m)=>(a(),d("div",null,[Me(r("input",{class:"m-2",type:"checkbox",id:o,"onUpdate:modelValue":m[0]||(m[0]=f=>l.value=f),onChange:i},null,544),[[qe,l.value]]),r("label",{for:o},w(g.label),1)]))}}),Gt={class:"m-4"},Qt={class:"block text-2xs text-slate-800"},Xt=["value","placeholder"],Se=I({__name:"NumberInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue","input"],setup(n,{emit:e}){const t=o=>{e("update:modelValue",o.target.value),e("input",o.target.value)};return(o,l)=>(a(),d("div",Gt,[r("label",Qt,w(o.label),1),r("input",{class:"border border-neutral-400 block h-full w-full rounded-md border-2 p-1 pl-2 text-xs",type:"number",value:o.modelValue,placeholder:o.placeholder,onInput:l[0]||(l[0]=i=>t(i))},null,40,Xt)]))}}),Yt={class:"flex"},Zt={class:"ml-auto h-6 m-4 w-1/3"},eo={class:"ml-auto h-6 m-4 w-1/3"},to={class:"ml-auto h-6 m-4 w-1/3"},oo={class:"my-auto ml-auto h-6 m-4 w-1/3"},no={class:"flex"},so=I({__name:"ArticleForm",props:{article:{}},emits:["change"],setup(n,{emit:e}){const t=n,o=v([{text:"Terminé",value:"fnsh"},{text:"Relecture",value:"rvew"},{text:"Idée",value:"idea"}]),l=v([{text:"Livre",value:"book"},{text:"Fiche de lecture",value:"shet"},{text:"Article de média",value:"natc"},{text:"Article de recherche",value:"ratc"},{text:"Film",value:"movi"},{text:"Podcast",value:"pcst"}]),{categories:i}=je(),g=U(()=>i.value.map(f=>({text:f.display_name,value:f.id}))),m=(f,s)=>{let p={...t.article};p[f]=s,e("change",p)};return(f,s)=>(a(),d("div",null,[u(N,{label:"Titre",modelValue:f.article.title,"onUpdate:modelValue":s[0]||(s[0]=p=>m("title",p))},null,8,["modelValue"]),u(N,{class:"h-6",label:"Sous-titre",modelValue:f.article.subtitle,"onUpdate:modelValue":s[1]||(s[1]=p=>m("subtitle",p))},null,8,["modelValue"]),r("div",Yt,[u(Se,{class:"mr-auto h-6",label:"Progression",modelValue:f.article.interaction_progress,"onUpdate:modelValue":s[2]||(s[2]=p=>m("progress",p))},null,8,["modelValue"]),r("div",Zt,[u(H,{label:"Catégorie",choices:g.value,"model-value":f.article.category_id,"onUpdate:modelValue":s[3]||(s[3]=p=>m("category_id",p))},null,8,["choices","model-value"])]),r("div",eo,[u(H,{label:"Stade d'écriture",choices:o.value,"model-value":f.article.maturing_state,"onUpdate:modelValue":s[4]||(s[4]=p=>m("maturing_state",p))},null,8,["choices","model-value"])]),r("div",to,[u(H,{label:"Type de ressource",choices:l.value,"onUpdate:modelValue":s[5]||(s[5]=p=>m("resource_type",p)),"model-value":f.article.resource_type},null,8,["choices","model-value"])]),r("div",oo,[u(Wt,{class:"mt-3",label:"Externe","onUpdate:modelValue":s[6]||(s[6]=p=>m("is_external",p)),"model-value":f.article.is_external},null,8,["model-value"])])]),r("div",no,[u(N,{class:"h-6",label:"Lien contenu externe",modelValue:f.article.external_content_url,"onUpdate:modelValue":s[7]||(s[7]=p=>m("external_content_url",p))},null,8,["modelValue"]),u(N,{class:"h-6",label:"Lien image",modelValue:f.article.image_url,"onUpdate:modelValue":s[8]||(s[8]=p=>m("image_url",p))},null,8,["modelValue"])]),u(Z,{label:"Pistes d'amélioration",modelValue:f.article.comment,"onUpdate:modelValue":s[9]||(s[9]=p=>m("comment",p))},null,8,["modelValue"])]))}}),ao={class:"flex flex-wrap"},lo=I({__name:"ResourceAuthorPicker",props:{interaction:{},resourceId:{}},emits:["update"],setup(n,{emit:e}){const t=n,o=v(null),l=v([]),i=y=>{if(y)return{text:`${y.first_name} ${y.last_name}`,value:y.id}},g=U(()=>{var y;return(y=o.value)==null?void 0:y.id}),m=U(()=>{if(l.value)return l.value.map(y=>i(y))}),{getUsers:f,getUserById:s}=q(),p=async y=>o.value=await s(y.interaction_user_id),{createInteractionForResource:x,newInteraction:b,createInteraction:O,updateInteraction:D}=_e(),K=async y=>{if(console.log(`newUser : ${JSON.stringify(y)}`),t.interaction){const $={...t.interaction};$.interaction_user_id=y,console.log("newUserid : ",y.id),console.log(`Interaction payload : ${JSON.stringify($)}`),await D(t.interaction.id,$),e("update")}else{console.log("create interaction");const $=b();$.interaction_user_id=y,$.resource_id=t.resourceId,await x(t.resourceId,$),e("update")}},P=async y=>{await D(t.interaction.id,y),e("update")};return A(async()=>{l.value=await f(),await p(t.interaction)}),ne(z(t).interaction,async y=>await p(y)),(y,$)=>(a(),d("div",null,[r("div",ao,[u(H,{label:"Auteur",class:"my-auto",choices:m.value,"model-value":g.value,"onUpdate:modelValue":$[0]||($[0]=F=>K(F))},null,8,["choices","model-value"]),y.interaction?(a(),R(N,{key:0,class:"my-auto",label:"Date d'écriture","model-value":y.interaction.interaction_date.split("T")[0],"onUpdate:modelValue":$[1]||($[1]=F=>P({...y.interaction,interaction_date:F})),type:"date"},null,8,["model-value"])):k("",!0),y.interaction?(a(),R(Se,{key:1,class:"my-auto",label:"Progression",modelValue:y.interaction.interaction_progress,"onUpdate:modelValue":$[2]||($[2]=F=>P({...y.interaction,interaction_progress:F}))},null,8,["modelValue"])):k("",!0)])]))}}),ro={key:0,class:"mx-auto"},uo={key:0},io={class:"my-8"},co=["src"],mo={class:"text-3xl my-3 font-mplus md:text-center text-left"},po={class:"md:text-center text-left"},vo={class:"md:text-center text-left"},_o={class:"md:flex my-8"},go=["href"],fo={key:1},ho={class:"flex flex-row-reverse"},yo={key:1,class:"p-2 border rounded bg-neutral-100"},xo=r("hr",{class:"border-top border-zinc-400 my-4"},null,-1),bo={key:2},wo=r("div",{class:"text-xs italic"},"Commentaire",-1),ko=r("hr",{class:"border-top border-zinc-400 my-4"},null,-1),$o=r("div",{class:"text-xs italic"},"Contenu",-1),Vo={key:3},Ro={key:4},Co={key:5},Io={class:"fixed right-3 bottom-5"},Uo=I({__name:"ResourceComponent",props:{id:{},secondLevel:{type:Boolean}},setup(n){const e=n,t=ze(),o=U(()=>e.secondLevel?"popup_tab":"tab"),l=U(()=>[{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli",count:s.value.length},{text:"Sujets",value:"pblm",count:$.value.length},{text:"Interactions",value:"inpt",count:D.value.length}]),i=v(t.query[o.value]&&typeof t.query[o.value]=="string"?t.query[o.value]:"ctnt"),g=v(t.query[o.value]);ne(()=>t.query[o.value],_=>{console.log("new route query",_),typeof _=="string"&&(g.value=_)});const{getResourceRelationsForResource:m,getUsagesForResource:f}=Ie(),s=v([]),p=v(!1),x=v(!1),b=async()=>{s.value=await m(z(e).id.value)},O=U(()=>s.value.map(_=>({resource:_.origin_resource,date:_.created_at,user_id:_.user_id,context_comment:_.relation_comment,progress:null})));A(()=>b());const D=v([]),{getInteractionsForResource:K}=_e(),P=async()=>{D.value=await K(e.id)};A(async()=>await P());const y=U(()=>D.value.map(_=>({resource:null,date:_.interaction_date,user_id:_.interaction_user_id,context_comment:_.interaction_comment,progress:_.interaction_progress}))),$=v([]);A(async()=>await F());const F=async()=>{$.value=await f(e.id)},W=U(()=>$.value.map(_=>({resource:_.target_resource,date:_.created_at,user_id:_.user_id,context_comment:_.relation_comment,progress:null}))),{newResource:ae,getResource:le,updateResource:ee,getAuthorInteractionForResource:G}=ve(),C=v(null),c=v(ae()),B=He();ne(()=>t.query.editing,_=>{console.log("Editing : ",_),re.value=_==="false"?!1:!!_});const re=v(!1),ge=_=>{B.push({query:{editing:_.toString()}})},Ae=()=>{!c.value||!c.value.id||(c.value.publishing_state="pbsh",ee(c.value.id,c.value))},ue=(_,h)=>{c.value=h,C.value!==null&&clearTimeout(C.value),C.value=setTimeout(async()=>{try{await ee(_,c.value)}catch(ie){console.log("An error : ",ie)}},1e3)},fe=_=>{_!=`
`&&ue(z(e).id.value,{...c.value,content:_})},he=_=>{_!=`
`&&ue(z(e).id.value,{...c.value,comment:_})},{user:ye,getUserById:Te}=q(),Q=U(()=>c.value.is_external?!0:ye.value?E.value?E.value.id==ye.value.id:!0:!1),E=v(null),L=v(null),te=v(!1),De=async()=>{L.value=await G(e.id)},{getCommentsForThoughtOutput:Fe}=Ce(),xe=v([]);return A(async()=>{c.value=await le(e.id),xe.value=await Fe(e.id),L.value=await G(e.id),L.value&&(E.value=await Te(L.value.interaction_user_id));const _=t.query.editing;re.value=_==="false"?!1:!!_}),(_,h)=>{const ie=ke("router-link");return c.value?(a(),d("div",ro,[re.value?(a(),d("div",fo,[u(so,{article:c.value,onChange:h[0]||(h[0]=V=>ue(c.value.id,V))},null,8,["article"]),u(lo,{class:"mx-4",interaction:L.value,"resource-id":_.id,onChange:De},null,8,["interaction","resource-id"]),r("div",ho,[u(J,{class:"mx-4",onClick:h[1]||(h[1]=V=>ge(!1)),type:"valid",text:"Preview"},{default:S(()=>[Y("Ok")]),_:1}),c.value.publishing_state=="drft"?(a(),R(J,{key:0,onClick:Ae,type:"valid",text:"Publier"})):(a(),d("div",yo,"Publié"))])])):(a(),d("div",uo,[r("div",io,[r("img",{src:c.value.image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto",style:{"max-height":"20rem"}},null,8,co)]),r("h1",mo,w(c.value.title),1),r("div",po,w(c.value.subtitle),1),r("div",vo,[E.value?(a(),R(ie,{key:0,to:"/users/"+E.value.id,class:"text-sm underline"},{default:S(()=>[Y(w(E.value.first_name)+" "+w(E.value.last_name),1)]),_:1},8,["to"])):k("",!0),L.value?(a(),R(Kt,{key:1,date:L.value.interaction_date},null,8,["date"])):k("",!0)]),r("div",_o,[L.value?(a(),R($e,{key:0,"progress-value":L.value.interaction_progress,class:"m-2 w-1/3"},null,8,["progress-value"])):k("",!0),c.value.external_content_url?(a(),d("a",{key:1,class:"ml-auto underline",href:c.value.external_content_url,target:"_blank"}," Lien ressource externe ",8,go)):k("",!0)])])),r("div",null,[u(Re,{choices:l.value,default:i.value,"url-key":o.value,url:""},null,8,["choices","default","url-key"])]),xo,g.value=="ctnt"?(a(),d("div",bo,[wo,c.value.publishing_state!="drft"?(a(),R(de,{key:0,"full-text":c.value.comment,editable:Q.value,onChange:h[2]||(h[2]=V=>he(V))},null,8,["full-text","editable"])):(a(),R(Z,{key:1,class:"h-20",label:"Commentaire",modelValue:c.value.comment,"onUpdate:modelValue":h[3]||(h[3]=V=>he(V))},null,8,["modelValue"])),ko,$o,c.value.publishing_state!="drft"?(a(),R(de,{key:2,class:"min-h-fit","ext-comments":xe.value,"resource-id":c.value.id,"full-text":c.value.content,editable:Q.value,onChange:h[4]||(h[4]=V=>fe(V))},null,8,["ext-comments","resource-id","full-text","editable"])):(a(),R(Z,{key:3,class:"h-96",label:"Contenu",modelValue:c.value.content,"onUpdate:modelValue":h[5]||(h[5]=V=>fe(V))},null,8,["modelValue"])),u(Bt,{"resource-id":_.id},null,8,["resource-id"])])):g.value=="bbli"?(a(),d("div",Vo,[u(oe,{open:p.value,onClose:h[7]||(h[7]=V=>p.value=!1)},{default:S(()=>[u(we,{onRefresh:b,onClose:h[6]||(h[6]=V=>p.value=!1),"target-resource":c.value},null,8,["target-resource"])]),_:1},8,["open"]),r("div",{onClick:h[8]||(h[8]=V=>p.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),u(X,{"contextual-resources":O.value},null,8,["contextual-resources"])])):g.value=="pblm"?(a(),d("div",Ro,[u(X,{"contextual-resources":W.value},null,8,["contextual-resources"])])):g.value=="inpt"?(a(),d("div",Co,[u(X,{"contextual-resources":y.value},null,8,["contextual-resources"])])):k("",!0),r("div",Io,[Q.value?(a(),R(ce,{key:0,title:"Modifier",onClick:h[9]||(h[9]=V=>ge(!0))},{default:S(()=>[u(M(We),{class:"m-1"})]),_:1})):k("",!0),Q.value?(a(),R(ce,{key:1,class:"mt-2",color:"red",title:"Marquer comme lu",onClick:h[10]||(h[10]=V=>te.value=!0)},{default:S(()=>[u(M(Ke),{class:"m-1"})]),_:1})):k("",!0),u(oe,{open:te.value,onClose:h[12]||(h[12]=V=>te.value=!1)},{default:S(()=>[u(Jt,{onRefresh:P,onClose:h[11]||(h[11]=V=>te.value=!1),resource:c.value},null,8,["resource"])]),_:1},8,["open"]),Q.value?(a(),R(ce,{key:2,class:"mt-2",color:"green",title:"Relier à d'autres ressources",onClick:h[13]||(h[13]=V=>x.value=!0)},{default:S(()=>[u(M(Ge),{class:"m-1"})]),_:1})):k("",!0),u(oe,{open:x.value,onClose:h[15]||(h[15]=V=>x.value=!1)},{default:S(()=>[u(we,{onRefresh:F,onClose:h[14]||(h[14]=V=>x.value=!1),"origin-resource":c.value},null,8,["origin-resource"])]),_:1},8,["open"])])])):k("",!0)}}});export{Uo as _,st as a,oe as b,X as c,Z as d,H as e,We as r,Ut as u};
