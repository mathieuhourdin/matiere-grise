import{o as s,c as m,f as i,l as N,d as C,r as p,m as $,t as O,u as z,i as f,h as d,_ as x,e as D,n as R,p as S,F as K,q as Q,s as P,v as X,w as U,x as Y,a as L,y as Z,z as ee,A as M}from"./index-c393c4f7.js";import{a as E,b as te,_ as oe}from"./ArticleForm.vue_vue_type_script_setup_true_lang-b2259c59.js";import{_ as H,u as se,a as ue}from"./ModalSheet.vue_vue_type_script_setup_true_lang-c8eb484b.js";import{_ as le,u as ae}from"./TextInterface.vue_vue_type_script_setup_true_lang-b4db31e6.js";import{_ as I}from"./TextInput.vue_vue_type_script_setup_true_lang-afd22ee1.js";import{u as ne}from"./useThoughtOutput-576986df.js";function re(c,r){return s(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}const ie=async c=>(await N.get("/thought_outputs/"+c+"/thought_input_usages")).data,de=async c=>(await N.post("/thought_input_usages",c)).data;function G(){return{getThoughtInputUsagesForThoughtOutput:ie,createThoughtInputUsage:de}}const ce={key:1},pe={class:"flex flex-row-reverse"},me=C({__name:"CreateThoughtInputUsageForm",props:{thoughtOutput:{}},emits:["close","refresh"],setup(c,{emit:r}){const g=c,{user:h}=D(),a=p([]),u=p(null),t=p(""),{createThoughtInputUsage:_}=G(),v=async()=>{console.log("create");const b={thought_output_id:g.thoughtOutput.id,thought_input_id:u.value.id,usage_reason:t.value};await _(b),r("refresh"),r("close")},{getUserThoughtInputs:k}=se(),T=b=>{u.value=b};return $(async()=>a.value=await k(h.value.id)),(b,e)=>(s(),m("div",null,[i("div",null,O(z(h).first_name),1),u.value?(s(),m("div",ce,[d(E,{label:"Pourquoi ajouter cet élément ?",modelValue:t.value,"onUpdate:modelValue":e[1]||(e[1]=y=>t.value=y)},null,8,["modelValue"]),i("div",pe,[d(x,{type:"valid",onClick:v,text:"Ajouter"}),d(x,{type:"abort",onClick:e[2]||(e[2]=y=>r("close")),text:"Ajouter"})])])):(s(),f(H,{key:0,"thought-inputs":a.value,center:"",onSelect:e[0]||(e[0]=y=>T(y))},null,8,["thought-inputs"]))]))}}),he={class:"mx-auto flex flex-wrap max-w-full"},ve=C({__name:"ToggleButtonGroup",props:{choices:{},default:{}},setup(c){const r=c,g=p(null),h=R(),a=S(),u=t=>{g.value=t;const _=a.query,v=a.path;h.push({path:v,query:{..._,tab:t}}),console.log(`route : ${JSON.stringify(a)}`)};return $(()=>u(r.default)),(t,_)=>(s(),m("div",he,[(s(!0),m(K,null,Q(t.choices,v=>(s(),f(x,{key:v.value,class:"w-24 mx-auto my-1 md:mx-1",text:v.text,onClick:k=>u(v.value),type:v.value==g.value?"valid":"abort"},null,8,["text","onClick","type"]))),128))]))}}),ge={class:"flex"},_e={class:"flex"},fe=C({__name:"ProblemForm",props:{problem:{}},emits:["change"],setup(c,{emit:r}){const g=c,h=(a,u)=>{let t={...g.problem};t[a]=u,r("change",t)};return(a,u)=>(s(),m("div",null,[d(I,{label:"Titre",modelValue:a.problem.title,"onUpdate:modelValue":u[0]||(u[0]=t=>h("title",t))},null,8,["modelValue"]),d(I,{class:"h-6",label:"Description",modelValue:a.problem.description,"onUpdate:modelValue":u[1]||(u[1]=t=>h("description",t))},null,8,["modelValue"]),i("div",ge,[d(te,{class:"mr-auto h-6",label:"Progression",modelValue:a.problem.progress,"onUpdate:modelValue":u[2]||(u[2]=t=>h("progress",t))},null,8,["modelValue"])]),i("div",_e,[d(I,{class:"h-6",label:"Lien image",modelValue:a.problem.image_url,"onUpdate:modelValue":u[3]||(u[3]=t=>h("image_url",t))},null,8,["modelValue"])])]))}}),be={key:0,class:"px-8 mx-auto"},ye={key:0},xe={class:"my-8"},ke=["src"],Te={class:"text-3xl my-3 font-mplus md:text-center text-left"},$e={class:"md:text-center text-left"},Ce={class:"md:flex my-8"},we=["href"],Ve={key:1},Ue={class:"flex flex-row-reverse"},Ie={key:1,class:"p-2 border rounded bg-neutral-100"},Oe=i("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Ae={key:2},qe={key:3},Ne=C({__name:"SeeArticle",props:{id:{}},setup(c){const r=c,g=S(),h=p([{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli"}]),a=p(null);P(()=>g.query.tab,l=>{console.log("new route query",l),a.value=l});const{getThoughtInputUsagesForThoughtOutput:u}=G(),t=p([]),_=p(!1),v=async()=>{t.value=await u(M(r).id.value)};$(()=>v());const{getThoughtOutput:k,updateThoughtOutput:T}=ne(),b=p(null),e=p(null),y=R();P(()=>g.query.editing,l=>{console.log("Editing : ",l),w.value=l==="false"?!1:!!l});const w=p(!1),A=l=>{y.push({query:{editing:l}})},J=()=>{e.value.publishing_state="pbsh",T(e.value.id,e.value)},V=(l,o)=>{e.value=o,clearTimeout(b.value),b.value=setTimeout(async()=>{try{await T(l,e.value)}catch(n){console.log("An error : ",n)}},1e3)},q=l=>{l!=`
`&&V(M(r).id.value,{...e.value,content:l})},{user:B}=D(),F=X(()=>B.value?e.value.author_id==B.value.id:!1),{getCommentsForThoughtOutput:W}=ae(),j=p([]);return $(async()=>{e.value=await k(r.id),j.value=await W(r.id);const l=g.query.editing;w.value=l==="false"?!1:!!l}),(l,o)=>e.value?(s(),m("div",be,[w.value?(s(),m("div",Ve,[e.value.output_type=="atcl"?(s(),f(oe,{key:0,article:e.value,onChange:o[1]||(o[1]=n=>V(e.value.id,n))},null,8,["article"])):(s(),f(fe,{key:1,problem:e.value,onChange:o[2]||(o[2]=n=>V(e.value.id,n))},null,8,["problem"])),i("div",Ue,[d(x,{class:"mx-4",onClick:o[3]||(o[3]=n=>A(!1)),type:"valid",text:"Preview"},{default:U(()=>[ee("Ok")]),_:1}),e.value.publishing_state=="drft"?(s(),f(x,{key:0,onClick:J,type:"valid",text:"Publier"})):(s(),m("div",Ie,"Publié"))])])):(s(),m("div",ye,[i("div",xe,[i("img",{src:e.value.image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto"},null,8,ke)]),i("h1",Te,O(e.value.title),1),i("div",$e,O(e.value.description),1),F.value?(s(),f(Y,{key:0,onClick:o[0]||(o[0]=n=>A(!0))},{default:U(()=>[d(z(re),{class:"m-1"})]),_:1})):L("",!0),i("div",Ce,[d(Z,{"progress-value":e.value.progress,class:"w-1/3"},null,8,["progress-value"]),i("a",{class:"ml-auto underline",href:e.value.gdoc_url}," Ajouter un commentaire ",8,we)])])),i("div",null,[d(ve,{choices:h.value,default:"ctnt"},null,8,["choices"])]),Oe,a.value=="ctnt"?(s(),m("div",Ae,[e.value.publishing_state!="drft"?(s(),f(le,{key:0,"ext-comments":j.value,"ressource-id":e.value.id,"full-text":e.value.content,editable:F.value,onChange:o[4]||(o[4]=n=>q(n))},null,8,["ext-comments","ressource-id","full-text","editable"])):(s(),f(E,{key:1,class:"h-96",label:"Contenu",modelValue:e.value.content,"onUpdate:modelValue":o[5]||(o[5]=n=>q(n))},null,8,["modelValue"]))])):(s(),m("div",qe,[d(ue,{open:_.value,onClose:o[7]||(o[7]=n=>_.value=!1)},{default:U(()=>[d(me,{onRefresh:v,onClose:o[6]||(o[6]=n=>_.value=!1),"thought-output":e.value},null,8,["thought-output"])]),_:1},8,["open"]),i("div",{onClick:o[8]||(o[8]=n=>_.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),d(H,{"thought-inputs":t.value.map(n=>n.thought_input)},null,8,["thought-inputs"])]))])):L("",!0)}});export{Ne as default};
