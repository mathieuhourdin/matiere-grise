import{_ as he,u as Te}from"./useArticle-e9d76af5.js";import{_ as ne}from"./RoundLinkButton.vue_vue_type_style_index_0_lang-9d8d0209.js";import{_ as Z,a as L,b as te,u as Ae,r as De}from"./useThoughtInputs-f98d8df1.js";import{_ as M}from"./ActionButton.vue_vue_type_script_setup_true_lang-8163d95c.js";import{_ as re,a as fe,u as xe}from"./TextInterface.vue_vue_type_script_setup_true_lang-e5f1dfd9.js";import{o as t,f as d,a as p,d as A,b as i,h as U,e as j,i as s,p as E,r as ye,t as V,c as $,w as T,l as Q,m as k,B as Be,y as ie,F as be,g as ke,C as Se,n as q,D as Fe,j as ue,E as ee,u as Pe,k as Oe}from"./index-4ed96122.js";import{_ as N}from"./TextInput.vue_vue_type_script_setup_true_lang-691de01f.js";import{u as ce}from"./useInteraction-9f1e9822.js";import{_ as we}from"./ProgressBar.vue_vue_type_script_setup_true_lang-b88ec1ad.js";import{u as Re}from"./useResourceRelations-7283fdad.js";import{u as Le}from"./useProblem-b3a1a51f.js";function Ne(y,l){return t(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 8.25H7.5a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25H15M9 12l3 3m0 0l3-3m-3 3V2.25"})])}function qe(y,l){return t(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z"})])}const je=p("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Ee=p("div",{class:"text-xs italic"},"Raison de la lecture",-1),ze=A({__name:"SeeThoughtInput",props:{thoughtInput:{}},setup(y){const l=y,{getUserById:o,user:a}=E(),c=i(null),b=U(()=>a.value?l.thoughtInput.interaction_user_id===a.value.id:!1);return j(async()=>{l.thoughtInput.interaction_user_id&&(c.value=await o(l.thoughtInput.interaction_user_id))}),(f,m)=>(t(),d("div",null,[s(Wt,{id:f.thoughtInput.resource_id,"second-level":""},null,8,["id"]),je,Ee,s(re,{"full-text":f.thoughtInput.interaction_comment,editable:b.value},null,8,["full-text","editable"])]))}}),Me={class:"w-full md:w-96"},Je={key:0,class:"text-xs italic mb-2 bg-white"},He={class:"flex flex-wrap"},We={key:1,class:"text-2xs italic ml-2"},Ge={key:2,class:"ml-auto m-1 w-1/3"},Ke={key:0,class:"border shadow-lg rounded p-4 md:w-96 bg-white"},Qe={class:"flex"},Xe=["src"],Ye={class:"flex flex-wrap w-full",style:{"margin-top":"-8px"}},Ze={class:"text-2xs"},et={class:"flex flex-wrap"},tt={key:0,class:"text-2xs italic"},lt=A({__name:"ThoughtInputCard",props:{contextualResource:{},isDisabled:{type:Boolean,default:!1}},setup(y){const l=y,{getUserById:o}=E(),{getAuthorInteractionForResource:a}=ie(),c=i(null),b=i(null),f=i(null);j(async()=>{l.contextualResource.user_id&&(f.value=await o(l.contextualResource.user_id)),l.contextualResource.resource&&(b.value=await a(l.contextualResource.resource.id)),b.value&&(c.value=await o(b.value.interaction_user_id))});const m=e=>e?e.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",g=e=>e.length>200?e.slice(0,150)+"...":e;return(e,n)=>{const h=ye("router-link");return t(),d("div",Me,[e.contextualResource.context_comment?(t(),d("div",Je,[p("div",null,V(e.contextualResource.context_comment),1),p("div",He,[f.value?(t(),$(h,{key:0,to:"/users/"+f.value.id,class:"text-2xs underline"},{default:T(()=>[Q(V(f.value.first_name)+" "+V(f.value.last_name),1)]),_:1},8,["to"])):k("",!0),e.contextualResource.date?(t(),d("div",We,V(m(e.contextualResource.date)),1)):k("",!0),e.contextualResource.progress?(t(),d("div",Ge,[s(we,{"progress-value":e.contextualResource.progress},null,8,["progress-value"])])):k("",!0)])])):k("",!0),e.contextualResource.resource?(t(),$(Be(e.isDisabled?"span":"vue-router"),{key:1,to:"/resources/"+e.contextualResource.resource.id+"?tab=ctnt"},{default:T(()=>[e.contextualResource.resource?(t(),d("div",Ke,[p("div",Qe,[e.contextualResource.resource?(t(),d("img",{key:0,class:"w-8 h-fit mr-4",src:e.contextualResource.resource.image_url},null,8,Xe)):k("",!0),p("div",null,[p("div",null,V(e.contextualResource.resource.title)+" "+V(e.contextualResource.resource.subtitle),1),p("div",Ye,[c.value?(t(),$(h,{key:0,to:"/users/"+c.value.id,class:"text-2xs underline"},{default:T(()=>[Q(V(c.value.first_name)+" "+V(c.value.last_name),1)]),_:1},8,["to"])):k("",!0)]),p("div",Ze,V(g(e.contextualResource.resource.comment)),1)])]),p("div",et,[e.contextualResource.date?(t(),d("div",tt,V(m(e.contextualResource.resourcedate)),1)):k("",!0)])])):k("",!0)]),_:1},8,["to"])):k("",!0)])}}}),ot={class:"w-fit"},st=A({__name:"ThoughtInputCardWithPopup",props:{thoughtInput:{},usageReason:{},isDisabled:{type:Boolean,default:!1}},setup(y){const l=i(!1);return(o,a)=>(t(),d("div",ot,[s(Z,{open:l.value,onClose:a[0]||(a[0]=c=>l.value=!1)},{default:T(()=>[s(ze,{"thought-input":o.thoughtInput,"usage-reason":o.usageReason},null,8,["thought-input","usage-reason"])]),_:1},8,["open"]),s(lt,{class:"md:w-96","contextual-resource":o.thoughtInput,"is-disabled":o.isDisabled},null,8,["contextual-resource","is-disabled"])]))}}),at={class:"relative max-w-full"},nt={key:0,class:"absolute md:border h-full start-1/2 -z-10"},K=A({__name:"ThoughtInputsList",props:{contextualResources:{},center:{type:Boolean,default:!1},linksDisabled:{type:Boolean,default:!1}},emits:["select"],setup(y,{emit:l}){const o=c=>c.sort((b,f)=>+(f.date>b.date)),a=c=>{console.log("Select"),l("select",c)};return(c,b)=>(t(),d("div",at,[c.center?k("",!0):(t(),d("div",nt)),(t(!0),d(be,null,ke(o(c.contextualResources),(f,m)=>(t(),$(st,{key:f.id,class:Se(["mb-4 md:mb-1 mx-auto max-w-full max-w-fit p-1",{"md:ml-0":m%2==0&&!c.center,"md:mr-0":!c.center}]),"thought-input":f,onClick:g=>a(f),"is-disabled":c.linksDisabled},null,8,["class","thought-input","onClick","is-disabled"]))),128))]))}}),rt={key:0,class:"mb-4"},ut={key:1},it={key:1},ct={key:2},dt={class:"flex flex-row-reverse"},ge=A({__name:"CreateResourceRelationForm",props:{targetResource:{},originResource:{}},emits:["close","refresh"],setup(y,{emit:l}){const o=y,{user:a}=E(),c=i(),b=I=>{console.log("Event : ",I),c.value=I},f=i([{text:"Externes",value:"extr"},{text:"Internes",value:"artl"},{text:"Problème",value:"pblm"}]),m=i([{text:"Biblio",value:"bibl"},{text:"Résumé",value:"sumr"},{text:"Sujet principal",value:"main"},{text:"Evocation",value:"mino"}]),g=i([]),e=i(null),n=i([]),h=i([]),x=i([]),S=i(""),D=i(""),{createResourceRelation:J}=Re(),{getResources:P}=ie(),{getArticles:_}=Te(),{getProblems:w}=Le(),B=U(()=>g.value.map(I=>({resource:I.resource}))),H=I=>I.map(C=>({resource:C})),z=U(()=>({extr:H(n.value),artl:H(h.value),pblm:H(x.value)})),le=async()=>{if(console.log("create"),!e.value)return;const I={target_resource_id:o.targetResource?o.targetResource.id:e.value.id,origin_resource_id:o.originResource?o.originResource.id:e.value.id,relation_comment:S.value,relation_type:D.value};await J(I),l("refresh"),l("close")},{getUserThoughtInputs:oe}=Ae(),W=I=>{e.value=I.resource};return j(async()=>{!a.value||!a.value.id||(o.targetResource&&(g.value=await oe(a.value.id)),o.originResource&&(n.value=await P(),h.value=await _({author:!0}),x.value=await w()))}),(I,C)=>(t(),d("div",null,[q(a)?(t(),d("div",rt," Nouvelle relation entre ressources par "+V(q(a).first_name)+" "+V(q(a).last_name),1)):k("",!0),e.value?(t(),d("div",ct,[s(L,{class:"m-4",label:"Type de lien",choices:m.value,modelValue:D.value,"onUpdate:modelValue":C[2]||(C[2]=r=>D.value=r)},null,8,["choices","modelValue"]),s(te,{class:"m-4",label:"Pourquoi ajouter cet élément ?",modelValue:S.value,"onUpdate:modelValue":C[3]||(C[3]=r=>S.value=r)},null,8,["modelValue"]),p("div",dt,[s(M,{type:"valid",onClick:le,text:"Ajouter"}),s(M,{type:"abort",onClick:C[4]||(C[4]=r=>l("close")),text:"Annuler",class:"mr-1"})])])):(t(),d("div",ut,[I.targetResource?(t(),$(K,{key:0,"contextual-resources":B.value,center:"","links-disabled":"",onSelect:C[0]||(C[0]=r=>W(r))},null,8,["contextual-resources"])):(t(),d("div",it,[p("div",null,[Q(" Choisir une ressource cible "),s(he,{center:"",choices:f.value,default:"pblm",onUpdate:b},null,8,["choices"]),s(K,{"contextual-resources":z.value[c.value]||[],center:"",onSelect:C[1]||(C[1]=r=>W(r)),"links-disabled":""},null,8,["contextual-resources"])])]))]))]))}}),mt=A({__name:"CommentsThread",props:{resourceId:{}},setup(y){const l=y,{user:o}=E(),a=i([]),{createComment:c,getCommentsForThoughtOutput:b}=xe(),f=async()=>{console.log("Comment thread"),console.log("Props id : ",l.resourceId),a.value=await b(l.resourceId)},m=U(()=>a.value.filter(n=>!n.start_index).sort((n,h)=>n.created_at-h.created_at)),g=i(""),e=async()=>{await c(l.resourceId,null,g.value,!1),g.value="",await f()};return j(async()=>await f()),(n,h)=>(t(),d("div",null,[(t(!0),d(be,null,ke(m.value,x=>(t(),$(fe,{key:x.id,class:"w-full",modelValue:x.content,"onUpdate:modelValue":S=>x.content=S,editing:x.editing,onValidate:S=>x.editing=!1,author:x.author,"created-at":x.created_at},null,8,["modelValue","onUpdate:modelValue","editing","onValidate","author","created-at"]))),128)),s(fe,{class:"w-full",modelValue:g.value,"onUpdate:modelValue":h[0]||(h[0]=x=>g.value=x),editing:!0,onValidate:e,author:q(o),"created-at":null},null,8,["modelValue","author"])]))}}),vt={class:"flex flex-wrap"},pt={class:"flex flex-row-reverse"},_t=A({__name:"CreateInteraction",props:{resource:{}},emits:["close","refresh"],setup(y,{emit:l}){const o=y,a=i([{text:"Lecture / Visionage",value:"inpt"},{text:"Envie",value:"wish"}]),{newInteraction:c,createInteractionForResource:b}=ce(),{user:f}=E(),m=i(c());j(()=>{m.value.interaction_type||(m.value.interaction_type="inpt")});const g=()=>{m.value.resource_id=o.resource.id,m.value.interaction_user_id=f.value.id,b(o.resource.id,m.value),l("refresh"),e()},e=()=>l("close");return(n,h)=>(t(),d("div",null,[p("div",null,"Nouvelle interaction, avec la ressource : "+V(n.resource.title),1),p("div",vt,[s(N,{label:"Avancement de l'ouvrage",class:"my-auto",modelValue:m.value.interaction_progress,"onUpdate:modelValue":h[0]||(h[0]=x=>m.value.interaction_progress=x),type:"number"},null,8,["modelValue"]),s(L,{label:"Type d'interaction",class:"m-4 w-full md:w-5/12 md:ml-auto",choices:a.value,modelValue:m.value.interaction_type,"onUpdate:modelValue":h[1]||(h[1]=x=>m.value.interaction_type=x)},null,8,["choices","modelValue"])]),s(N,{label:"Date de lecture",modelValue:m.value.interaction_date,"onUpdate:modelValue":h[2]||(h[2]=x=>m.value.interaction_date=x),type:"date"},null,8,["modelValue"]),s(te,{label:"Pourquoi s'y être interessé ?",modelValue:m.value.interaction_comment,"onUpdate:modelValue":h[3]||(h[3]=x=>m.value.interaction_comment=x)},null,8,["modelValue"]),p("div",pt,[s(M,{onClick:g,class:"m-4",text:"Valider",type:"valid"}),s(M,{onClick:e,class:"m-4",text:"Annuler",type:"abort"})])]))}}),ft=A({__name:"DateField",props:{date:{}},setup(y){const l=y,o=U(()=>new Date(l.date).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}));return(a,c)=>(t(),d("div",null,V(o.value),1))}}),gt={class:"flex flex-col"},ht={class:"block text-2xs text-slate-800"},xt=["value","placeholder"],yt=A({__name:"NumberInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue","input"],setup(y,{emit:l}){const o=a=>{l("update:modelValue",a.target.value),l("input",a.target.value)};return(a,c)=>(t(),d("div",gt,[p("label",ht,V(a.label),1),p("input",{class:"border border-neutral-400 block h-full w-full rounded-md border-2 p-1 pl-2 text-xs",type:"number",value:a.modelValue,placeholder:a.placeholder,onInput:c[0]||(c[0]=b=>o(b))},null,40,xt)]))}}),bt={class:"grid grid-cols-4 gap-y-2 gap-x-4 auto-rows-auto"},kt=A({__name:"ArticleForm",props:{article:{}},emits:["change"],setup(y,{emit:l}){const o=y,a=i([{text:"Terminé",value:"fnsh"},{text:"Relecture",value:"rvew"},{text:"Idée",value:"idea"}]),c=i([{text:"Livre",value:"book"},{text:"Fiche de lecture",value:"shet"},{text:"Article de média",value:"natc"},{text:"Article de recherche",value:"ratc"},{text:"Film",value:"movi"},{text:"Podcast",value:"pcst"}]),{categories:b}=Fe(),f=U(()=>b.value.map(g=>({text:g.display_name,value:g.id}))),m=(g,e)=>{let n={...o.article};n[g]=e,n.is_external&&(n.maturing_state="fnsh"),console.log("Article : ",n),l("change",n)};return(g,e)=>(t(),d("div",bt,[s(N,{class:"col-span-4",label:"Titre",modelValue:g.article.title,"onUpdate:modelValue":e[0]||(e[0]=n=>m("title",n))},null,8,["modelValue"]),s(N,{class:"col-span-4",label:"Sous-titre",modelValue:g.article.subtitle,"onUpdate:modelValue":e[1]||(e[1]=n=>m("subtitle",n))},null,8,["modelValue"]),s(N,{class:"col-span-4 md:col-span-2",label:"Lien contenu externe",modelValue:g.article.external_content_url,"onUpdate:modelValue":e[2]||(e[2]=n=>m("external_content_url",n))},null,8,["modelValue"]),s(N,{class:"col-span-4 md:col-span-2",label:"Lien image",modelValue:g.article.image_url,"onUpdate:modelValue":e[3]||(e[3]=n=>m("image_url",n))},null,8,["modelValue"]),s(L,{label:"Catégorie",class:"col-span-4 md:col-span-1",choices:f.value,"model-value":g.article.category_id,"onUpdate:modelValue":e[4]||(e[4]=n=>m("category_id",n))},null,8,["choices","model-value"]),s(L,{label:"Type de ressource",class:"col-span-4 md:col-span-1",choices:c.value,"onUpdate:modelValue":e[5]||(e[5]=n=>m("resource_type",n)),"model-value":g.article.resource_type},null,8,["choices","model-value"]),s(L,{label:"Ressource externe",class:"col-span-4 md:col-span-1",choices:[{text:"Oui",value:!0},{text:"Non",value:!1}],"onUpdate:modelValue":e[6]||(e[6]=n=>m("is_external",JSON.parse(n))),"model-value":g.article.is_external},null,8,["model-value"]),s(L,{label:"Stade d'écriture",class:"col-span-4 md:col-span-1",choices:a.value,"model-value":g.article.maturing_state,"onUpdate:modelValue":e[7]||(e[7]=n=>m("maturing_state",n))},null,8,["choices","model-value"])]))}}),wt={class:"grid grid-cols-3 gap-4"},Rt=A({__name:"ResourceAuthorPicker",props:{interaction:{},resourceId:{}},emits:["update"],setup(y,{emit:l}){const o=y,a=i(null),c=i([]),b=_=>{if(_)return{text:`${_.first_name} ${_.last_name}`,value:_.id}},f=U(()=>{var _;return(_=a.value)==null?void 0:_.id}),m=U(()=>{if(c.value)return c.value.map(_=>b(_))}),{getUsers:g,getUserById:e}=E(),n=async _=>a.value=await e(_.interaction_user_id),{createInteractionForResource:h,newInteraction:x,createInteraction:S,updateInteraction:D}=ce(),J=async _=>{if(console.log(`newUser : ${JSON.stringify(_)}`),o.interaction){const w={...o.interaction};w.interaction_user_id=_,console.log("newUserid : ",_.id),console.log(`Interaction payload : ${JSON.stringify(w)}`),await D(o.interaction.id,w),l("update")}else{console.log("create interaction");const w=x();w.interaction_user_id=_,w.resource_id=o.resourceId,await h(o.resourceId,w),l("update")}},P=async _=>{await D(o.interaction.id,_),l("update")};return j(async()=>{c.value=await g(),await n(o.interaction)}),ue(ee(o).interaction,async _=>await n(_)),(_,w)=>(t(),d("div",wt,[s(L,{label:"Auteur",class:"",choices:m.value,"model-value":f.value,"onUpdate:modelValue":w[0]||(w[0]=B=>J(B))},null,8,["choices","model-value"]),_.interaction?(t(),$(N,{key:0,class:"text-2xs",label:"Date d'écriture","model-value":_.interaction.interaction_date?_.interaction.interaction_date.split("T")[0]:null,"onUpdate:modelValue":w[1]||(w[1]=B=>P({..._.interaction,interaction_date:B})),type:"date"},null,8,["model-value"])):k("",!0),_.interaction?(t(),$(yt,{key:1,class:"",label:"Progression",modelValue:_.interaction.interaction_progress,"onUpdate:modelValue":w[2]||(w[2]=B=>P({..._.interaction,interaction_progress:B}))},null,8,["modelValue"])):k("",!0)]))}}),$t={key:0,class:"text-center text-2xl pt-10"},Vt={key:1},Ct={key:0},It={class:"my-8"},Ut=["src"],Tt={class:"text-3xl my-3 font-mplus md:text-center text-left"},At={class:"md:text-center text-left"},Dt={class:"md:text-center text-left"},Bt={class:"md:flex my-8"},St=["href"],Ft={key:1,class:"my-2 flex flex-col"},Pt={class:"flex flex-row-reverse mb-4"},Ot={key:1,class:"p-2 border rounded bg-neutral-100"},Lt=p("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Nt={key:2},qt=p("div",{class:"text-xs italic"},"Commentaire",-1),jt=p("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Et=p("div",{class:"text-xs italic"},"Contenu",-1),zt={key:3},Mt={key:4},Jt={key:5},Ht={class:"fixed right-3 bottom-5"},Wt=A({__name:"ResourceComponent",props:{id:{},secondLevel:{type:Boolean}},setup(y){const l=y,o=Pe(),a=U(()=>l.secondLevel?"popup_tab":"tab"),c=U(()=>[{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli",count:e.value.length},{text:"Sujets",value:"pblm",count:w.value.length},{text:"Interactions",value:"inpt",count:D.value.length}]),b=i(o.query[a.value]&&typeof o.query[a.value]=="string"?o.query[a.value]:"ctnt"),f=i(o.query[a.value]);ue(()=>o.query[a.value],u=>{console.log("new route query",u),typeof u=="string"&&(f.value=u)});const{getResourceRelationsForResource:m,getUsagesForResource:g}=Re(),e=i([]),n=i(!1),h=i(!1),x=async()=>{e.value=await m(ee(l).id.value)},S=U(()=>e.value.map(u=>({resource:u.origin_resource,date:u.created_at,user_id:u.user_id,context_comment:u.relation_comment,progress:null}))),D=i([]),{getInteractionsForResource:J}=ce(),P=async()=>{D.value=await J(l.id)},_=U(()=>D.value.map(u=>({resource:null,date:u.interaction_date,user_id:u.interaction_user_id,context_comment:u.interaction_comment,progress:u.interaction_progress}))),w=i([]),B=async()=>{w.value=await g(l.id)},H=U(()=>w.value.map(u=>({resource:u.target_resource,date:u.created_at,user_id:u.user_id,context_comment:u.relation_comment,progress:null}))),z=i(!1),{newResource:le,getResource:oe,updateResource:W,getAuthorInteractionForResource:I}=ie(),C=i(null),r=i(le()),$e=Oe();ue(()=>o.query.editing,u=>{console.log("Editing : ",u),X.value=u==="false"?!1:!!u});const X=i(!1),de=u=>{$e.push({query:{editing:u.toString()}})},Ve=()=>{!r.value||!r.value.id||(r.value.publishing_state="pbsh",W(r.value.id,r.value))},se=(u,v)=>{r.value=v,C.value!==null&&clearTimeout(C.value),C.value=setTimeout(async()=>{try{await W(u,r.value)}catch(ae){console.log("An error : ",ae)}},1e3)},me=u=>{u!=`
`&&se(ee(l).id.value,{...r.value,content:u})},ve=u=>{u!=`
`&&se(ee(l).id.value,{...r.value,comment:u})},{user:pe,getUserById:Ce}=E(),G=U(()=>r.value.is_external?!0:pe.value?O.value?O.value.id==pe.value.id:!0:!1),O=i(null),F=i(null),Y=i(!1),Ie=async()=>{F.value=await I(l.id)},{getCommentsForThoughtOutput:Ue}=xe(),_e=i([]);return j(async()=>{z.value=!1,r.value=await oe(l.id),z.value=!0,await x(),await P(),await B(),_e.value=await Ue(l.id),F.value=await I(l.id),F.value&&(O.value=await Ce(F.value.interaction_user_id));const u=o.query.editing;X.value=u==="false"?!1:!!u}),(u,v)=>{const ae=ye("router-link");return t(),d("div",null,[z.value?(t(),d("div",Vt,[X.value?(t(),d("div",Ft,[s(kt,{article:r.value,class:"",onChange:v[0]||(v[0]=R=>se(r.value.id,R))},null,8,["article"]),s(Rt,{class:"my-2",interaction:F.value,"resource-id":u.id,onChange:Ie},null,8,["interaction","resource-id"]),p("div",Pt,[s(M,{class:"ml-4",onClick:v[1]||(v[1]=R=>de(!1)),type:"valid",text:"Preview"},{default:T(()=>[Q("Ok")]),_:1}),r.value.publishing_state=="drft"?(t(),$(M,{key:0,onClick:Ve,type:"valid",text:"Publier"})):(t(),d("div",Ot,"Publié"))])])):(t(),d("div",Ct,[p("div",It,[p("img",{src:r.value.image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto",style:{"max-height":"20rem"}},null,8,Ut)]),p("h1",Tt,V(r.value.title),1),p("div",At,V(r.value.subtitle),1),p("div",Dt,[O.value?(t(),$(ae,{key:0,to:"/users/"+O.value.id,class:"text-sm underline"},{default:T(()=>[Q(V(O.value.first_name)+" "+V(O.value.last_name),1)]),_:1},8,["to"])):k("",!0),F.value?(t(),$(ft,{key:1,date:F.value.interaction_date},null,8,["date"])):k("",!0)]),p("div",Bt,[F.value?(t(),$(we,{key:0,"progress-value":F.value.interaction_progress,class:"m-2 w-1/3"},null,8,["progress-value"])):k("",!0),r.value.external_content_url?(t(),d("a",{key:1,class:"ml-auto underline",href:r.value.external_content_url,target:"_blank"}," Lien ressource externe ",8,St)):k("",!0)])])),p("div",null,[X.value?k("",!0):(t(),$(he,{key:0,choices:c.value,default:b.value,"url-key":a.value,url:""},null,8,["choices","default","url-key"]))]),Lt,f.value=="ctnt"?(t(),d("div",Nt,[qt,r.value.publishing_state!="drft"?(t(),$(re,{key:0,"full-text":r.value.comment,editable:G.value,onChange:v[2]||(v[2]=R=>ve(R))},null,8,["full-text","editable"])):(t(),$(te,{key:1,class:"h-20",label:"Commentaire",modelValue:r.value.comment,"onUpdate:modelValue":v[3]||(v[3]=R=>ve(R))},null,8,["modelValue"])),jt,Et,z.value&&!r.value.is_local_draft&&r.value.publishing_state!="drft"?(t(),$(re,{key:2,class:"min-h-fit","ext-comments":_e.value,"resource-id":r.value.id,"full-text":r.value.content,editable:G.value,onChange:v[4]||(v[4]=R=>me(R))},null,8,["ext-comments","resource-id","full-text","editable"])):(t(),$(te,{key:3,class:"h-96",label:"Contenu",modelValue:r.value.content,"onUpdate:modelValue":v[5]||(v[5]=R=>me(R))},null,8,["modelValue"])),s(mt,{"resource-id":u.id},null,8,["resource-id"])])):f.value=="bbli"?(t(),d("div",zt,[s(Z,{open:n.value,onClose:v[7]||(v[7]=R=>n.value=!1)},{default:T(()=>[s(ge,{onRefresh:x,onClose:v[6]||(v[6]=R=>n.value=!1),"target-resource":r.value},null,8,["target-resource"])]),_:1},8,["open"]),p("div",{onClick:v[8]||(v[8]=R=>n.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),s(K,{"contextual-resources":S.value},null,8,["contextual-resources"])])):f.value=="pblm"?(t(),d("div",Mt,[s(K,{"contextual-resources":H.value},null,8,["contextual-resources"])])):f.value=="inpt"?(t(),d("div",Jt,[s(K,{"contextual-resources":_.value},null,8,["contextual-resources"])])):k("",!0),p("div",Ht,[G.value?(t(),$(ne,{key:0,title:"Modifier",onClick:v[9]||(v[9]=R=>de(!0))},{default:T(()=>[s(q(De),{class:"m-1"})]),_:1})):k("",!0),G.value?(t(),$(ne,{key:1,class:"mt-2",color:"red",title:"Marquer comme lu",onClick:v[10]||(v[10]=R=>Y.value=!0)},{default:T(()=>[s(q(Ne),{class:"m-1"})]),_:1})):k("",!0),s(Z,{open:Y.value,onClose:v[12]||(v[12]=R=>Y.value=!1)},{default:T(()=>[s(_t,{onRefresh:P,onClose:v[11]||(v[11]=R=>Y.value=!1),resource:r.value},null,8,["resource"])]),_:1},8,["open"]),G.value?(t(),$(ne,{key:2,class:"mt-2",color:"green",title:"Relier à d'autres ressources",onClick:v[13]||(v[13]=R=>h.value=!0)},{default:T(()=>[s(q(qe),{class:"m-1"})]),_:1})):k("",!0),s(Z,{open:h.value,onClose:v[15]||(v[15]=R=>h.value=!1)},{default:T(()=>[s(ge,{onRefresh:B,onClose:v[14]||(v[14]=R=>h.value=!1),"origin-resource":r.value},null,8,["origin-resource"])]),_:1},8,["open"])])])):(t(),d("div",$t,"Loading..."))])}}});export{Wt as _,ze as a,K as b};
