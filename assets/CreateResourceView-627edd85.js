import{q as R,d as C,b as r,h as I,o as n,f as i,i as s,s as L,c as k,w as T,l as E,m as u,k as N,a as m,_ as B,p as K}from"./index-9488f31e.js";import{_ as f}from"./TextInput.vue_vue_type_script_setup_true_lang-941e02fe.js";import{_ as x}from"./ActionButton.vue_vue_type_script_setup_true_lang-c76570a7.js";import{_ as S}from"./UserPicker.vue_vue_type_script_setup_true_lang-afdd8eb2.js";import{_ as j}from"./SelectionTextInterface.vue_vue_type_script_setup_true_lang-dd7fa5ae.js";import"./SelectionTextInterface.vue_vue_type_style_index_0_lang-3d9cb80c.js";import{u as q}from"./useResource-ef4eea54.js";import{u as O}from"./useInteraction-46bb999b.js";async function G(d){return(await R.post("/link_preview",d)).data}function W(){return{postLinkPreview:G}}const z=C({__name:"ExternalResourcePreview",emits:["change"],setup(d,{emit:o}){const{postLinkPreview:V}=W(),y=async()=>{const p=await V({external_content_url:e.value});console.log(p),v.value=e.value,o("change",p)},e=r(""),v=r(""),g=I(()=>v.value!==e.value);return(p,b)=>(n(),i("div",null,[s(f,{modelValue:e.value,"onUpdate:modelValue":b[0]||(b[0]=c=>e.value=c),class:"mb-4",onKeyup:L(y,["enter"]),label:"Lien ressource externe"},null,8,["modelValue","onKeyup"]),g.value?(n(),k(x,{key:0,class:"mb-4",text:"Preview",onClick:y,type:"valid"},{default:T(()=>[E("Générer")]),_:1})):u("",!0)]))}}),H=async d=>(await R.post("/file_conversion",d,"multipart/form-data")).data;function J(){return{postFileConversion:H}}const M={class:"mt-10 mx-5"},Q={key:0},X={key:1},Y={key:2},Z=m("div",null,"Ajouter a partir d'un fichier",-1),ee={key:1},te=["src"],le={key:0},ae=m("div",{class:"text-2xs text-slate-800"},"Text formaté",-1),se=C({__name:"CreateResourceProcess",setup(d){const o=r(0),{newResource:V,createResource:y}=q(),e=r({id:"",title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"",maturing_state:"",image_url:"",resource_type:"",comment:"",is_local_draft:!0,is_external:!1}),v=a=>{_.value=a,a?(o.value=1,e.value.maturing_state="fnsh",e.is_external=!0):(c.value=b.value.id,e.value.maturing_state="idea",e.is_external=!1,o.value=1,w.value=new Date(Date.now()).toISOString().split("T")[0])},{postFileConversion:g}=J(),p=async a=>{const t=a.target.files[0],l=new FormData;l.append(t.name,t);const P=await g(l);e.value.content=P.content,e.value.title=P.name},{user:b}=K(),c=r(null),w=r(null),_=r(!1),h=r(!1),$=a=>{console.log("apply preview : ",a),e.value.title=a.title,e.value.subtitle=a.subtitle,e.value.image_url=a.image_url,e.value.content=a.content,e.value.resource_type=a.resource_type,e.value.external_content_url=a.external_content_url,h.value=!0},U=r([{text:"Livre",value:"book"},{text:"Fiche de lecture",value:"shet"},{text:"Article de média",value:"natc"},{text:"Article de recherche",value:"ratc"},{text:"Film",value:"movi"},{text:"Podcast",value:"pcst"},{text:"Poême",value:"poem"}]),{createInteractionForResource:D,newInteraction:ne}=O(),F=N(),A=async()=>{const a=await y(e.value),t={interaction_user_id:c.value,resource_id:a.id,interaction_progress:_?100:0,interaction_date:new Date(w.value),interaction_comment:"",interaction_is_public:!!_.value};await D(a.id,t),F.push({path:"/resources/"+a.id,query:{editing:"false"}})};return(a,t)=>(n(),i("div",M,[o.value===0?(n(),i("div",Q,[m("div",null,[s(x,{class:"mb-2",text:"Resource Externe",type:"valid",onClick:t[0]||(t[0]=l=>v(!0))}),s(x,{text:"Production personnelle",type:"valid",onClick:t[1]||(t[1]=l=>v(!1))})])])):u("",!0),o.value===1?(n(),i("div",X,[s(S,{class:"mb-4",modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=l=>c.value=l)},null,8,["modelValue"]),c.value?(n(),k(f,{key:0,class:"text-2xs mb-4",label:"Date d'écriture","model-value":w.value,"onUpdate:modelValue":t[3]||(t[3]=l=>w.value=l),type:"date"},null,8,["model-value"])):u("",!0),s(x,{type:"valid",text:"Valider",onClick:t[4]||(t[4]=l=>o.value=2)})])):u("",!0),o.value===2?(n(),i("div",Y,[m("div",null,[_.value?(n(),k(z,{key:0,onChange:t[5]||(t[5]=l=>$(l))})):u("",!0),Z,m("input",{id:"file",type:"file",onChange:p,placeholder:"Ajouter depuis un fichier"},null,32),!_.value||h.value?(n(),i("div",ee,[s(f,{class:"mb-4",modelValue:e.value.title,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.title=l),label:"Titre"},null,8,["modelValue"]),s(f,{class:"mb-4",modelValue:e.value.subtitle,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.subtitle=l),label:"Description"},null,8,["modelValue"]),s(f,{class:"mb-4",modelValue:e.value.image_url,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.image_url=l),label:"Url de l'image"},null,8,["modelValue"]),m("img",{class:"mb-4",src:e.value.image_url},null,8,te),s(B,{label:"Type de ressource",class:"mb-4",choices:U.value,modelValue:e.value.resource_type,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.resource_type=l)},null,8,["choices","modelValue"]),e.value.content!==""?(n(),i("div",le,[ae,s(j,{class:"max-h-40 overflow-scroll border border-slate-400 mb-4 p-2 rounded",type:"textarea",text:e.value.content},null,8,["text"])])):u("",!0),s(x,{class:"mb-4",text:"Créer",onClick:A,type:"valid"})])):u("",!0)])])):u("",!0)]))}}),oe={class:"w-full"},_e=C({__name:"CreateResourceView",setup(d){return(o,V)=>(n(),i("div",oe,[s(se)]))}});export{_e as default};
