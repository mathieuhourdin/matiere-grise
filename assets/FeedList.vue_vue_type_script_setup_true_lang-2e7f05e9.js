import{_ as M}from"./UserMini.vue_vue_type_script_setup_true_lang-2b68ac2b.js";import{d as L,r as h,j as y,o as P,a as A,b as i,c,l as a,t as u,p as R,h as w,e as f,w as k,f as N,s as S,u as V,m as F,k as I,F as H,g as U,n as z}from"./index-3d64515b.js";import{u as D}from"./useResourceRelations-7060e27d.js";import{a as E,b as O,r as q}from"./PaperAirplaneIcon-909688c6.js";const G=l=>{if(!l||l==="")return[];const t=l.replace(/\?/g,"?.").split(".");let o=0;const s=[];for(;o<t.length;){let n=0,m=[];if(t[o].length>=270)s.push(t[o].replace("/?./g","?")),o++;else{for(;o<t.length&&n+t[o].length<270;)m.push(t[o]),n+=t[o].length,o++;s.push(m.join(". ").replace("/?./g","?"))}}return s},J=l=>l?l.split(`
`).map(o=>G(o)).flat():[],B={splitTextForPanel:J},K=["src"],Q={key:1,class:"bg-white h-full text-center flex items-center justify-center"},W={class:"text-2xl text-black"},X={class:"text-lg text-bold mt-2"},Y={class:"text-bold mb-2"},Z={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},ee={key:1},te={key:1},re=L({__name:"FeedCardTextInterface",props:{interaction:{}},setup(l){const t=l,o=r=>{if(r>0&&r<=p.value.length){const e=p.value[r-1];return{text:e.replace(/#/g,""),header:r===1?"Commentaire : ":null,class:{"font-black":e.charAt(0)==="#","bg-gray-700":!0}}}else{const e=b.value[r-p.value.length-1];return{text:e?e.replace(/#/g,""):"",header:r===p.value.length+1?"Contenu : ":null,class:{"font-black":e&&e.charAt(0)==="#","bg-slate-700":!0}}}},s=h(0),n=()=>{s.value=(s.value+1)%d.value},m=()=>{s.value===0?s.value=d.value-1:s.value=(s.value-1)%d.value},_=y(()=>`${s.value+1}/${d.value}`),d=y(()=>p.value.length+b.value.length+1),b=y(()=>B.splitTextForPanel(t.interaction.resource.content)),p=y(()=>B.splitTextForPanel(t.interaction.context_comment)),C=()=>{if(t.interaction.interaction_type!="inpt"&&t.interaction.resource.image_url!==""){const r=g.value.offsetHeight;g.value.style.height=`${r}px`}},{getAuthorInteractionForResource:T}=S(),v=h(null),g=h(null);return P(async()=>{(t.interaction.interaction_type!="inpt"&&t.interaction.resource.image_url===""||t.interaction.resource.image_url===null)&&(s.value=1);const r=await T(t.interaction.resource.id);r&&(r.resource=t.interaction.resource,r.user_id=r.interaction_user_id,v.value=r)}),(r,e)=>{const x=A("router-link");return r.interaction.interaction_type!="inpt"&&r.interaction.interaction_type!="bibl"?(i(),c("div",{key:0,class:"overflow-auto relative w-full md:h-4/5 h-full min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:g},[s.value==0&&r.interaction.resource.image_url!==""?(i(),c("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:r.interaction.resource.image_url,onLoad:C},null,40,K)):s.value==0?(i(),c("div",Q,[a("div",null,[a("div",W,u(r.interaction.resource.title),1),a("div",X,u(r.interaction.resource.subtitle),1)])])):(i(),c("div",{key:2,class:R(["h-full overflow-scroll p-1 pb-16 border flex items-center justify-center",o(s.value).class])},[a("div",{class:R([o(s.value).class,"text-center text-sm my-auto text-white"])},[a("div",null,[a("div",Y,u(o(s.value).header),1),a("div",null,u(o(s.value).text),1)])],2)],2)),a("div",Z,u(_.value),1),a("div",{class:"absolute h-full w-full left-0 top-0 flex"},[a("div",{class:"w-1/2 h-full",onClick:m}),a("div",{class:"w-1/2 h-full",onClick:n})])],512)):(i(),c("div",ee,[v.value?(i(),w(j,{key:0,interaction:v.value,class:"mx-1.5 mb-0.5 h-96 border-1 border border-slate-600 rounded"},null,8,["interaction"])):(i(),c("div",te,[f(x,{to:"/app/resources/"+r.interaction.resource.id},{default:k(()=>[N(u(r.interaction.resource.title),1)]),_:1},8,["to"])]))]))}}}),oe={class:"flex flex-col py-1.5 overflow-auto dark:border-gray-600 border-t border-black"},se={class:"flex mx-1.5"},ne={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},ae={key:0,class:"flex mx-1.5"},ie={title:"Coming Soon ;)",class:"w-6"},le={title:"Coming Soon ;)",class:"w-6"},ce={key:1,class:"flex mx-1.5"},ue={class:"text-2xs"},de={class:""},pe={class:"mb-2 font-bold text-sm"},me={class:"text-2xs mb-auto"},j=L({__name:"FeedCard",props:{interaction:{}},setup(l){const t=l,o=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",s=e=>e==="outp"?"Production personnelle":"Bibliographie",{resourceTypeOptions:n,getAuthorInteractionForResource:m}=S(),_=e=>n.find(x=>x.value===e).text;h(null);const d=h(null),b=e=>e?e.length>200?e.slice(0,150)+"...":e:"",p=h([]),{getResourceRelationsForResource:C}=D(),T=async()=>{t.interaction.id&&(p.value=await C(t.interaction.resource.id))},{getUserById:v}=V(),g=h(!1),r=async()=>{if(t.interaction.user_id){try{d.value=await v(t.interaction.user_id)}catch(e){console.log(e)}g.value=!0}else{const e=await m(t.interaction.resource.id);d.value=await v(e.value)}};return P(async()=>{await T(),await r()}),(e,x)=>{const $=A("router-link");return i(),c("div",oe,[a("div",se,[g.value?(i(),w(M,{key:0,class:"flex mb-1.5 h-8",user:d.value,secondText:o(e.interaction.date),firstBottomText:s(e.interaction.interaction_type),secondBottomText:e.$t(_(e.interaction.resource.resource_type))},null,8,["user","secondText","firstBottomText","secondBottomText"])):(i(),c("div",ne))]),f(re,{class:"border-1 border-black",interaction:e.interaction},null,8,["interaction"]),e.interaction.interaction_type!="inpt"?(i(),c("div",ae,[a("div",ie,[f(F(E),{class:"w-full my-auto"})]),a("div",le,[f(F(O),{class:"w-full my-auto"})]),f($,{to:"/me/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto"},{default:k(()=>[f(F(q),{class:"w-8"})]),_:1},8,["to"])])):I("",!0),e.interaction.interaction_type!="inpt"?(i(),c("div",ce,[a("div",ue,u(Math.floor(Math.random()*100))+" likes",1),f($,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:k(()=>[N(u(p.value.length)+" relations ",1)]),_:1},8,["to"])])):I("",!0),e.interaction.interaction_type!="inpt"?(i(),w($,{key:2,class:"mx-1.5",to:"/app/resources/"+e.interaction.resource.id},{default:k(()=>[a("div",de,[a("div",pe,u(e.interaction.resource.title),1),a("div",me,u(b(e.interaction.resource.subtitle)),1)])]),_:1},8,["to"])):I("",!0)])}}}),fe={class:"flex flex-col"},ye=L({__name:"FeedList",props:{interactionsList:{}},setup(l){const t=l,{feedFilter:o}=z(),s=y(()=>t.interactionsList.filter(n=>o.value==="production"?n.interaction_type==="outp"&&!n.resource.is_external&&n.resource.resource_type!=="pblm"&&!n.resource.is_external:o.value==="draft"?n.interaction_type==="outp"&&!n.resource.is_external&&(n.resource.maturing_state==="drft"||n.resource.maturing_state==="rvew"):o.value==="reviews"?n.interaction_type==="rvew":o.value==="problem"?n.resource.resource_type==="pblm":o.value==="biblio"?n.interaction_type==="inpt":n.interaction_type==="bibl"||n.interaction_type==="inpt"||!n.resource.is_external));return(n,m)=>(i(),c("div",fe,[(i(!0),c(H,null,U(s.value,(_,d)=>(i(),w(j,{class:"md:mb-2 md:mx-1 flex-grow md:rounded max-h-screen border-t-[1px] md:border-[1px] border-black",interaction:_,key:_.id},null,8,["interaction"]))),128))]))}});export{ye as _};
