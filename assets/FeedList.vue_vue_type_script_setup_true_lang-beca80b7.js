import{o as l,f as i,a as r,d as B,b as d,h as m,e as S,r as j,c as F,I as A,t as u,i as h,n as g,w,l as N,p as z,F as U,g as V,y as D}from"./index-a4be3ca1.js";import{u as H}from"./useResourceRelations-e61ac51c.js";const q=s=>{if(!s)return[];const t=s.replace("/?/g","?.").split(".");let o=0;const c=[];for(;o<t.length;){let a=0,n=[];if(t[o].length>=270)c.push(t[o].replace("/?./g","?")),o++;else{for(;o<t.length&&a+t[o].length<270;)n.push(t[o]),a+=t[o].length,o++;c.push(n.join(". ").replace("/?./g","?"))}}return c},E=s=>s?s.split(`
`).map(o=>q(o)).flat():[],T={splitTextForPanel:E};function G(s,t){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function J(s,t){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})])}function K(s,t){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}const O={class:"flex flex-col border p-1.5 overflow-auto"},Q={class:"flex"},W={key:1,class:"animate-pulse w-2/3 bg-gradient-to-r from-slate-600 h-8 mb-1.5"},X=["src"],Y={key:1,class:"overflow-auto h-full overflow-scroll bg-red-100 p-1 pt-8 border"},Z={class:"bg-red-100 text-center text-sm my-auto"},ee={key:2,class:"overflow-auto h-full overflow-scroll bg-blue-100 p-1 pt-8 border"},te={class:"bg-blue-100 text-center text-sm my-auto"},oe={class:"absolute right-2 top-2 bg-gray-400 rounded-xl p-1 text-xs opacity-70"},re={class:"flex"},se={title:"Coming Soon ;)",class:"w-6"},ne={title:"Coming Soon ;)",class:"w-6"},le={class:"flex"},ae={class:"text-2xs"},ie={class:""},ce={class:"mb-2 font-bold text-sm"},ue={class:"text-2xs mb-auto"},de=B({__name:"FeedCard",props:{interaction:{}},setup(s){const t=s,o=e=>e?e.toLocaleString("fr-FR",{day:"numeric",month:"short",year:"2-digit"}):"",c=e=>e==="outp"?"Production personnelle":"Bibliographie",a=e=>{switch(e){case"pblm":return"ProblÃ©matique";case"book":return"Livre";case"atcl":return"Article";case"ratc":return"Article de recherche"}return e},n=d(0);d(null);const p=d(null),x=()=>{n.value=(n.value+1)%b.value},L=m(()=>`${n.value+1}/${b.value}`),b=m(()=>f.value.length+y.value.length+1),y=m(()=>T.splitTextForPanel(t.interaction.resource.content)),f=m(()=>T.splitTextForPanel(t.interaction.context_comment)),M=e=>e?e.length>200?e.slice(0,150)+"...":e:"",k=d([]),{getResourceRelationsForResource:R}=H(),$=async()=>{t.interaction.id&&(k.value=await R(t.interaction.resource.id))},{getUserById:P}=z(),C=d(!1),I=async()=>{try{p.value=await P(t.interaction.user_id)}catch(e){console.log(e)}C.value=!0},v=d(null);return S(async()=>{await $(),await I();const e=v.value.offsetHeight;v.value.style.height=`${e}px`}),(e,pe)=>{const _=j("router-link");return l(),i("div",O,[r("div",Q,[C.value?(l(),F(A,{key:0,class:"flex mb-1.5 h-8",user:p.value,secondText:o(e.interaction.date),firstBottomText:c(e.interaction.interaction_type),secondBottomText:a(e.interaction.resource.resource_type)},null,8,["user","secondText","firstBottomText","secondBottomText"])):(l(),i("div",W))]),r("div",{onClick:x,class:"overflow-auto relative w-full md:h-4/5 min-h-60 mb-2 bg-gray-700",ref_key:"parentCard",ref:v},[n.value==0?(l(),i("img",{key:0,class:"overflow-auto object-contain w-full h-full mt-auto mx-auto",src:e.interaction.resource.image_url},null,8,X)):n.value>0&&n.value<=f.value.length?(l(),i("div",Y,[r("div",Z,u(f.value[n.value-1]),1)])):(l(),i("div",ee,[r("div",te,u(y.value[n.value-f.value.length-1]),1)])),r("div",oe,u(L.value),1)],512),r("div",re,[r("div",se,[h(g(J),{class:"w-full my-auto"})]),r("div",ne,[h(g(K),{class:"w-full my-auto"})]),h(_,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto"},{default:w(()=>[h(g(G),{class:"w-8"})]),_:1},8,["to"])]),r("div",le,[r("div",ae,u(Math.floor(Math.random()*100))+" likes",1),h(_,{to:"/resources/"+e.interaction.resource.id+"/feed",class:"ml-auto text-2xs underline"},{default:w(()=>[N(u(k.value.length)+" relations ",1)]),_:1},8,["to"])]),h(_,{class:"",to:"/resources/"+e.interaction.resource.id},{default:w(()=>[r("div",ie,[r("div",ce,u(e.interaction.resource.title),1),r("div",ue,u(M(e.interaction.resource.subtitle)),1)])]),_:1},8,["to"])])}}}),he={class:"flex flex-col"},ve=B({__name:"FeedList",props:{interactionsList:{}},setup(s){const t=s,{feedFilter:o}=D(),c=m(()=>t.interactionsList.filter(a=>o.value==="production"?a.interaction_type==="outp"&&!a.resource.is_external&&a.resource.resource_type!=="pblm":o.value==="problem"?a.resource.resource_type==="pblm":o.value==="biblio"?a.interaction_type==="inpt":!0));return(a,n)=>(l(),i("div",he,[(l(!0),i(U,null,V(c.value,(p,x)=>(l(),F(de,{class:"md:mb-2 flex-grow md:rounded max-h-screen border-b-1 border-black",interaction:p,key:p.id},null,8,["interaction"]))),128))]))}});export{ve as _};
