import{d as K,j as y,c as s,t as c,k,p as o,m as d,l as m,F as f,g as h,X as V,b as r,n as E}from"./index-7b431e64.js";const j={key:0,class:"text-left"},O={key:0,class:"text-xs leading-4 text-slate-300"},Y={key:1,class:"text-[10px] text-slate-500"},z={key:2,class:"mt-1 text-[10px] text-slate-500"},A=["title"],H={key:1},J={key:0,class:"flex items-center justify-between mb-3"},P={key:0,class:"text-lg font-semibold text-slate-700 dark:text-slate-200"},R={key:1,class:"text-xs text-slate-500"},X={key:1,class:"text-sm text-slate-500"},q={key:2,class:"text-sm text-slate-500"},G={key:3},Q=["title"],Z={key:0,class:"mt-3 flex items-center gap-2 text-xs text-slate-500"},I=V('<div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm border border-slate-300 dark:border-slate-700 bg-slate-200 dark:bg-slate-800/50"></span><span class="w-3 h-3 rounded-sm border border-emerald-900 bg-emerald-900/50"></span><span class="w-3 h-3 rounded-sm border border-emerald-800 bg-emerald-800/70"></span><span class="w-3 h-3 rounded-sm border border-emerald-700 bg-emerald-700/90"></span><span class="w-3 h-3 rounded-sm border border-emerald-600 bg-emerald-600"></span></div>',1),te=K({__name:"HeatmapDisplay",props:{days:{},compact:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},title:{default:""},emptyText:{default:"No data"},monthLocale:{default:"fr-FR"},weekdayLabels:{},legendLessLabel:{default:"Moins"},legendMoreLabel:{default:"Plus"},showLegend:{type:Boolean,default:!0},showMax:{type:Boolean,default:!0},rangeStart:{default:null},rangeEnd:{default:null},hideFirstCompactMonthLabel:{type:Boolean,default:!1},compactWeeksLimit:{default:null}},setup($){const i=$,{isMobile:n}=E(),N=y(()=>i.weekdayLabels&&i.weekdayLabels.length===7?i.weekdayLabels:["Lu","Ma","Me","Je","Ve","Sa","Di"]),L=e=>{const[a,t,l]=e.split("-").map(Number);return new Date(Date.UTC(a,t-1,l))},C=e=>{const a=e.getUTCFullYear(),t=String(e.getUTCMonth()+1).padStart(2,"0"),l=String(e.getUTCDate()).padStart(2,"0");return`${a}-${t}-${l}`},U=e=>{if(!e)return null;if(typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const a=new Date(e);return Number.isNaN(a.getTime())?null:C(a)},M=e=>{if(!e)return null;if(e instanceof Date)return Number.isNaN(e.getTime())?null:new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()));if(/^\d{4}-\d{2}-\d{2}$/.test(e))return L(e);const a=new Date(e);return Number.isNaN(a.getTime())?null:new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()))},B=e=>{const t=(e.getUTCDay()+6)%7;return new Date(e.getTime()-t*864e5)},F=e=>{const t=6-(e.getUTCDay()+6)%7;return new Date(e.getTime()+t*864e5)},w=y(()=>{const e=new Map;for(const a of i.days??[]){const t=U(a.day);if(!t)continue;const l=Number(a.value??0);e.set(t,(e.get(t)??0)+(Number.isNaN(l)?0:l))}return e}),v=y(()=>{const e=Array.from(w.value.values());return e.length===0?0:Math.max(...e)}),T=y(()=>{const e=M(i.rangeStart),a=M(i.rangeEnd);if(e&&a&&e.getTime()<=a.getTime())return{start:e,end:a};if(w.value.size===0)return null;const t=Array.from(w.value.keys()).sort();return{start:L(t[0]),end:L(t[t.length-1])}}),g=y(()=>{var u;if(!T.value)return[];const e=B(T.value.start),a=F(T.value.end),t=[];for(let p=e.getTime();p<=a.getTime();p+=864e5){const x=new Date(p),b=C(x),S=w.value.get(b)??0;t.push({date:x,dateStr:b,value:S})}const l=[];for(let p=0;p<t.length;p+=7){const x=t.slice(p,p+7),b=x.find(S=>S.date.getUTCDate()===1);l.push({weekStart:((u=x[0])==null?void 0:u.dateStr)??`week-${p}`,monthLabel:b?b.date.toLocaleString(i.monthLocale,{month:"short"}):"",days:x})}return l}),D=y(()=>{const e=i.compactWeeksLimit;if(!i.compact||e==null||!Number.isFinite(e)||e<=0)return g.value;const a=Math.floor(e);return g.value.length<=a?g.value:g.value.slice(g.value.length-a)}),W=(e,a)=>!e||i.hideFirstCompactMonthLabel&&a===0?"":e.replace(".","").slice(0,3),_=e=>{if(!e||v.value===0)return i.compact?"bg-slate-800/50":"bg-slate-200 dark:bg-slate-800/50";const a=e/v.value;return a<=.25?"bg-emerald-700/60 border-emerald-700":a<=.5?"bg-emerald-600/70 border-emerald-600":a<=.75?"bg-emerald-600/90 border-emerald-600":"bg-emerald-600 border-emerald-400"};return(e,a)=>e.compact?(r(),s("div",j,[e.title?(r(),s("div",O,c(e.title),1)):k("",!0),e.loading?(r(),s("div",Y,"...")):D.value.length===0?(r(),s("div",z,c(e.emptyText),1)):(r(),s("div",{key:3,class:o(["mt-1 flex flex-col",d(n)?"gap-[1px]":"gap-[2px]"])},[m("div",{class:o(["flex leading-none text-slate-500",d(n)?"gap-[1px] h-[10px] text-[8px]":"gap-[2px] h-3 text-[9px]"])},[(r(!0),s(f,null,h(D.value,(t,l)=>(r(),s("div",{key:`compact-month-${l}-${t.weekStart}`,class:o(["overflow-hidden text-ellipsis whitespace-nowrap",d(n)?"w-[12px]":"w-[17px]"])},c(W(t.monthLabel,l)),3))),128))],2),m("div",{class:o(["flex",d(n)?"gap-[1px]":"gap-[2px]"])},[(r(!0),s(f,null,h(D.value,(t,l)=>(r(),s("div",{key:`compact-week-${l}-${t.weekStart}`,class:o(["grid grid-rows-7",d(n)?"gap-[1px]":"gap-[2px]"])},[(r(!0),s(f,null,h(t.days,u=>(r(),s("div",{key:`compact-day-${u.dateStr}`,class:o([d(n)?"w-[12px] h-[12px] rounded-[3px]":"w-[17px] h-[17px] rounded-[4px]","border border-slate-700",_(u.value)]),title:`${u.dateStr}: ${u.value}`},null,10,A))),128))],2))),128))],2)],2))])):(r(),s("div",H,[e.title||e.showMax&&v.value>0?(r(),s("div",J,[e.title?(r(),s("h2",P,c(e.title),1)):k("",!0),e.showMax&&v.value>0?(r(),s("div",R," Max: "+c(v.value),1)):k("",!0)])):k("",!0),e.loading?(r(),s("div",X,"Chargement...")):g.value.length===0?(r(),s("div",q,c(e.emptyText),1)):(r(),s("div",G,[m("div",{class:o(["flex overflow-x-auto",d(n)?"gap-1":"gap-2"])},[m("div",{class:o(["grid grid-rows-7 pr-2 text-slate-500",d(n)?"gap-[2px] pt-4 text-[9px]":"gap-1 pt-5 text-[10px]"])},[(r(!0),s(f,null,h(N.value,t=>(r(),s("div",{key:t,class:o(["flex items-center justify-end leading-none",d(n)?"h-3":"h-4"])},c(t),3))),128))],2),m("div",{class:o(["flex flex-col",d(n)?"gap-1":"gap-2"])},[m("div",{class:o(["flex text-xs text-slate-500",d(n)?"gap-[2px] h-3 text-[10px]":"gap-1 h-4"])},[(r(!0),s(f,null,h(g.value,(t,l)=>(r(),s("div",{key:`month-${l}-${t.weekStart}`,class:o(d(n)?"w-3":"w-4")},c(t.monthLabel),3))),128))],2),m("div",{class:o(["flex",d(n)?"gap-[2px]":"gap-1"])},[(r(!0),s(f,null,h(g.value,(t,l)=>(r(),s("div",{key:`week-${l}-${t.weekStart}`,class:o(["grid grid-rows-7",d(n)?"gap-[2px]":"gap-1"])},[(r(!0),s(f,null,h(t.days,u=>(r(),s("div",{key:`day-${u.dateStr}`,class:o([d(n)?"w-3 h-3":"w-4 h-4","rounded-sm border border-slate-300 dark:border-slate-700",_(u.value)]),title:`${u.dateStr}: ${u.value}`},null,10,Q))),128))],2))),128))],2)],2)],2),e.showLegend?(r(),s("div",Z,[m("span",null,c(e.legendLessLabel),1),I,m("span",null,c(e.legendMoreLabel),1)])):k("",!0)]))]))}});export{te as _};
