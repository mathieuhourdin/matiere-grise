import{_ as ke,u as Oe,a as ce}from"./useArticle-234f0cf4.js";import{b as a,c,e as r,d as I,t as w,F as me,l as pe,r as p,q as D,o as L,f as u,m as j,y as Le,w as se,z as H,p as Pe,A as Ee,B as Ne,j as k,s as $e,g as R,h as S,i as Z,C as Me,D as qe,E as A,G as Ve,k as q,H as je,I as ze,x as He,u as Je,a as Ke}from"./index-a270df15.js";import{_ as K}from"./ActionButton.vue_vue_type_script_setup_true_lang-a620d8d6.js";import{_ as de,a as xe,u as Re}from"./TextInterface.vue_vue_type_script_setup_true_lang-038fedf2.js";import{_ as M}from"./TextInput.vue_vue_type_script_setup_true_lang-9cd02321.js";import{_ as Ce}from"./ProgressBar.vue_vue_type_script_setup_true_lang-261f7e20.js";import{u as ve}from"./useResource-08b13a78.js";import{a as We,u as Ie}from"./useProblem-ec461d21.js";function Ge(o,e){return a(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 8.25H7.5a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25H15M9 12l3 3m0 0l3-3m-3 3V2.25"})])}function Qe(o,e){return a(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}function Xe(o,e){return a(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z"})])}const Ye={class:"block text-2xs text-slate-800"},Ze=["value"],et=["value"],J=I({__name:"SelectInput",props:{label:{},choices:{},modelValue:{},displayFunction:{type:Function,default:o=>o.text}},emits:["update:modelValue"],setup(o,{emit:e}){const t=s=>{console.log(s.target.value),e("update:modelValue",s.target.value)};return(s,l)=>(a(),c("div",null,[r("label",Ye,w(s.label),1),r("select",{value:s.modelValue,name:"Stade d'écriture",class:"text-xs w-full p-1 block rounded border-2 border-neutral-400",onInput:l[0]||(l[0]=i=>t(i))},[(a(!0),c(me,null,pe(s.choices,i=>(a(),c("option",{key:i.value,value:i.value},w(s.displayFunction(i)),9,et))),128))],40,Ze)]))}}),tt={class:"m-4"},ot={class:"block text-2xs text-slate-800"},st=["value","placeholder"],ee=I({__name:"TextAreaInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue"],setup(o,{emit:e}){const t=s=>{e("update:modelValue",s.target.value)};return(s,l)=>(a(),c("div",tt,[r("label",ot,w(s.label),1),r("textarea",{class:"border border-neutral-800 block h-full w-full",value:s.modelValue,placeholder:s.placeholder,onInput:l[0]||(l[0]=i=>t(i))},null,40,st)]))}}),nt=r("hr",{class:"border-top border-zinc-400 my-4"},null,-1),at=r("div",{class:"text-xs italic"},"Raison de la lecture",-1),lt=I({__name:"SeeThoughtInput",props:{thoughtInput:{}},setup(o){const e=o,{getUserById:t,user:s}=j(),l=p(null),i=D(()=>s.value?e.thoughtInput.interaction_user_id===s.value.id:!1);return L(async()=>{e.thoughtInput.interaction_user_id&&(l.value=await t(e.thoughtInput.interaction_user_id))}),(f,d)=>(a(),c("div",null,[u(To,{id:f.thoughtInput.resource_id,"second-level":""},null,8,["id"]),nt,at,u(de,{"full-text":f.thoughtInput.interaction_comment,editable:i.value},null,8,["full-text","editable"])]))}}),rt={class:"flex"},oe=I({__name:"ModalSheet",props:{open:{type:Boolean,default:!1}},emits:["close"],setup(o,{emit:e}){const t=o,s=p(!1);return L(()=>{s.value=t.open}),Le(()=>{const l=i=>{(i.key==="Escape"||i.key==="Enter"||i.key==="Esc"||i.keyCode===27)&&e("close")};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}}),se(H(t).open,l=>s.value=l),(l,i)=>s.value?(a(),c("div",{key:0,tabindex:"0",onKeyup:i[2]||(i[2]=Ne(f=>e("close"),["esc"])),class:"fixed top-0 left-0 w-full h-full z-10 bg-slate-500/50",onClick:i[3]||(i[3]=f=>e("close"))},[r("div",{class:"max-w-xl overflow-y-scroll max-h-screen mb-10 bg-white mx-auto mt-6 p-4 rounded shadow",onClick:i[1]||(i[1]=Ee(()=>{},["stop"]))},[r("div",rt,[r("div",{class:"ml-auto",onClick:i[0]||(i[0]=f=>e("close"))},"x")]),Pe(l.$slots,"default")])],32)):k("",!0)}}),ut={class:"w-full md:w-96"},it={key:0,class:"text-xs italic mb-2 bg-white"},ct={class:"flex flex-wrap"},dt={key:1,class:"text-2xs italic ml-2"},mt={key:2,class:"ml-auto m-1 w-1/3"},pt={key:0,class:"border shadow-lg rounded p-4 md:w-96 bg-white"},vt={class:"flex"},_t=["src"],ft={class:"flex flex-wrap w-full",style:{"margin-top":"-8px"}},gt={class:"text-2xs"},ht={class:"flex flex-wrap"},yt={key:0,class:"text-2xs italic"},bt=I({__name:"ThoughtInputCard",props:{contextualResource:{},isDisabled:{type:Boolean,default:!1}},setup(o){const e=o,{getUserById:t}=j(),{getAuthorInteractionForResource:s}=ve(),l=p(null),i=p(null),f=p(null);L(async()=>{e.contextualResource.user_id&&(f.value=await t(e.contextualResource.user_id)),e.contextualResource.resource&&(i.value=await s(e.contextualResource.resource.id)),i.value&&(l.value=await t(i.value.interaction_user_id))});const d=n=>n?n.toLocaleString("fr-FR",{hour:"numeric",weekday:"short",day:"numeric",month:"short",year:"2-digit"}):"",g=n=>n.length>200?n.slice(0,150)+"...":n;return(n,m)=>{const b=$e("router-link");return a(),c("div",ut,[n.contextualResource.context_comment?(a(),c("div",it,[r("div",null,w(n.contextualResource.context_comment),1),r("div",ct,[f.value?(a(),R(b,{key:0,to:"/users/"+f.value.id,class:"text-2xs underline"},{default:S(()=>[Z(w(f.value.first_name)+" "+w(f.value.last_name),1)]),_:1},8,["to"])):k("",!0),n.contextualResource.date?(a(),c("div",dt,w(d(n.contextualResource.date)),1)):k("",!0),n.contextualResource.progress?(a(),c("div",mt,[u(Ce,{"progress-value":n.contextualResource.progress},null,8,["progress-value"])])):k("",!0)])])):k("",!0),n.contextualResource.resource?(a(),R(Me(n.isDisabled?"span":"vue-router"),{key:1,to:"/resources/"+n.contextualResource.resource.id+"?tab=ctnt"},{default:S(()=>[n.contextualResource.resource?(a(),c("div",pt,[r("div",vt,[n.contextualResource.resource?(a(),c("img",{key:0,class:"w-8 h-fit mr-4",src:n.contextualResource.resource.image_url},null,8,_t)):k("",!0),r("div",null,[r("div",null,w(n.contextualResource.resource.title)+" "+w(n.contextualResource.resource.subtitle),1),r("div",ft,[l.value?(a(),R(b,{key:0,to:"/users/"+l.value.id,class:"text-2xs underline"},{default:S(()=>[Z(w(l.value.first_name)+" "+w(l.value.last_name),1)]),_:1},8,["to"])):k("",!0)]),r("div",gt,w(g(n.contextualResource.resource.comment)),1)])]),r("div",ht,[n.contextualResource.date?(a(),c("div",yt,w(d(n.contextualResource.resourcedate)),1)):k("",!0)])])):k("",!0)]),_:1},8,["to"])):k("",!0)])}}}),xt={class:"w-fit"},wt=I({__name:"ThoughtInputCardWithPopup",props:{thoughtInput:{},usageReason:{},isDisabled:{type:Boolean,default:!1}},setup(o){const e=p(!1);return(t,s)=>(a(),c("div",xt,[u(oe,{open:e.value,onClose:s[0]||(s[0]=l=>e.value=!1)},{default:S(()=>[u(lt,{"thought-input":t.thoughtInput,"usage-reason":t.usageReason},null,8,["thought-input","usage-reason"])]),_:1},8,["open"]),u(bt,{class:"md:w-96","contextual-resource":t.thoughtInput,"is-disabled":t.isDisabled},null,8,["contextual-resource","is-disabled"])]))}}),kt={class:"relative max-w-full"},$t={key:0,class:"absolute md:border h-full start-1/2 -z-10"},Y=I({__name:"ThoughtInputsList",props:{contextualResources:{},center:{type:Boolean,default:!1},linksDisabled:{type:Boolean,default:!1}},emits:["select"],setup(o,{emit:e}){const t=l=>l.sort((i,f)=>+(f.date>i.date)),s=l=>{console.log("Select"),e("select",l)};return(l,i)=>(a(),c("div",kt,[l.center?k("",!0):(a(),c("div",$t)),(a(!0),c(me,null,pe(t(l.contextualResources),(f,d)=>(a(),R(wt,{key:f.id,class:qe(["mb-4 md:mb-1 mx-auto max-w-full max-w-fit p-1",{"md:ml-0":d%2==0&&!l.center,"md:mr-0":!l.center}]),"thought-input":f,onClick:g=>s(f),"is-disabled":l.linksDisabled},null,8,["class","thought-input","onClick","is-disabled"]))),128))]))}}),{launchSnackbar:Vt}=Ve();function Rt(){const o={title:"",subtitle:"",content:"",external_content_url:"",publishing_state:"pbsh",maturing_state:"fnsh",image_url:"",resource_type:"",comment:""};return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0,resource:o}}function ne(o){return console.log("Date : ",o.interaction_date),o.interaction_date=new Date(o.interaction_date),o}async function Ct(){return(await A.get("/thought_inputs?limit=60")).data.map(e=>ne(e))}async function It(o){const e=await A.get("/thought_inputs/"+o);return ne(e.data)}async function Ut(o){return(await A.get("/users/"+o+"/thought_inputs?limit=60")).data.map(t=>ne(t))}async function Dt(o){const e=new Date(o.interaction_date);console.log("Date : ",e);const t=e.toISOString().split(".")[0];o.interaction_progress=Number(o.interaction_progress);const s=await A.post("/thought_inputs",{...o,interaction_date:t});return Vt("Creation de l'input réussie","success"),ne(s.data)}function St(){return{getUserThoughtInputs:Ut,newThoughtInput:Rt,createThoughtInput:Dt,getThoughtInputs:Ct,getThoughtInput:It}}const At={key:0,class:"mb-4"},Tt={key:1},Bt={key:1},Ft={key:2},Ot={class:"flex flex-row-reverse"},we=I({__name:"CreateResourceRelationForm",props:{targetResource:{},originResource:{}},emits:["close","refresh"],setup(o,{emit:e}){const t=o,{user:s}=j(),l=p(),i=U=>{console.log("Event : ",U),l.value=U},f=p([{text:"Externes",value:"extr"},{text:"Internes",value:"artl"},{text:"Problème",value:"pblm"}]),d=p([{text:"Biblio",value:"bibl"},{text:"Résumé",value:"sumr"},{text:"Sujet principal",value:"main"},{text:"Evocation",value:"mino"}]),g=p([]),n=p(null),m=p([]),b=p([]),x=p([]),F=p(""),T=p(""),{createResourceRelation:W}=Ie(),{getResources:E}=ve(),{getArticles:y}=Oe(),{getProblems:$}=We(),B=D(()=>g.value.map(U=>({resource:U.resource}))),G=U=>U.map(C=>({resource:C})),z=D(()=>({extr:G(m.value),artl:G(b.value),pblm:G(x.value)})),ae=async()=>{if(console.log("create"),!n.value)return;const U={target_resource_id:t.targetResource?t.targetResource.id:n.value.id,origin_resource_id:t.originResource?t.originResource.id:n.value.id,relation_comment:F.value,relation_type:T.value};await W(U),e("refresh"),e("close")},{getUserThoughtInputs:le}=St(),Q=U=>{n.value=U.resource};return L(async()=>{!s.value||!s.value.id||(t.targetResource&&(g.value=await le(s.value.id)),t.originResource&&(m.value=await E(),b.value=await y({author:!0}),x.value=await $()))}),(U,C)=>(a(),c("div",null,[q(s)?(a(),c("div",At," Nouvelle relation entre ressources par "+w(q(s).first_name)+" "+w(q(s).last_name),1)):k("",!0),n.value?(a(),c("div",Ft,[u(J,{class:"m-4",label:"Type de lien",choices:d.value,modelValue:T.value,"onUpdate:modelValue":C[2]||(C[2]=v=>T.value=v)},null,8,["choices","modelValue"]),u(ee,{class:"m-4",label:"Pourquoi ajouter cet élément ?",modelValue:F.value,"onUpdate:modelValue":C[3]||(C[3]=v=>F.value=v)},null,8,["modelValue"]),r("div",Ot,[u(K,{type:"valid",onClick:ae,text:"Ajouter"}),u(K,{type:"abort",onClick:C[4]||(C[4]=v=>e("close")),text:"Annuler",class:"mr-1"})])])):(a(),c("div",Tt,[U.targetResource?(a(),R(Y,{key:0,"contextual-resources":B.value,center:"","links-disabled":"",onSelect:C[0]||(C[0]=v=>Q(v))},null,8,["contextual-resources"])):(a(),c("div",Bt,[r("div",null,[Z(" Choisir une ressource cible "),u(ke,{center:"",choices:f.value,default:"pblm",onUpdate:i},null,8,["choices"]),u(Y,{"contextual-resources":z.value[l.value]||[],center:"",onSelect:C[1]||(C[1]=v=>Q(v)),"links-disabled":""},null,8,["contextual-resources"])])]))]))]))}}),Lt=I({__name:"CommentsThread",props:{resourceId:{}},setup(o){const e=o,{user:t}=j(),s=p([]),{createComment:l,getCommentsForThoughtOutput:i}=Re(),f=async()=>{console.log("Comment thread"),console.log("Props id : ",e.resourceId),s.value=await i(e.resourceId)},d=D(()=>s.value.filter(m=>!m.start_index).sort((m,b)=>m.created_at-b.created_at)),g=p(""),n=async()=>{await l(e.resourceId,null,g.value,!1),g.value="",await f()};return L(async()=>await f()),(m,b)=>(a(),c("div",null,[(a(!0),c(me,null,pe(d.value,x=>(a(),R(xe,{key:x.id,class:"w-full",modelValue:x.content,"onUpdate:modelValue":F=>x.content=F,editing:x.editing,onValidate:F=>x.editing=!1,author:x.author,"created-at":x.created_at},null,8,["modelValue","onUpdate:modelValue","editing","onValidate","author","created-at"]))),128)),u(xe,{class:"w-full",modelValue:g.value,"onUpdate:modelValue":b[0]||(b[0]=x=>g.value=x),editing:!0,onValidate:n,author:q(t),"created-at":null},null,8,["modelValue","author"])]))}}),{launchSnackbar:Ue}=Ve();function Pt(){return{interaction_progress:0,interaction_date:new Date(Date.now()),interaction_comment:"",interaction_is_public:!0}}function P(o){return console.log("Date : ",o.interaction_date),o.interaction_date=new Date(o.interaction_date),o}async function Et(){return(await A.get("/thought_inputs?limit=60")).data.map(e=>P(e))}async function Nt(o){return(await A.get("/users/"+o+"/thought_outputs?limit=60")).data.map(t=>P(t))}async function Mt(o){const e=await A.get("/thought_inputs/"+o);return P(e.data)}async function qt(o){return(await A.get("/users/"+o+"/thought_inputs")).data.map(t=>P(t))}async function jt(o,e){const t=new Date(e.interaction_date);console.log("Date : ",t);const s=t.toISOString().split(".")[0];e.interaction_progress=Number(e.interaction_progress);const l=await A.put("/interactions/"+o,{...e,interaction_date:s});return P(l.data)}async function zt(o){const e=new Date(o.interaction_date);console.log("Date : ",e);const t=e.toISOString().split(".")[0];o.interaction_progress=Number(o.interaction_progress);const s=await A.post("/thought_inputs",{...o,interaction_date:t});return Ue("Creation de l'input réussie","success"),P(s.data)}async function Ht(o,e){const t=new Date(e.interaction_date);console.log("Date : ",t);const s=t.toISOString().split(".")[0];e.interaction_progress=Number(e.interaction_progress);const l=await A.post(`/resources/${o}/interactions`,{...e,interaction_date:s});return Ue("Creation de l'input réussie","success"),P(l.data)}async function Jt(o){return(await A.get(`/resources/${o}/interactions`)).data.map(t=>P(t))}function _e(){return{getUserInteractions:qt,newInteraction:Pt,createInteraction:zt,getInteractions:Et,getInteraction:Mt,updateInteraction:jt,createInteractionForResource:Ht,getInteractionsForResource:Jt,getUserThoughtOutputs:Nt}}const Kt={class:"flex flex-wrap"},Wt={class:"flex flex-row-reverse"},Gt=I({__name:"CreateInteraction",props:{resource:{}},emits:["close","refresh"],setup(o,{emit:e}){const t=o,s=p([{text:"Lecture / Visionage",value:"inpt"},{text:"Envie",value:"wish"}]),{newInteraction:l,createInteractionForResource:i}=_e(),{user:f}=j(),d=p(l());L(()=>{d.value.interaction_type||(d.value.interaction_type="inpt")});const g=()=>{d.value.resource_id=t.resource.id,d.value.interaction_user_id=f.value.id,i(t.resource.id,d.value),e("refresh"),n()},n=()=>e("close");return(m,b)=>(a(),c("div",null,[r("div",null,"Nouvelle interaction, avec la ressource : "+w(m.resource.title),1),r("div",Kt,[u(M,{label:"Avancement de l'ouvrage",class:"my-auto",modelValue:d.value.interaction_progress,"onUpdate:modelValue":b[0]||(b[0]=x=>d.value.interaction_progress=x),type:"number"},null,8,["modelValue"]),u(J,{label:"Type d'interaction",class:"m-4 w-full md:w-5/12 md:ml-auto",choices:s.value,modelValue:d.value.interaction_type,"onUpdate:modelValue":b[1]||(b[1]=x=>d.value.interaction_type=x)},null,8,["choices","modelValue"])]),u(M,{label:"Date de lecture",modelValue:d.value.interaction_date,"onUpdate:modelValue":b[2]||(b[2]=x=>d.value.interaction_date=x),type:"date"},null,8,["modelValue"]),u(ee,{label:"Pourquoi s'y être interessé ?",modelValue:d.value.interaction_comment,"onUpdate:modelValue":b[3]||(b[3]=x=>d.value.interaction_comment=x)},null,8,["modelValue"]),r("div",Wt,[u(K,{onClick:g,class:"m-4",text:"Valider",type:"valid"}),u(K,{onClick:n,class:"m-4",text:"Annuler",type:"abort"})])]))}}),Qt=I({__name:"DateField",props:{date:{}},setup(o){const e=o,t=D(()=>new Date(e.date).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}));return(s,l)=>(a(),c("div",null,w(t.value),1))}}),Xt=I({__name:"CheckboxInput",props:{label:{},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(o,{emit:e}){const t=o,s="checkbox-"+Math.random().toString(36).substr(2,9),l=p(H(t).modelValue),i=()=>{l.value=!l.value,console.log(l.value),e("update:modelValue",!t.modelValue)};return(f,d)=>(a(),c("div",null,[je(r("input",{class:"m-2",type:"checkbox",id:s,"onUpdate:modelValue":d[0]||(d[0]=g=>l.value=g),onChange:i},null,544),[[ze,l.value]]),r("label",{for:s},w(f.label),1)]))}}),Yt={class:"m-4"},Zt={class:"block text-2xs text-slate-800"},eo=["value","placeholder"],De=I({__name:"NumberInput",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue","input"],setup(o,{emit:e}){const t=s=>{e("update:modelValue",s.target.value),e("input",s.target.value)};return(s,l)=>(a(),c("div",Yt,[r("label",Zt,w(s.label),1),r("input",{class:"border border-neutral-400 block h-full w-full rounded-md border-2 p-1 pl-2 text-xs",type:"number",value:s.modelValue,placeholder:s.placeholder,onInput:l[0]||(l[0]=i=>t(i))},null,40,eo)]))}}),to={class:"flex"},oo={class:"ml-auto h-6 m-4 w-1/3"},so={class:"ml-auto h-6 m-4 w-1/3"},no={class:"ml-auto h-6 m-4 w-1/3"},ao={class:"my-auto ml-auto h-6 m-4 w-1/3"},lo={class:"flex"},ro=I({__name:"ArticleForm",props:{article:{}},emits:["change"],setup(o,{emit:e}){const t=o,s=p([{text:"Terminé",value:"fnsh"},{text:"Relecture",value:"rvew"},{text:"Idée",value:"idea"}]),l=p([{text:"Livre",value:"book"},{text:"Fiche de lecture",value:"shet"},{text:"Article de média",value:"natc"},{text:"Article de recherche",value:"ratc"},{text:"Film",value:"movi"},{text:"Podcast",value:"pcst"}]),{categories:i}=He(),f=D(()=>i.value.map(g=>({text:g.display_name,value:g.id}))),d=(g,n)=>{let m={...t.article};m[g]=n,e("change",m)};return(g,n)=>(a(),c("div",null,[u(M,{label:"Titre",modelValue:g.article.title,"onUpdate:modelValue":n[0]||(n[0]=m=>d("title",m))},null,8,["modelValue"]),u(M,{class:"h-6",label:"Sous-titre",modelValue:g.article.subtitle,"onUpdate:modelValue":n[1]||(n[1]=m=>d("subtitle",m))},null,8,["modelValue"]),r("div",to,[u(De,{class:"mr-auto h-6",label:"Progression",modelValue:g.article.interaction_progress,"onUpdate:modelValue":n[2]||(n[2]=m=>d("progress",m))},null,8,["modelValue"]),r("div",oo,[u(J,{label:"Catégorie",choices:f.value,"model-value":g.article.category_id,"onUpdate:modelValue":n[3]||(n[3]=m=>d("category_id",m))},null,8,["choices","model-value"])]),r("div",so,[u(J,{label:"Stade d'écriture",choices:s.value,"model-value":g.article.maturing_state,"onUpdate:modelValue":n[4]||(n[4]=m=>d("maturing_state",m))},null,8,["choices","model-value"])]),r("div",no,[u(J,{label:"Type de ressource",choices:l.value,"onUpdate:modelValue":n[5]||(n[5]=m=>d("resource_type",m)),"model-value":g.article.resource_type},null,8,["choices","model-value"])]),r("div",ao,[u(Xt,{class:"mt-3",label:"Externe","onUpdate:modelValue":n[6]||(n[6]=m=>d("is_external",m)),"model-value":g.article.is_external},null,8,["model-value"])])]),r("div",lo,[u(M,{class:"h-6",label:"Lien contenu externe",modelValue:g.article.external_content_url,"onUpdate:modelValue":n[7]||(n[7]=m=>d("external_content_url",m))},null,8,["modelValue"]),u(M,{class:"h-6",label:"Lien image",modelValue:g.article.image_url,"onUpdate:modelValue":n[8]||(n[8]=m=>d("image_url",m))},null,8,["modelValue"])]),u(ee,{label:"Pistes d'amélioration",modelValue:g.article.comment,"onUpdate:modelValue":n[9]||(n[9]=m=>d("comment",m))},null,8,["modelValue"])]))}}),uo={class:"flex flex-wrap"},io=I({__name:"ResourceAuthorPicker",props:{interaction:{},resourceId:{}},emits:["update"],setup(o,{emit:e}){const t=o,s=p(null),l=p([]),i=y=>{if(y)return{text:`${y.first_name} ${y.last_name}`,value:y.id}},f=D(()=>{var y;return(y=s.value)==null?void 0:y.id}),d=D(()=>{if(l.value)return l.value.map(y=>i(y))}),{getUsers:g,getUserById:n}=j(),m=async y=>s.value=await n(y.interaction_user_id),{createInteractionForResource:b,newInteraction:x,createInteraction:F,updateInteraction:T}=_e(),W=async y=>{if(console.log(`newUser : ${JSON.stringify(y)}`),t.interaction){const $={...t.interaction};$.interaction_user_id=y,console.log("newUserid : ",y.id),console.log(`Interaction payload : ${JSON.stringify($)}`),await T(t.interaction.id,$),e("update")}else{console.log("create interaction");const $=x();$.interaction_user_id=y,$.resource_id=t.resourceId,await b(t.resourceId,$),e("update")}},E=async y=>{await T(t.interaction.id,y),e("update")};return L(async()=>{l.value=await g(),await m(t.interaction)}),se(H(t).interaction,async y=>await m(y)),(y,$)=>(a(),c("div",null,[r("div",uo,[u(J,{label:"Auteur",class:"my-auto",choices:d.value,"model-value":f.value,"onUpdate:modelValue":$[0]||($[0]=B=>W(B))},null,8,["choices","model-value"]),y.interaction?(a(),R(M,{key:0,class:"my-auto",label:"Date d'écriture","model-value":y.interaction.interaction_date.split("T")[0],"onUpdate:modelValue":$[1]||($[1]=B=>E({...y.interaction,interaction_date:B})),type:"date"},null,8,["model-value"])):k("",!0),y.interaction?(a(),R(De,{key:1,class:"my-auto",label:"Progression",modelValue:y.interaction.interaction_progress,"onUpdate:modelValue":$[2]||($[2]=B=>E({...y.interaction,interaction_progress:B}))},null,8,["modelValue"])):k("",!0)])]))}}),co={key:0,class:"text-center text-2xl pt-10"},mo={key:1},po={key:0},vo={class:"my-8"},_o=["src"],fo={class:"text-3xl my-3 font-mplus md:text-center text-left"},go={class:"md:text-center text-left"},ho={class:"md:text-center text-left"},yo={class:"md:flex my-8"},bo=["href"],xo={key:1},wo={class:"flex flex-row-reverse"},ko={key:1,class:"p-2 border rounded bg-neutral-100"},$o=r("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Vo={key:2},Ro=r("div",{class:"text-xs italic"},"Commentaire",-1),Co=r("hr",{class:"border-top border-zinc-400 my-4"},null,-1),Io=r("div",{class:"text-xs italic"},"Contenu",-1),Uo={key:3},Do={key:4},So={key:5},Ao={class:"fixed right-3 bottom-5"},To=I({__name:"ResourceComponent",props:{id:{},secondLevel:{type:Boolean}},setup(o){const e=o,t=Je(),s=D(()=>e.secondLevel?"popup_tab":"tab"),l=D(()=>[{text:"Contenu",value:"ctnt"},{text:"Biblio",value:"bbli",count:n.value.length},{text:"Sujets",value:"pblm",count:$.value.length},{text:"Interactions",value:"inpt",count:T.value.length}]),i=p(t.query[s.value]&&typeof t.query[s.value]=="string"?t.query[s.value]:"ctnt"),f=p(t.query[s.value]);se(()=>t.query[s.value],_=>{console.log("new route query",_),typeof _=="string"&&(f.value=_)});const{getResourceRelationsForResource:d,getUsagesForResource:g}=Ie(),n=p([]),m=p(!1),b=p(!1),x=async()=>{n.value=await d(H(e).id.value)},F=D(()=>n.value.map(_=>({resource:_.origin_resource,date:_.created_at,user_id:_.user_id,context_comment:_.relation_comment,progress:null}))),T=p([]),{getInteractionsForResource:W}=_e(),E=async()=>{T.value=await W(e.id)},y=D(()=>T.value.map(_=>({resource:null,date:_.interaction_date,user_id:_.interaction_user_id,context_comment:_.interaction_comment,progress:_.interaction_progress}))),$=p([]),B=async()=>{$.value=await g(e.id)},G=D(()=>$.value.map(_=>({resource:_.target_resource,date:_.created_at,user_id:_.user_id,context_comment:_.relation_comment,progress:null}))),z=p(!1),{newResource:ae,getResource:le,updateResource:Q,getAuthorInteractionForResource:U}=ve(),C=p(null),v=p(ae()),Se=Ke();se(()=>t.query.editing,_=>{console.log("Editing : ",_),re.value=_==="false"?!1:!!_});const re=p(!1),fe=_=>{Se.push({query:{editing:_.toString()}})},Ae=()=>{!v.value||!v.value.id||(v.value.publishing_state="pbsh",Q(v.value.id,v.value))},ue=(_,h)=>{v.value=h,C.value!==null&&clearTimeout(C.value),C.value=setTimeout(async()=>{try{await Q(_,v.value)}catch(ie){console.log("An error : ",ie)}},1e3)},ge=_=>{_!=`
`&&ue(H(e).id.value,{...v.value,content:_})},he=_=>{_!=`
`&&ue(H(e).id.value,{...v.value,comment:_})},{user:ye,getUserById:Te}=j(),X=D(()=>v.value.is_external?!0:ye.value?N.value?N.value.id==ye.value.id:!0:!1),N=p(null),O=p(null),te=p(!1),Be=async()=>{O.value=await U(e.id)},{getCommentsForThoughtOutput:Fe}=Re(),be=p([]);return L(async()=>{z.value=!1,v.value=await le(e.id),z.value=!0,await x(),await E(),await B(),be.value=await Fe(e.id),O.value=await U(e.id),O.value&&(N.value=await Te(O.value.interaction_user_id));const _=t.query.editing;re.value=_==="false"?!1:!!_}),(_,h)=>{const ie=$e("router-link");return a(),c("div",null,[z.value?(a(),c("div",mo,[re.value?(a(),c("div",xo,[u(ro,{article:v.value,onChange:h[0]||(h[0]=V=>ue(v.value.id,V))},null,8,["article"]),u(io,{class:"mx-4",interaction:O.value,"resource-id":_.id,onChange:Be},null,8,["interaction","resource-id"]),r("div",wo,[u(K,{class:"mx-4",onClick:h[1]||(h[1]=V=>fe(!1)),type:"valid",text:"Preview"},{default:S(()=>[Z("Ok")]),_:1}),v.value.publishing_state=="drft"?(a(),R(K,{key:0,onClick:Ae,type:"valid",text:"Publier"})):(a(),c("div",ko,"Publié"))])])):(a(),c("div",po,[r("div",vo,[r("img",{src:v.value.image_url,class:"border border-slate-300 dark:border-zinc-700 rounded-xl ml-auto mr-auto",style:{"max-height":"20rem"}},null,8,_o)]),r("h1",fo,w(v.value.title),1),r("div",go,w(v.value.subtitle),1),r("div",ho,[N.value?(a(),R(ie,{key:0,to:"/users/"+N.value.id,class:"text-sm underline"},{default:S(()=>[Z(w(N.value.first_name)+" "+w(N.value.last_name),1)]),_:1},8,["to"])):k("",!0),O.value?(a(),R(Qt,{key:1,date:O.value.interaction_date},null,8,["date"])):k("",!0)]),r("div",yo,[O.value?(a(),R(Ce,{key:0,"progress-value":O.value.interaction_progress,class:"m-2 w-1/3"},null,8,["progress-value"])):k("",!0),v.value.external_content_url?(a(),c("a",{key:1,class:"ml-auto underline",href:v.value.external_content_url,target:"_blank"}," Lien ressource externe ",8,bo)):k("",!0)])])),r("div",null,[u(ke,{choices:l.value,default:i.value,"url-key":s.value,url:""},null,8,["choices","default","url-key"])]),$o,f.value=="ctnt"?(a(),c("div",Vo,[Ro,v.value.publishing_state!="drft"?(a(),R(de,{key:0,"full-text":v.value.comment,editable:X.value,onChange:h[2]||(h[2]=V=>he(V))},null,8,["full-text","editable"])):(a(),R(ee,{key:1,class:"h-20",label:"Commentaire",modelValue:v.value.comment,"onUpdate:modelValue":h[3]||(h[3]=V=>he(V))},null,8,["modelValue"])),Co,Io,z.value&&!v.value.is_local_draft&&v.value.publishing_state!="drft"?(a(),R(de,{key:2,class:"min-h-fit","ext-comments":be.value,"resource-id":v.value.id,"full-text":v.value.content,editable:X.value,onChange:h[4]||(h[4]=V=>ge(V))},null,8,["ext-comments","resource-id","full-text","editable"])):(a(),R(ee,{key:3,class:"h-96",label:"Contenu",modelValue:v.value.content,"onUpdate:modelValue":h[5]||(h[5]=V=>ge(V))},null,8,["modelValue"])),u(Lt,{"resource-id":_.id},null,8,["resource-id"])])):f.value=="bbli"?(a(),c("div",Uo,[u(oe,{open:m.value,onClose:h[7]||(h[7]=V=>m.value=!1)},{default:S(()=>[u(we,{onRefresh:x,onClose:h[6]||(h[6]=V=>m.value=!1),"target-resource":v.value},null,8,["target-resource"])]),_:1},8,["open"]),r("div",{onClick:h[8]||(h[8]=V=>m.value=!0),class:"text-sm italic underline"}," Ajouter une référence "),u(Y,{"contextual-resources":F.value},null,8,["contextual-resources"])])):f.value=="pblm"?(a(),c("div",Do,[u(Y,{"contextual-resources":G.value},null,8,["contextual-resources"])])):f.value=="inpt"?(a(),c("div",So,[u(Y,{"contextual-resources":y.value},null,8,["contextual-resources"])])):k("",!0),r("div",Ao,[X.value?(a(),R(ce,{key:0,title:"Modifier",onClick:h[9]||(h[9]=V=>fe(!0))},{default:S(()=>[u(q(Qe),{class:"m-1"})]),_:1})):k("",!0),X.value?(a(),R(ce,{key:1,class:"mt-2",color:"red",title:"Marquer comme lu",onClick:h[10]||(h[10]=V=>te.value=!0)},{default:S(()=>[u(q(Ge),{class:"m-1"})]),_:1})):k("",!0),u(oe,{open:te.value,onClose:h[12]||(h[12]=V=>te.value=!1)},{default:S(()=>[u(Gt,{onRefresh:E,onClose:h[11]||(h[11]=V=>te.value=!1),resource:v.value},null,8,["resource"])]),_:1},8,["open"]),X.value?(a(),R(ce,{key:2,class:"mt-2",color:"green",title:"Relier à d'autres ressources",onClick:h[13]||(h[13]=V=>b.value=!0)},{default:S(()=>[u(q(Xe),{class:"m-1"})]),_:1})):k("",!0),u(oe,{open:b.value,onClose:h[15]||(h[15]=V=>b.value=!1)},{default:S(()=>[u(we,{onRefresh:B,onClose:h[14]||(h[14]=V=>b.value=!1),"origin-resource":v.value},null,8,["origin-resource"])]),_:1},8,["open"])])])):(a(),c("div",co,"Loading..."))])}}});export{To as _,lt as a,oe as b,Y as c,ee as d,_e as e,J as f,Qe as r,St as u};
